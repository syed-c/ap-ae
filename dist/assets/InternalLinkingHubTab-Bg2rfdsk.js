import{b as U,u as Z,j as e}from"./chunk-CPh6voF3.js";import{r as i}from"./chunk-CffrGP6S.js";import{B as N,G as J,v as X,x as Y,p as P,Z as I,E as ee,L as S,a2 as se,a3 as ae,a5 as te,a6 as re,a7 as b,I as le,i as m,S as q,C as A,s as o,b as L}from"./index-DflORfjh.js";import{C as l,d as n,a as h,b as u,c as v}from"./chunk-Dwq_v72W.js";import{P as ne}from"./chunk-DSDQubI6.js";import{T as ie,a as ce,b as T,c as _}from"./chunk-k8HiDHrE.js";import{T as de,a as oe,b as z,c,d as xe,e as d}from"./chunk-NLs5Ye4A.js";import{L as y}from"./chunk-B0x3dbdo.js";import{R as me}from"./chunk-BOvFDp2b.js";import{F as he}from"./chunk-BaL04tya.js";import{B as ue}from"./chunk-B_ghW3Ra.js";import{C as ge}from"./chunk-wy0nNZZG.js";import{C as g}from"./chunk-GLPyMM0F.js";import{A as pe}from"./chunk-C2VW2Ml6.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function Ee(){const $=U(),[Q,M]=i.useState("overview"),[p,B]=i.useState(!1),[w,E]=i.useState(!1),[k,V]=i.useState(""),[C,D]=i.useState("all"),[t,G]=i.useState([]),{data:j}=Z({queryKey:["linking-page-stats"],queryFn:async()=>{const[{count:s},{count:a},{count:x},{count:O},{count:r}]=await Promise.all([o.from("seo_pages").select("*",{count:"exact",head:!0}),o.from("blog_posts").select("*",{count:"exact",head:!0}).eq("status","published"),o.from("seo_pages").select("*",{count:"exact",head:!0}).eq("page_type","treatment"),o.from("seo_pages").select("*",{count:"exact",head:!0}).eq("page_type","city"),o.from("seo_pages").select("*",{count:"exact",head:!0}).eq("page_type","neighborhood")]);return{seoPages:s||0,blogPosts:a||0,treatmentPages:x||0,cityPages:O||0,areaPages:r||0,totalPages:(s||0)+(a||0)}}}),R=async()=>{B(!0);try{const{data:s,error:a}=await o.functions.invoke("ai-brain-audit",{body:{action:"linking-audit"}});if(a)throw a;s?.results&&(G(s.results),L.success(`Audit complete! ${s.results.length} pages analyzed.`))}catch(s){L.error(`Audit failed: ${s instanceof Error?s.message:"Unknown error"}`)}finally{B(!1)}},H=async s=>{E(!0);try{const{data:a,error:x}=await o.functions.invoke("ai-brain-audit",{body:{action:"fix-internal-links",scope:s}});if(x)throw x;L.success(`Fixed internal links for ${a?.fixed||0} pages!`),await R()}catch(a){L.error(`Fix failed: ${a instanceof Error?a.message:"Unknown error"}`)}finally{E(!1)}},f=i.useMemo(()=>{if(t.length===0)return null;const s=t.filter(r=>r.orphan).length,a=t.filter(r=>r.score>=80).length,x=t.filter(r=>r.score<40).length,O=Math.round(t.reduce((r,K)=>r+K.score,0)/t.length);return{orphans:s,wellLinked:a,poor:x,avgScore:O,total:t.length}},[t]),F=i.useMemo(()=>t.filter(s=>!(C!=="all"&&s.page_type!==C||k&&!s.page_slug.toLowerCase().includes(k.toLowerCase()))),[t,C,k]),W=s=>s>=80?e.jsxs(m,{className:"bg-green-500/20 text-green-400",children:[s,"%"]}):s>=50?e.jsxs(m,{className:"bg-amber-500/20 text-amber-400",children:[s,"%"]}):e.jsxs(m,{className:"bg-red-500/20 text-red-400",children:[s,"%"]});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-teal/10 via-primary/10 to-purple/10 p-6 border border-teal/20",children:[e.jsxs("div",{className:"absolute inset-0 opacity-20",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 rounded-full bg-teal blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-1/3 w-48 h-48 rounded-full bg-primary blur-3xl"})]}),e.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-display font-bold text-foreground flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gradient-to-br from-teal to-primary flex items-center justify-center",children:e.jsx(y,{className:"h-6 w-6 text-white"})}),"Internal Linking Hub"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Audit, visualize, and auto-fix internal link structures for maximum SEO impact"})]}),e.jsxs(N,{variant:"outline",size:"sm",onClick:()=>$.invalidateQueries({queryKey:["linking-page-stats"]}),children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[{label:"Total Pages",value:j?.totalPages||0,icon:J,color:"text-primary"},{label:"SEO Pages",value:j?.seoPages||0,icon:he,color:"text-teal"},{label:"Blog Posts",value:j?.blogPosts||0,icon:ue,color:"text-purple"},{label:"Services",value:j?.treatmentPages||0,icon:X,color:"text-gold"},{label:"Locations",value:j?.cityPages||0,icon:Y,color:"text-coral"}].map(s=>e.jsx(l,{children:e.jsxs(n,{className:"pt-4 pb-3 flex items-center gap-3",children:[e.jsx(s.icon,{className:`h-8 w-8 ${s.color} opacity-50`}),e.jsxs("div",{children:[e.jsx("p",{className:`text-2xl font-bold ${s.color}`,children:s.value.toLocaleString()}),e.jsx("p",{className:"text-[10px] text-muted-foreground",children:s.label})]})]})},s.label))}),e.jsxs(ie,{value:Q,onValueChange:M,children:[e.jsxs(ce,{className:"grid grid-cols-4 max-w-xl",children:[e.jsxs(T,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(ge,{className:"h-4 w-4"}),"Overview"]}),e.jsxs(T,{value:"audit",className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-4 w-4"}),"Audit"]}),e.jsxs(T,{value:"orphans",className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-4 w-4"}),"Orphan Pages"]}),e.jsxs(T,{value:"autofix",className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-4 w-4"}),"Auto-Fix"]})]}),e.jsx(_,{value:"overview",className:"mt-6 space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-primary"}),"Linking Strategy"]}),e.jsx(v,{children:"How internal linking works on this platform"})]}),e.jsx(n,{className:"space-y-4",children:e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 border-l-4 border-primary",children:[e.jsx("p",{className:"font-medium",children:"Parent Links"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Every page links to its parent (e.g., Area → City → Emirate → Home)"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 border-l-4 border-teal",children:[e.jsx("p",{className:"font-medium",children:"Child Links"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Pages link to their children (e.g., City → Areas within it)"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 border-l-4 border-purple",children:[e.jsx("p",{className:"font-medium",children:"Lateral Links"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"Pages link to 2+ related siblings (e.g., Teeth Whitening → Veneers, Dental Crowns)"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 border-l-4 border-gold",children:[e.jsx("p",{className:"font-medium",children:"Contextual Blocks"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:'"Popular Treatments", "Nearby Areas", "Accepted Insurance" with natural anchor text'})]})]})})]}),e.jsxs(l,{children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-teal"}),"Linking Health"]}),e.jsx(v,{children:"Current internal linking status"})]}),e.jsx(n,{children:f?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{children:"Average Link Score"}),e.jsxs("span",{className:"font-bold",children:[f.avgScore,"%"]})]}),e.jsx(ne,{value:f.avgScore,className:"h-3"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-green-500/10 border border-green-500/20 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-400",children:f.wellLinked}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Well Linked"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-red-500/10 border border-red-500/20 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-400",children:f.orphans}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Orphan Pages"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(y,{className:"h-12 w-12 text-muted-foreground/30 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:"Run an audit to see linking health"}),e.jsxs(N,{onClick:R,disabled:p,variant:"outline",size:"sm",children:[p?e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(P,{className:"h-4 w-4 mr-2"}),"Run Audit"]})]})})]})]})}),e.jsxs(_,{value:"audit",className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(N,{onClick:R,disabled:p,children:[p?e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(P,{className:"h-4 w-4 mr-2"}),p?"Auditing...":"Run Link Audit"]}),e.jsxs(se,{value:C,onValueChange:D,children:[e.jsx(ae,{className:"w-[180px]",children:e.jsx(te,{placeholder:"Filter type"})}),e.jsxs(re,{children:[e.jsx(b,{value:"all",children:"All Types"}),e.jsx(b,{value:"treatment",children:"Services"}),e.jsx(b,{value:"city",children:"Cities"}),e.jsx(b,{value:"neighborhood",children:"Areas"}),e.jsx(b,{value:"blog",children:"Blog"})]})]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(P,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(le,{placeholder:"Search pages...",value:k,onChange:s=>V(s.target.value),className:"pl-10"})]})]}),e.jsxs(m,{variant:"outline",children:[F.length," pages"]})]}),F.length>0?e.jsx(l,{children:e.jsx(n,{className:"pt-4",children:e.jsx(q,{className:"h-[500px]",children:e.jsxs(de,{children:[e.jsx(oe,{children:e.jsxs(z,{children:[e.jsx(c,{children:"Page"}),e.jsx(c,{children:"Type"}),e.jsx(c,{className:"text-center",children:"Outbound"}),e.jsx(c,{className:"text-center",children:"Inbound"}),e.jsx(c,{className:"text-center",children:"Parent"}),e.jsx(c,{className:"text-center",children:"Children"}),e.jsx(c,{className:"text-center",children:"Lateral"}),e.jsx(c,{className:"text-center",children:"Score"})]})}),e.jsx(xe,{children:F.map((s,a)=>e.jsxs(z,{className:s.orphan?"bg-red-500/5":"",children:[e.jsxs(d,{className:"font-medium max-w-[250px] truncate",children:["/",s.page_slug]}),e.jsx(d,{children:e.jsx(m,{variant:"outline",className:"text-xs",children:s.page_type})}),e.jsx(d,{className:"text-center",children:s.outbound_links}),e.jsx(d,{className:"text-center",children:s.inbound_links}),e.jsx(d,{className:"text-center",children:s.has_parent_link?e.jsx(A,{className:"h-4 w-4 text-green-400 mx-auto"}):e.jsx(g,{className:"h-4 w-4 text-red-400 mx-auto"})}),e.jsx(d,{className:"text-center",children:s.has_child_links?e.jsx(A,{className:"h-4 w-4 text-green-400 mx-auto"}):e.jsx(g,{className:"h-4 w-4 text-muted-foreground mx-auto"})}),e.jsx(d,{className:"text-center",children:s.has_lateral_links?e.jsx(A,{className:"h-4 w-4 text-green-400 mx-auto"}):e.jsx(g,{className:"h-4 w-4 text-red-400 mx-auto"})}),e.jsx(d,{className:"text-center",children:W(s.score)})]},a))})]})})})}):e.jsx(l,{className:"border-dashed",children:e.jsxs(n,{className:"py-12 text-center",children:[e.jsx(y,{className:"h-16 w-16 text-muted-foreground/30 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Audit Results"}),e.jsx("p",{className:"text-muted-foreground",children:"Run a link audit to see the internal linking structure of all pages."})]})})]}),e.jsx(_,{value:"orphans",className:"mt-6 space-y-4",children:e.jsxs(l,{children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5 text-coral"}),"Orphan Pages"]}),e.jsx(v,{children:"Pages with no inbound links from other pages on the site. These are invisible to search engines unless they're in the sitemap."})]}),e.jsx(n,{children:t.filter(s=>s.orphan).length>0?e.jsx(q,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-2",children:t.filter(s=>s.orphan).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border border-coral/20 bg-coral/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(g,{className:"h-4 w-4 text-coral"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:["/",s.page_slug]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.page_type," • ",s.outbound_links," outbound links"]})]})]}),e.jsx(m,{variant:"outline",className:"text-coral border-coral/50",children:"Orphan"})]},a))})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(A,{className:"h-12 w-12 text-green-400/50 mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.length>0?"No orphan pages found! All pages have inbound links.":"Run an audit first to detect orphan pages."})]})})]})}),e.jsxs(_,{value:"autofix",className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(l,{className:"border-2 border-teal/20",children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5 text-teal"}),"Fix Orphan Pages"]}),e.jsx(v,{children:"Add contextual internal links to orphan pages using AI-generated anchor text. Links are inserted into relevant content blocks."})]}),e.jsx(n,{children:e.jsxs(N,{onClick:()=>H("orphans"),disabled:w,className:"w-full bg-gradient-to-r from-teal to-primary hover:opacity-90",children:[w?e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(I,{className:"h-4 w-4 mr-2"}),"Fix Orphan Pages"]})})]}),e.jsxs(l,{className:"border-2 border-purple/20",children:[e.jsxs(h,{children:[e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-purple"}),"Full Link Optimization"]}),e.jsx(v,{children:"Analyze all pages and add missing parent, child, and lateral links. Ensures every page follows the linking strategy."})]}),e.jsx(n,{children:e.jsxs(N,{onClick:()=>H("all"),disabled:w,className:"w-full bg-gradient-to-r from-purple to-primary hover:opacity-90",children:[w?e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(y,{className:"h-4 w-4 mr-2"}),"Optimize All Links"]})})]})]}),e.jsxs(l,{children:[e.jsx(h,{children:e.jsx(u,{children:"How Auto-Fix Works"})}),e.jsx(n,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold text-sm",children:"1"}),e.jsx("span",{className:"font-medium text-sm",children:"Detect"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Scans all SEO pages, blog posts, and location pages to map the link graph and identify gaps."})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-teal/20 flex items-center justify-center text-teal font-bold text-sm",children:"2"}),e.jsx("span",{className:"font-medium text-sm",children:"Generate"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"AI generates natural anchor text and identifies the best insertion points within existing content."})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-purple/20 flex items-center justify-center text-purple font-bold text-sm",children:"3"}),e.jsx("span",{className:"font-medium text-sm",children:"Insert"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:'Links are injected into "Related Services", "Nearby Areas", and inline content sections automatically.'})]})]})})]})]})]})]})}export{Ee as default};
