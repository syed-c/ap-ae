import{b as H,u as F,c as X,j as e}from"./chunk-CPh6voF3.js";import{r as f}from"./chunk-CffrGP6S.js";import{L as Y}from"./chunk-Drd-rt-S.js";import{f as J,a0 as P,u as ee,s as g,w as se,B as c,z as O,m as A,t as te,C as q,T as ae,Z as re,p as le,I as ne,a2 as U,a3 as V,a5 as W,a6 as B,a7 as o,S as ie,i as M,P as I,Q,F as de,a9 as ce,aa as oe,ab as me,ac as xe,a8 as he,ad as pe,A as ue,ae as je,b as R}from"./index-DflORfjh.js";import{C as m,d as x}from"./chunk-Dwq_v72W.js";import{S as y}from"./chunk-CQtADEjB.js";import{T as fe,a as ge,b as C}from"./chunk-k8HiDHrE.js";import{A as z,b as E}from"./chunk-Df_5lNy2.js";import{c as Ne}from"./chunk-CyRXX0qx.js";import{C as be}from"./chunk-CbEmr7WL.js";import{a as we,i as K}from"./chunk-CJX3t94M.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-DncHrJ4I.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=J("ArrowUpDown",[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]]);function ye(n,p,r){const l=P(n,r),i=P(p,r);return+l==+i}function Ce(n,p){return ye(n,Ne(n),p)}function Re(){const{user:n}=ee(),p=H(),[r,l]=f.useState("all"),[i,L]=f.useState(""),[a,N]=f.useState(null),[b,k]=f.useState("all"),[_,$]=f.useState("newest"),{data:w,isLoading:Z}=F({queryKey:["dentist-clinic-appointments",n?.id],queryFn:async()=>{const{data:s,error:t}=await g.from("clinics").select("id, name").eq("claimed_by",n?.id).limit(1).single();if(t&&t.code!=="PGRST116")throw t;return s},enabled:!!n?.id}),{data:h,isLoading:G}=F({queryKey:["dentist-all-appointments",w?.id],queryFn:async()=>{const{data:s,error:t}=await g.from("appointments").select("*, treatment:treatments(id, name)").eq("clinic_id",w?.id).order("created_at",{ascending:!1});if(t)throw t;return s},enabled:!!w?.id}),S=X({mutationFn:async({id:s,updates:t})=>{const{data:j}=await g.from("appointments").select("*").eq("id",s).single(),{error:d}=await g.from("appointments").update({...t,updated_at:new Date().toISOString()}).eq("id",s);if(d)throw d;t.status&&j?.status!==t.status&&g.functions.invoke("send-booking-email",{body:{appointmentId:s,type:"status_update",newStatus:t.status}}).catch(console.error)},onSuccess:()=>{p.invalidateQueries({queryKey:["dentist-all-appointments"]}),R.success("Appointment updated"),N(null)},onError:s=>R.error(s.message||"Failed to update")}),v=[...h?.filter(s=>{const t=!i||s.patient_name.toLowerCase().includes(i.toLowerCase())||s.patient_phone.includes(i),j=r==="all"||r==="pending"&&s.status==="pending"||r==="confirmed"&&s.status==="confirmed"||r==="completed"&&s.status==="completed";let d=!0;if(b!=="all"&&s.preferred_date){const T=new Date(s.preferred_date);switch(b){case"today":d=K(T);break;case"tomorrow":d=we(T);break;case"this_week":d=Ce(T);break}}return t&&j&&d})||[]].sort((s,t)=>_==="oldest"?new Date(s.created_at).getTime()-new Date(t.created_at).getTime():_==="date"?s.preferred_date?t.preferred_date?new Date(s.preferred_date).getTime()-new Date(t.preferred_date).getTime():-1:1:new Date(t.created_at).getTime()-new Date(s.created_at).getTime()),u={all:h?.length||0,pending:h?.filter(s=>s.status==="pending").length||0,confirmed:h?.filter(s=>s.status==="confirmed").length||0,completed:h?.filter(s=>s.status==="completed").length||0,today:h?.filter(s=>s.preferred_date&&K(new Date(s.preferred_date))).length||0},D=s=>{switch(s){case"pending":return{label:"Pending",className:"bg-amber-500/10 text-amber-600 border-amber-200"};case"confirmed":return{label:"Confirmed",className:"bg-primary/10 text-primary border-primary/20"};case"completed":return{label:"Completed",className:"bg-emerald-500/10 text-emerald-600 border-emerald-200"};case"cancelled":return{label:"Cancelled",className:"bg-destructive/10 text-destructive border-destructive/20"};default:return{label:"Unknown",className:"bg-muted text-muted-foreground"}}};return Z?e.jsxs("div",{className:"space-y-6",children:[e.jsx(y,{className:"h-20 w-full"}),e.jsx("div",{className:"grid grid-cols-5 gap-4",children:[...Array(5)].map((s,t)=>e.jsx(y,{className:"h-24"},t))}),e.jsx(y,{className:"h-96"})]}):w?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Appointments"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your patient bookings"})]}),e.jsxs(c,{variant:"outline",className:"gap-2",children:[e.jsx(O,{className:"h-4 w-4"}),"Calendar View"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(m,{className:"cursor-pointer bg-gradient-to-br from-slate-900 to-slate-800 border-0 text-white hover:shadow-xl transition-all",onClick:()=>l("all"),children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-xl bg-white/10 flex items-center justify-center",children:e.jsx(A,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:u.all}),e.jsx("p",{className:"text-xs text-slate-300",children:"Total"})]})]})})}),e.jsx(m,{className:"cursor-pointer bg-gradient-to-br from-amber-500 to-amber-600 border-0 text-white hover:shadow-xl transition-all",onClick:()=>l("pending"),children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx(te,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:u.pending}),e.jsx("p",{className:"text-xs text-amber-100",children:"Pending"})]})]})})}),e.jsx(m,{className:"cursor-pointer bg-gradient-to-br from-primary to-teal border-0 text-white hover:shadow-xl transition-all",onClick:()=>l("confirmed"),children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx(q,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:u.confirmed}),e.jsx("p",{className:"text-xs text-teal-100",children:"Confirmed"})]})]})})}),e.jsx(m,{className:"cursor-pointer bg-gradient-to-br from-emerald-500 to-emerald-600 border-0 text-white hover:shadow-xl transition-all",onClick:()=>l("completed"),children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx(ae,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:u.completed}),e.jsx("p",{className:"text-xs text-emerald-100",children:"Completed"})]})]})})}),e.jsx(m,{className:"cursor-pointer bg-gradient-to-br from-coral to-coral/90 border-0 text-white hover:shadow-xl transition-all",onClick:()=>{k("today"),l("all")},children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-11 w-11 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx(re,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:u.today}),e.jsx("p",{className:"text-xs text-coral-light",children:"Today"})]})]})})})]}),e.jsx(m,{className:"card-modern",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(le,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ne,{className:"pl-10 bg-background rounded-xl",placeholder:"Search patients...",value:i,onChange:s=>L(s.target.value)})]}),e.jsxs(U,{value:b,onValueChange:k,children:[e.jsxs(V,{className:"w-[140px] rounded-xl",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),e.jsx(W,{placeholder:"Date"})]}),e.jsxs(B,{children:[e.jsx(o,{value:"all",children:"All Dates"}),e.jsx(o,{value:"today",children:"Today"}),e.jsx(o,{value:"tomorrow",children:"Tomorrow"}),e.jsx(o,{value:"this_week",children:"This Week"})]})]}),e.jsxs(U,{value:_,onValueChange:s=>$(s),children:[e.jsxs(V,{className:"w-[140px] rounded-xl",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),e.jsx(W,{})]}),e.jsxs(B,{children:[e.jsx(o,{value:"newest",children:"Newest"}),e.jsx(o,{value:"oldest",children:"Oldest"}),e.jsx(o,{value:"date",children:"By Date"})]})]}),e.jsx(fe,{value:r,onValueChange:l,className:"ml-auto",children:e.jsxs(ge,{className:"bg-muted/50",children:[e.jsx(C,{value:"all",children:"All"}),e.jsx(C,{value:"pending",children:"Pending"}),e.jsx(C,{value:"confirmed",children:"Confirmed"}),e.jsx(C,{value:"completed",children:"Completed"})]})})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",v.length," appointment",v.length!==1?"s":""]}),(i||b!=="all"||r!=="all")&&e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>{L(""),k("all"),l("all")},children:"Clear Filters"})]}),e.jsx(m,{className:"card-modern overflow-hidden",children:e.jsx(x,{className:"p-0",children:G?e.jsx("div",{className:"p-4 space-y-3",children:[...Array(5)].map((s,t)=>e.jsx(y,{className:"h-20"},t))}):v.length>0?e.jsx(ie,{className:"max-h-[600px]",children:e.jsx("div",{className:"divide-y",children:v.map(s=>{const t=D(s.status);return e.jsxs("div",{className:"flex items-center gap-4 p-4 hover:bg-muted/30 cursor-pointer transition-colors group",onClick:()=>N(s),children:[e.jsx(z,{className:"h-12 w-12 border-2 border-primary/20",children:e.jsx(E,{className:"bg-primary/10 text-primary font-bold",children:s.patient_name.split(" ").map(j=>j[0]).join("").slice(0,2).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("p",{className:"font-semibold text-foreground",children:s.patient_name}),s.treatment&&e.jsx(M,{variant:"secondary",className:"text-xs",children:s.treatment?.name})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),s.patient_phone]}),s.preferred_date&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3"}),Q(new Date(s.preferred_date),"MMM d"),s.preferred_time&&` at ${s.preferred_time}`]})]})]}),e.jsx(M,{className:`${t.className} border`,children:t.label}),e.jsx(de,{className:"h-5 w-5 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]},s.id)})})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"h-16 w-16 rounded-2xl bg-muted/50 flex items-center justify-center mb-4",children:e.jsx(A,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("p",{className:"font-medium mb-1",children:"No appointments found"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Appointments will appear here"})]})})}),e.jsx(ce,{open:!!a,onOpenChange:()=>N(null),children:e.jsxs(oe,{className:"max-w-lg",children:[e.jsxs(me,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-primary"}),"Appointment Details"]}),e.jsx(pe,{children:"View and manage this booking"})]}),a&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{className:"h-14 w-14 border-2 border-primary/20",children:e.jsx(E,{className:"bg-primary/10 text-primary text-lg font-bold",children:a.patient_name.split(" ").map(s=>s[0]).join("").slice(0,2).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:a.patient_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),a.patient_phone]}),a.patient_email&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"h-3 w-3"}),a.patient_email]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-muted/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Requested Date"}),e.jsx("p",{className:"font-medium",children:a.preferred_date?Q(new Date(a.preferred_date),"MMMM d, yyyy"):"Not specified"})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-muted/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Requested Time"}),e.jsx("p",{className:"font-medium",children:a.preferred_time||"Not specified"})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-muted/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Status"}),e.jsx(M,{className:`${D(a.status).className} border`,children:D(a.status).label})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-muted/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Source"}),e.jsx("p",{className:"font-medium capitalize",children:a.source||"Website"})]})]}),a.notes&&e.jsxs("div",{className:"p-3 rounded-xl bg-muted/30",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:"Patient Notes"}),e.jsx("p",{className:"text-sm",children:a.notes})]})]}),e.jsxs(je,{className:"gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>N(null),children:"Close"}),a?.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs(c,{variant:"destructive",onClick:()=>S.mutate({id:a.id,updates:{status:"cancelled"}}),children:[e.jsx(be,{className:"h-4 w-4 mr-1"})," Cancel"]}),e.jsxs(c,{className:"bg-primary",onClick:()=>S.mutate({id:a.id,updates:{status:"confirmed"}}),children:[e.jsx(q,{className:"h-4 w-4 mr-1"})," Confirm"]})]}),a?.status==="confirmed"&&e.jsxs(c,{className:"bg-emerald-600 hover:bg-emerald-700",onClick:()=>S.mutate({id:a.id,updates:{status:"completed"}}),children:[e.jsx(q,{className:"h-4 w-4 mr-1"})," Mark Complete"]})]})]})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"h-20 w-20 rounded-3xl bg-muted/50 flex items-center justify-center mb-6",children:e.jsx(se,{className:"h-10 w-10 text-muted-foreground"})}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Practice Linked"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Claim your profile to start receiving bookings"}),e.jsx(c,{asChild:!0,children:e.jsx(Y,{to:"/claim-profile",children:"Claim Your Profile"})})]})}export{Re as default};
