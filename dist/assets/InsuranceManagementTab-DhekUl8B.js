import{b as M,u as j,c as R,j as e}from"./chunk-CPh6voF3.js";import{r as f}from"./chunk-CffrGP6S.js";import{u as D,s as m,B as N,o as v,w as _,p as H,I as W,b7 as $,C as J,b as q}from"./index-DflORfjh.js";import{C as l,d,a as k,b as A,c as L}from"./chunk-Dwq_v72W.js";import{S as w}from"./chunk-CQtADEjB.js";import{N as O}from"./chunk-BQwaAkM6.js";import{S as U}from"./chunk-C7BdFRQZ.js";import{F as V}from"./chunk-7oaXC-Tp.js";import{C as X}from"./chunk-GLPyMM0F.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-Cq66vzLV.js";import"./chunk-fofMllkR.js";import"./chunk-DSDQubI6.js";import"./chunk-BaL04tya.js";import"./chunk-HAC-i_a2.js";function Ne(){const{user:i}=D(),o=M(),[n,E]=f.useState(""),[c,x]=f.useState(new Set),[y,b]=f.useState(!1),{data:t,isLoading:P}=j({queryKey:["dentist-clinic-insurance",i?.id],queryFn:async()=>{const{data:s,error:a}=await m.from("clinics").select("id, name, claim_status").eq("claimed_by",i?.id).limit(1).single();if(a&&a.code!=="PGRST116")throw a;return s},enabled:!!i?.id}),{data:h,isLoading:B}=j({queryKey:["all-insurances"],queryFn:async()=>{const{data:s,error:a}=await m.from("insurances").select("id, name, slug, logo_url, is_active").eq("is_active",!0).order("name");if(a)throw a;return s}}),{data:Y,isLoading:Q}=j({queryKey:["clinic-insurances",t?.id],queryFn:async()=>{const{data:s,error:a}=await m.from("clinic_insurances").select("insurance_id").eq("clinic_id",t?.id);if(a)throw a;const r=new Set((s||[]).map(g=>g.insurance_id));return x(r),s||[]},enabled:!!t?.id}),z=R({mutationFn:async()=>{if(!t?.id)throw new Error("No clinic found");const{error:s}=await m.from("clinic_insurances").delete().eq("clinic_id",t.id);if(s)throw s;if(c.size>0){const a=Array.from(c).map(g=>({clinic_id:t.id,insurance_id:g})),{error:r}=await m.from("clinic_insurances").insert(a);if(r)throw r}},onSuccess:()=>{o.invalidateQueries({queryKey:["clinic-insurances"]}),q.success("Insurance preferences saved successfully")},onError:s=>q.error(s.message||"Failed to save")}),G=async()=>{b(!0);try{await z.mutateAsync()}finally{b(!1)}},C=s=>{x(a=>{const r=new Set(a);return r.has(s)?r.delete(s):r.add(s),r})},K=()=>{h&&x(new Set(h.map(s=>s.id)))},T=()=>{x(new Set)},S=h?.filter(s=>!n||s.name.toLowerCase().includes(n.toLowerCase())),I=["dha","haad","moh","seha","thiqa","saada"],u=S?.filter(s=>I.some(a=>s.slug.toLowerCase().includes(a))),p=S?.filter(s=>!I.some(a=>s.slug.toLowerCase().includes(a)));return P||B?e.jsxs("div",{className:"space-y-6",children:[e.jsx(w,{className:"h-12 w-64"}),e.jsx(w,{className:"h-64"})]}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold",children:"Accepted Insurances"}),e.jsx("p",{className:"text-muted-foreground",children:"Select the insurance providers your clinic accepts"})]}),e.jsxs(N,{onClick:G,disabled:y,children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),y?"Saving...":"Save Changes"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(l,{className:"bg-slate-900 text-white border-slate-700",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary flex items-center justify-center",children:e.jsx(v,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:c.size}),e.jsx("p",{className:"text-xs text-slate-400",children:"Selected"})]})]})})}),e.jsx(l,{className:"bg-teal text-white border-teal",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx(V,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:h?.length||0}),e.jsx("p",{className:"text-xs text-teal-100",children:"Available"})]})]})})}),e.jsx(l,{className:"bg-gold text-white border-gold",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx(_,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:u?.filter(s=>c.has(s.id)).length||0}),e.jsx("p",{className:"text-xs text-gold-light",children:"Government"})]})]})})})]}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(W,{className:"pl-10",placeholder:"Search insurances...",value:n,onChange:s=>E(s.target.value)})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{variant:"outline",size:"sm",onClick:K,children:"Select All"}),e.jsx(N,{variant:"outline",size:"sm",onClick:T,children:"Clear All"})]})]}),e.jsx(l,{className:"border-blue-200 bg-blue-50",children:e.jsx(d,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(X,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium",children:"Why add insurance information?"}),e.jsx("p",{className:"text-blue-700",children:"Patients often search for dentists that accept their insurance. By listing accepted insurances, your clinic will appear in relevant search results and insurance-specific pages."})]})]})})}),u&&u.length>0&&e.jsxs(l,{children:[e.jsxs(k,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-5 w-5"}),"Government Programs"]}),e.jsx(L,{children:"Government-sponsored insurance programs"})]}),e.jsx(d,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:u.map(s=>e.jsx(F,{insurance:s,isSelected:c.has(s.id),onToggle:()=>C(s.id)},s.id))})})]}),e.jsxs(l,{children:[e.jsxs(k,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(v,{className:"h-5 w-5"}),"Private Insurance Providers"]}),e.jsx(L,{children:"Select all insurance providers your clinic accepts"})]}),e.jsx(d,{children:Q?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[...Array(8)].map((s,a)=>e.jsx(w,{className:"h-16"},a))}):p&&p.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:p.map(s=>e.jsx(F,{insurance:s,isSelected:c.has(s.id),onToggle:()=>C(s.id)},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(v,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No insurances found matching your search"})]})})]})]}):e.jsx(O,{compact:!0})}function F({insurance:i,isSelected:o,onToggle:n}){return e.jsxs("div",{onClick:n,className:`p-4 border rounded-xl cursor-pointer transition-all flex items-center gap-3 ${o?"border-primary bg-primary/5 ring-1 ring-primary":"hover:border-primary/50 hover:bg-muted/50"}`,children:[e.jsx($,{checked:o,onCheckedChange:n,className:"pointer-events-none"}),e.jsx("div",{className:"flex-1 min-w-0",children:i.logo_url?e.jsx("img",{src:i.logo_url,alt:i.name,className:"h-6 object-contain"}):e.jsx("p",{className:"font-medium text-sm truncate",children:i.name})}),o&&e.jsx(J,{className:"h-4 w-4 text-primary flex-shrink-0"})]})}export{Ne as default};
