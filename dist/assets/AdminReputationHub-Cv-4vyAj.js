import{u as P,j as e,b as ae,c as Z}from"./chunk-CPh6voF3.js";import{r as q}from"./chunk-CffrGP6S.js";import{i as y,n as te,bz as U,B as F,L as ue,y as ie,T as he,t as Ke,Q as W,s as f,b as A,p as $e,I as ye,a2 as Re,a3 as Ae,a5 as Ce,a6 as qe,a7 as I,S as oe,w as de,a9 as Ne,aa as be,ab as we,ac as _e,a as z,al as Pe,aK as je,ae as Ee,$ as es,a4 as Ge,C as Ie,o as fe,bA as ss,Z as ts,a8 as as}from"./index-DflORfjh.js";import{T as Qe,a as Ue,b as me,c as Y}from"./chunk-k8HiDHrE.js";import{C as k,d as R,a as M,b as K,c as $}from"./chunk-Dwq_v72W.js";import{P as xe}from"./chunk-DSDQubI6.js";import{S as Q}from"./chunk-CQtADEjB.js";import{A as ze,S as Me,B as Be,a as ns}from"./chunk-C2VW2Ml6.js";import{M as pe}from"./chunk-B7d2qnKb.js";import{T as H}from"./chunk-DbdCK11k.js";import{A as rs}from"./chunk-bmpXwoJk.js";import{L as He}from"./chunk-DR32GIZ2.js";import{T as Fe,a as Le}from"./chunk-BLd3XU4A.js";import{E as Se}from"./chunk-CcezodbN.js";import{s as ge}from"./chunk-aAsotRsv.js";import{c as le}from"./chunk-BSjc5zjM.js";import{F as is}from"./chunk-3oqKMbN4.js";import{C as ls}from"./chunk-GLPyMM0F.js";import{S as se}from"./chunk-DfjE-bP6.js";import{C as cs}from"./chunk-wy0nNZZG.js";import{P as ds}from"./chunk-HAC-i_a2.js";import{F as De}from"./chunk-BaL04tya.js";import{S as os}from"./chunk-B51FxpoB.js";import{R as ve}from"./chunk-BOvFDp2b.js";import{C as ms}from"./chunk-CbEmr7WL.js";import{a as Te}from"./chunk-j7XJPWWF.js";import{D as xs}from"./chunk-z-mlRDN4.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-I1o_Hd8I.js";import"./chunk-CyRXX0qx.js";import"./chunk-DncHrJ4I.js";import"./chunk-CbETxTmt.js";import"./chunk-CedtSHBb.js";import"./chunk-D2X27E5n.js";import"./chunk-Bl7VVhKV.js";import"./chunk-B_ghW3Ra.js";function us({clinicId:l,isAdmin:w}){const[N,_]=q.useState(!1),[d,c]=q.useState(null),{data:m=[],isLoading:p}=P({queryKey:["rep-google-reviews",l],queryFn:async()=>{let a=f.from("google_reviews").select("*, clinic:clinics(id, name)").order("review_time",{ascending:!1}).limit(500);l&&(a=a.eq("clinic_id",l));const{data:j,error:b}=await a;if(b)throw b;return j||[]}}),{data:r=[],isLoading:v}=P({queryKey:["rep-internal-reviews",l],queryFn:async()=>{let a=f.from("internal_reviews").select("*, clinic:clinics(id, name)").order("created_at",{ascending:!1}).limit(500);l&&(a=a.eq("clinic_id",l));const{data:j,error:b}=await a;if(b)throw b;return j||[]}}),{data:n=[],isLoading:h}=P({queryKey:["rep-funnel-events",l],queryFn:async()=>{let a=f.from("review_funnel_events").select("*").order("created_at",{ascending:!1});l&&(a=a.eq("clinic_id",l));const{data:j,error:b}=await a;if(b)throw b;return j||[]}}),{data:D=[]}=P({queryKey:["rep-alerts",l],queryFn:async()=>{const{data:a,error:j}=await f.from("reputation_alerts").select("*").order("created_at",{ascending:!1}).limit(10);return j?[]:a||[]}}),x=q.useMemo(()=>{const j=ge(new Date,30),b=m.length?m.reduce((L,ke)=>L+ke.rating,0)/m.length:0,G=m.filter(L=>new Date(L.review_time||L.created_at)>=j),C=m.filter(L=>L.reply_status!=="posted"),X=r.length?r.reduce((L,ke)=>L+ke.rating,0)/r.length:0,J=r.filter(L=>L.status==="new"),B=n.filter(L=>L.event_type==="thumbs_up").length,ne=n.filter(L=>L.event_type==="thumbs_down").length,O=n.length,ee=O>0?B/O*100:0,re=n.filter(L=>new Date(L.created_at)>=j),ce=re.filter(L=>L.event_type==="thumbs_up").length,t=re.filter(L=>L.event_type==="thumbs_down").length,u=m.filter(L=>L.sentiment_label),g=m.length>0?u.length/m.length*100:0,S=b/5*40,V=Math.min(G.length/20,1)*25,Oe=m.length>0?(m.length-C.length)/m.length*20:10,Ve=O>0?B/O*15:7.5,Ye=Math.round(S+V+Oe+Ve),We=b<4,Ze=C.length>5,Xe=t>ce,Je=(We?30:0)+(Ze?30:0)+(Xe?20:0);return{reputationScore:Ye,riskScore:Je,avgGoogleRating:b,avgInternalRating:X,totalGoogleReviews:m.length,totalInternalReviews:r.length,recentGoogleReviews:G.length,unrepliedCount:C.length,newInternalCount:J.length,thumbsUp:B,thumbsDown:ne,conversionRate:ee,last30Up:ce,last30Down:t,sentimentCoverage:g,activeAlerts:D.filter(L=>L.status!=="resolved").length}},[m,r,n,D]),E=async()=>{_(!0);try{const a={total_google:x.totalGoogleReviews,avg_rating:x.avgGoogleRating,unreplied:x.unrepliedCount,recent_30d:x.recentGoogleReviews,reputation_score:x.reputationScore,risk_score:x.riskScore,funnel_positive:x.thumbsUp,funnel_negative:x.thumbsDown,conversion_rate:x.conversionRate,sentiment_coverage:x.sentimentCoverage,recent_reviews:m.slice(0,20).map(G=>({rating:G.rating,sentiment:G.sentiment_label,replied:G.reply_status==="posted",content_preview:(G.text_content||"").slice(0,100)}))},{data:j,error:b}=await f.functions.invoke("reputation-ai",{body:{action:"overview_insights",reviews_data:a}});if(b)throw b;if(!j.success)throw new Error(j.error);c(j.insights),A.success("AI insights generated")}catch(a){A.error("Failed to generate insights: "+a.message)}finally{_(!1)}};if(p||v||h)return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"grid lg:grid-cols-4 gap-4",children:[...Array(4)].map((a,j)=>e.jsx(Q,{className:"h-32 rounded-xl"},j))}),e.jsx(Q,{className:"h-64 rounded-xl"})]});const o=a=>a>=80?"text-emerald-500":a>=60?"text-primary":a>=40?"text-amber-500":"text-red-500",s=a=>a>=80?"Excellent":a>=60?"Good":a>=40?"Fair":"Needs Attention",i=a=>a>=60?"text-red-500":a>=30?"text-amber-500":"text-emerald-500";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-4 gap-4",children:[e.jsx(k,{className:"bg-gradient-to-br from-primary/10 to-teal/5 border-primary/20",children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/20 flex items-center justify-center",children:e.jsx(ze,{className:"h-6 w-6 text-primary"})}),e.jsx(y,{className:`${x.reputationScore>=60?"bg-emerald-500/20 text-emerald-600":"bg-amber-500/20 text-amber-600"}`,children:s(x.reputationScore)})]}),e.jsx("p",{className:`text-4xl font-bold ${o(x.reputationScore)}`,children:x.reputationScore}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reputation Score"}),e.jsx(xe,{value:x.reputationScore,className:"mt-3 h-2"})]})}),e.jsx(k,{children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-amber-100 flex items-center justify-center",children:e.jsx(te,{className:"h-6 w-6 text-amber-500 fill-amber-500"})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Google"})]}),e.jsx("p",{className:"text-4xl font-bold",children:x.avgGoogleRating?x.avgGoogleRating.toFixed(1):"N/A"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Avg Rating (",x.totalGoogleReviews," reviews)"]}),e.jsx("div",{className:"flex gap-0.5 mt-3",children:[1,2,3,4,5].map(a=>e.jsx(te,{className:`h-4 w-4 ${a<=Math.round(x.avgGoogleRating)?"text-amber-500 fill-amber-500":"text-muted"}`},a))})]})}),e.jsx(k,{className:x.unrepliedCount>5?"border-amber-500/50":"",children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-blue-100 flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-blue-500"})}),x.unrepliedCount>5&&e.jsx(y,{variant:"destructive",className:"text-xs",children:"Action Needed"})]}),e.jsx("p",{className:"text-4xl font-bold",children:x.unrepliedCount}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unreplied Reviews"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[x.newInternalCount," new internal feedback"]})]})}),e.jsx(k,{className:x.riskScore>=30?"border-amber-500/50":"",children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`h-12 w-12 rounded-xl flex items-center justify-center ${x.riskScore>=60?"bg-red-100":x.riskScore>=30?"bg-amber-100":"bg-emerald-100"}`,children:e.jsx(H,{className:`h-6 w-6 ${i(x.riskScore)}`})}),x.activeAlerts>0&&e.jsxs(y,{variant:"destructive",className:"text-xs",children:[x.activeAlerts," Active"]})]}),e.jsxs("p",{className:`text-4xl font-bold ${i(x.riskScore)}`,children:[x.riskScore,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Risk Level"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:x.riskScore>=60?"High risk - immediate action":x.riskScore>=30?"Medium risk - monitor closely":"Low risk - healthy status"})]})})]}),e.jsxs(k,{className:"border-primary/20",children:[e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),"AI Reputation Insights"]}),e.jsx($,{children:"Gemini-powered executive summary and recommendations"})]}),e.jsxs(F,{onClick:E,disabled:N,className:"gap-2",children:[N?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(ie,{className:"h-4 w-4"}),"Generate Insights"]})]})}),e.jsx(R,{children:d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-primary/5 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(rs,{className:"h-5 w-5 text-primary"}),e.jsxs("span",{className:"font-bold text-lg",children:["Health Grade: ",d.health_grade]})]}),e.jsx("p",{className:"text-sm",children:d.executive_summary})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[d.top_strengths?.length>0&&e.jsxs("div",{className:"p-4 rounded-lg border bg-emerald-50/50",children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2 text-emerald-700",children:[e.jsx(he,{className:"h-4 w-4"}),"Top Strengths"]}),e.jsx("ul",{className:"space-y-1",children:d.top_strengths.map((a,j)=>e.jsxs("li",{className:"text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-500 mt-0.5",children:"✓"}),a]},j))})]}),d.top_concerns?.length>0&&e.jsxs("div",{className:"p-4 rounded-lg border bg-amber-50/50",children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2 text-amber-700",children:[e.jsx(H,{className:"h-4 w-4"}),"Top Concerns"]}),e.jsx("ul",{className:"space-y-1",children:d.top_concerns.map((a,j)=>e.jsxs("li",{className:"text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-amber-500 mt-0.5",children:"⚠"}),a]},j))})]})]}),d.quick_wins?.length>0&&e.jsxs("div",{className:"p-4 rounded-lg border",children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4 text-amber-500"}),"Quick Wins"]}),e.jsx("ul",{className:"space-y-1",children:d.quick_wins.map((a,j)=>e.jsxs("li",{className:"text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"→"}),a]},j))})]}),d.competitor_positioning&&e.jsx("p",{className:"text-xs text-muted-foreground italic",children:d.competitor_positioning})]}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(U,{className:"h-10 w-10 mx-auto mb-2 opacity-40"}),e.jsx("p",{children:'Click "Generate Insights" to get AI-powered recommendations'}),e.jsx("p",{className:"text-xs mt-1",children:"Analysis covers ratings, reply rates, sentiment, and trends"})]})})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"h-5 w-5 text-primary"}),"Funnel Performance"]}),e.jsx($,{children:"Review collection funnel stats"})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Fe,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"text-sm",children:"Positive (→ Google)"})]}),e.jsx("span",{className:"font-bold",children:x.thumbsUp})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm",children:"Private Feedback"})]}),e.jsx("span",{className:"font-bold",children:x.thumbsDown})]}),e.jsxs("div",{className:"pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Conversion Rate"}),e.jsxs("span",{className:"font-bold text-primary",children:[x.conversionRate.toFixed(1),"%"]})]}),e.jsx(xe,{value:x.conversionRate,className:"h-2"})]}),e.jsxs("div",{className:"pt-2 text-sm text-muted-foreground",children:["Last 30 days: +",x.last30Up," positive, ",x.last30Down," private"]}),e.jsxs("div",{className:"pt-2 border-t",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"})," AI Coverage"]}),e.jsxs("span",{className:"text-sm font-medium",children:[x.sentimentCoverage.toFixed(0),"%"]})]}),e.jsx(xe,{value:x.sentimentCoverage,className:"h-1.5 mt-1"})]})]})]}),e.jsxs(k,{className:"lg:col-span-2",children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Ke,{className:"h-5 w-5 text-primary"}),"Recent Activity"]}),e.jsx($,{children:"Latest reviews and feedback"})]}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-3",children:[m.slice(0,5).map(a=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/50",children:[e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((j,b)=>e.jsx(te,{className:`h-3 w-3 ${b<a.rating?"text-amber-500 fill-amber-500":"text-muted"}`},b))}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:a.author_name}),e.jsx(y,{variant:"outline",className:"text-xs",children:"Google"}),a.sentiment_label&&e.jsxs(y,{className:`text-xs ${a.sentiment_label==="positive"?"bg-emerald-100 text-emerald-700":a.sentiment_label==="negative"?"bg-red-100 text-red-700":"bg-muted text-muted-foreground"}`,children:[e.jsx(U,{className:"h-2.5 w-2.5 mr-0.5"}),a.sentiment_label]}),a.reply_status!=="posted"&&e.jsx(y,{variant:"destructive",className:"text-xs",children:"Needs Reply"})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1 mt-1",children:a.text_content||"No comment"})]}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:a.review_time?W(new Date(a.review_time),"MMM d"):"N/A"})]},a.id)),m.length===0&&e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Se,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No Google reviews found"})]})]})})]})]})]})}function hs({clinicId:l,isAdmin:w}){const[N,_]=q.useState("all"),[d,c]=q.useState(""),[m,p]=q.useState("all"),[r,v]=q.useState("all"),[n,h]=q.useState(null),[D,x]=q.useState(!1),[E,T]=q.useState(null),o=ae(),{data:s=[],isLoading:i}=P({queryKey:["reviews-google",l],queryFn:async()=>{let t=f.from("google_reviews").select("*, clinic:clinics(id, name, slug)").order("review_time",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:u,error:g}=await t.limit(500);if(g)throw g;return(u||[]).map(S=>({...S,source:"google"}))}}),{data:a=[],isLoading:j}=P({queryKey:["reviews-internal",l],queryFn:async()=>{let t=f.from("internal_reviews").select("*, clinic:clinics(id, name, slug)").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:u,error:g}=await t.limit(500);if(g)throw g;return(u||[]).map(S=>({...S,source:"platform"}))}}),{data:b=[],isLoading:G}=P({queryKey:["reviews-funnel",l],queryFn:async()=>{let t=f.from("review_funnel_events").select("*, clinic:clinics(id, name)").eq("event_type","thumbs_down").order("created_at",{ascending:!1});l&&(t=t.eq("clinic_id",l));const{data:u,error:g}=await t.limit(200);if(g)throw g;return(u||[]).map(S=>({...S,source:"funnel",rating:S.rating||1}))}}),C=q.useMemo(()=>{let t=[];if((N==="all"||N==="google")&&(t=[...t,...s]),(N==="all"||N==="platform")&&(t=[...t,...a]),(N==="all"||N==="funnel")&&(t=[...t,...b]),d){const u=d.toLowerCase();t=t.filter(g=>g.author_name?.toLowerCase().includes(u)||g.patient_name?.toLowerCase().includes(u)||g.text_content?.toLowerCase().includes(u)||g.comment?.toLowerCase().includes(u)||g.clinic?.name?.toLowerCase().includes(u))}if(m!=="all"){const u=parseInt(m);t=t.filter(g=>g.rating===u)}return r!=="all"&&(r==="unreplied"?t=t.filter(u=>u.source==="google"&&u.reply_status!=="posted"):r==="new"?t=t.filter(u=>u.source==="platform"&&u.status==="new"):r==="unanalyzed"&&(t=t.filter(u=>!u.sentiment_label))),t.sort((u,g)=>{const S=new Date(u.review_time||u.created_at);return new Date(g.review_time||g.created_at).getTime()-S.getTime()}),t},[s,a,b,N,d,m,r]),X=async t=>{x(!0);try{const{data:u,error:g}=await f.functions.invoke("generate-ai-reply",{body:{review_id:t.id,review_type:t.source,author_name:t.author_name||t.patient_name,rating:t.rating,text_content:t.text_content||t.comment,clinic_name:t.clinic?.name}});if(g)throw g;A.success("AI reply generated"),o.invalidateQueries({queryKey:["reviews-google"]}),o.invalidateQueries({queryKey:["reviews-internal"]}),h({...t,ai_suggested_reply:u.reply})}catch(u){A.error("Failed to generate reply: "+u.message)}finally{x(!1)}},J=async t=>{const u=t.text_content||t.comment;if(!u){A.error("No review content to analyze");return}T(t.id);try{const{data:g,error:S}=await f.functions.invoke("reputation-ai",{body:{action:"analyze_sentiment",review_id:t.id,review_type:t.source==="platform"?"internal":"google",content:u,clinic_id:t.clinic_id}});if(S)throw S;if(!g.success)throw new Error(g.error);A.success(`Sentiment: ${g.analysis.sentiment_label} (${g.analysis.urgency} urgency)`),o.invalidateQueries({queryKey:["reviews-google"]}),o.invalidateQueries({queryKey:["reviews-internal"]}),h(V=>V?.id===t.id?{...V,sentiment_label:g.analysis.sentiment_label,sentiment_score:g.analysis.sentiment_score,hipaa_flagged:g.analysis.hipaa_flagged,hipaa_flag_reason:g.analysis.hipaa_flag_reason,_ai_analysis:g.analysis}:V)}catch(g){A.error("Sentiment analysis failed: "+g.message)}finally{T(null)}},B=Z({mutationFn:async({id:t,status:u})=>{const{error:g}=await f.from("internal_reviews").update({status:u,updated_at:new Date().toISOString()}).eq("id",t);if(g)throw g;await le({action:"update_review_status",entityType:"internal_review",entityId:t,newValues:{status:u}})},onSuccess:()=>{A.success("Status updated"),o.invalidateQueries({queryKey:["reviews-internal"]}),h(null)},onError:t=>A.error("Failed: "+t.message)}),ne=Z({mutationFn:async({id:t,reason:u})=>{const{error:g}=await f.from("internal_reviews").update({status:"flagged_fake",is_fake_suspected:!0,fake_review_reason:u,updated_at:new Date().toISOString()}).eq("id",t);if(g)throw g;await le({action:"flag_fake_review",entityType:"internal_review",entityId:t,newValues:{is_fake_suspected:!0,fake_review_reason:u}})},onSuccess:()=>{A.success("Review flagged"),o.invalidateQueries({queryKey:["reviews-internal"]}),h(null)},onError:t=>A.error("Failed: "+t.message)}),O=i||j||G,ee=t=>{switch(t){case"google":return e.jsx(y,{className:"bg-blue-100 text-blue-700",children:"Google"});case"platform":return e.jsx(y,{className:"bg-primary/10 text-primary",children:"Platform"});case"funnel":return e.jsx(y,{className:"bg-amber-100 text-amber-700",children:"Private"});default:return e.jsx(y,{variant:"outline",children:t})}},re=t=>{if(t.source==="google")return t.reply_status==="posted"?e.jsx(y,{className:"bg-emerald-100 text-emerald-700",children:"Replied"}):e.jsx(y,{variant:"destructive",children:"Needs Reply"});if(t.source==="platform"){const u={new:"bg-blue-100 text-blue-700",acknowledged:"bg-amber-100 text-amber-700",follow_up:"bg-purple-100 text-purple-700",resolved:"bg-emerald-100 text-emerald-700",flagged_fake:"bg-red-100 text-red-700"};return e.jsx(y,{className:u[t.status]||"bg-muted",children:t.status})}return null},ce=t=>{if(!t.sentiment_label)return null;const u={positive:"bg-emerald-100 text-emerald-700",negative:"bg-red-100 text-red-700",neutral:"bg-muted text-muted-foreground",mixed:"bg-amber-100 text-amber-700"};return e.jsxs(y,{className:u[t.sentiment_label]||"bg-muted",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),t.sentiment_label]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{children:e.jsxs(R,{className:"p-4",children:[e.jsx("div",{className:"flex flex-col lg:flex-row gap-4",children:e.jsx(Qe,{value:N,onValueChange:t=>_(t),className:"flex-1",children:e.jsxs(Ue,{className:"grid w-full grid-cols-4",children:[e.jsxs(me,{value:"all",children:["All (",s.length+a.length+b.length,")"]}),e.jsxs(me,{value:"google",children:["Google (",s.length,")"]}),e.jsxs(me,{value:"platform",children:["Platform (",a.length,")"]}),e.jsxs(me,{value:"funnel",children:["Private (",b.length,")"]})]})})}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"Search reviews...",value:d,onChange:t=>c(t.target.value),className:"pl-9"})]}),e.jsxs(Re,{value:m,onValueChange:p,children:[e.jsx(Ae,{className:"w-[140px]",children:e.jsx(Ce,{placeholder:"Rating"})}),e.jsxs(qe,{children:[e.jsx(I,{value:"all",children:"All Ratings"}),e.jsx(I,{value:"5",children:"5 Stars"}),e.jsx(I,{value:"4",children:"4 Stars"}),e.jsx(I,{value:"3",children:"3 Stars"}),e.jsx(I,{value:"2",children:"2 Stars"}),e.jsx(I,{value:"1",children:"1 Star"})]})]}),e.jsxs(Re,{value:r,onValueChange:v,children:[e.jsx(Ae,{className:"w-[160px]",children:e.jsx(Ce,{placeholder:"Status"})}),e.jsxs(qe,{children:[e.jsx(I,{value:"all",children:"All Status"}),e.jsx(I,{value:"unreplied",children:"Needs Reply"}),e.jsx(I,{value:"new",children:"New Feedback"}),e.jsx(I,{value:"unanalyzed",children:"Not Analyzed"})]})]})]})]})}),e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{children:["Reviews (",C.length,")"]}),e.jsx($,{children:"Unified inbox for all review types"})]}),e.jsx(R,{children:O?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((t,u)=>e.jsx(Q,{className:"h-20 rounded-lg"},u))}):C.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Se,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No reviews found"})]}):e.jsx(oe,{className:"h-[600px]",children:e.jsx("div",{className:"space-y-3 pr-4",children:C.map(t=>e.jsx("div",{onClick:()=>h(t),className:"p-4 rounded-xl border bg-card hover:bg-muted/50 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:`h-10 w-10 rounded-lg flex items-center justify-center font-bold text-white ${t.rating>=4?"bg-emerald-500":t.rating>=3?"bg-amber-500":"bg-red-500"}`,children:t.rating}),e.jsx("div",{className:"flex",children:[...Array(5)].map((u,g)=>e.jsx(te,{className:`h-3 w-3 ${g<t.rating?"text-amber-500 fill-amber-500":"text-muted"}`},g))})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("span",{className:"font-medium",children:t.author_name||t.patient_name||"Anonymous"}),ee(t.source),re(t),ce(t),t.hipaa_flagged&&e.jsx(y,{variant:"destructive",className:"text-xs",children:"HIPAA"}),t.is_fake_suspected&&e.jsx(y,{variant:"destructive",className:"text-xs",children:"Fake"}),w&&t.clinic?.name&&e.jsxs(y,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),t.clinic.name]})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:t.text_content||t.comment||"No comment provided"})]}),e.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[e.jsx("p",{children:W(new Date(t.review_time||t.created_at),"MMM d, yyyy")}),e.jsx("p",{children:W(new Date(t.review_time||t.created_at),"HH:mm")})]})]})},t.id))})})})]}),e.jsx(Ne,{open:!!n,onOpenChange:()=>h(null),children:e.jsx(be,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:n&&e.jsxs(e.Fragment,{children:[e.jsx(we,{children:e.jsxs(_e,{className:"flex items-center gap-2",children:["Review Details",ee(n.source),re(n)]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"flex",children:[...Array(5)].map((t,u)=>e.jsx(te,{className:`h-5 w-5 ${u<n.rating?"text-amber-500 fill-amber-500":"text-muted"}`},u))}),e.jsx("span",{className:"font-medium",children:n.author_name||n.patient_name}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:W(new Date(n.review_time||n.created_at),"PPp")})]}),e.jsx("p",{children:n.text_content||n.comment||"No comment provided"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-primary"}),"AI Sentiment Analysis"]}),e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>J(n),disabled:E===n.id,className:"gap-2",children:[E===n.id?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(U,{className:"h-4 w-4"}),n.sentiment_label?"Re-analyze":"Analyze"]})]}),(n.sentiment_label||n._ai_analysis)&&e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[ce(n),n.sentiment_score!=null&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Score: ",Number(n.sentiment_score).toFixed(2)]}),n.hipaa_flagged&&e.jsxs(y,{variant:"destructive",className:"text-xs gap-1",children:[e.jsx(H,{className:"h-3 w-3"}),"HIPAA Flagged"]})]}),n.hipaa_flag_reason&&e.jsx("p",{className:"text-xs text-red-600",children:n.hipaa_flag_reason}),n._ai_analysis?.key_themes&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:n._ai_analysis.key_themes.map((t,u)=>e.jsx(y,{variant:"outline",className:"text-xs",children:t},u))}),n._ai_analysis?.urgency&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Urgency: ",e.jsx("strong",{children:n._ai_analysis.urgency})]}),n._ai_analysis?.recommended_action&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.jsx("strong",{children:"Recommended:"})," ",n._ai_analysis.recommended_action]})]})]}),(n.source==="google"||n.source==="platform")&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(z,{children:"AI-Suggested Reply"}),e.jsxs(F,{size:"sm",variant:"outline",onClick:()=>X(n),disabled:D,className:"gap-2",children:[e.jsx(ie,{className:`h-4 w-4 ${D?"animate-spin":""}`}),"Generate Reply"]})]}),(n.ai_suggested_reply||n.ai_suggested_response)&&e.jsx(Pe,{value:n.ai_suggested_reply||n.ai_suggested_response,readOnly:!0,className:"min-h-[100px]"})]}),n.source==="platform"&&w&&e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[n.status!=="resolved"&&e.jsxs(F,{onClick:()=>B.mutate({id:n.id,status:"resolved"}),disabled:B.isPending,className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Mark Resolved"]}),n.status==="new"&&e.jsx(F,{variant:"outline",onClick:()=>B.mutate({id:n.id,status:"acknowledged"}),disabled:B.isPending,children:"Acknowledge"}),e.jsxs(F,{variant:"destructive",onClick:()=>ne.mutate({id:n.id,reason:"Flagged by admin"}),disabled:ne.isPending,className:"gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Flag as Fake"]})]})]})]})})})]})}function gs({clinicId:l,isAdmin:w}){const[N,_]=q.useState("pending"),[d,c]=q.useState(null),[m,p]=q.useState(""),[r,v]=q.useState(!1),n=ae(),{data:h=[],isLoading:D}=P({queryKey:["replies-google",l,N],queryFn:async()=>{let s=f.from("google_reviews").select("*, clinic:clinics(id, name, slug, google_place_id)").order("review_time",{ascending:!1});l&&(s=s.eq("clinic_id",l)),N!=="all"&&(s=s.eq("reply_status",N));const{data:i,error:a}=await s.limit(200);if(a)throw a;return i||[]}}),x=async()=>{if(d){v(!0);try{const{data:s,error:i}=await f.functions.invoke("generate-ai-reply",{body:{review_id:d.id,review_type:"google",author_name:d.author_name,rating:d.rating,text_content:d.text_content,clinic_name:d.clinic?.name}});if(i)throw i;p(s.reply),A.success("AI reply generated")}catch(s){A.error("Failed: "+s.message)}finally{v(!1)}}},E=Z({mutationFn:async()=>{const{error:s}=await f.from("google_reviews").update({ai_suggested_reply:m,reply_status:"ready_to_post",updated_at:new Date().toISOString()}).eq("id",d.id);if(s)throw s;await le({action:"save_reply",entityType:"google_review",entityId:d.id,newValues:{reply_status:"ready_to_post"}})},onSuccess:()=>{A.success("Reply saved"),n.invalidateQueries({queryKey:["replies-google"]}),c(null),p("")},onError:s=>A.error("Failed: "+s.message)}),T=Z({mutationFn:async s=>{const{error:i}=await f.from("google_reviews").update({reply_status:"posted",reply_time:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",s);if(i)throw i;await le({action:"mark_reply_posted",entityType:"google_review",entityId:s})},onSuccess:()=>{A.success("Marked as posted"),n.invalidateQueries({queryKey:["replies-google"]})},onError:s=>A.error("Failed: "+s.message)}),o=s=>{const i={pending:{className:"bg-amber-100 text-amber-700",label:"Needs Reply"},ready_to_post:{className:"bg-blue-100 text-blue-700",label:"Ready to Post"},posted:{className:"bg-emerald-100 text-emerald-700",label:"Posted"},failed:{className:"bg-red-100 text-red-700",label:"Failed"}},a=i[s]||i.pending;return e.jsx(y,{className:a.className,children:a.label})};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{children:e.jsxs(R,{className:"p-4 flex items-center gap-4",children:[e.jsxs(Re,{value:N,onValueChange:_,children:[e.jsx(Ae,{className:"w-[180px]",children:e.jsx(Ce,{placeholder:"Filter by status"})}),e.jsxs(qe,{children:[e.jsx(I,{value:"all",children:"All Replies"}),e.jsx(I,{value:"pending",children:"Needs Reply"}),e.jsx(I,{value:"ready_to_post",children:"Ready to Post"}),e.jsx(I,{value:"posted",children:"Posted"})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[h.length," reviews"]})]})}),e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-primary"}),"Reply Operations"]}),e.jsx($,{children:"Manage Google review replies"})]}),e.jsx(R,{children:D?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,i)=>e.jsx(Q,{className:"h-24 rounded-lg"},i))}):h.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(je,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No reviews matching filter"})]}):e.jsx(oe,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-3 pr-4",children:h.map(s=>e.jsx("div",{className:"p-4 rounded-xl border bg-card hover:bg-muted/50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[e.jsx("span",{className:"font-medium",children:s.author_name}),o(s.reply_status),w&&s.clinic?.name&&e.jsxs(y,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),s.clinic.name]})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:s.text_content||"No comment"}),s.ai_suggested_reply&&e.jsxs("div",{className:"p-2 rounded bg-primary/5 border border-primary/20 text-sm",children:[e.jsx("span",{className:"text-xs text-muted-foreground block mb-1",children:"Reply:"}),e.jsx("p",{className:"line-clamp-2",children:s.ai_suggested_reply})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(F,{size:"sm",variant:"outline",onClick:()=>{c(s),p(s.ai_suggested_reply||"")},children:s.reply_status==="pending"?"Compose":"Edit"}),s.reply_status==="ready_to_post"&&e.jsxs(F,{size:"sm",onClick:()=>T.mutate(s.id),disabled:T.isPending,children:[e.jsx(je,{className:"h-4 w-4 mr-1"}),"Posted"]})]})]})},s.id))})})})]}),e.jsx(Ne,{open:!!d,onOpenChange:()=>c(null),children:e.jsx(be,{className:"max-w-xl",children:d&&e.jsxs(e.Fragment,{children:[e.jsx(we,{children:e.jsx(_e,{children:"Compose Reply"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"font-medium",children:d.author_name}),e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:W(new Date(d.review_time),"PPp")})]}),e.jsx("p",{className:"text-sm",children:d.text_content||"No comment"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your Reply"}),e.jsxs(F,{size:"sm",variant:"outline",onClick:x,disabled:r,className:"gap-2",children:[e.jsx(ie,{className:`h-4 w-4 ${r?"animate-spin":""}`}),"AI Generate"]})]}),e.jsx(Pe,{value:m,onChange:s=>p(s.target.value),placeholder:"Type your reply...",className:"min-h-[120px]"})]}),e.jsxs("div",{className:"p-3 rounded-lg bg-amber-50 border border-amber-200 text-sm text-amber-800",children:[e.jsx(ls,{className:"h-4 w-4 inline mr-2"}),"Note: Replies cannot be auto-posted to Google. You must post manually via Google Business Profile."]})]}),e.jsxs(Ee,{children:[e.jsx(F,{variant:"outline",onClick:()=>c(null),children:"Cancel"}),e.jsxs(F,{onClick:()=>E.mutate(),disabled:!m.trim()||E.isPending,className:"gap-2",children:[e.jsx(es,{className:"h-4 w-4"}),"Save Reply"]})]})]})})})]})}function ps({clinicId:l,isAdmin:w}){const N=ae(),{data:_=[],isLoading:d}=P({queryKey:["funnel-events",l],queryFn:async()=>{let r=f.from("review_funnel_events").select("*, clinic:clinics(id, name)").order("created_at",{ascending:!1});l&&(r=r.eq("clinic_id",l));const{data:v,error:n}=await r;if(n)throw n;return v||[]}}),{data:c}=P({queryKey:["funnel-settings",l],queryFn:async()=>{if(l){const{data:v}=await f.from("dentist_settings").select("funnel_enabled, funnel_threshold").eq("clinic_id",l).maybeSingle();return v||{funnel_enabled:!0,funnel_threshold:4}}const{data:r}=await f.from("global_settings").select("value").eq("key","review_funnel_config").maybeSingle();return r?.value||{enabled:!0,threshold:4}}}),m=q.useMemo(()=>{const r=new Date,v=ge(r,30),n=ge(r,7),h=_.length,D=_.filter(C=>C.event_type==="thumbs_up").length,x=_.filter(C=>C.event_type==="thumbs_down").length,E=h>0?D/h*100:0,T=_.filter(C=>new Date(C.created_at)>=v),o=_.filter(C=>new Date(C.created_at)>=n),s=T.filter(C=>C.event_type==="thumbs_up").length,i=T.filter(C=>C.event_type==="thumbs_down").length,a=o.filter(C=>C.event_type==="thumbs_up").length,j=o.filter(C=>C.event_type==="thumbs_down").length,b=new Map;_.forEach(C=>{C.visitor_id&&b.set(C.visitor_id,(b.get(C.visitor_id)||0)+1)});const G=Array.from(b.entries()).filter(([C,X])=>X>10);return{total:h,thumbsUp:D,thumbsDown:x,conversionRate:E,last30Total:T.length,last30Up:s,last30Down:i,last7Total:o.length,last7Up:a,last7Down:j,suspiciousActivity:G.length}},[_]),p=Z({mutationFn:async r=>{if(l){const{error:v}=await f.from("dentist_settings").upsert({clinic_id:l,...r,updated_at:new Date().toISOString()});if(v)throw v}else{const{error:v}=await f.from("global_settings").upsert({key:"review_funnel_config",value:r,updated_at:new Date().toISOString()});if(v)throw v}await le({action:"update_funnel_settings",entityType:"funnel_settings",entityId:l||"global",newValues:r})},onSuccess:()=>{A.success("Settings updated"),N.invalidateQueries({queryKey:["funnel-settings"]})},onError:r=>A.error("Failed: "+r.message)});return d?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid lg:grid-cols-4 gap-4",children:[...Array(4)].map((r,v)=>e.jsx(Q,{className:"h-32 rounded-xl"},v))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid lg:grid-cols-4 gap-4",children:[e.jsx(k,{children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(Ge,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:m.total}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Responses"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last 30 days: ",m.last30Total]})]})}),e.jsx(k,{children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-emerald-100 flex items-center justify-center",children:e.jsx(Fe,{className:"h-5 w-5 text-emerald-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:m.thumbsUp}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirected to Google"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last 7 days: +",m.last7Up]})]})}),e.jsx(k,{children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(Le,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:m.thumbsDown}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Private Feedback"})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Last 7 days: ",m.last7Down]})]})}),e.jsx(k,{children:e.jsxs(R,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(he,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[m.conversionRate.toFixed(1),"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Conversion Rate"})]})]}),e.jsx(xe,{value:m.conversionRate,className:"h-2"})]})})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5 text-primary"}),"Funnel Configuration"]}),e.jsx($,{children:"Control review gating behavior"})]}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Enable Review Funnel"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Route patients through satisfaction check"})]}),e.jsx(se,{checked:c?.funnel_enabled??c?.enabled??!0,onCheckedChange:r=>p.mutate(l?{funnel_enabled:r}:{enabled:r})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Positive Threshold"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ratings at or above this redirect to Google"}),e.jsx(ye,{type:"number",min:1,max:5,value:c?.funnel_threshold??c?.threshold??4,onChange:r=>p.mutate(l?{funnel_threshold:parseInt(r.target.value)}:{threshold:parseInt(r.target.value)}),className:"w-24"})]})]})]}),e.jsxs(k,{className:m.suspiciousActivity>0?"border-amber-500/50":"",children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(H,{className:`h-5 w-5 ${m.suspiciousActivity>0?"text-amber-500":"text-muted-foreground"}`}),"Abuse Detection"]}),e.jsx($,{children:"Monitor for suspicious activity"})]}),e.jsx(R,{children:m.suspiciousActivity>0?e.jsxs("div",{className:"p-4 rounded-lg bg-amber-50 border border-amber-200",children:[e.jsxs("p",{className:"font-medium text-amber-800 mb-2",children:[m.suspiciousActivity," suspicious patterns detected"]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Multiple submissions from same source detected. Review manually."}),w&&e.jsx(F,{variant:"outline",size:"sm",className:"mt-3",children:"View Details"})]}):e.jsxs("div",{className:"p-4 rounded-lg bg-emerald-50 border border-emerald-200",children:[e.jsx("p",{className:"font-medium text-emerald-800",children:"No abuse detected"}),e.jsx("p",{className:"text-sm text-emerald-700",children:"All funnel activity appears legitimate"})]})})]})]}),e.jsxs(k,{children:[e.jsx(M,{children:e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"h-5 w-5 text-primary"}),"Recent Funnel Activity"]})}),e.jsx(R,{children:e.jsxs("div",{className:"space-y-2",children:[_.slice(0,20).map(r=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r.event_type==="thumbs_up"?e.jsx(Fe,{className:"h-4 w-4 text-emerald-500"}):e.jsx(Le,{className:"h-4 w-4 text-red-500"}),e.jsxs("div",{children:[e.jsx(y,{variant:"outline",className:"text-xs",children:r.source}),r.comment&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-1",children:r.comment})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:W(new Date(r.created_at),"MMM d, HH:mm")})]},r.id)),_.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No funnel activity yet"})]})})]})]})}function js({clinicId:l,isAdmin:w}){const[N,_]=q.useState(!1),[d,c]=q.useState(null),[m,p]=q.useState(""),[r,v]=q.useState(""),n=ae(),{data:h=[],isLoading:D}=P({queryKey:["reputation-surveys",l],queryFn:async()=>{const{data:o,error:s}=await f.from("global_settings").select("*").eq("key","survey_templates").maybeSingle();if(s||!o?.value)return[];const i=o.value;return Array.isArray(i)?i:[]}}),{data:x=[]}=P({queryKey:["negative-themes",l],queryFn:async()=>{let o=f.from("review_funnel_events").select("comment, rating, created_at").eq("event_type","thumbs_down").not("comment","is",null).order("created_at",{ascending:!1});l&&(o=o.eq("clinic_id",l));const{data:s,error:i}=await o.limit(50);return i?[]:s||[]}}),E=Z({mutationFn:async()=>{const o={id:d?.id||crypto.randomUUID(),name:m,content:r,is_active:!0,version:d?(d.version||0)+1:1,updated_at:new Date().toISOString(),created_at:d?.created_at||new Date().toISOString()},{data:s}=await f.from("global_settings").select("value").eq("key","survey_templates").maybeSingle(),i=Array.isArray(s?.value)?s.value:[],a=d?i.map(j=>j.id===d.id?{...j,is_active:!1}:j).concat([o]):[...i,o];await f.from("global_settings").upsert({key:"survey_templates",value:a,updated_at:new Date().toISOString()}),await le({action:d?"update_survey":"create_survey",entityType:"survey_template",newValues:o})},onSuccess:()=>{A.success(d?"New version created":"Survey created"),n.invalidateQueries({queryKey:["reputation-surveys"]}),_(!1),c(null),p(""),v("")},onError:o=>A.error("Failed: "+o.message)}),T=o=>{o?(c(o),p(o.name),v(o.content||"")):(c(null),p(""),v("")),_(!0)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"Survey Templates"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage feedback collection surveys"})]}),w&&e.jsxs(F,{onClick:()=>T(),className:"gap-2",children:[e.jsx(ds,{className:"h-4 w-4"}),"New Survey"]})]}),e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-5 w-5 text-primary"}),"Survey Templates"]}),e.jsx($,{children:"Each edit creates a new version for audit tracking"})]}),e.jsx(R,{children:D?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((o,s)=>e.jsx(Q,{className:"h-20 rounded-lg"},s))}):h.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(De,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No survey templates yet"}),w&&e.jsx(F,{variant:"outline",className:"mt-4",onClick:()=>T(),children:"Create First Survey"})]}):e.jsx("div",{className:"space-y-3",children:h.map(o=>e.jsxs("div",{className:"p-4 rounded-xl border bg-card flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:o.name}),e.jsxs(y,{variant:"outline",children:["v",o.version||1]}),o.is_active?e.jsx(y,{className:"bg-emerald-100 text-emerald-700",children:"Active"}):e.jsx(y,{variant:"secondary",children:"Archived"})]}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:o.content||"No content"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Updated ",W(new Date(o.updated_at||o.created_at),"PPp")]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{size:"sm",variant:"ghost",onClick:()=>T(o),children:e.jsx(os,{className:"h-4 w-4"})}),e.jsx(F,{size:"sm",variant:"ghost",children:e.jsx(Se,{className:"h-4 w-4"})})]})]},o.id))})})]}),e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsx(K,{children:"Negative Feedback Themes"}),e.jsx($,{children:"Common issues from private feedback"})]}),e.jsx(R,{children:x.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No negative feedback to analyze"}):e.jsx(oe,{className:"h-[300px]",children:e.jsx("div",{className:"space-y-3 pr-4",children:x.map((o,s)=>e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[o.rating&&e.jsxs(y,{variant:"destructive",className:"text-xs",children:[o.rating,"★"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:W(new Date(o.created_at),"MMM d, yyyy")})]}),e.jsx("p",{className:"text-sm",children:o.comment})]},s))})})})]}),e.jsx(Ne,{open:N,onOpenChange:_,children:e.jsxs(be,{className:"max-w-xl",children:[e.jsx(we,{children:e.jsx(_e,{children:d?"Edit Survey (Creates New Version)":"Create Survey"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Survey Name"}),e.jsx(ye,{value:m,onChange:o=>p(o.target.value),placeholder:"e.g., Post-Visit Satisfaction Survey"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{children:"Questions / Content"}),e.jsx(Pe,{value:r,onChange:o=>v(o.target.value),placeholder:"Enter survey questions or content...",className:"min-h-[200px]"})]}),d&&e.jsxs("div",{className:"p-3 rounded-lg bg-amber-50 border border-amber-200 text-sm text-amber-800",children:[e.jsx(Ke,{className:"h-4 w-4 inline mr-2"}),"Editing creates a new version (v",(d.version||1)+1,"). Previous version will be archived."]})]}),e.jsxs(Ee,{children:[e.jsx(F,{variant:"outline",onClick:()=>_(!1),children:"Cancel"}),e.jsx(F,{onClick:()=>E.mutate(),disabled:!m.trim()||E.isPending,children:d?"Create New Version":"Create Survey"})]})]})})]})}function fs({clinicId:l,isAdmin:w}){const N=ae(),[_,d]=q.useState(!1),[c,m]=q.useState(null),{data:p=[],isLoading:r}=P({queryKey:["risk-google",l],queryFn:async()=>{let i=f.from("google_reviews").select("rating, review_time, reply_status, created_at, text_content, sentiment_label").order("review_time",{ascending:!1});l&&(i=i.eq("clinic_id",l));const{data:a,error:j}=await i.limit(500);if(j)throw j;return a||[]}}),{data:v=[],isLoading:n}=P({queryKey:["risk-funnel",l],queryFn:async()=>{let i=f.from("review_funnel_events").select("event_type, created_at").order("created_at",{ascending:!1});l&&(i=i.eq("clinic_id",l));const{data:a,error:j}=await i.limit(500);if(j)throw j;return a||[]}}),h=q.useMemo(()=>{const i=new Date,a=ge(i,30),j=ge(i,7),b=p.length?p.reduce((S,V)=>S+V.rating,0)/p.length:0,G=p.filter(S=>new Date(S.review_time||S.created_at)>=a),C=G.length?G.reduce((S,V)=>S+V.rating,0)/G.length:b,X=b-C,J=p.filter(S=>S.reply_status!=="posted"),B=J.filter(S=>new Date(S.review_time||S.created_at)<j),ne=v.filter(S=>new Date(S.created_at)>=a),O=ne.filter(S=>S.event_type==="thumbs_down").length,ee=ne.filter(S=>S.event_type==="thumbs_up").length,re=O>ee,t=p.filter(S=>new Date(S.review_time||S.created_at)>=j).length<1,u=[];let g=0;return X>.5?(u.push({id:"rating_drop",label:"Rating Decline",description:`Average rating dropped by ${X.toFixed(1)} stars in 30 days`,severity:"high",score:30}),g+=30):b<4&&(u.push({id:"low_rating",label:"Low Rating",description:`Current average rating is ${b.toFixed(1)} stars`,severity:"medium",score:20}),g+=20),B.length>5?(u.push({id:"slow_replies",label:"Slow Reply Time",description:`${B.length} reviews over 7 days old without replies`,severity:"high",score:25}),g+=25):J.length>10&&(u.push({id:"unreplied",label:"Unreplied Reviews",description:`${J.length} reviews pending replies`,severity:"medium",score:15}),g+=15),re&&(u.push({id:"negative_trend",label:"Negative Sentiment Trend",description:`More negative (${O}) than positive (${ee}) in 30 days`,severity:"medium",score:20}),g+=20),t&&p.length>10&&(u.push({id:"volume_drop",label:"Review Volume Drop",description:"No new reviews in the last 7 days",severity:"low",score:10}),g+=10),g=Math.min(g,100),{riskScore:g,factors:u,avgRating:b,recentAvg:C,unrepliedCount:J.length,negativeCount:O,positiveCount:ee}},[p,v]),D=async()=>{d(!0),m(null);try{const i=p.slice(0,50).map(b=>({rating:b.rating,date:b.review_time||b.created_at,replied:b.reply_status==="posted",sentiment:b.sentiment_label||"unknown",hasContent:!!b.text_content})),{data:a,error:j}=await f.functions.invoke("reputation-ai",{body:{action:"risk_analysis",reviews_data:i,clinic_id:l}});if(j)throw j;if(!a.success)throw new Error(a.error);m(a.analysis),A.success("AI risk analysis complete")}catch(i){A.error("AI risk analysis failed: "+i.message)}finally{d(!1)}},x=()=>{N.invalidateQueries({queryKey:["risk-google"]}),N.invalidateQueries({queryKey:["risk-funnel"]}),A.success("Risk score recalculated")},E=r||n,T=i=>i>=60?{label:"High Risk",color:"text-red-500",bg:"bg-red-100"}:i>=30?{label:"Medium Risk",color:"text-amber-500",bg:"bg-amber-100"}:{label:"Low Risk",color:"text-emerald-500",bg:"bg-emerald-100"},o=i=>{const a={high:"bg-red-100 text-red-700",medium:"bg-amber-100 text-amber-700",low:"bg-blue-100 text-blue-700"};return e.jsx(y,{className:a[i]||"bg-muted",children:i})};if(E)return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{className:"h-48 rounded-xl"}),e.jsx(Q,{className:"h-64 rounded-xl"})]});const s=T(h.riskScore);return e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{className:`border-2 ${h.riskScore>=60?"border-red-500/50":h.riskScore>=30?"border-amber-500/50":"border-emerald-500/50"}`,children:e.jsxs(R,{className:"p-8",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:`h-24 w-24 rounded-2xl ${s.bg} flex items-center justify-center`,children:e.jsx("span",{className:`text-4xl font-bold ${s.color}`,children:h.riskScore})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold mb-1",children:s.label}),e.jsxs("p",{className:"text-muted-foreground",children:[h.factors.length," risk factor",h.factors.length!==1?"s":""," detected"]}),e.jsxs("div",{className:"flex gap-4 mt-3 text-sm",children:[e.jsxs("span",{children:["Avg Rating: ",e.jsx("strong",{children:h.avgRating.toFixed(1)})]}),e.jsxs("span",{children:["Unreplied: ",e.jsx("strong",{children:h.unrepliedCount})]}),e.jsxs("span",{children:["Negative (30d): ",e.jsx("strong",{children:h.negativeCount})]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs(F,{onClick:x,variant:"outline",className:"gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Recalculate"]}),e.jsxs(F,{onClick:D,disabled:_,className:"gap-2",children:[_?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(U,{className:"h-4 w-4"}),"AI Risk Analysis"]})]})]}),e.jsx(xe,{value:h.riskScore,className:"mt-6 h-3"})]})}),c&&e.jsxs(k,{className:"border-primary/30",children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),"AI Risk Assessment"]}),e.jsx($,{children:"Powered by Gemini AI"})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(y,{className:c.overall_risk==="critical"?"bg-red-500 text-white":c.overall_risk==="high"?"bg-red-100 text-red-700":c.overall_risk==="medium"?"bg-amber-100 text-amber-700":"bg-emerald-100 text-emerald-700",children:[c.overall_risk?.toUpperCase()," RISK"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["AI Score: ",c.risk_score,"/100"]})]}),c.risk_factors?.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-sm",children:"AI-Identified Risk Factors"}),c.risk_factors.map((i,a)=>e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(H,{className:`h-4 w-4 ${i.severity==="high"?"text-red-500":"text-amber-500"}`}),e.jsx("span",{className:"font-medium text-sm",children:i.factor}),o(i.severity)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.description}),e.jsxs("p",{className:"text-sm text-primary mt-1",children:["💡 ",i.recommendation]})]},a))]}),c.immediate_actions?.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(He,{className:"h-4 w-4 text-amber-500"}),"Immediate Actions"]}),e.jsx("ul",{className:"space-y-1",children:c.immediate_actions.map((i,a)=>e.jsxs("li",{className:"text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"→"}),i]},a))})]}),c.positive_signals?.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-emerald-500"}),"Positive Signals"]}),e.jsx("ul",{className:"space-y-1",children:c.positive_signals.map((i,a)=>e.jsxs("li",{className:"text-sm flex items-start gap-2",children:[e.jsx("span",{className:"text-emerald-500 mt-0.5",children:"✓"}),i]},a))})]})]})]}),e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-primary"}),"Rule-Based Risk Factors"]}),e.jsx($,{children:"Automated risk detection from review data"})]}),e.jsx(R,{children:h.factors.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"h-12 w-12 mx-auto mb-3 text-emerald-500 opacity-50"}),e.jsx("p",{className:"font-medium text-emerald-600",children:"No risk factors detected"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your reputation is healthy"})]}):e.jsx("div",{className:"space-y-4",children:h.factors.map(i=>e.jsxs("div",{className:"p-4 rounded-xl border bg-card flex items-start gap-4",children:[e.jsx("div",{className:`h-10 w-10 rounded-lg flex items-center justify-center ${i.severity==="high"?"bg-red-100":i.severity==="medium"?"bg-amber-100":"bg-blue-100"}`,children:e.jsx(H,{className:`h-5 w-5 ${i.severity==="high"?"text-red-600":i.severity==="medium"?"text-amber-600":"text-blue-600"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:i.label}),o(i.severity),e.jsxs(y,{variant:"outline",children:["+",i.score," pts"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:i.description})]})]},i.id))})})]}),w&&e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsx(K,{children:"Automated Risk Actions"}),e.jsx($,{children:"Configure automatic responses to risk events"})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Auto-alert on high risk"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send email notification when risk score exceeds 60"})]}),e.jsx(se,{defaultChecked:!0})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Auto-escalate rating drops"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Flag clinics with sudden rating decline for review"})]}),e.jsx(se,{defaultChecked:!0})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Weekly risk digest"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send weekly summary of all high-risk profiles"})]}),e.jsx(se,{})]})]})]})]})}function vs({clinicId:l,isAdmin:w}){const[N,_]=q.useState(""),[d,c]=q.useState(null),{data:m=[],isLoading:p}=P({queryKey:["rep-profiles",l],queryFn:async()=>{let n=f.from("clinics").select("id, name, slug, rating, review_count, is_active, claimed_by").eq("is_active",!0).order("rating",{ascending:!1});l&&(n=n.eq("id",l));const{data:h,error:D}=await n.limit(200);if(D)throw D;return h||[]},enabled:w||!!l}),{data:r}=P({queryKey:["rep-profile-stats",d?.id],queryFn:async()=>{const[n,h,D]=await Promise.all([f.from("google_reviews").select("rating, reply_status").eq("clinic_id",d.id),f.from("internal_reviews").select("rating, status").eq("clinic_id",d.id),f.from("review_funnel_events").select("event_type").eq("clinic_id",d.id)]),x=n.data||[],E=h.data||[],T=D.data||[];return{googleCount:x.length,googleAvg:x.length?x.reduce((o,s)=>o+s.rating,0)/x.length:0,unreplied:x.filter(o=>o.reply_status!=="posted").length,internalCount:E.length,internalNew:E.filter(o=>o.status==="new").length,funnelUp:T.filter(o=>o.event_type==="thumbs_up").length,funnelDown:T.filter(o=>o.event_type==="thumbs_down").length}},enabled:!!d}),v=m.filter(n=>n.name.toLowerCase().includes(N.toLowerCase()));if(!w&&l){const n=m[0];return p?e.jsx(Q,{className:"h-64 rounded-xl"}):n?e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-primary"}),n.name]}),e.jsx($,{children:"Your practice reputation profile"})]}),e.jsx(R,{children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx(te,{className:"h-6 w-6 mx-auto mb-2 text-amber-500"}),e.jsx("p",{className:"text-2xl font-bold",children:n.rating?.toFixed(1)||"N/A"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rating"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx(pe,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),e.jsx("p",{className:"text-2xl font-bold",children:n.review_count||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reviews"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx(fe,{className:"h-6 w-6 mx-auto mb-2 text-emerald-500"}),e.jsx("p",{className:"text-2xl font-bold",children:n.claimed_by?"Yes":"No"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Claimed"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx(he,{className:"h-6 w-6 mx-auto mb-2 text-blue-500"}),e.jsx("p",{className:"text-2xl font-bold",children:"Active"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"})]})]})})]}):e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No profile found"})}return e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{children:e.jsx(R,{className:"p-4",children:e.jsxs("div",{className:"relative",children:[e.jsx($e,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ye,{placeholder:"Search clinics...",value:N,onChange:n=>_(n.target.value),className:"pl-9"})]})})}),e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-primary"}),"Clinic Profiles (",v.length,")"]}),e.jsx($,{children:"Reputation profiles for all clinics"})]}),e.jsx(R,{children:p?e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((n,h)=>e.jsx(Q,{className:"h-20 rounded-lg"},h))}):v.length===0?e.jsx("div",{className:"text-center py-12 text-muted-foreground",children:"No clinics found"}):e.jsx(oe,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-3 pr-4",children:v.map(n=>e.jsx("div",{onClick:()=>c(n),className:"p-4 rounded-xl border bg-card hover:bg-muted/50 cursor-pointer transition-colors",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:n.name}),n.claimed_by&&e.jsx(y,{className:"bg-emerald-100 text-emerald-700",children:"Claimed"})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(te,{className:"h-3 w-3 text-amber-500 fill-amber-500"}),n.rating?.toFixed(1)||"N/A"]}),e.jsxs("span",{children:[n.review_count||0," reviews"]})]})]}),e.jsx(F,{size:"sm",variant:"ghost",children:e.jsx(Se,{className:"h-4 w-4"})})]})},n.id))})})})]}),e.jsx(Ne,{open:!!d,onOpenChange:()=>c(null),children:e.jsx(be,{className:"max-w-lg",children:d&&e.jsxs(e.Fragment,{children:[e.jsx(we,{children:e.jsx(_e,{children:d.name})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.googleCount||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Google Reviews"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.unreplied||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Unreplied"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.funnelUp||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Thumbs Up"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50 text-center",children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.funnelDown||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Private Feedback"})]})]}),w&&e.jsxs("div",{className:"flex gap-2 pt-4 border-t",children:[e.jsxs(F,{variant:"outline",className:"flex-1 gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Lock Automation"]}),e.jsxs(F,{variant:"outline",className:"flex-1 gap-2",children:[e.jsx(H,{className:"h-4 w-4"}),"Add to Watchlist"]})]})]})]})})})]})}function ys({clinicId:l,isAdmin:w}){const N=ae(),[_,d]=q.useState(!1),[c,m]=q.useState(null),{data:p,isLoading:r}=P({queryKey:["ai-module-settings"],queryFn:async()=>{const{data:s,error:i}=await f.from("ai_module_settings").select("*").order("module");return i?[]:s||[]},enabled:!!w}),{data:v=[],isLoading:n}=P({queryKey:["ai-events-recent",l],queryFn:async()=>{let s=f.from("ai_events").select("*").order("created_at",{ascending:!1});l&&(s=s.eq("clinic_id",l));const{data:i,error:a}=await s.limit(50);return a?[]:i||[]}}),h=async()=>{d(!0),m(null);try{const{data:s,error:i}=await f.functions.invoke("reputation-ai",{body:{action:"test_connection"}});if(i)throw i;m(s),s.success?A.success(s.message||"AI connection successful"):A.error(s.error||"AI connection failed")}catch(s){m({success:!1,error:s.message}),A.error("Test failed: "+s.message)}finally{d(!1)}},D=Z({mutationFn:async()=>{const{data:s,error:i}=await f.functions.invoke("reputation-ai",{body:{action:"bulk_sentiment",clinic_id:l}});if(i)throw i;if(!s.success)throw new Error(s.error);return s},onSuccess:s=>{A.success(s.message),N.invalidateQueries({queryKey:["reviews-google"]}),N.invalidateQueries({queryKey:["reviews-internal"]}),N.invalidateQueries({queryKey:["ai-events-recent"]})},onError:s=>A.error("Bulk analysis failed: "+s.message)}),x=Z({mutationFn:async({module:s,enabled:i})=>{const{error:a}=await f.from("ai_module_settings").upsert({module:s,is_enabled:i,updated_at:new Date().toISOString()});if(a)throw a;await le({action:i?"enable_ai_module":"disable_ai_module",entityType:"ai_module",entityId:s})},onSuccess:()=>{A.success("AI module updated"),N.invalidateQueries({queryKey:["ai-module-settings"]})},onError:s=>A.error("Failed: "+s.message)}),E=[{id:"sentiment_analysis",name:"Sentiment Analysis",description:"Analyze review sentiment, themes, and HIPAA concerns using Gemini AI",icon:U},{id:"reply_generation",name:"Reply Generation",description:"Generate professional review replies using Gemini AI",icon:pe},{id:"risk_detection",name:"Risk Detection",description:"AI-powered reputation risk assessment and recommendations",icon:H},{id:"trend_analysis",name:"Trend Analysis",description:"AI trend analysis with predictions and strategic recommendations",icon:he}],T=s=>p?.find(a=>a.module===s)?.is_enabled??!0;return r?e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{className:"h-32 rounded-xl"}),e.jsx(Q,{className:"h-64 rounded-xl"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx(k,{className:c?.success===!1?"border-red-500/50":c?.success?"border-emerald-500/50":"border-primary/30",children:e.jsx(R,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`h-14 w-14 rounded-xl flex items-center justify-center ${c?.success?"bg-emerald-100":c?.success===!1?"bg-red-100":"bg-primary/10"}`,children:e.jsx(ie,{className:`h-7 w-7 ${c?.success?"text-emerald-600":c?.success===!1?"text-red-600":"text-primary"}`})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:["Gemini AI Engine (AIMLAPI)",c?.success&&e.jsx(y,{className:"bg-emerald-100 text-emerald-700",children:"Connected"}),c?.success===!1&&e.jsx(y,{variant:"destructive",children:"Error"}),c===null&&e.jsx(y,{variant:"outline",children:"Not Tested"})]}),e.jsx("p",{className:"text-muted-foreground",children:c?.message||c?.error||"Test the AI connection to verify Gemini is operational"})]})]}),e.jsxs(F,{onClick:h,disabled:_,className:"gap-2",children:[_?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(ss,{className:"h-4 w-4"}),"Test Connection"]})]})})}),e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5 text-primary"}),"AI Quick Actions"]}),e.jsx($,{children:"Run AI operations on your review data"})]}),e.jsx(R,{children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(U,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Bulk Sentiment Analysis"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Analyze up to 10 unanalyzed reviews"})]})]}),e.jsxs(F,{onClick:()=>D.mutate(),disabled:D.isPending,className:"w-full gap-2",children:[D.isPending?e.jsx(ue,{className:"h-4 w-4 animate-spin"}):e.jsx(ie,{className:"h-4 w-4"}),"Run Bulk Analysis"]})]}),e.jsxs("div",{className:"p-4 rounded-xl border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(ve,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Refresh AI Events"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reload latest AI activity log"})]})]}),e.jsxs(F,{variant:"outline",className:"w-full gap-2",onClick:()=>N.invalidateQueries({queryKey:["ai-events-recent"]}),children:[e.jsx(ve,{className:"h-4 w-4"}),"Refresh Activity"]})]})]})})]}),w&&e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5 text-primary"}),"AI Modules"]}),e.jsx($,{children:"Enable or disable specific AI capabilities (all powered by Gemini via AIMLAPI)"})]}),e.jsx(R,{className:"space-y-4",children:E.map(s=>{const i=s.icon,a=T(s.id);return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl border bg-card",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(i,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsx(se,{checked:a,onCheckedChange:j=>x.mutate({module:s.id,enabled:j}),disabled:x.isPending})]},s.id)})})]}),e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsx(K,{children:"Recent AI Activity"}),e.jsx($,{children:"Latest AI operations and results"})]}),e.jsx(R,{children:v.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(U,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No AI activity yet"}),e.jsx("p",{className:"text-sm mt-1",children:"Run a bulk analysis or test the connection to get started"})]}):e.jsx("div",{className:"space-y-3",children:v.slice(0,15).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.status==="completed"?e.jsx(Ie,{className:"h-4 w-4 text-emerald-500"}):s.status==="failed"?e.jsx(ms,{className:"h-4 w-4 text-red-500"}):e.jsx(ze,{className:"h-4 w-4 text-primary animate-pulse"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.event_type.replace(/_/g," ")}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.module})]})]}),e.jsx(y,{variant:"outline",className:"text-xs",children:s.confidence_score?`${(s.confidence_score*100).toFixed(0)}%`:s.status})]},s.id))})})]}),w&&e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsx(K,{children:"AI Safety Rules"}),e.jsx($,{children:"Guardrails for AI operations"})]}),e.jsxs(R,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Require confirmation before posting"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"AI-generated replies must be approved before posting"})]}),e.jsx(se,{defaultChecked:!0,disabled:!0})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Block HIPAA-sensitive content"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatically flag reviews containing PHI"})]}),e.jsx(se,{defaultChecked:!0,disabled:!0})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{children:[e.jsx(z,{children:"Human escalation threshold"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Escalate to human review when confidence < 70%"})]}),e.jsx(se,{defaultChecked:!0,disabled:!0})]})]})]})]})}function Ns({clinicId:l,isAdmin:w}){ae();const{data:N=[],isLoading:_}=P({queryKey:["rep-alerts-derived",l],queryFn:async()=>{const c=[];let m=f.from("google_reviews").select("id, clinic_id, author_name, rating, created_at, clinic:clinics(name)").neq("reply_status","posted").order("created_at",{ascending:!0});l&&(m=m.eq("clinic_id",l));const{data:p}=await m.limit(20),r=new Date;r.setDate(r.getDate()-7),p?.forEach(h=>{new Date(h.created_at)<r&&c.push({id:`unreplied-${h.id}`,type:"slow_reply",severity:"high",title:"Unreplied Review",description:`Review from ${h.author_name} (${h.rating}★) needs reply`,clinic_name:h.clinic?.name,created_at:h.created_at,status:"active"})});let v=f.from("google_reviews").select("id, clinic_id, author_name, rating, created_at, clinic:clinics(name)").lte("rating",2).order("created_at",{ascending:!1});l&&(v=v.eq("clinic_id",l));const{data:n}=await v.limit(10);return n?.forEach(h=>{c.push({id:`low-${h.id}`,type:"low_rating",severity:"medium",title:"Low Rating Alert",description:`${h.rating}★ review from ${h.author_name}`,clinic_name:h.clinic?.name,created_at:h.created_at,status:"active"})}),c.slice(0,50)}}),d=c=>{const m={high:"bg-destructive/10 text-destructive",medium:"bg-amber-100 text-amber-700",low:"bg-blue-100 text-blue-700"};return e.jsx(y,{className:m[c]||"bg-muted",children:c})};return _?e.jsx(Q,{className:"h-64 rounded-xl"}):e.jsx("div",{className:"space-y-6",children:e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-primary"}),"Active Alerts (",N.filter(c=>c.status==="active").length,")"]}),e.jsx($,{children:"Reputation incidents requiring attention"})]}),e.jsx(R,{children:N.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(je,{className:"h-12 w-12 mx-auto mb-3 text-emerald-500 opacity-50"}),e.jsx("p",{className:"font-medium text-emerald-600",children:"No active alerts"}),e.jsx("p",{className:"text-sm",children:"Your reputation is healthy"})]}):e.jsx(oe,{className:"h-[400px]",children:e.jsx("div",{className:"space-y-3 pr-4",children:N.map(c=>e.jsx("div",{className:"p-4 rounded-xl border bg-card",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(H,{className:`h-5 w-5 mt-0.5 ${c.severity==="high"?"text-destructive":"text-amber-500"}`}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-medium",children:c.title}),d(c.severity)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c.description}),w&&c.clinic_name&&e.jsxs(y,{variant:"outline",className:"mt-2 text-xs gap-1",children:[e.jsx(de,{className:"h-3 w-3"}),c.clinic_name]})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:W(new Date(c.created_at),"MMM d")})]})},c.id))})})})]})})}function bs({clinicId:l,isAdmin:w}){const{data:N=[],isLoading:_}=P({queryKey:["rep-audit-logs",l],queryFn:async()=>{const r=["update_review_status","flag_fake_review","save_reply","mark_reply_posted","update_funnel_settings","create_survey","update_survey","enable_ai_module","disable_ai_module"];let v=f.from("audit_logs").select("*").in("action",r).order("created_at",{ascending:!1});const{data:n,error:h}=await v.limit(200);return h?[]:n||[]},enabled:w}),{data:d=[]}=P({queryKey:["rep-dentist-logs",l],queryFn:async()=>{const{data:r}=await f.from("audit_logs").select("*").order("created_at",{ascending:!1}).limit(50);return r||[]},enabled:!w&&!!l}),c=w?N:d,m=r=>r.includes("ai")?e.jsx(y,{className:"bg-purple-100 text-purple-700",children:"AI"}):r.includes("reply")?e.jsx(y,{className:"bg-blue-100 text-blue-700",children:"Reply"}):r.includes("review")?e.jsx(y,{className:"bg-amber-100 text-amber-700",children:"Review"}):r.includes("funnel")?e.jsx(y,{className:"bg-primary/10 text-primary",children:"Funnel"}):e.jsx(y,{variant:"outline",children:r}),p=r=>r.includes("ai")?e.jsx(ie,{className:"h-4 w-4 text-purple-500"}):r.includes("settings")?e.jsx(Me,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(as,{className:"h-4 w-4 text-muted-foreground"});return _?e.jsx(Q,{className:"h-64 rounded-xl"}):e.jsx("div",{className:"space-y-6",children:e.jsxs(k,{children:[e.jsxs(M,{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-primary"}),"Audit Logs"]}),e.jsx($,{children:w?"All reputation-related actions across the platform":"Your recent actions"})]}),e.jsx(R,{children:c.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(Te,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No audit logs found"})]}):e.jsx(oe,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-2 pr-4",children:c.map(r=>e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50 flex items-start gap-3",children:[p(r.action),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[e.jsx("span",{className:"font-medium text-sm",children:r.action.replace(/_/g," ")}),m(r.action)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[r.user_email||"System"," • ",r.entity_type,r.entity_id&&` (${r.entity_id.slice(0,8)}...)`]})]}),e.jsx("span",{className:"text-xs text-muted-foreground whitespace-nowrap",children:W(new Date(r.created_at),"MMM d, HH:mm")})]},r.id))})})})]})})}function ws({clinicId:l,isAdmin:w=!1}){const[N,_]=q.useState("overview"),d=ae(),c=Z({mutationFn:async()=>{const{error:p}=await f.functions.invoke("gmb-import",{body:{action:"sync_reviews",clinicId:l}});if(p)throw p},onSuccess:()=>{A.success("Review sync initiated"),d.invalidateQueries({queryKey:["google-reviews"]}),d.invalidateQueries({queryKey:["reputation-kpis"]})},onError:p=>A.error("Sync failed: "+p.message)}),m=[{id:"overview",label:"Overview",icon:ns},{id:"reviews",label:"Reviews",icon:te},{id:"replies",label:"Replies",icon:pe},{id:"funnel",label:"Funnel",icon:Ge},{id:"surveys",label:"Surveys",icon:De},{id:"risk",label:"Risk",icon:H},{id:"profiles",label:"Profiles",icon:de},{id:"ai",label:"AI",icon:ie},{id:"alerts",label:"Alerts",icon:Be},{id:"logs",label:"Logs",icon:Te}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold text-foreground flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-gradient-to-br from-primary to-teal flex items-center justify-center shadow-lg",children:e.jsx(fe,{className:"h-5 w-5 text-white"})}),"Reputation Intelligence Hub"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:w?"Platform-wide reputation management & governance":"Manage your practice reputation"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(F,{variant:"outline",onClick:()=>c.mutate(),disabled:c.isPending,className:"gap-2",children:[e.jsx(ve,{className:`h-4 w-4 ${c.isPending?"animate-spin":""}`}),"Sync Reviews"]}),e.jsxs(F,{variant:"outline",className:"gap-2",children:[e.jsx(xs,{className:"h-4 w-4"}),"Export"]})]})]}),e.jsxs(Qe,{value:N,onValueChange:_,className:"space-y-6",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Ue,{className:"inline-flex h-12 items-center justify-start rounded-xl bg-muted/50 p-1.5 text-muted-foreground w-auto min-w-full lg:min-w-0",children:m.map(p=>{const r=p.icon;return e.jsxs(me,{value:p.id,className:"inline-flex items-center justify-center whitespace-nowrap rounded-lg px-4 py-2 text-sm font-medium transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm gap-2",children:[e.jsx(r,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:p.label})]},p.id)})})}),e.jsx(Y,{value:"overview",children:e.jsx(us,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"reviews",children:e.jsx(hs,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"replies",children:e.jsx(gs,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"funnel",children:e.jsx(ps,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"surveys",children:e.jsx(js,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"risk",children:e.jsx(fs,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"profiles",children:e.jsx(vs,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"ai",children:e.jsx(ys,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"alerts",children:e.jsx(Ns,{clinicId:l,isAdmin:w})}),e.jsx(Y,{value:"logs",children:e.jsx(bs,{clinicId:l,isAdmin:w})})]})]})}function mt(){return e.jsx(ws,{isAdmin:!0})}export{mt as default};
