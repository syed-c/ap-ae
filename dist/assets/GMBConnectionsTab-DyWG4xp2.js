import{u as E,j as e}from"./chunk-CPh6voF3.js";import{r as v}from"./chunk-CffrGP6S.js";import{B as x,w,C as j,i as C,p as z,I as P,G as k,n as F,s as H}from"./index-DflORfjh.js";import{C as r,d as n,a as Q,b as q,c as K}from"./chunk-Dwq_v72W.js";import{T as U,a as X,b as f,c as o,d as J,e as l}from"./chunk-NLs5Ye4A.js";import{P as V}from"./chunk-DSDQubI6.js";import{S as p}from"./chunk-CQtADEjB.js";import{R as S}from"./chunk-BOvFDp2b.js";import{S as W,A as Y}from"./chunk-C2VW2Ml6.js";import{L as A}from"./chunk-CG1o0-Xj.js";import{C as N}from"./chunk-CbEmr7WL.js";import{T}from"./chunk-DbdCK11k.js";import{f as Z}from"./chunk-CyRXX0qx.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-DncHrJ4I.js";function Ne(){const[b,B]=v.useState(""),[d,u]=v.useState("all"),{data:c=[],isLoading:D,refetch:L}=E({queryKey:["gmb-connections"],queryFn:async()=>{const{data:s,error:t}=await H.from("clinics").select(`
          id, name, slug, google_place_id, gmb_connected, rating, review_count, claim_status, verification_status, is_active, source,
          oauth_tokens:clinic_oauth_tokens(gmb_connected, gmb_location_id, gmb_last_sync_at, gmb_account_email, gmb_data)
        `).order("name").limit(5e4);if(t)throw t;return(s||[]).map(a=>({...a,oauth_tokens:Array.isArray(a.oauth_tokens)?a.oauth_tokens[0]:a.oauth_tokens}))}}),i=c.length,m=c.filter(s=>s.oauth_tokens?.gmb_connected===!0||s.gmb_connected===!0),_=c.filter(s=>s.google_place_id&&!s.oauth_tokens?.gmb_connected&&!s.gmb_connected),y=c.filter(s=>!s.google_place_id&&!s.oauth_tokens?.gmb_connected&&!s.gmb_connected),G=c.filter(s=>{const t=s.oauth_tokens?.gmb_last_sync_at;if(!t)return!1;const a=new Date(t),I=new Date(Date.now()-24*60*60*1e3);return a>=I}),R=c.filter(s=>s.oauth_tokens?.gmb_data?.sync_error),g=i>0?Math.round(m.length/i*100):0,h=c.filter(s=>{const t=s.name.toLowerCase().includes(b.toLowerCase()),a=s.oauth_tokens?.gmb_connected===!0||s.gmb_connected===!0;return d==="connected"?t&&a:d==="disconnected"?t&&!a:t}),O=s=>s.oauth_tokens?.gmb_connected===!0||s.gmb_connected===!0?s.oauth_tokens?.gmb_data?.sync_error?{status:"error",label:"Sync Error",color:"text-coral"}:{status:"connected",label:"OAuth Connected",color:"text-teal"}:s.google_place_id?{status:"imported",label:"Imported (No OAuth)",color:"text-gold"}:{status:"disconnected",label:"Not Linked",color:"text-muted-foreground"},M=s=>{const t=s.oauth_tokens?.gmb_last_sync_at;if(t)try{return Z(new Date(t),{addSuffix:!0})}catch{return"Unknown"}return"Never"};return D?e.jsxs("div",{className:"space-y-6",children:[e.jsx(p,{className:"h-12 w-64"}),e.jsx("div",{className:"grid grid-cols-5 gap-4",children:[1,2,3,4,5].map(s=>e.jsx(p,{className:"h-24"},s))}),e.jsx(p,{className:"h-96"})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text",children:"GMB Connections"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor Google Business Profile sync status across all clinics"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:"outline",onClick:()=>L(),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsxs(x,{children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Sync Settings"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(r,{className:"card-modern bg-gradient-to-br from-primary/10 to-transparent border-primary/20",children:e.jsxs(n,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(w,{className:"h-5 w-5 text-primary"})}),e.jsx("p",{className:"text-3xl font-bold",children:i}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Clinics"})]})}),e.jsx(r,{className:"card-modern bg-gradient-to-br from-teal/10 to-transparent border-teal/20",children:e.jsxs(n,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(j,{className:"h-5 w-5 text-teal"}),e.jsxs(C,{variant:"outline",className:"text-[10px]",children:[g,"%"]})]}),e.jsx("p",{className:"text-3xl font-bold",children:m.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"OAuth Connected"})]})}),e.jsx(r,{className:"card-modern bg-gradient-to-br from-gold/10 to-transparent border-gold/20",children:e.jsxs(n,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(A,{className:"h-5 w-5 text-gold"})}),e.jsx("p",{className:"text-3xl font-bold",children:_.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Imported Only"})]})}),e.jsx(r,{className:"card-modern bg-gradient-to-br from-muted/30 to-transparent border-muted",children:e.jsxs(n,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(N,{className:"h-5 w-5 text-muted-foreground"})}),e.jsx("p",{className:"text-3xl font-bold",children:y.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not Linked"})]})}),e.jsx(r,{className:"card-modern bg-gradient-to-br from-blue-500/10 to-transparent border-blue-500/20",children:e.jsxs(n,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(Y,{className:"h-5 w-5 text-blue-500"})}),e.jsx("p",{className:"text-3xl font-bold",children:G.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Synced (24h)"})]})}),e.jsx(r,{className:"card-modern bg-gradient-to-br from-coral/10 to-transparent border-coral/20",children:e.jsxs(n,{className:"p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx(T,{className:"h-5 w-5 text-coral"})}),e.jsx("p",{className:"text-3xl font-bold",children:R.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sync Errors"})]})})]}),e.jsx(r,{className:"card-modern border-primary/20 bg-gradient-to-r from-primary/5 via-card to-teal/5",children:e.jsxs(n,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-lg",children:"True OAuth Connection Rate"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clinics with active Google Business OAuth tokens (not just imported)"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-4xl font-bold bg-gradient-to-r from-primary to-teal bg-clip-text text-transparent",children:[g,"%"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[m.length," of ",i]})]})]}),e.jsx(V,{value:g,className:"h-3"}),e.jsxs("div",{className:"mt-4 grid grid-cols-3 gap-4 text-center text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-teal",children:m.length}),e.jsx("p",{className:"text-muted-foreground",children:"OAuth Connected"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-gold",children:_.length}),e.jsx("p",{className:"text-muted-foreground",children:"Imported Only"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-muted-foreground",children:y.length}),e.jsx("p",{className:"text-muted-foreground",children:"Not Linked"})]})]})]})}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(P,{placeholder:"Search clinics...",value:b,onChange:s=>B(s.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{variant:d==="all"?"default":"outline",size:"sm",onClick:()=>u("all"),children:["All (",i,")"]}),e.jsxs(x,{variant:d==="connected"?"default":"outline",size:"sm",onClick:()=>u("connected"),className:d==="connected"?"bg-teal hover:bg-teal/90":"",children:[e.jsx(j,{className:"h-4 w-4 mr-1"}),"OAuth (",m.length,")"]}),e.jsxs(x,{variant:d==="disconnected"?"default":"outline",size:"sm",onClick:()=>u("disconnected"),children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),"Not Connected (",i-m.length,")"]})]})]}),e.jsxs(r,{className:"card-modern",children:[e.jsxs(Q,{children:[e.jsxs(q,{className:"text-lg flex items-center gap-2",children:[e.jsx(k,{className:"h-5 w-5 text-primary"}),"Clinic GMB Status"]}),e.jsx(K,{children:"Real-time sync status for all Google Business Profiles"})]}),e.jsxs(n,{className:"p-0",children:[e.jsxs(U,{children:[e.jsx(X,{children:e.jsxs(f,{children:[e.jsx(o,{children:"Clinic"}),e.jsx(o,{children:"GMB Status"}),e.jsx(o,{children:"Rating"}),e.jsx(o,{children:"Reviews"}),e.jsx(o,{children:"Last Sync"}),e.jsx(o,{children:"Claim Status"}),e.jsx(o,{className:"text-right",children:"Actions"})]})}),e.jsxs(J,{children:[h.slice(0,50).map(s=>{const t=O(s);return e.jsxs(f,{children:[e.jsx(l,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(w,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[200px]",children:s.google_place_id||"No GMB ID"})]})]})}),e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.status==="connected"?e.jsx(j,{className:"h-4 w-4 text-teal"}):t.status==="imported"?e.jsx(A,{className:"h-4 w-4 text-gold"}):t.status==="error"?e.jsx(T,{className:"h-4 w-4 text-coral"}):e.jsx(N,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:t.color,children:t.label})]}),s.oauth_tokens?.gmb_account_email&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.oauth_tokens.gmb_account_email})]}),e.jsx(l,{children:s.rating?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4 fill-gold text-gold"}),e.jsx("span",{className:"font-medium",children:s.rating.toFixed(1)})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(l,{children:e.jsx("span",{className:"font-medium",children:s.review_count||0})}),e.jsx(l,{children:e.jsx("span",{className:"text-sm text-muted-foreground",children:M(s)})}),e.jsx(l,{children:e.jsx(C,{variant:s.claim_status==="claimed"?"default":"outline",className:s.claim_status==="claimed"?"bg-teal/20 text-teal border-0":"",children:s.claim_status||"unclaimed"})}),e.jsx(l,{className:"text-right",children:s.google_place_id&&e.jsxs(x,{size:"sm",variant:"outline",children:[e.jsx(S,{className:"h-4 w-4 mr-1"}),"Sync"]})})]},s.id)}),h.length===0&&e.jsx(f,{children:e.jsxs(l,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:[e.jsx(k,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No clinics found matching your criteria"})]})})]})]}),h.length>50&&e.jsx("div",{className:"p-4 text-center border-t",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing 50 of ",h.length," clinics"]})})]})]})]})}export{Ne as default};
