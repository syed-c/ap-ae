import{b as ne,c as ce,j as e,u as V}from"./chunk-CPh6voF3.js";import{r as m}from"./chunk-CffrGP6S.js";import{f as ge,a9 as B,aa as z,ab as H,ac as G,$ as J,ad as ee,a as o,A as se,P as ae,I as F,al as te,B as v,L as oe,s as A,b as D,S as le,i as L,C as $,t as R,m as de,Q as Y,a2 as me,a3 as xe,a5 as he,a6 as pe,a7 as ue,b7 as fe,X as ve,bd as be,u as ye,aj as we,o as Fe}from"./index-DflORfjh.js";import{C as E,d as O}from"./chunk-Dwq_v72W.js";import{S as re}from"./chunk-CQtADEjB.js";import{N as Se}from"./chunk-BQwaAkM6.js";import{R as je,a as X}from"./chunk-DV8-8yGh.js";import{S as Ce}from"./chunk-CzOt8Wyl.js";import{F as C}from"./chunk-BaL04tya.js";import{E as W}from"./chunk-CcezodbN.js";import{S as ke}from"./chunk-DfjE-bP6.js";import{P as Z}from"./chunk-HAC-i_a2.js";import{G as _e}from"./chunk-DqEkDSiw.js";import{T as Me}from"./chunk-BRVan1jG.js";import{S as Pe}from"./chunk-C7BdFRQZ.js";import{T as Ne}from"./chunk-z7Kqt5JR.js";import{A as qe}from"./chunk-oOYeAGgD.js";import{S as Te}from"./chunk-qKgaU6ML.js";import{C as Ee,a as Oe}from"./chunk-j7XJPWWF.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-Cq66vzLV.js";import"./chunk-fofMllkR.js";import"./chunk-DSDQubI6.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const De=ge("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);function Ae({open:b,onOpenChange:N,template:r,clinicId:g,clinicName:f}){const a=ne(),[i,x]=m.useState("email"),[l,h]=m.useState(""),[c,y]=m.useState(""),[M,P]=m.useState(""),[q,u]=m.useState(""),w=()=>{h(""),y(""),P(""),u(""),x("email")},k=ce({mutationFn:async()=>{if(!r)throw new Error("No template selected");const{data:n,error:T}=await A.from("patient_form_submissions").insert({template_id:r.id,clinic_id:g,patient_email:i==="email"?l:null,patient_phone:i==="sms"?c:null,status:"pending"}).select().single();if(T)throw T;const{error:t}=await A.functions.invoke("send-form-request",{body:{submissionId:n.id,templateName:r.name,deliveryMethod:i,patientEmail:i==="email"?l:void 0,patientPhone:i==="sms"?c:void 0,patientName:M||void 0,customMessage:q||void 0,clinicName:f}});if(t)throw t;return n},onSuccess:()=>{D.success("Form request sent successfully!"),a.invalidateQueries({queryKey:["form-submissions"]}),N(!1),w()},onError:n=>{D.error(`Failed to send form: ${n.message}`)}}),I=n=>{if(n.preventDefault(),i==="email"&&!l){D.error("Please enter a patient email");return}if(i==="sms"&&!c){D.error("Please enter a patient phone number");return}k.mutate()};return e.jsx(B,{open:b,onOpenChange:N,children:e.jsxs(z,{className:"sm:max-w-md",children:[e.jsxs(H,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Send Form to Patient"]}),e.jsxs(ee,{children:['Send "',r?.name,'" to a patient via email or SMS']})]}),e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Delivery Method"}),e.jsxs(je,{value:i,onValueChange:n=>x(n),className:"flex gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{value:"email",id:"email"}),e.jsxs(o,{htmlFor:"email",className:"flex items-center gap-1 cursor-pointer font-normal",children:[e.jsx(se,{className:"h-4 w-4"})," Email"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{value:"sms",id:"sms"}),e.jsxs(o,{htmlFor:"sms",className:"flex items-center gap-1 cursor-pointer font-normal",children:[e.jsx(ae,{className:"h-4 w-4"})," SMS"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"patientName",children:"Patient Name (Optional)"}),e.jsx(F,{id:"patientName",placeholder:"John Doe",value:M,onChange:n=>P(n.target.value)})]}),i==="email"?e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"patientEmail",children:"Patient Email *"}),e.jsx(F,{id:"patientEmail",type:"email",placeholder:"patient@example.com",value:l,onChange:n=>h(n.target.value),required:!0})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"patientPhone",children:"Patient Phone *"}),e.jsx(F,{id:"patientPhone",type:"tel",placeholder:"+971 50 123 4567",value:c,onChange:n=>y(n.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"customMessage",children:"Custom Message (Optional)"}),e.jsx(te,{id:"customMessage",placeholder:"Please complete this form before your appointment...",value:q,onChange:n=>u(n.target.value),rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(v,{type:"button",variant:"outline",onClick:()=>{N(!1),w()},children:"Cancel"}),e.jsx(v,{type:"submit",disabled:k.isPending,children:k.isPending?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Send Form"]})})]})]})]})})}function Le({open:b,onOpenChange:N,submission:r}){if(!r)return null;const g=r.template,f=r.form_data||{},a=Array.isArray(g?.fields)?g.fields:[],i=l=>a.find(c=>c.name===l)?.label||l,x=(l,h)=>{if(l==null)return"â€”";const c=a.find(y=>y.name===h);if(typeof l=="boolean")return l?"Yes":"No";if(Array.isArray(l))return l.join(", ");if(c?.type==="date"&&l)try{return Y(new Date(l),"MMM d, yyyy")}catch{return l}return String(l)};return e.jsx(B,{open:b,onOpenChange:N,children:e.jsxs(z,{className:"sm:max-w-lg max-h-[85vh]",children:[e.jsx(H,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Form Submission Details"]})}),e.jsx(le,{className:"max-h-[60vh] pr-4",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsxs(L,{variant:r.status==="completed"?"default":"secondary",className:"flex items-center gap-1",children:[r.status==="completed"?e.jsx($,{className:"h-3 w-3"}):e.jsx(R,{className:"h-3 w-3"}),r.status]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Form"}),e.jsx("span",{className:"font-medium",children:g?.name||"Unknown Form"})]}),r.patient_email&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(se,{className:"h-3 w-3"})," Email"]}),e.jsx("span",{className:"font-medium",children:r.patient_email})]}),r.patient_phone&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ae,{className:"h-3 w-3"})," Phone"]}),e.jsx("span",{className:"font-medium",children:r.patient_phone})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(de,{className:"h-3 w-3"})," Sent"]}),e.jsx("span",{className:"text-sm",children:Y(new Date(r.created_at),"MMM d, yyyy h:mm a")})]}),r.submitted_at&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx($,{className:"h-3 w-3"})," Submitted"]}),e.jsx("span",{className:"text-sm",children:Y(new Date(r.submitted_at),"MMM d, yyyy h:mm a")})]})]}),e.jsx(Ce,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-sm uppercase tracking-wide text-muted-foreground",children:"Responses"}),r.status==="pending"?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(R,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Awaiting patient submission"})]}):Object.keys(f).length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No responses recorded"})]}):e.jsx("div",{className:"space-y-3",children:Object.entries(f).map(([l,h])=>e.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:i(l)}),e.jsx("p",{className:"text-foreground",children:x(h,l)})]},l))})]})]})})]})})}function Ie({open:b,onOpenChange:N,template:r}){if(!r)return null;const g=Array.isArray(r.fields)?r.fields:[],f=(a,i)=>{const x=a.required;switch(a.type){case"text":case"email":case"tel":case"number":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-1",children:[a.label,x&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(F,{type:a.type,placeholder:a.placeholder||`Enter ${a.label.toLowerCase()}`,disabled:!0,className:"bg-muted/30"})]},a.name||i);case"textarea":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-1",children:[a.label,x&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(te,{placeholder:a.placeholder||`Enter ${a.label.toLowerCase()}`,disabled:!0,className:"bg-muted/30",rows:3})]},a.name||i);case"date":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-1",children:[a.label,x&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(F,{type:"date",disabled:!0,className:"bg-muted/30"})]},a.name||i);case"checkbox":return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{disabled:!0}),e.jsxs(o,{className:"font-normal cursor-not-allowed text-muted-foreground",children:[a.label,x&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]})]},a.name||i);case"radio":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-1",children:[a.label,x&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(je,{disabled:!0,className:"flex flex-col gap-2",children:(a.options||[]).map((l,h)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(X,{value:l,disabled:!0}),e.jsx(o,{className:"font-normal cursor-not-allowed text-muted-foreground",children:l})]},h))})]},a.name||i);case"select":return e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-1",children:[a.label,x&&e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsxs(me,{disabled:!0,children:[e.jsx(xe,{className:"bg-muted/30",children:e.jsx(he,{placeholder:`Select ${a.label.toLowerCase()}`})}),e.jsx(pe,{children:(a.options||[]).map((l,h)=>e.jsx(ue,{value:l,children:l},h))})]})]},a.name||i);default:return e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:a.label}),e.jsx(F,{disabled:!0,className:"bg-muted/30",placeholder:"Unknown field type"})]},a.name||i)}};return e.jsx(B,{open:b,onOpenChange:N,children:e.jsxs(z,{className:"sm:max-w-lg max-h-[85vh]",children:[e.jsxs(H,{children:[e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Form Preview"]}),e.jsx(ee,{children:"This is how patients will see the form"})]}),e.jsxs("div",{className:"bg-muted/30 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(C,{className:"h-6 w-6 text-primary"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:r.name}),r.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:r.description})]})]}),e.jsx("div",{className:"mt-2",children:e.jsxs(L,{variant:"secondary",children:[g.length," fields"]})})]}),e.jsx(le,{className:"max-h-[50vh] pr-4",children:e.jsx("div",{className:"space-y-6",children:g.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(C,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"No fields defined for this form"})]}):g.map((a,i)=>f(a,i))})})]})})}const U=[{value:"text",label:"Short Text",icon:Ne},{value:"textarea",label:"Long Text",icon:qe},{value:"email",label:"Email",icon:se},{value:"phone",label:"Phone",icon:ae},{value:"number",label:"Number",icon:De},{value:"date",label:"Date",icon:de},{value:"checkbox",label:"Checkboxes",icon:Te},{value:"radio",label:"Multiple Choice",icon:be},{value:"select",label:"Dropdown",icon:C}],$e=[{value:"medical_history",label:"Medical History"},{value:"consent",label:"Consent Form"},{value:"insurance",label:"Insurance Info"},{value:"custom",label:"Custom Form"}];function Re({open:b,onOpenChange:N,clinicId:r}){const g=ne(),[f,a]=m.useState(""),[i,x]=m.useState(""),[l,h]=m.useState("custom"),[c,y]=m.useState([]),[M,P]=m.useState(!1),q=()=>Math.random().toString(36).substr(2,9),u=s=>{const d={id:q(),label:"",type:s,required:!1,options:["checkbox","radio","select"].includes(s)?["Option 1","Option 2"]:void 0,placeholder:""};y([...c,d]),P(!1)},w=(s,d)=>{y(c.map(j=>j.id===s?{...j,...d}:j))},k=s=>{y(c.filter(d=>d.id!==s))},I=s=>{const d=c.find(j=>j.id===s);d?.options&&w(s,{options:[...d.options,`Option ${d.options.length+1}`]})},n=(s,d,j)=>{const p=c.find(S=>S.id===s);if(p?.options){const S=[...p.options];S[d]=j,w(s,{options:S})}},T=(s,d)=>{const j=c.find(p=>p.id===s);if(j?.options&&j.options.length>1){const p=j.options.filter((S,Q)=>Q!==d);w(s,{options:p})}},t=ce({mutationFn:async()=>{if(!f.trim())throw new Error("Form name is required");if(c.length===0)throw new Error("Add at least one field");if(c.some(d=>!d.label.trim()))throw new Error("All fields must have a label");const{error:s}=await A.from("intake_form_templates").insert([{clinic_id:r,name:f,description:i,form_type:l,fields:c,is_active:!0}]);if(s)throw s},onSuccess:()=>{D.success("Form template created"),g.invalidateQueries({queryKey:["intake-templates",r]}),N(!1),_()},onError:s=>{D.error(s.message||"Failed to create form")}}),_=()=>{a(""),x(""),h("custom"),y([])},K=s=>U.find(j=>j.value===s)?.icon||Ne;return e.jsx(B,{open:b,onOpenChange:N,children:e.jsxs(z,{className:"max-w-3xl max-h-[90vh] overflow-hidden bg-slate-900 border-slate-700",children:[e.jsxs(H,{children:[e.jsxs(G,{className:"text-white flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5 text-primary"}),"Create Custom Form"]}),e.jsx(ee,{className:"text-white/60",children:"Build a custom intake form for your patients"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-white/80",children:"Form Name *"}),e.jsx(F,{value:f,onChange:s=>a(s.target.value),placeholder:"e.g., New Patient Intake",className:"bg-slate-800 border-slate-600 text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-white/80",children:"Description"}),e.jsx(te,{value:i,onChange:s=>x(s.target.value),placeholder:"Brief description of this form...",className:"bg-slate-800 border-slate-600 text-white resize-none",rows:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-white/80",children:"Form Type"}),e.jsxs(me,{value:l,onValueChange:h,children:[e.jsx(xe,{className:"bg-slate-800 border-slate-600 text-white",children:e.jsx(he,{})}),e.jsx(pe,{className:"bg-slate-800 border-slate-600",children:$e.map(s=>e.jsx(ue,{value:s.value,className:"text-white hover:bg-slate-700",children:s.label},s.value))})]})]}),e.jsxs("div",{className:"relative",children:[e.jsxs(v,{variant:"outline",onClick:()=>P(!M),className:"w-full gap-2 bg-slate-800 border-slate-600 text-white hover:bg-slate-700 border-dashed",children:[e.jsx(Z,{className:"h-4 w-4"}),"Add Field"]}),M&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 p-2 bg-slate-800 border border-slate-600 rounded-lg shadow-lg z-10 grid grid-cols-3 gap-2",children:U.map(s=>{const d=s.icon;return e.jsxs("button",{onClick:()=>u(s.value),className:"flex flex-col items-center gap-1 p-2 rounded-lg hover:bg-slate-700 transition-colors text-white/80 hover:text-white",children:[e.jsx(d,{className:"h-5 w-5"}),e.jsx("span",{className:"text-[10px]",children:s.label})]},s.value)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"text-white/80",children:["Form Fields (",c.length,")"]}),e.jsx(le,{className:"h-[350px] border border-slate-700 rounded-lg p-3 bg-slate-800/50",children:c.length===0?e.jsx("div",{className:"h-full flex items-center justify-center text-white/40 text-sm",children:e.jsxs("div",{className:"text-center",children:[e.jsx(C,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No fields yet"}),e.jsx("p",{className:"text-xs mt-1",children:'Click "Add Field" to start'})]})}):e.jsx("div",{className:"space-y-3",children:c.map((s,d)=>{const j=K(s.type);return e.jsxs("div",{className:"p-3 rounded-lg border border-slate-600 bg-slate-800 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4 text-white/30 cursor-move"}),e.jsxs(L,{variant:"outline",className:"text-xs border-primary/30 text-primary",children:[e.jsx(j,{className:"h-3 w-3 mr-1"}),U.find(p=>p.value===s.type)?.label]}),e.jsx("div",{className:"flex-1"}),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6 text-coral hover:text-coral hover:bg-coral/10",onClick:()=>k(s.id),children:e.jsx(Me,{className:"h-3 w-3"})})]}),e.jsx(F,{value:s.label,onChange:p=>w(s.id,{label:p.target.value}),placeholder:"Field label",className:"bg-slate-900 border-slate-600 text-white h-8 text-sm"}),!["checkbox","radio","select"].includes(s.type)&&e.jsx(F,{value:s.placeholder||"",onChange:p=>w(s.id,{placeholder:p.target.value}),placeholder:"Placeholder text (optional)",className:"bg-slate-900 border-slate-600 text-white h-8 text-sm"}),["checkbox","radio","select"].includes(s.type)&&e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-white/50",children:"Options:"}),s.options?.map((p,S)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{value:p,onChange:Q=>n(s.id,S,Q.target.value),className:"bg-slate-900 border-slate-600 text-white h-7 text-xs flex-1"}),e.jsx(v,{variant:"ghost",size:"icon",className:"h-6 w-6 text-white/40 hover:text-coral",onClick:()=>T(s.id,S),children:e.jsx(ve,{className:"h-3 w-3"})})]},S)),e.jsxs(v,{variant:"ghost",size:"sm",className:"text-xs text-primary hover:text-primary h-7",onClick:()=>I(s.id),children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),"Add Option"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{checked:s.required,onCheckedChange:p=>w(s.id,{required:p}),id:`required-${s.id}`}),e.jsx(o,{htmlFor:`required-${s.id}`,className:"text-xs text-white/60",children:"Required field"})]})]},s.id)})})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t border-slate-700",children:[e.jsx(v,{variant:"outline",onClick:()=>N(!1),className:"flex-1 bg-slate-800 border-slate-600 text-white hover:bg-slate-700",children:"Cancel"}),e.jsx(v,{onClick:()=>t.mutate(),disabled:t.isPending,className:"flex-1 bg-gradient-to-r from-primary to-teal hover:opacity-90",children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Pe,{className:"h-4 w-4 mr-2"}),"Create Form"]})})]})]})})}const ie={medical_history:{icon:we,color:"bg-coral-light text-coral",label:"Medical History"},consent:{icon:Fe,color:"bg-teal-light text-teal",label:"Consent"},insurance:{icon:Ee,color:"bg-gold-light text-gold",label:"Insurance"},custom:{icon:Oe,color:"bg-purple-light text-purple",label:"Custom"}};function us(){const{user:b}=ye(),[N,r]=m.useState(!1),[g,f]=m.useState(null),[a,i]=m.useState(!1),[x,l]=m.useState(null),[h,c]=m.useState(!1),[y,M]=m.useState(null),[P,q]=m.useState(!1),{data:u,isLoading:w}=V({queryKey:["dentist-clinic-forms",b?.id],queryFn:async()=>{const{data:t}=await A.from("clinics").select("id, name").eq("claimed_by",b?.id).limit(1).single();return t},enabled:!!b?.id}),{data:k,isLoading:I}=V({queryKey:["intake-templates",u?.id],queryFn:async()=>{const{data:t}=await A.from("intake_form_templates").select("*").or(`clinic_id.eq.${u?.id},clinic_id.is.null`).eq("is_active",!0).order("form_type");return t||[]},enabled:!!u?.id}),{data:n}=V({queryKey:["form-submissions",u?.id],queryFn:async()=>{const{data:t}=await A.from("patient_form_submissions").select("*, template:intake_form_templates!template_id(id, name, form_type, fields)").eq("clinic_id",u?.id).order("created_at",{ascending:!1}).limit(50);return t||[]},enabled:!!u?.id}),T={total:n?.length||0,pending:n?.filter(t=>t.status==="pending").length||0,completed:n?.filter(t=>t.status==="completed").length||0};return w?e.jsx(re,{className:"h-96"}):u?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold",children:"Patient Intake Forms"}),e.jsx("p",{className:"text-muted-foreground",children:"Send forms to patients before their appointment"})]}),e.jsxs(v,{onClick:()=>q(!0),className:"gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Create Form"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(E,{className:"card-modern",children:e.jsxs(O,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(C,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:k?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Form Templates"})]})]})}),e.jsx(E,{className:"card-modern",children:e.jsxs(O,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gold-light flex items-center justify-center",children:e.jsx(R,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:T.pending}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})]})}),e.jsx(E,{className:"card-modern",children:e.jsxs(O,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal-light flex items-center justify-center",children:e.jsx($,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:T.completed}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Available Form Templates"}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:I?[...Array(3)].map((t,_)=>e.jsx(re,{className:"h-32"},_)):k?.map(t=>{const _=ie[t.form_type]||ie.custom,K=_.icon,s=Array.isArray(t.fields)?t.fields:[];return e.jsx(E,{className:"card-modern",children:e.jsxs(O,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-lg ${_.color} flex items-center justify-center`,children:e.jsx(K,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium",children:t.name}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:t.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(L,{variant:"secondary",className:"text-xs",children:[s.length," fields"]}),e.jsx(L,{variant:"outline",className:`text-xs ${_.color} border-0`,children:_.label})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(v,{size:"sm",variant:"outline",onClick:()=>{l(t),i(!0)},children:[e.jsx(W,{className:"h-4 w-4 mr-1"}),"Preview"]}),e.jsxs(v,{size:"sm",onClick:()=>{f(t),r(!0)},children:[e.jsx(J,{className:"h-4 w-4 mr-1"}),"Send"]})]})]})},t.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Recent Submissions"}),n&&n.length>0?e.jsx("div",{className:"space-y-2",children:n.slice(0,10).map(t=>e.jsx(E,{className:"card-modern cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>{M(t),c(!0)},children:e.jsxs(O,{className:"p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-8 w-8 rounded-lg flex items-center justify-center ${t.status==="completed"?"bg-teal-light":"bg-gold-light"}`,children:t.status==="completed"?e.jsx($,{className:"h-4 w-4 text-teal"}):e.jsx(R,{className:"h-4 w-4 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.patient_email||t.patient_phone||"Unknown"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.template?.name||"Form"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{variant:t.status==="completed"?"default":"secondary",children:t.status}),e.jsx(v,{variant:"ghost",size:"sm",children:e.jsx(W,{className:"h-4 w-4"})})]})]})},t.id))}):e.jsx(E,{className:"card-modern",children:e.jsxs(O,{className:"py-12 text-center",children:[e.jsx(C,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Submissions Yet"}),e.jsx("p",{className:"text-muted-foreground",children:"Forms sent to patients will appear here once submitted"})]})})]}),e.jsx(Ae,{open:N,onOpenChange:r,template:g,clinicId:u.id,clinicName:u.name}),e.jsx(Ie,{open:a,onOpenChange:i,template:x}),e.jsx(Le,{open:h,onOpenChange:c,submission:y}),e.jsx(Re,{open:P,onOpenChange:q,clinicId:u.id})]}):e.jsx(Se,{compact:!0})}export{us as default};
