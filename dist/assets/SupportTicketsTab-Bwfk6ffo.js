import{b as M,u as g,c as I,j as e}from"./chunk-CPh6voF3.js";import{r as j}from"./chunk-CffrGP6S.js";import{L as P}from"./chunk-Drd-rt-S.js";import{u as B,ag as E,s as l,w as F,B as c,a9 as L,bc as O,aa as A,ab as H,ac as R,a as x,a2 as Q,a3 as G,a5 as K,a6 as U,a7 as Y,y as V,I as $,al as z,L as J,$ as W,i as f,t as X,Q as Z,C as ee,b}from"./index-DflORfjh.js";import{C as n,d as o,a as se,b as ae}from"./chunk-Dwq_v72W.js";import{S as te}from"./chunk-CQtADEjB.js";import{C as N}from"./chunk-C14yCe0w.js";import{P as y}from"./chunk-HAC-i_a2.js";import{M as re}from"./chunk-B7d2qnKb.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";const w=[{value:"billing",label:"Billing & Subscription",icon:"üí≥"},{value:"technical",label:"Technical Issue",icon:"üîß"},{value:"profile",label:"Profile Help",icon:"üë§"},{value:"review",label:"Review Management",icon:"‚≠ê"},{value:"integration",label:"Integration (GMB/SMS)",icon:"üîó"},{value:"feature",label:"Feature Request",icon:"üí°"},{value:"other",label:"Other",icon:"üìù"}],v={open:{label:"Open",color:"bg-blue-100 text-blue-700"},in_progress:{label:"In Progress",color:"bg-amber-100 text-amber-700"},resolved:{label:"Resolved",color:"bg-emerald-100 text-emerald-700"},closed:{label:"Closed",color:"bg-muted text-muted-foreground"}};function be(){const{user:d}=B(),{data:C}=E(),S=C?.contactDetails?.support_email||"support@appointpanda.ae",T=M(),[k,u]=j.useState(!1),[t,r]=j.useState({category:"",subject:"",description:""}),{data:i}=g({queryKey:["support-clinic",d?.id],queryFn:async()=>{const{data:s}=await l.from("clinics").select("id, name").eq("claimed_by",d?.id).limit(1).single();return s},enabled:!!d?.id}),{data:p=[],isLoading:_}=g({queryKey:["support-tickets",i?.id],queryFn:async()=>{const{data:s,error:a}=await l.from("support_tickets").select("*").eq("clinic_id",i?.id).order("created_at",{ascending:!1});if(a)throw a;return s||[]},enabled:!!i?.id}),h=s=>{const a=s.toLowerCase();return a.includes("pay")||a.includes("bill")||a.includes("subscri")||a.includes("price")?"billing":a.includes("error")||a.includes("bug")||a.includes("not working")||a.includes("broken")?"technical":a.includes("review")||a.includes("feedback")||a.includes("rating")?"review":a.includes("google")||a.includes("gmb")||a.includes("sms")||a.includes("whatsapp")?"integration":a.includes("profile")||a.includes("photo")||a.includes("image")||a.includes("hours")?"profile":""},D=s=>{if(r({...t,description:s}),!t.category){const a=h(s);a&&r(q=>({...q,category:a}))}},m=I({mutationFn:async()=>{const{data:{user:s}}=await l.auth.getUser();if(!s)throw new Error("Not authenticated");const{error:a}=await l.from("support_tickets").insert({clinic_id:i?.id,user_id:s.id,category:t.category,subject:t.subject,description:t.description,ai_suggested_category:h(t.description)||null,status:"open",priority:"medium"});if(a)throw a},onSuccess:()=>{T.invalidateQueries({queryKey:["support-tickets"]}),u(!1),r({category:"",subject:"",description:""}),b.success("Support ticket created! Our team will respond within 24 hours.")},onError:s=>b.error(s.message||"Failed to create ticket")});return i?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-display font-bold flex items-center gap-2",children:[e.jsx(N,{className:"h-6 w-6"}),"Support & Help"]}),e.jsx("p",{className:"text-muted-foreground",children:"Get help from our team"})]}),e.jsxs(L,{open:k,onOpenChange:u,children:[e.jsx(O,{asChild:!0,children:e.jsxs(c,{className:"gap-2",children:[e.jsx(y,{className:"h-4 w-4"}),"New Ticket"]})}),e.jsxs(A,{className:"max-w-lg",children:[e.jsx(H,{children:e.jsx(R,{children:"Create Support Ticket"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Category"}),e.jsxs(Q,{value:t.category,onValueChange:s=>r({...t,category:s}),children:[e.jsx(G,{children:e.jsx(K,{placeholder:"Select a category"})}),e.jsx(U,{children:w.map(s=>e.jsx(Y,{value:s.value,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]})},s.value))})]}),t.category&&e.jsxs("div",{className:"flex items-center gap-1 text-xs text-primary",children:[e.jsx(V,{className:"h-3 w-3"}),"AI suggested based on your description"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Subject"}),e.jsx($,{value:t.subject,onChange:s=>r({...t,subject:s.target.value}),placeholder:"Brief summary of your issue"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{children:"Description"}),e.jsx(z,{value:t.description,onChange:s=>D(s.target.value),placeholder:"Describe your issue in detail. The more info, the faster we can help!",rows:5})]}),e.jsxs(c,{onClick:()=>m.mutate(),disabled:!t.category||!t.subject||!t.description||m.isPending,className:"w-full gap-2",children:[m.isPending?e.jsx(J,{className:"h-4 w-4 animate-spin"}):e.jsx(W,{className:"h-4 w-4"}),"Submit Ticket"]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(n,{className:"bg-primary text-white border-primary hover:bg-primary/90 transition-colors cursor-pointer",children:e.jsxs(o,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"üìö"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:"Help Center"}),e.jsx("p",{className:"text-xs text-primary-foreground/70",children:"Browse FAQs and guides"})]})]})}),e.jsx(n,{className:"bg-teal text-white border-teal hover:bg-teal/90 transition-colors cursor-pointer",children:e.jsxs(o,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-white/20 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"üí¨"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:"Live Chat"}),e.jsx("p",{className:"text-xs text-teal-100",children:"Chat with support (9AM-6PM)"})]})]})}),e.jsx(n,{className:"bg-slate-900 text-white border-slate-700 hover:bg-slate-800 transition-colors cursor-pointer",children:e.jsxs(o,{className:"p-4 flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-white/10 flex items-center justify-center",children:e.jsx("span",{className:"text-lg",children:"üìß"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:"Email Us"}),e.jsx("p",{className:"text-xs text-slate-400",children:S})]})]})})]}),e.jsxs(n,{children:[e.jsx(se,{children:e.jsxs(ae,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5"}),"Your Tickets"]})}),e.jsx(o,{children:_?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((s,a)=>e.jsx(te,{className:"h-20"},a))}):p.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"font-semibold text-lg mb-2",children:"No Tickets Yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Have a question or issue? Create a support ticket and our team will help."}),e.jsxs(c,{onClick:()=>u(!0),children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"Create Your First Ticket"]})]}):e.jsx("div",{className:"space-y-3",children:p.map(s=>e.jsx("div",{className:"p-4 rounded-xl border bg-muted/30 hover:bg-muted/50 transition-colors cursor-pointer",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center text-lg",children:w.find(a=>a.value===s.category)?.icon||"üìù"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.subject}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(f,{className:v[s.status].color,children:v[s.status].label}),e.jsxs("span",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),Z(new Date(s.created_at),"MMM d, yyyy")]})]})]})]}),s.admin_response&&e.jsxs(f,{className:"bg-emerald-100 text-emerald-700",children:[e.jsx(ee,{className:"h-3 w-3 mr-1"}),"Replied"]})]})},s.id))})})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Practice Linked"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please claim your practice profile first."}),e.jsx(c,{asChild:!0,children:e.jsx(P,{to:"/claim-profile",children:"Claim Your Profile"})})]})}export{be as default};
