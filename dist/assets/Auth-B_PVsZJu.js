import{j as e}from"./chunk-CPh6voF3.js";import{r}from"./chunk-CffrGP6S.js";import{u as U,B as x,L as W,a as o,I as c,b as n,c as Z,s as J}from"./index-DflORfjh.js";import{C as M,a as V,b as $,c as z,d as K}from"./chunk-Dwq_v72W.js";import{T as Q,a as X,b as y,c as N}from"./chunk-k8HiDHrE.js";import{a as Y}from"./chunk-Drd-rt-S.js";import{s as A,Z as _}from"./chunk-yff5u8mE.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-xExVBHTi.js";const I=A().email("Please enter a valid email address"),C=A().min(6,"Password must be at least 6 characters");function me(){const{user:b,roles:i,signIn:E,signUp:P,isLoading:u}=U(),l=Y(),[d,m]=r.useState(!1),[w,j]=r.useState(!1),[v,k]=r.useState(!1),[g,G]=r.useState(""),[p,T]=r.useState(""),[h,L]=r.useState(""),[f,F]=r.useState(""),[S,q]=r.useState("");r.useEffect(()=>{if(u||!b||v)return;if(localStorage.getItem("gmb_listing_flow")==="true"||localStorage.getItem("gmb_relink_flow")==="true"||localStorage.getItem("gmb_pending")==="true"||localStorage.getItem("gmb_restore_session")==="true"){console.log("[Auth] GMB flow in progress, not redirecting");return}k(!0);const a=i.includes("super_admin")||i.includes("district_manager"),t=a||i.some(H=>["seo_team","content_team","marketing_team","support_team"].includes(H)),R=i.includes("dentist");a||t?l("/admin",{replace:!0}):R?l("/dashboard?tab=my-dashboard",{replace:!0}):i.length===0?l("/onboarding?new=true",{replace:!0}):i.includes("super_admin")||i.includes("district_manager")?l("/admin",{replace:!0}):l("/onboarding?new=true",{replace:!0})},[b,i,u,l,v]);const D=async s=>{s.preventDefault();try{I.parse(g),C.parse(p)}catch(t){if(t instanceof _){n.error(t.errors[0].message);return}}m(!0);const{error:a}=await E(g,p);m(!1),a?n.error(a.message.includes("Invalid login credentials")?"Invalid email or password":a.message):n.success("Welcome back!")},O=async s=>{s.preventDefault();try{I.parse(h),C.parse(f)}catch(t){if(t instanceof _){n.error(t.errors[0].message);return}}m(!0);const{error:a}=await P(h,f,S);m(!1),a?n.error(a.message.includes("already registered")?"This email is already registered. Please sign in.":a.message):n.success("Account created successfully!")},B=async()=>{j(!0);try{localStorage.removeItem("gmb_listing_flow"),localStorage.removeItem("gmb_pending"),localStorage.removeItem("gmb_link_token"),localStorage.removeItem("gmb_relink_flow"),localStorage.removeItem("gmb_restore_session"),Z();const a=`${window.location.origin}/auth/callback`;console.log("[Auth] Starting Google OAuth, redirect:",a);const{error:t}=await J.auth.signInWithOAuth({provider:"google",options:{redirectTo:a,queryParams:{access_type:"offline",prompt:"select_account"}}});if(t)throw t}catch(s){n.error(s.message||"Failed to sign in with Google"),j(!1)}};return r.useEffect(()=>{let s=document.querySelector('meta[name="robots"]');return s||(s=document.createElement("meta"),s.setAttribute("name","robots"),document.head.appendChild(s)),s.setAttribute("content","noindex, nofollow"),()=>{s?.setAttribute("content","index, follow")}},[]),u?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-background via-background to-muted flex items-center justify-center p-4",children:e.jsxs(M,{className:"w-full max-w-md",children:[e.jsxs(V,{className:"text-center",children:[e.jsx($,{className:"text-2xl font-bold bg-gradient-to-r from-primary to-coral bg-clip-text text-transparent",children:"Appoint Panda"}),e.jsx(z,{children:"Sign in to manage your dental practice or find the best dentists"})]}),e.jsxs(K,{children:[e.jsxs(x,{variant:"outline",className:"w-full mb-6 h-12",onClick:B,disabled:w,children:[w?e.jsx(W,{className:"mr-2 h-5 w-5 animate-spin"}):e.jsx("img",{src:"https://www.gstatic.com/images/branding/product/2x/googleg_48dp.png",alt:"Google",className:"h-5 w-5 mr-2"}),"Continue with Google"]}),e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("span",{className:"w-full border-t"})}),e.jsx("div",{className:"relative flex justify-center text-xs uppercase",children:e.jsx("span",{className:"bg-card px-3 text-muted-foreground",children:"Or continue with email"})})]}),e.jsxs(Q,{defaultValue:"login",className:"w-full",children:[e.jsxs(X,{className:"grid w-full grid-cols-2",children:[e.jsx(y,{value:"login",children:"Sign In"}),e.jsx(y,{value:"signup",children:"Sign Up"})]}),e.jsx(N,{value:"login",children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-email",children:"Email"}),e.jsx(c,{id:"login-email",type:"email",placeholder:"you@example.com",value:g,onChange:s=>G(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"login-password",children:"Password"}),e.jsx(c,{id:"login-password",type:"password",placeholder:"••••••••",value:p,onChange:s=>T(s.target.value),required:!0})]}),e.jsx(x,{type:"submit",className:"w-full",disabled:d,children:d?"Signing in...":"Sign In"})]})}),e.jsx(N,{value:"signup",children:e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"signup-name",children:"Full Name"}),e.jsx(c,{id:"signup-name",type:"text",placeholder:"Dr. John Smith",value:S,onChange:s=>q(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"signup-email",children:"Email"}),e.jsx(c,{id:"signup-email",type:"email",placeholder:"you@example.com",value:h,onChange:s=>L(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"signup-password",children:"Password"}),e.jsx(c,{id:"signup-password",type:"password",placeholder:"••••••••",value:f,onChange:s=>F(s.target.value),required:!0})]}),e.jsx(x,{type:"submit",className:"w-full",disabled:d,children:d?"Creating account...":"Create Account"})]})})]})]})]})})}export{me as default};
