import{b as Q,u as g,c as V,j as e}from"./chunk-CPh6voF3.js";import{r as N}from"./chunk-CffrGP6S.js";import{u as U,s as x,q as b,G as p,i as d,B,P as Z,C as M,t as y,a as $,a2 as z,a3 as J,a5 as X,a6 as Y,a7 as u,A as ee,Z as se,b as P}from"./index-DflORfjh.js";import{u as ae,a as R}from"./chunk-Dq1MrkKO.js";import{C as l,a as m,b as o,d as c,c as w}from"./chunk-Dwq_v72W.js";import{S as h}from"./chunk-DfjE-bP6.js";import{S as G}from"./chunk-CQtADEjB.js";import{T as re,a as te,b as v,c as _}from"./chunk-k8HiDHrE.js";import{N as ie}from"./chunk-BQwaAkM6.js";import{U as ne}from"./chunk-8P_iFEn-.js";import{B as S}from"./chunk-C2VW2Ml6.js";import{M as C}from"./chunk-B7d2qnKb.js";import{C as le}from"./chunk-DI0yTdYZ.js";import{S as ce}from"./chunk-C7BdFRQZ.js";import{C as de}from"./chunk-GLPyMM0F.js";import{R as me}from"./chunk-BOvFDp2b.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-Cq66vzLV.js";import"./chunk-fofMllkR.js";import"./chunk-DSDQubI6.js";import"./chunk-BaL04tya.js";import"./chunk-HAC-i_a2.js";import"./chunk-CyKl6YHG.js";import"./chunk-BvZfqwfW.js";import"./chunk-B46JjdBY.js";function Ke(){const{user:j}=U(),T=Q(),[F,E]=N.useState("reminders"),[L,A]=N.useState(!1),[t,n]=N.useState(null),{data:r,isLoading:D}=g({queryKey:["dentist-clinic-operations",j?.id],queryFn:async()=>{const{data:a,error:s}=await x.from("clinics").select("id, name, google_place_id").eq("claimed_by",j?.id).limit(1).single();if(s&&s.code!=="PGRST116")throw s;return a},enabled:!!j?.id}),{data:oe,isLoading:O}=g({queryKey:["clinic-automation-settings",r?.id],queryFn:async()=>{const{data:a,error:s}=await x.from("clinic_automation_settings").select("*").eq("clinic_id",r?.id).single();if(s&&s.code==="PGRST116"){const{data:q,error:k}=await x.from("clinic_automation_settings").insert({clinic_id:r?.id}).select().single();if(k)throw k;return n(q),q}if(s)throw s;return n(a),a},enabled:!!r?.id}),{data:i}=g({queryKey:["clinic-crm-number",r?.id],queryFn:async()=>{const{data:a,error:s}=await x.from("crm_numbers").select("*").eq("clinic_id",r?.id).eq("is_active",!0).limit(1).single();if(s&&s.code!=="PGRST116")throw s;return a},enabled:!!r?.id}),I=V({mutationFn:async()=>{if(!t||!r?.id)throw new Error("No settings");const{error:a}=await x.from("clinic_automation_settings").update({reminder_2_days:t.reminder_2_days,reminder_1_day:t.reminder_1_day,reminder_3_hours:t.reminder_3_hours,reminder_channel:t.reminder_channel,followup_enabled:t.followup_enabled,review_request_enabled:t.review_request_enabled,updated_at:new Date().toISOString()}).eq("clinic_id",r.id);if(a)throw a},onSuccess:()=>{T.invalidateQueries({queryKey:["clinic-automation-settings"]}),P.success("Settings saved")},onError:a=>P.error(a.message||"Failed to save")}),K=async()=>{A(!0);try{await I.mutateAsync()}finally{A(!1)}},{data:W}=ae(r?.id);R(r?.id,"sms_reminders"),R(r?.id,"gmb_sync");const f=W?.plan?.name||"Free",H=f!=="Free"&&f!=="Basic";return D||O?e.jsxs("div",{className:"space-y-6",children:[e.jsx(G,{className:"h-12"}),e.jsx(G,{className:"h-64"})]}):r?H?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold",children:"Operations"}),e.jsx("p",{className:"text-muted-foreground",children:"Automation & communication settings"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{className:"bg-primary/10 text-primary border-primary/20",children:[e.jsx(le,{className:"h-3 w-3 mr-1"}),f]}),e.jsxs(B,{onClick:K,disabled:L,children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]})]}),e.jsx(l,{className:i?"border-green-200 bg-green-50":"border-amber-200 bg-amber-50",children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-xl flex items-center justify-center ${i?"bg-green-100":"bg-amber-100"}`,children:e.jsx(Z,{className:`h-5 w-5 ${i?"text-green-600":"text-amber-600"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i?"CRM Number Active":"No CRM Number Assigned"}),i?e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx("span",{children:i.phone_number}),i.is_whatsapp_enabled&&e.jsx(d,{variant:"secondary",className:"text-xs",children:"WhatsApp"})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Contact admin to get a dedicated number for SMS/WhatsApp"})]})]}),i?e.jsxs(d,{className:"bg-green-100 text-green-800",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Active"]}):e.jsxs(d,{variant:"secondary",children:[e.jsx(de,{className:"h-3 w-3 mr-1"}),"Pending"]})]})})}),e.jsxs(re,{value:F,onValueChange:E,children:[e.jsxs(te,{className:"grid w-full grid-cols-3 rounded-xl",children:[e.jsxs(v,{value:"reminders",className:"rounded-xl",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Reminders"]}),e.jsxs(v,{value:"followup",className:"rounded-xl",children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Follow-up"]}),e.jsxs(v,{value:"gmb",className:"rounded-xl",children:[e.jsx(p,{className:"h-4 w-4 mr-2"}),"GMB Sync"]})]}),e.jsx(_,{value:"reminders",className:"mt-4",children:e.jsxs(l,{children:[e.jsxs(m,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-5 w-5"}),"Appointment Reminders"]}),e.jsx(w,{children:"Automatically remind patients about their upcoming appointments"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(y,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"2 Days Before"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send reminder 48 hours before appointment"})]})]}),e.jsx(h,{checked:t?.reminder_2_days||!1,onCheckedChange:a=>n(s=>s?{...s,reminder_2_days:a}:null)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(y,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"1 Day Before"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send reminder 24 hours before appointment"})]})]}),e.jsx(h,{checked:t?.reminder_1_day||!1,onCheckedChange:a=>n(s=>s?{...s,reminder_1_day:a}:null)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-amber-100 flex items-center justify-center",children:e.jsx(y,{className:"h-5 w-5 text-amber-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"3 Hours Before"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send final reminder 3 hours before"})]})]}),e.jsx(h,{checked:t?.reminder_3_hours||!1,onCheckedChange:a=>n(s=>s?{...s,reminder_3_hours:a}:null)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:"Reminder Channel"}),e.jsxs(z,{value:t?.reminder_channel||"sms",onValueChange:a=>n(s=>s?{...s,reminder_channel:a}:null),children:[e.jsx(J,{children:e.jsx(X,{})}),e.jsxs(Y,{children:[e.jsx(u,{value:"email",children:"Email Only"}),e.jsx(u,{value:"sms",children:"SMS Only"}),e.jsx(u,{value:"whatsapp",disabled:!i?.is_whatsapp_enabled,children:"WhatsApp Only"}),e.jsx(u,{value:"email_sms",children:"Email + SMS"}),e.jsx(u,{value:"all",disabled:!i?.is_whatsapp_enabled,children:"All Channels"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email is always available. SMS/WhatsApp require a CRM number."})]})]})]})}),e.jsx(_,{value:"followup",className:"mt-4",children:e.jsxs(l,{children:[e.jsxs(m,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(C,{className:"h-5 w-5"}),"Follow-up Automation"]}),e.jsx(w,{children:"Automatic follow-up messages after appointments"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-teal-100 flex items-center justify-center",children:e.jsx(ee,{className:"h-5 w-5 text-teal-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Post-Appointment Follow-up"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send a thank you message after completed appointments"})]})]}),e.jsx(h,{checked:t?.followup_enabled||!1,onCheckedChange:a=>n(s=>s?{...s,followup_enabled:a}:null)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-gold-light flex items-center justify-center",children:e.jsx(se,{className:"h-5 w-5 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Review Request"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send review link after positive appointment feedback"})]})]}),e.jsx(h,{checked:t?.review_request_enabled||!1,onCheckedChange:a=>n(s=>s?{...s,review_request_enabled:a}:null)})]})]})]})}),e.jsx(_,{value:"gmb",className:"mt-4",children:e.jsxs(l,{children:[e.jsxs(m,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"h-5 w-5"}),"Google My Business Sync"]}),e.jsx(w,{children:"Keep your profile in sync with Google Business"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsx("div",{className:"p-4 bg-muted/50 rounded-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(p,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Google Place ID"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r.google_place_id||"Not connected"})]})]}),r.google_place_id?e.jsxs(d,{className:"bg-green-100 text-green-800",children:[e.jsx(M,{className:"h-3 w-3 mr-1"}),"Connected"]}):e.jsx(d,{variant:"secondary",children:"Not Connected"})]})}),r.google_place_id&&e.jsxs(B,{className:"w-full",variant:"outline",children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Sync Now"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"GMB sync updates your profile with the latest hours, photos, and reviews from Google. Set your Google Place ID in the Profile tab."})]})]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold",children:"Operations & Automation"}),e.jsx("p",{className:"text-muted-foreground",children:"Automation & communication settings"})]}),e.jsx(ne,{featureName:"Automation Suite",requiredPlan:"professional",clinicId:r.id}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4 opacity-60 pointer-events-none",children:[e.jsxs(l,{className:"border-dashed",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(o,{className:"text-base flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-primary"}),"Appointment Reminders",e.jsx(b,{className:"h-3 w-3 text-muted-foreground ml-auto"})]})}),e.jsx(c,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Auto-send reminders 2 days, 1 day, and 3 hours before appointments"})})]}),e.jsxs(l,{className:"border-dashed",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(o,{className:"text-base flex items-center gap-2",children:[e.jsx(C,{className:"h-4 w-4 text-teal"}),"Follow-up Messages",e.jsx(b,{className:"h-3 w-3 text-muted-foreground ml-auto"})]})}),e.jsx(c,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Automatic thank you messages and review requests"})})]}),e.jsxs(l,{className:"border-dashed",children:[e.jsx(m,{className:"pb-3",children:e.jsxs(o,{className:"text-base flex items-center gap-2",children:[e.jsx(p,{className:"h-4 w-4 text-blue-500"}),"GMB Sync",e.jsx(b,{className:"h-3 w-3 text-muted-foreground ml-auto"})]})}),e.jsx(c,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Keep your profile synced with Google Business"})})]})]})]}):e.jsx(ie,{compact:!0})}export{Ke as default};
