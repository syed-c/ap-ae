import{b as ne,u as I,c as re,j as e}from"./chunk-CPh6voF3.js";import{r}from"./chunk-CffrGP6S.js";import{u as oe,s as v,i as h,A as N,P as k,B as o,$ as x,a9 as F,aa as W,ab as E,ac as Y,ad as $,a as l,ae as B,a2 as le,a3 as ce,a5 as me,a6 as de,S as pe,a7 as ue,al as he,n as U,C as xe,t as ge,Z as ye,aj as G,y as je,m as z,U as K,b as g}from"./index-DflORfjh.js";import{C as fe,a as we,b as be,c as _e,d as ve}from"./chunk-Dwq_v72W.js";import{T as Ne,a as ke,b as L,c as Ce}from"./chunk-k8HiDHrE.js";import{S as O}from"./chunk-CQtADEjB.js";import{N as Se}from"./chunk-BQwaAkM6.js";import{F as Te}from"./chunk-BaL04tya.js";import{M as C}from"./chunk-DnhFyEPV.js";import{E as Re}from"./chunk-CcezodbN.js";import{C as Ae}from"./chunk-BFhD_ct7.js";import{R as Q}from"./chunk-BOvFDp2b.js";import{B as Z}from"./chunk-C2VW2Ml6.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-Cq66vzLV.js";import"./chunk-fofMllkR.js";import"./chunk-DSDQubI6.js";import"./chunk-HAC-i_a2.js";const S=[{id:"review_request",category:"review",name:"Review Request",description:"Ask patients for a review after their visit",icon:U,color:"from-amber-500 to-orange-500",channels:["email","sms","whatsapp"],subject:"How was your visit to {clinic_name}?",message:`Hi {patient_name}! Thank you for visiting {clinic_name}. We hope you had a great experience. Would you take a moment to share your feedback? It really helps us improve and helps others find quality dental care.

{review_link}`,variables:["patient_name","clinic_name","review_link"]},{id:"appointment_confirmation",category:"booking",name:"Appointment Confirmation",description:"Confirm a new booking with the patient",icon:xe,color:"from-emerald-500 to-teal-500",channels:["email","sms","whatsapp"],subject:"Your appointment is confirmed at {clinic_name}",message:`Hi {patient_name}! Your appointment at {clinic_name} is confirmed.

ðŸ“… Date: {appointment_date}
â° Time: {appointment_time}
ðŸ“ Address: {clinic_address}

Please arrive 10 minutes early. If you need to reschedule, reply to this message or call us.`,variables:["patient_name","clinic_name","appointment_date","appointment_time","clinic_address"]},{id:"appointment_reminder_2day",category:"reminder",name:"Reminder (2 Days)",description:"Remind patients 2 days before appointment",icon:Z,color:"from-blue-500 to-indigo-500",channels:["email","sms","whatsapp"],subject:"Reminder: Your appointment in 2 days",message:`Hi {patient_name}! This is a friendly reminder about your upcoming appointment at {clinic_name}.

ðŸ“… Date: {appointment_date}
â° Time: {appointment_time}

We look forward to seeing you!`,variables:["patient_name","clinic_name","appointment_date","appointment_time"]},{id:"appointment_reminder_1day",category:"reminder",name:"Reminder (1 Day)",description:"Remind patients 1 day before appointment",icon:ge,color:"from-purple-500 to-pink-500",channels:["email","sms","whatsapp"],subject:"Tomorrow: Your appointment at {clinic_name}",message:`Hi {patient_name}! Just a quick reminder - your appointment at {clinic_name} is tomorrow!

ðŸ“… Date: {appointment_date}
â° Time: {appointment_time}

See you soon!`,variables:["patient_name","clinic_name","appointment_date","appointment_time"]},{id:"appointment_reminder_3hr",category:"reminder",name:"Reminder (3 Hours)",description:"Final reminder 3 hours before appointment",icon:ye,color:"from-rose-500 to-red-500",channels:["sms","whatsapp"],subject:"Your appointment is in 3 hours",message:"Hi {patient_name}! Your appointment at {clinic_name} is in 3 hours at {appointment_time}. Please arrive 10 minutes early. See you soon!",variables:["patient_name","clinic_name","appointment_time"]},{id:"follow_up",category:"followup",name:"Follow-up Message",description:"Check in with patients after treatment",icon:G,color:"from-pink-500 to-rose-500",channels:["email","sms","whatsapp"],subject:"How are you feeling after your visit?",message:`Hi {patient_name}! We wanted to check in and see how you're feeling after your recent visit to {clinic_name}.

If you have any questions or concerns about your treatment, please don't hesitate to reach out. We're here to help!

Warm regards,
{clinic_name} Team`,variables:["patient_name","clinic_name"]},{id:"thank_you",category:"followup",name:"Thank You",description:"Thank patients for choosing your practice",icon:je,color:"from-teal-500 to-cyan-500",channels:["email","sms","whatsapp"],subject:"Thank you for visiting {clinic_name}!",message:`Hi {patient_name}! Thank you for choosing {clinic_name} for your dental care. We truly appreciate your trust in us!

If you have any questions or need to schedule your next visit, we're always here to help.`,variables:["patient_name","clinic_name"]},{id:"reschedule",category:"booking",name:"Reschedule Request",description:"Ask patient to reschedule their appointment",icon:Q,color:"from-slate-500 to-slate-700",channels:["email","sms","whatsapp"],subject:"Need to reschedule your appointment?",message:`Hi {patient_name}! We noticed you might need to reschedule your appointment at {clinic_name}.

Please reply to this message or call us to find a new time that works better for you. We're flexible and happy to accommodate your schedule!`,variables:["patient_name","clinic_name"]},{id:"missed_appointment",category:"reminder",name:"Missed Appointment",description:"Follow up on missed appointments",icon:z,color:"from-amber-500 to-yellow-500",channels:["email","sms","whatsapp"],subject:"We missed you today!",message:`Hi {patient_name}! We noticed you weren't able to make it to your appointment today at {clinic_name}.

We hope everything is okay! Please reach out to reschedule at your convenience. Your dental health is important to us.`,variables:["patient_name","clinic_name"]},{id:"recall_reminder",category:"marketing",name:"Recall/Check-up Reminder",description:"Remind patients about their regular check-up",icon:K,color:"from-green-500 to-emerald-600",channels:["email","sms"],subject:"Time for your dental check-up!",message:`Hi {patient_name}! It's been a while since your last visit to {clinic_name}. Regular check-ups are important for maintaining your oral health.

We'd love to see you again! Book your appointment today.

{booking_link}`,variables:["patient_name","clinic_name","booking_link"]}],V={review:{label:"Review Requests",icon:U,color:"text-amber-500"},booking:{label:"Booking & Confirmation",icon:z,color:"text-emerald-500"},reminder:{label:"Reminders",icon:Z,color:"text-blue-500"},followup:{label:"Follow-up",icon:G,color:"text-pink-500"},marketing:{label:"Marketing",icon:K,color:"text-green-500"}};function ea(){const{user:y,isAdmin:T,isSuperAdmin:R}=oe();ne();const[d,J]=r.useState("all"),[i,j]=r.useState(null),[X,p]=r.useState(!1),[c,A]=r.useState(null),[m,M]=r.useState("email"),[u,q]=r.useState(null),[D,f]=r.useState(""),[w,H]=r.useState(!1),{data:n,isLoading:ee}=I({queryKey:["dentist-clinic-templates",y?.id],queryFn:async()=>{const{data:a,error:s}=await v.from("clinics").select("id, name, slug, address").eq("claimed_by",y?.id).limit(1).single();if(s&&s.code!=="PGRST116")throw s;return a},enabled:!!y?.id&&!T&&!R}),{data:b=[]}=I({queryKey:["clinic-patients-templates",n?.id],queryFn:async()=>{const{data:a,error:s}=await v.from("patients").select("id, name, phone, email").eq("clinic_id",n?.id).eq("is_deleted_by_dentist",!1).order("name").limit(200);if(s)throw s;return a||[]},enabled:!!n?.id}),ae=re({mutationFn:async()=>{if(!c||!n)throw new Error("No template selected");const a=b.find(_=>_.id===u);if(!a)throw new Error("No patient selected");const s=(D||c.message).replace(/{patient_name}/g,a.name).replace(/{clinic_name}/g,n.name).replace(/{clinic_address}/g,n.address||"").replace(/{review_link}/g,`${window.location.origin}/review/${n.slug}`).replace(/{booking_link}/g,`${window.location.origin}/clinic/${n.slug}`),{error:t}=await v.functions.invoke("send-review-request",{body:{clinicId:n.id,recipientName:a.name,recipientEmail:m==="email"?a.email:void 0,recipientPhone:m!=="email"?a.phone:void 0,channel:m,customMessage:s,templateId:c.id}});if(t)throw t},onSuccess:()=>{g.success("Message sent successfully!"),p(!1),A(null),q(null),f("")},onError:a=>{g.error(a.message||"Failed to send message")}}),se=async()=>{H(!0);try{await ae.mutateAsync()}finally{H(!1)}},P=a=>{A(a),f(a.message),M(a.channels.includes("email")?"email":a.channels[0]),p(!0)},ie=async a=>{try{await navigator.clipboard.writeText(a),g.success("Copied to clipboard!")}catch{g.error("Failed to copy")}},te=d==="all"?S:S.filter(a=>a.category===d);return ee?e.jsxs("div",{className:"space-y-6",children:[e.jsx(O,{className:"h-20"}),e.jsx("div",{className:"grid grid-cols-3 gap-4",children:[...Array(6)].map((a,s)=>e.jsx(O,{className:"h-40"},s))})]}):!n&&!T&&!R?e.jsx(Se,{compact:!0}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between p-5 rounded-2xl bg-gradient-to-r from-slate-900 to-slate-800 text-white",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Te,{className:"h-6 w-6"}),"Message Templates"]}),e.jsx("p",{className:"text-white/70 mt-1",children:"Pre-built templates for all your patient communications"})]}),e.jsxs(h,{className:"bg-primary/20 text-primary-foreground border-0",children:[S.length," Templates"]})]}),e.jsxs(Ne,{value:d,onValueChange:J,children:[e.jsxs(ke,{className:"grid w-full grid-cols-6 bg-muted/50 rounded-xl p-1 h-auto",children:[e.jsx(L,{value:"all",className:"rounded-lg py-2 text-xs sm:text-sm",children:"All"}),Object.entries(V).map(([a,s])=>{const t=s.icon;return e.jsxs(L,{value:a,className:"rounded-lg py-2 text-xs sm:text-sm gap-1",children:[e.jsx(t,{className:`h-3 w-3 sm:h-4 sm:w-4 ${s.color}`}),e.jsx("span",{className:"hidden sm:inline",children:s.label.split(" ")[0]})]},a)})]}),e.jsx(Ce,{value:d,className:"mt-6",children:e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-4",children:te.map(a=>{const s=a.icon;return V[a.category],e.jsxs(fe,{className:"group hover:shadow-lg transition-all duration-300 border-muted/50 overflow-hidden",children:[e.jsx("div",{className:`h-2 bg-gradient-to-r ${a.color}`}),e.jsxs(we,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{className:`h-11 w-11 rounded-xl bg-gradient-to-br ${a.color} flex items-center justify-center shadow-lg`,children:e.jsx(s,{className:"h-5 w-5 text-white"})}),e.jsx("div",{className:"flex gap-1",children:a.channels.map(t=>e.jsxs(h,{variant:"secondary",className:"text-[10px] px-1.5 py-0",children:[t==="email"&&e.jsx(N,{className:"h-2.5 w-2.5"}),t==="sms"&&e.jsx(k,{className:"h-2.5 w-2.5"}),t==="whatsapp"&&e.jsx(C,{className:"h-2.5 w-2.5"})]},t))})]}),e.jsx(be,{className:"text-base mt-3",children:a.name}),e.jsx(_e,{className:"text-xs line-clamp-2",children:a.description})]}),e.jsx(ve,{className:"pt-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",className:"flex-1 gap-1 text-xs",onClick:()=>j(a),children:[e.jsx(Re,{className:"h-3 w-3"}),"Preview"]}),e.jsxs(o,{size:"sm",className:"flex-1 gap-1 text-xs bg-gradient-to-r from-primary to-teal text-white",onClick:()=>P(a),children:[e.jsx(x,{className:"h-3 w-3"}),"Send"]})]})})]},a.id)})})})]}),e.jsx(F,{open:!!i,onOpenChange:()=>j(null),children:e.jsxs(W,{className:"max-w-lg",children:[e.jsxs(E,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[i&&e.jsx(i.icon,{className:"h-5 w-5 text-primary"}),i?.name]}),e.jsx($,{children:i?.description})]}),i&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground",children:"Subject Line"}),e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg mt-1",children:e.jsx("p",{className:"text-sm font-medium",children:i.subject})})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground",children:"Message Content"}),e.jsx("div",{className:"p-3 bg-muted/50 rounded-lg mt-1",children:e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:i.message})})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground",children:"Variables"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-1",children:i.variables.map(a=>e.jsx(h,{variant:"outline",className:"text-xs",children:`{${a}}`},a))})]}),e.jsxs("div",{children:[e.jsx(l,{className:"text-xs text-muted-foreground",children:"Available Channels"}),e.jsx("div",{className:"flex gap-2 mt-1",children:i.channels.map(a=>e.jsxs(h,{className:"gap-1",children:[a==="email"&&e.jsx(N,{className:"h-3 w-3"}),a==="sms"&&e.jsx(k,{className:"h-3 w-3"}),a==="whatsapp"&&e.jsx(C,{className:"h-3 w-3"}),a.charAt(0).toUpperCase()+a.slice(1)]},a))})]})]}),e.jsxs(B,{className:"gap-2",children:[e.jsxs(o,{variant:"outline",onClick:()=>ie(i?.message||""),children:[e.jsx(Ae,{className:"h-4 w-4 mr-2"}),"Copy Message"]}),e.jsxs(o,{onClick:()=>{j(null),i&&P(i)},children:[e.jsx(x,{className:"h-4 w-4 mr-2"}),"Send This"]})]})]})}),e.jsx(F,{open:X,onOpenChange:p,children:e.jsxs(W,{className:"max-w-lg",children:[e.jsxs(E,{children:[e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5 text-primary"}),"Send ",c?.name]}),e.jsx($,{children:"Select a patient and channel to send this message"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Select Patient"}),e.jsxs(le,{value:u||"",onValueChange:q,children:[e.jsx(ce,{className:"mt-1",children:e.jsx(me,{placeholder:"Choose a patient..."})}),e.jsx(de,{children:e.jsx(pe,{className:"max-h-[200px]",children:b.map(a=>e.jsx(ue,{value:a.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.email||a.phone})]})},a.id))})})]})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Send Via"}),e.jsx("div",{className:"grid grid-cols-3 gap-2 mt-1",children:c?.channels.map(a=>{const s=b.find(_=>_.id===u),t=a==="email"?!s?.email:!s?.phone;return e.jsxs(o,{type:"button",variant:m===a?"default":"outline",className:`gap-2 ${m===a?"bg-primary text-white":""}`,onClick:()=>M(a),disabled:t,children:[a==="email"&&e.jsx(N,{className:"h-4 w-4"}),a==="sms"&&e.jsx(k,{className:"h-4 w-4"}),a==="whatsapp"&&e.jsx(C,{className:"h-4 w-4"}),a.charAt(0).toUpperCase()+a.slice(1)]},a)})})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Message (editable)"}),e.jsx(he,{value:D,onChange:a=>f(a.target.value),rows:6,className:"mt-1 font-mono text-sm"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Variables like ","{patient_name}"," will be replaced automatically"]})]})]}),e.jsxs(B,{children:[e.jsx(o,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsxs(o,{onClick:se,disabled:!u||w,className:"gap-2",children:[w?e.jsx(Q,{className:"h-4 w-4 animate-spin"}):e.jsx(x,{className:"h-4 w-4"}),w?"Sending...":"Send Message"]})]})]})})]})}export{ea as default};
