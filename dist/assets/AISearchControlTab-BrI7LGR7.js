import{b as U,u as k,c as V,j as e}from"./chunk-CPh6voF3.js";import{r as R}from"./chunk-CffrGP6S.js";import{y as Z,i as p,Z as T,p as A,a as f,B as D,t as G,E as J,T as X,Q,s as v,b as M}from"./index-DflORfjh.js";import{C as l,a as h,b as u,c as _,d as c}from"./chunk-Dwq_v72W.js";import{S as q}from"./chunk-DfjE-bP6.js";import{T as Y,a as $,b as I,c as o,d as ee,e as m}from"./chunk-NLs5Ye4A.js";import{T as se,a as ae,b as w,c as C}from"./chunk-k8HiDHrE.js";import{S as te}from"./chunk-FxOzQZIr.js";import{S as re}from"./chunk-C2VW2Ml6.js";import{C as ne}from"./chunk-wy0nNZZG.js";import{C as E}from"./chunk-GLPyMM0F.js";import{R as L}from"./chunk-BOvFDp2b.js";import{E as ie}from"./chunk-CcezodbN.js";import{s as le}from"./chunk-aAsotRsv.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function Te(){const N=U(),[x,d]=R.useState("settings"),[i,B]=R.useState(7),{data:j,isLoading:S}=k({queryKey:["ai-search-settings"],queryFn:async()=>{const{data:s,error:a}=await v.from("ai_search_settings").select("*");if(a)throw a;const r={};return s?.forEach(g=>{r[g.setting_key]=g.setting_value}),r}}),{data:t,isLoading:F,refetch:P}=k({queryKey:["ai-search-logs",i],queryFn:async()=>{const s=le(new Date,i).toISOString(),{data:a,error:r}=await v.from("ai_search_logs").select("*").gte("created_at",s).order("created_at",{ascending:!1}).limit(500);if(r)throw r;return a}}),y=V({mutationFn:async({key:s,value:a})=>{const{error:r}=await v.from("ai_search_settings").update({setting_value:a,updated_at:new Date().toISOString()}).eq("setting_key",s);if(r)throw r},onSuccess:()=>{N.invalidateQueries({queryKey:["ai-search-settings"]}),M.success("Setting updated")},onError:s=>{M.error("Failed to update setting"),console.error(s)}}),W=s=>{y.mutate({key:"ai_search_enabled",value:{enabled:s}})},z=s=>{y.mutate({key:"paid_priority_enabled",value:{enabled:s}})},H=(s,a)=>{const g={...j?.ranking_weights||{},[s]:a/100};y.mutate({key:"ranking_weights",value:g})},n=t?{totalSearches:t.length,avgDuration:t.length>0?Math.round(t.reduce((s,a)=>s+(a.search_duration_ms||0),0)/t.length):0,noResults:t.filter(s=>s.results_count===0).length,clickRate:t.length>0?Math.round(t.filter(s=>s.clicked_result_id).length/t.length*100):0,fallbackRate:t.length>0?Math.round(t.filter(s=>s.fallback_used).length/t.length*100):0,topQueries:ce(t),noResultQueries:t.filter(s=>s.results_count===0).slice(0,10)}:null,b=j?.ai_search_enabled?.enabled!==!1,K=j?.paid_priority_enabled?.enabled!==!1,O=j?.ranking_weights||{service_match:.25,budget_fit:.2,location_proximity:.2,rating:.15,profile_completeness:.1,paid_bonus:.1};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(Z,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"AI Search Control"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage AI-powered search settings and analytics"})]})]}),e.jsxs(p,{variant:b?"default":"secondary",className:"gap-1",children:[e.jsx(T,{className:"h-3 w-3"}),b?"AI Search Active":"AI Search Disabled"]})]}),e.jsxs(se,{value:x,onValueChange:d,children:[e.jsxs(ae,{children:[e.jsxs(w,{value:"settings",className:"gap-2",children:[e.jsx(re,{className:"h-4 w-4"}),"Settings"]}),e.jsxs(w,{value:"analytics",className:"gap-2",children:[e.jsx(ne,{className:"h-4 w-4"}),"Analytics"]}),e.jsxs(w,{value:"logs",className:"gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Search Logs"]})]}),e.jsx(C,{value:"settings",className:"space-y-6",children:e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Search Controls"}),e.jsx(_,{children:"Enable or disable AI search features"})]}),e.jsxs(c,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{children:"Enable AI Search"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Use Gemini AI for intent extraction"})]}),e.jsx(q,{checked:b,onCheckedChange:W,disabled:S})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(f,{children:"Paid Dentist Priority"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Boost paid dentists in search rankings"})]}),e.jsx(q,{checked:K,onCheckedChange:z,disabled:S})]})]})]}),e.jsxs(l,{children:[e.jsxs(h,{children:[e.jsx(u,{children:"Ranking Weights"}),e.jsx(_,{children:"Adjust how results are scored and ranked"})]}),e.jsx(c,{className:"space-y-6",children:Object.entries(O).map(([s,a])=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx(f,{className:"capitalize",children:s.replace(/_/g," ")}),e.jsxs("span",{className:"text-muted-foreground",children:[Math.round(a*100),"%"]})]}),e.jsx(te,{value:[a*100],onValueChange:([r])=>H(s,r),max:50,step:5,className:"w-full"})]},s))})]})]})}),e.jsxs(C,{value:"analytics",className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{children:"Date Range:"}),e.jsx("div",{className:"flex gap-2",children:[7,14,30].map(s=>e.jsxs(D,{variant:i===s?"default":"outline",size:"sm",onClick:()=>B(s),children:[s," days"]},s))})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-5",children:[e.jsx(l,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Total Searches"})]}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:n?.totalSearches||0})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Avg Duration"})]}),e.jsxs("p",{className:"text-2xl font-bold mt-2",children:[n?.avgDuration||0,"ms"]})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Click Rate"})]}),e.jsxs("p",{className:"text-2xl font-bold mt-2",children:[n?.clickRate||0,"%"]})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"No Results"})]}),e.jsx("p",{className:"text-2xl font-bold mt-2",children:n?.noResults||0})]})}),e.jsx(l,{children:e.jsxs(c,{className:"pt-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Fallback Rate"})]}),e.jsxs("p",{className:"text-2xl font-bold mt-2",children:[n?.fallbackRate||0,"%"]})]})})]}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs(l,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Top Queries"]})}),e.jsx(c,{children:n?.topQueries&&n.topQueries.length>0?e.jsx("div",{className:"space-y-2",children:n.topQueries.map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/50",children:[e.jsx("span",{className:"text-sm truncate",children:s.query}),e.jsx(p,{variant:"secondary",children:s.count})]},a))}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"No data yet"})})]}),e.jsxs(l,{children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5 text-warning"}),"No-Result Queries"]})}),e.jsx(c,{children:n?.noResultQueries&&n.noResultQueries.length>0?e.jsx("div",{className:"space-y-2",children:n.noResultQueries.map((s,a)=>e.jsxs("div",{className:"p-2 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm truncate",children:s.original_query}),e.jsx("p",{className:"text-xs text-muted-foreground",children:Q(new Date(s.created_at),"MMM d, h:mm a")})]},a))}):e.jsx("p",{className:"text-muted-foreground text-sm",children:"No failed searches"})})]})]})]}),e.jsx(C,{value:"logs",children:e.jsxs(l,{children:[e.jsxs(h,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(u,{children:"Search Logs"}),e.jsx(_,{children:"Recent AI search queries and results"})]}),e.jsxs(D,{variant:"outline",size:"sm",onClick:()=>P(),className:"gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Refresh"]})]}),e.jsx(c,{children:F?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(L,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):e.jsxs(Y,{children:[e.jsx($,{children:e.jsxs(I,{children:[e.jsx(o,{children:"Query"}),e.jsx(o,{children:"Intent"}),e.jsx(o,{children:"Results"}),e.jsx(o,{children:"Duration"}),e.jsx(o,{children:"Clicked"}),e.jsx(o,{children:"Date"})]})}),e.jsx(ee,{children:t?.slice(0,50).map(s=>e.jsxs(I,{children:[e.jsx(m,{className:"max-w-[200px] truncate font-medium",children:s.original_query}),e.jsx(m,{children:e.jsx("div",{className:"flex flex-wrap gap-1",children:s.extracted_intent?.treatments?.slice(0,2).map((a,r)=>e.jsx(p,{variant:"secondary",className:"text-xs",children:a},r))})}),e.jsx(m,{children:e.jsx(p,{variant:s.results_count>0?"default":"destructive",children:s.results_count})}),e.jsxs(m,{className:"text-muted-foreground",children:[s.search_duration_ms,"ms"]}),e.jsx(m,{children:s.clicked_result_id?e.jsx(ie,{className:"h-4 w-4 text-primary"}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(m,{className:"text-muted-foreground text-sm",children:Q(new Date(s.created_at),"MMM d, h:mm a")})]},s.id))})]})})]})})]})]})}function ce(N){const x=new Map;return N.forEach(d=>{const i=d.original_query.toLowerCase().trim();x.set(i,(x.get(i)||0)+1)}),Array.from(x.entries()).map(([d,i])=>({query:d,count:i})).sort((d,i)=>i.count-d.count).slice(0,10)}export{Te as AISearchControlTab};
