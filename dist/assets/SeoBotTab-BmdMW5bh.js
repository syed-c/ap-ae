import{u as F,b as S,c as T,j as e}from"./chunk-CPh6voF3.js";import{r as L}from"./chunk-CffrGP6S.js";import{s as N,b as p,L as _,B as u,p as J,Z as H,C as I,o as W,i as P,Q as E,S as X,a as m,I as h,ap as Y}from"./index-DflORfjh.js";import{C as l,d as c,a as g,b as j,c as y}from"./chunk-Dwq_v72W.js";import{S as ee}from"./chunk-DfjE-bP6.js";import{T as se,a as ae,b as C,c as k}from"./chunk-k8HiDHrE.js";import{T as Q,a as K,b as v,c as d,d as z,e as n}from"./chunk-NLs5Ye4A.js";import{B as te}from"./chunk-Bl7VVhKV.js";import{C as M}from"./chunk-BFhD_ct7.js";import{F as D}from"./chunk-BaL04tya.js";import{H as G}from"./chunk-C077LRJi.js";import{R as re}from"./chunk-BOvFDp2b.js";import{T as ie}from"./chunk-DbdCK11k.js";import{R as $}from"./chunk-3oqKMbN4.js";import{S as ne}from"./chunk-C2VW2Ml6.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-BSjc5zjM.js";import"./chunk-I1o_Hd8I.js";import"./chunk-CyRXX0qx.js";import"./chunk-DncHrJ4I.js";import"./chunk-CbETxTmt.js";import"./chunk-j7XJPWWF.js";import"./chunk-GLPyMM0F.js";import"./chunk-CedtSHBb.js";import"./chunk-B7d2qnKb.js";import"./chunk-D2X27E5n.js";import"./chunk-B_ghW3Ra.js";function le(){return F({queryKey:["seo-bot-settings"],queryFn:async()=>{const{data:r,error:a}=await N.functions.invoke("seo-bot",{body:{action:"get_settings"}});if(a)throw a;return r.settings}})}function ce(){const r=S();return T({mutationFn:async({key:a,value:i})=>{const{data:x,error:t}=await N.functions.invoke("seo-bot",{body:{action:"update_settings",key:a,value:i}});if(t)throw t;return x},onSuccess:()=>{r.invalidateQueries({queryKey:["seo-bot-settings"]}),p.success("Setting updated")},onError:a=>p.error("Failed to update setting: "+a.message)})}function de(){return F({queryKey:["seo-audit-runs"],queryFn:async()=>{const{data:r,error:a}=await N.functions.invoke("seo-bot",{body:{action:"get_runs"}});if(a)throw a;return r.runs||[]}})}function oe(r){return F({queryKey:["seo-metadata-history",r],queryFn:async()=>{let a=N.from("seo_metadata_history").select("*").order("created_at",{ascending:!1}).limit(100);r&&(a=a.eq("batch_id",r));const{data:i,error:x}=await a;if(x)throw x;return i||[]},enabled:!0})}function me(){const r=S();return T({mutationFn:async()=>{const{data:a,error:i}=await N.functions.invoke("seo-bot",{body:{action:"generate_metadata"}});if(i)throw i;return a},onSuccess:a=>{r.invalidateQueries({queryKey:["admin-seo-pages"]}),r.invalidateQueries({queryKey:["seo-audit-runs"]}),p.success(`Generated metadata for ${a.processed_pages} pages. ${a.duplicate_titles_found} potential duplicates found.`)},onError:a=>p.error("Failed to generate metadata: "+a.message)})}function xe(){const r=S();return T({mutationFn:async()=>{const{data:a,error:i}=await N.functions.invoke("seo-bot",{body:{action:"check_duplicates"}});if(i)throw i;return a},onSuccess:a=>{r.invalidateQueries({queryKey:["admin-seo-pages"]}),p.success(`Found ${a.exact_duplicates} exact duplicates and ${a.near_duplicates} near-duplicates.`)},onError:a=>p.error("Failed to check duplicates: "+a.message)})}function ue(){const r=S();return T({mutationFn:async({batchId:a,pageSlug:i})=>{const{data:x,error:t}=await N.functions.invoke("seo-bot",{body:{action:"rollback",batch_id:a,page_slug:i}});if(t)throw t;return x},onSuccess:a=>{r.invalidateQueries({queryKey:["admin-seo-pages"]}),r.invalidateQueries({queryKey:["seo-metadata-history"]}),p.success(`Rollback info: ${a.records_found} records found.`)},onError:a=>p.error("Failed to rollback: "+a.message)})}function Ue(){const[r,a]=L.useState("dashboard"),[i,x]=L.useState(null),{data:t,isLoading:U}=le(),{data:f,isLoading:O}=de(),{data:B,isLoading:V}=oe(i||void 0),o=ce(),R=me(),q=xe(),A=ue(),b=R.isPending||q.isPending,w=async s=>{s==="generate_metadata"?R.mutate():q.mutate()};return U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(_,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gradient-to-br from-primary to-primary/60 flex items-center justify-center",children:e.jsx(te,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"SEO Bot"}),e.jsx("p",{className:"text-muted-foreground",children:"Automated metadata generation & duplicate enforcement"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{variant:"outline",onClick:()=>w("check_duplicates"),disabled:b,children:[q.isPending?e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(J,{className:"h-4 w-4 mr-2"}),"Check Duplicates"]}),e.jsxs(u,{onClick:()=>w("generate_metadata"),disabled:b,children:[R.isPending?e.jsx(_,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(H,{className:"h-4 w-4 mr-2"}),"Generate Metadata"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(l,{className:"card-modern",children:e.jsxs(c,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal/10 flex items-center justify-center",children:e.jsx(I,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:f?.[0]?.fixed_pages||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Last Run Fixed"})]})]})}),e.jsx(l,{className:"card-modern",children:e.jsxs(c,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gold/10 flex items-center justify-center",children:e.jsx(M,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:f?.[0]?.summary?.duplicate_titles||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Duplicates Found"})]})]})}),e.jsx(l,{className:"card-modern",children:e.jsxs(c,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(D,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:f?.[0]?.total_pages||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Pages"})]})]})}),e.jsx(l,{className:"card-modern",children:e.jsxs(c,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-coral/10 flex items-center justify-center",children:e.jsx(G,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:f?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Runs"})]})]})})]}),e.jsxs(se,{value:r,onValueChange:a,children:[e.jsxs(ae,{className:"grid w-full grid-cols-4 rounded-xl",children:[e.jsx(C,{value:"dashboard",className:"rounded-xl",children:"Dashboard"}),e.jsx(C,{value:"runs",className:"rounded-xl",children:"Run History"}),e.jsx(C,{value:"history",className:"rounded-xl",children:"Change Log"}),e.jsx(C,{value:"settings",className:"rounded-xl",children:"Settings"})]}),e.jsx(k,{value:"dashboard",className:"mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(l,{className:"card-modern",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-primary"}),"Quick Actions"]}),e.jsx(y,{children:"Run SEO bot operations"})]}),e.jsxs(c,{className:"space-y-3",children:[e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>w("generate_metadata"),disabled:b,children:[e.jsx(D,{className:"h-4 w-4"}),"Generate Unique Metadata for All Pages"]}),e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-3",onClick:()=>w("check_duplicates"),disabled:b,children:[e.jsx(M,{className:"h-4 w-4"}),"Scan for Duplicate Titles/Descriptions"]}),e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-3",disabled:!0,children:[e.jsx(W,{className:"h-4 w-4"}),"Validate Canonical URLs"]}),e.jsxs(u,{variant:"outline",className:"w-full justify-start gap-3",disabled:!0,children:[e.jsx(re,{className:"h-4 w-4"}),"Refresh Sitemap Index"]})]})]}),e.jsxs(l,{className:"card-modern",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-gold"}),"Active Issues"]}),e.jsx(y,{children:"SEO problems requiring attention"})]}),e.jsx(c,{className:"space-y-3",children:f?.[0]?.summary?.duplicates?.slice(0,3).map((s,Z)=>e.jsxs("div",{className:"p-3 rounded-xl bg-gold/10 border border-gold/20",children:[e.jsx("p",{className:"text-sm font-medium text-gold",children:"Duplicate Title"}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s})]},Z))||e.jsxs("div",{className:"p-4 rounded-xl bg-teal/10 border border-teal/20 flex items-center gap-3",children:[e.jsx(I,{className:"h-5 w-5 text-teal"}),e.jsx("span",{className:"text-teal font-medium",children:"No active issues"})]})})]})]})}),e.jsx(k,{value:"runs",className:"mt-4",children:e.jsxs(l,{className:"card-modern",children:[e.jsx(g,{children:e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Audit Run History"]})}),e.jsx(c,{className:"p-0",children:O?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(_,{className:"h-6 w-6 animate-spin"})}):e.jsxs(Q,{children:[e.jsx(K,{children:e.jsxs(v,{children:[e.jsx(d,{children:"Run Type"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Started"}),e.jsx(d,{children:"Pages"}),e.jsx(d,{children:"Fixed"}),e.jsx(d,{children:"Errors"}),e.jsx(d,{className:"text-right",children:"Actions"})]})}),e.jsxs(z,{children:[f?.map(s=>e.jsxs(v,{children:[e.jsx(n,{children:e.jsx(P,{variant:"outline",className:"capitalize",children:s.run_type})}),e.jsx(n,{children:e.jsx(P,{className:s.status==="completed"?"bg-teal/20 text-teal":s.status==="running"?"bg-primary/20 text-primary":s.status==="failed"?"bg-coral/20 text-coral":"bg-muted text-muted-foreground",children:s.status})}),e.jsx(n,{className:"text-muted-foreground text-sm",children:s.started_at?E(new Date(s.started_at),"MMM d, HH:mm"):"-"}),e.jsx(n,{children:s.total_pages}),e.jsx(n,{className:"text-teal font-medium",children:s.fixed_pages}),e.jsx(n,{className:s.error_count>0?"text-coral":"",children:s.error_count}),e.jsx(n,{className:"text-right",children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>{x(s.id),a("history")},children:"View Details"})})]},s.id)),!f?.length&&e.jsx(v,{children:e.jsx(n,{colSpan:7,className:"text-center text-muted-foreground py-8",children:"No audit runs yet. Run your first audit above."})})]})]})})]})}),e.jsx(k,{value:"history",className:"mt-4",children:e.jsxs(l,{className:"card-modern",children:[e.jsxs(g,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Metadata Change History"]}),e.jsx(y,{children:"Track all metadata changes with rollback capability"})]}),i&&e.jsx(u,{variant:"outline",size:"sm",onClick:()=>x(null),children:"Clear Filter"})]}),e.jsx(c,{className:"p-0",children:V?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(_,{className:"h-6 w-6 animate-spin"})}):e.jsx(X,{className:"h-[400px]",children:e.jsxs(Q,{children:[e.jsx(K,{children:e.jsxs(v,{children:[e.jsx(d,{children:"Page"}),e.jsx(d,{children:"New Title"}),e.jsx(d,{children:"Reason"}),e.jsx(d,{children:"Changed"}),e.jsx(d,{className:"text-right",children:"Rollback"})]})}),e.jsxs(z,{children:[B?.map(s=>e.jsxs(v,{children:[e.jsx(n,{className:"font-mono text-sm truncate max-w-32",children:s.slug}),e.jsx(n,{className:"truncate max-w-48",children:s.new_title}),e.jsx(n,{className:"text-muted-foreground text-sm",children:s.change_reason}),e.jsx(n,{className:"text-muted-foreground text-sm",children:E(new Date(s.created_at),"MMM d, HH:mm")}),e.jsx(n,{className:"text-right",children:e.jsx(u,{variant:"ghost",size:"sm",onClick:()=>A.mutate({pageSlug:s.slug}),disabled:A.isPending,children:e.jsx($,{className:"h-3 w-3"})})})]},s.id)),!B?.length&&e.jsx(v,{children:e.jsx(n,{colSpan:5,className:"text-center text-muted-foreground py-8",children:"No change history yet."})})]})]})})})]})}),e.jsx(k,{value:"settings",className:"mt-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(l,{className:"card-modern",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Rate Limits"]}),e.jsx(y,{children:"Control API usage and batch sizes"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Requests per Minute"}),e.jsx(h,{type:"number",value:t?.rate_limits?.requests_per_minute||30,onChange:s=>o.mutate({key:"rate_limits",value:{...t?.rate_limits,requests_per_minute:parseInt(s.target.value)}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Pages per Batch"}),e.jsx(h,{type:"number",value:t?.rate_limits?.pages_per_batch||100,onChange:s=>o.mutate({key:"rate_limits",value:{...t?.rate_limits,pages_per_batch:parseInt(s.target.value)}})})]})]})]}),e.jsxs(l,{className:"card-modern",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5"}),"Cost Guardrails"]}),e.jsx(y,{children:"Prevent runaway costs"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Daily Budget (USD)"}),e.jsx(h,{type:"number",value:t?.cost_guardrails?.daily_budget_usd||10,onChange:s=>o.mutate({key:"cost_guardrails",value:{...t?.cost_guardrails,daily_budget_usd:parseInt(s.target.value)}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Max Pages per Run"}),e.jsx(h,{type:"number",value:t?.cost_guardrails?.max_pages_per_run||500,onChange:s=>o.mutate({key:"cost_guardrails",value:{...t?.cost_guardrails,max_pages_per_run:parseInt(s.target.value)}})})]})]})]}),e.jsxs(l,{className:"card-modern",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5"}),"Metadata Constraints"]}),e.jsx(y,{children:"Title and description length limits"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Title Min"}),e.jsx(h,{type:"number",value:t?.generation_config?.title_min_length||40,onChange:s=>o.mutate({key:"generation_config",value:{...t?.generation_config,title_min_length:parseInt(s.target.value)}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Title Max"}),e.jsx(h,{type:"number",value:t?.generation_config?.title_max_length||60,onChange:s=>o.mutate({key:"generation_config",value:{...t?.generation_config,title_max_length:parseInt(s.target.value)}})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Description Min"}),e.jsx(h,{type:"number",value:t?.generation_config?.description_min_length||120,onChange:s=>o.mutate({key:"generation_config",value:{...t?.generation_config,description_min_length:parseInt(s.target.value)}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Description Max"}),e.jsx(h,{type:"number",value:t?.generation_config?.description_max_length||160,onChange:s=>o.mutate({key:"generation_config",value:{...t?.generation_config,description_max_length:parseInt(s.target.value)}})})]})]})]})]}),e.jsxs(l,{className:"card-modern",children:[e.jsxs(g,{children:[e.jsxs(j,{className:"text-lg flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Duplicate Detection"]}),e.jsx(y,{children:"Similarity thresholds for detecting duplicates"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{children:"Title Similarity Threshold"}),e.jsx(h,{type:"number",step:"0.05",min:"0",max:"1",value:t?.similarity_threshold?.title||.85,onChange:s=>o.mutate({key:"similarity_threshold",value:{...t?.similarity_threshold,title:parseFloat(s.target.value)}})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"0.85 = 85% similar words triggers duplicate warning"})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2",children:[e.jsxs("div",{children:[e.jsx(m,{children:"Auto-fix Enabled"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Apply fixes without approval"})]}),e.jsx(ee,{checked:t?.auto_fix_enabled===!0,onCheckedChange:s=>o.mutate({key:"auto_fix_enabled",value:s})})]})]})]})]})})]})]})}export{Ue as default};
