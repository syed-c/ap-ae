import{j as e,u as y}from"./chunk-CPh6voF3.js";import{r as C}from"./chunk-CffrGP6S.js";import{B as u,ap as z,o as B,Z as K,i as I,a9 as L,aa as $,ab as O,ac as V,a as k,I as b,ae as U,s as h,b as N}from"./index-DflORfjh.js";import{C as g,d as p,a as _,b as w,c as T}from"./chunk-Dwq_v72W.js";import{T as q,a as P,b as f,c,d as E,e as n}from"./chunk-NLs5Ye4A.js";import{T as Z,a as Q,b as M,c as F}from"./chunk-k8HiDHrE.js";import{C as G}from"./chunk-BCvbbygb.js";import{E as D}from"./chunk-CbETxTmt.js";import{R as J}from"./chunk-BOvFDp2b.js";import{S as A}from"./chunk-B51FxpoB.js";import{T as W}from"./chunk-BRVan1jG.js";import{S as H}from"./chunk-C7BdFRQZ.js";import{P as X}from"./chunk-HAC-i_a2.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function ye(){const[t,d]=C.useState("cost-calculator");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(G,{className:"h-6 w-6 text-primary"}),"Tools Management"]}),e.jsx("p",{className:"text-muted-foreground",children:"Manage pricing, insurance coverage, and emergency dentist data for public tools"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:"/tools/dental-cost-calculator",target:"_blank",children:[e.jsx(D,{className:"h-4 w-4 mr-1"})," Cost Calculator"]})}),e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:"/tools/insurance-checker",target:"_blank",children:[e.jsx(D,{className:"h-4 w-4 mr-1"})," Insurance Checker"]})}),e.jsx(u,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs("a",{href:"/emergency-dentist",target:"_blank",children:[e.jsx(D,{className:"h-4 w-4 mr-1"})," Emergency Finder"]})})]})]}),e.jsxs(Z,{value:t,onValueChange:d,children:[e.jsxs(Q,{className:"w-full max-w-xl",children:[e.jsxs(M,{value:"cost-calculator",className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"})," Cost Calculator"]}),e.jsxs(M,{value:"insurance",className:"flex items-center gap-2",children:[e.jsx(B,{className:"h-4 w-4"})," Insurance"]}),e.jsxs(M,{value:"emergency",className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"})," Emergency"]})]}),e.jsx(F,{value:"cost-calculator",children:e.jsx(Y,{})}),e.jsx(F,{value:"insurance",children:e.jsx(ee,{})}),e.jsx(F,{value:"emergency",children:e.jsx(se,{})})]})]})}function Y(){const[t,d]=C.useState(null);C.useState(!1),C.useState("all");const{data:m}=y({queryKey:["admin-treatments"],queryFn:async()=>{const{data:s}=await h.from("treatments").select("id, name, slug").eq("is_active",!0).order("name");return s||[]}}),{data:o,refetch:l}=y({queryKey:["admin-budget-ranges"],queryFn:async()=>{const{data:s}=await h.from("budget_ranges").select("id, label, min_value, max_value, display_order, is_active, currency").order("display_order").order("min_value");return s||[]}}),{data:x}=y({queryKey:["admin-clinic-pricing-stats"],queryFn:async()=>{const{data:s}=await h.from("clinic_treatments").select("treatment_id, price_aed").not("price_aed","is",null),i={};return(s||[]).forEach(a=>{i[a.treatment_id]||(i[a.treatment_id]={count:0,minPrice:1/0,maxPrice:0,avgPrice:0});const r=i[a.treatment_id];r.count++,r.minPrice=Math.min(r.minPrice,a.price_aed),r.maxPrice=Math.max(r.maxPrice,a.price_aed),r.avgPrice=(r.avgPrice*(r.count-1)+a.price_aed)/r.count}),i}}),j=o,v=async s=>{const{error:i}=await h.from("budget_ranges").update({label:s.label,min_value:s.min_value,max_value:s.max_value,is_active:s.is_active}).eq("id",s.id);if(i){N.error("Failed to save");return}N.success("Budget range updated"),d(null),l()},S=async s=>{const{error:i}=await h.from("budget_ranges").delete().eq("id",s);if(i){N.error("Failed to delete");return}N.success("Deleted"),l()};return e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(g,{children:e.jsxs(p,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Treatments with Pricing"}),e.jsx("p",{className:"text-2xl font-bold",children:Object.keys(x||{}).length})]})}),e.jsx(g,{children:e.jsxs(p,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Budget Ranges Defined"}),e.jsx("p",{className:"text-2xl font-bold",children:o?.length||0})]})}),e.jsx(g,{children:e.jsxs(p,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clinics with Prices"}),e.jsx("p",{className:"text-2xl font-bold",children:Object.values(x||{}).reduce((s,i)=>s+i.count,0)})]})})]}),e.jsxs(g,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(w,{children:"Budget Ranges"}),e.jsx(T,{children:"These ranges are shown in the Cost Calculator and search filters"})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(u,{size:"sm",onClick:()=>l(),children:e.jsx(J,{className:"h-4 w-4"})})})]})}),e.jsx(p,{children:e.jsxs(q,{children:[e.jsx(P,{children:e.jsxs(f,{children:[e.jsx(c,{children:"Label"}),e.jsx(c,{className:"text-right",children:"Min (AED)"}),e.jsx(c,{className:"text-right",children:"Max (AED)"}),e.jsx(c,{className:"text-center",children:"Currency"}),e.jsx(c,{className:"text-center",children:"Status"}),e.jsx(c,{})]})}),e.jsxs(E,{children:[j?.map(s=>e.jsxs(f,{children:[e.jsx(n,{className:"font-medium",children:s.label}),e.jsx(n,{className:"text-right",children:s.min_value}),e.jsx(n,{className:"text-right",children:s.max_value}),e.jsx(n,{className:"text-center",children:s.currency||"AED"}),e.jsx(n,{className:"text-center",children:e.jsx(I,{variant:s.is_active?"default":"outline",children:s.is_active?"Active":"Inactive"})}),e.jsx(n,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>d({...s}),children:e.jsx(A,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"ghost",className:"text-destructive",onClick:()=>S(s.id),children:e.jsx(W,{className:"h-4 w-4"})})]})})]},s.id)),(!j||j.length===0)&&e.jsx(f,{children:e.jsx(n,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No budget ranges found. Add some to power the Cost Calculator."})})]})]})})]}),e.jsxs(g,{children:[e.jsxs(_,{children:[e.jsx(w,{children:"Real Clinic Pricing Data"}),e.jsx(T,{children:"Average prices submitted by dentists on the platform"})]}),e.jsx(p,{children:e.jsxs(q,{children:[e.jsx(P,{children:e.jsxs(f,{children:[e.jsx(c,{children:"Treatment"}),e.jsx(c,{className:"text-right",children:"Clinics"}),e.jsx(c,{className:"text-right",children:"Min"}),e.jsx(c,{className:"text-right",children:"Avg"}),e.jsx(c,{className:"text-right",children:"Max"})]})}),e.jsx(E,{children:m?.filter(s=>x?.[s.id]).map(s=>{const i=x[s.id];return e.jsxs(f,{children:[e.jsx(n,{className:"font-medium",children:s.name}),e.jsx(n,{className:"text-right",children:i.count}),e.jsxs(n,{className:"text-right",children:["$",i.minPrice.toFixed(0)]}),e.jsxs(n,{className:"text-right",children:["$",i.avgPrice.toFixed(0)]}),e.jsxs(n,{className:"text-right",children:["$",i.maxPrice.toFixed(0)]})]},s.id)})})]})})]}),t&&e.jsx(L,{open:!0,onOpenChange:()=>d(null),children:e.jsxs($,{children:[e.jsx(O,{children:e.jsx(V,{children:"Edit Budget Range"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Label"}),e.jsx(b,{value:t.label,onChange:s=>d({...t,label:s.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(k,{children:"Min Value (AED)"}),e.jsx(b,{type:"number",value:t.min_value,onChange:s=>d({...t,min_value:+s.target.value})})]}),e.jsxs("div",{children:[e.jsx(k,{children:"Max Value (AED)"}),e.jsx(b,{type:"number",value:t.max_value,onChange:s=>d({...t,max_value:+s.target.value})})]})]})]}),e.jsxs(U,{children:[e.jsx(u,{variant:"outline",onClick:()=>d(null),children:"Cancel"}),e.jsxs(u,{onClick:()=>v(t),children:[e.jsx(H,{className:"h-4 w-4 mr-1"})," Save"]})]})]})})]})}function ee(){const[t,d]=C.useState(null),[m,o]=C.useState(""),[l,x]=C.useState(""),{data:j,refetch:v}=y({queryKey:["admin-insurances"],queryFn:async()=>{const{data:a}=await h.from("insurances").select("id, name").order("name");return a||[]}}),{data:S}=y({queryKey:["admin-clinic-insurance-counts"],queryFn:async()=>{const{data:a}=await h.from("clinic_insurances").select("insurance_id"),r={};return(a||[]).forEach(R=>{r[R.insurance_id]=(r[R.insurance_id]||0)+1}),r}}),s=async()=>{if(!t||!m.trim())return;const{error:a}=await h.from("insurances").update({name:m.trim()}).eq("id",t);if(a){N.error("Failed");return}N.success("Updated"),d(null),v()},i=async()=>{if(!l.trim())return;const a=l.trim().toLowerCase().replace(/\s+/g,"-"),{error:r}=await h.from("insurances").insert({name:l.trim(),slug:a});if(r){N.error("Failed to add");return}N.success("Insurance added"),x(""),v()};return e.jsx("div",{className:"space-y-6 mt-4",children:e.jsxs(g,{children:[e.jsxs(_,{children:[e.jsx(w,{children:"Insurance Providers"}),e.jsx(T,{children:"Manage insurance providers shown in the Insurance Checker and clinic profiles"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{placeholder:"Add new insurance provider...",value:l,onChange:a=>x(a.target.value)}),e.jsxs(u,{onClick:i,disabled:!l.trim(),children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Add"]})]}),e.jsxs(q,{children:[e.jsx(P,{children:e.jsxs(f,{children:[e.jsx(c,{children:"Provider Name"}),e.jsx(c,{className:"text-center",children:"Clinics Accepting"}),e.jsx(c,{})]})}),e.jsx(E,{children:j?.map(a=>e.jsxs(f,{children:[e.jsx(n,{children:t===a.id?e.jsx(b,{value:m,onChange:r=>o(r.target.value),className:"w-64"}):e.jsx("span",{className:"font-medium",children:a.name})}),e.jsx(n,{className:"text-center",children:e.jsx(I,{variant:"outline",children:S?.[a.id]||0})}),e.jsx(n,{className:"text-right",children:t===a.id?e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(u,{size:"sm",onClick:s,children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>d(null),children:"Cancel"})]}):e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>{d(a.id),o(a.name)},children:e.jsx(A,{className:"h-4 w-4"})})})]},a.id))})]})]})]})})}function se(){const{data:t}=y({queryKey:["admin-emergency-stats"],queryFn:async()=>{const{count:m}=await h.from("clinics").select("id",{count:"exact",head:!0}).eq("is_active",!0).not("phone","is",null),{count:o}=await h.from("clinic_hours").select("clinic_id",{count:"exact",head:!0}),{data:l}=await h.from("clinic_hours").select("clinic_id").gte("close_time","20:00:00").eq("is_closed",!1),x=new Set((l||[]).map(j=>j.clinic_id));return{totalClinics:m||0,withHours:o||0,extendedHours:x.size}}}),{data:d}=y({queryKey:["admin-city-clinic-coverage"],queryFn:async()=>{const{data:m}=await h.from("clinics").select("city_id, cities(name, states(abbreviation))").eq("is_active",!0).not("phone","is",null),o={};return(m||[]).forEach(l=>{const x=l.cities?.name||"Unknown",j=l.cities?.states?.abbreviation||"",v=`${x}-${j}`;o[v]||(o[v]={name:x,state:j,count:0}),o[v].count++}),Object.values(o).sort((l,x)=>x.count-l.count).slice(0,30)}});return e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(g,{children:e.jsxs(p,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clinics with Phone"}),e.jsx("p",{className:"text-2xl font-bold",children:t?.totalClinics||0})]})}),e.jsx(g,{children:e.jsxs(p,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clinics with Hours Set"}),e.jsx("p",{className:"text-2xl font-bold",children:t?.withHours||0})]})}),e.jsx(g,{children:e.jsxs(p,{className:"pt-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Extended Hours (8PM+)"}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:t?.extendedHours||0})]})})]}),e.jsxs(g,{children:[e.jsxs(_,{children:[e.jsx(w,{children:"City Coverage"}),e.jsx(T,{children:"Top cities by number of clinics available for emergency search"})]}),e.jsx(p,{children:e.jsxs(q,{children:[e.jsx(P,{children:e.jsxs(f,{children:[e.jsx(c,{children:"City"}),e.jsx(c,{children:"State"}),e.jsx(c,{className:"text-right",children:"Clinics"})]})}),e.jsx(E,{children:d?.map((m,o)=>e.jsxs(f,{children:[e.jsx(n,{className:"font-medium",children:m.name}),e.jsx(n,{children:m.state}),e.jsx(n,{className:"text-right",children:e.jsx(I,{variant:"outline",children:m.count})})]},o))})]})})]})]})}export{ye as default};
