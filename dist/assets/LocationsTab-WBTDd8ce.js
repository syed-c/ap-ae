import{j as e,b as os,u as Je,c as Oe}from"./chunk-CPh6voF3.js";import{r as a}from"./chunk-CffrGP6S.js";import{u as ps,a as fs,b as vs,c as Ns,d as ws,e as bs,f as ys,g as Cs,h as Ss,i as _s,j as As,k as ks,l as Ts}from"./chunk-DlLtMEml.js";import{C as g,a as X,b as K,d as p,c as Xe}from"./chunk-Dwq_v72W.js";import{f as Ps,s as F,b as M,L as Q,B as j,G as xs,i as z,aF as es,aG as ss,S as ts,C as we,x as hs,aI as ms,Y as Fs,y as Es,bA as Ls,a as P,a2 as ie,a3 as ne,a5 as le,a6 as re,a7 as c,p as Ke,I as B,b7 as as,a9 as Ge,aa as Ve,ab as De,ac as Ue,ad as Ms,bc as Ie}from"./index-DflORfjh.js";import{S as Te}from"./chunk-DfjE-bP6.js";import{T as Ee,a as Le,b as R,c as u,d as Me,e as h}from"./chunk-NLs5Ye4A.js";import{T as zs,a as $s,b as Pe,c as Fe}from"./chunk-k8HiDHrE.js";import{P as He}from"./chunk-DSDQubI6.js";import{C as is,a as ns,b as ls}from"./chunk-CEjy5RHq.js";import{R as us}from"./chunk-BOvFDp2b.js";import{B as js}from"./chunk-BiqSGqdV.js";import{C as rs}from"./chunk-GLPyMM0F.js";import{C as Rs}from"./chunk-CbEmr7WL.js";import{f as cs}from"./chunk-D4OU6rOw.js";import{S as Gs}from"./chunk-FxOzQZIr.js";import{F as gs}from"./chunk-BaL04tya.js";import{F as Vs}from"./chunk-7oaXC-Tp.js";import{F as Ds}from"./chunk-CwDzaQ9n.js";import{S as Us}from"./chunk-D0B-jfny.js";import{S as Hs}from"./chunk-Beq7cUgv.js";import{S as qs}from"./chunk-qKgaU6ML.js";import{E as Ye}from"./chunk-CcezodbN.js";import{F as Ws}from"./chunk-3oqKMbN4.js";import{P as Be}from"./chunk-HAC-i_a2.js";import{E as ds}from"./chunk-Dfi7JVLs.js";import{S as Qe}from"./chunk-B51FxpoB.js";import"./chunk-BSjc5zjM.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-CKWDY2Lf.js";import"./chunk-C2VW2Ml6.js";import"./chunk-I1o_Hd8I.js";import"./chunk-CyRXX0qx.js";import"./chunk-DncHrJ4I.js";import"./chunk-CbETxTmt.js";import"./chunk-j7XJPWWF.js";import"./chunk-DbdCK11k.js";import"./chunk-CedtSHBb.js";import"./chunk-B7d2qnKb.js";import"./chunk-D2X27E5n.js";import"./chunk-Bl7VVhKV.js";import"./chunk-B_ghW3Ra.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Os=Ps("FileX",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]]);function Is(){const[d,f]=a.useState(null),[Y,Z]=a.useState(!0),[D,ce]=a.useState(!1),[H,q]=a.useState(!1),[N,U]=a.useState(null),[k,J]=a.useState(null),[T,je]=a.useState(!1),[y,be]=a.useState(!1);a.useEffect(()=>{C()},[]);const C=async()=>{Z(!0);try{const{data:m,error:v}=await F.functions.invoke("clinic-redistribution",{body:{action:"stats"}});if(v)throw v;const{data:Ce}=await F.from("cities").select(`
          id,
          name, 
          state:states(name)
        `).eq("is_active",!0).or("latitude.is.null,longitude.is.null").order("name"),W=[];for(const de of Ce||[]){const{count:ee}=await F.from("clinics").select("*",{count:"exact",head:!0}).eq("city_id",de.id).eq("is_active",!0),ge=de.state;W.push({name:de.name,state:ge?.name||"Unknown",clinicCount:ee||0})}f({cities:{...m.cities,missingList:W},clinics:m.clinics})}catch(m){console.error("Failed to fetch stats:",m),M.error("Failed to fetch redistribution stats")}finally{Z(!1)}},ye=async()=>{ce(!0),U(null);try{const{data:m,error:v}=await F.functions.invoke("clinic-redistribution",{body:{action:"geocode-cities"}});if(v)throw v;U(m),M.success(`Geocoded ${m.updated} cities!`),C()}catch(m){M.error("Geocoding failed: "+m.message)}finally{ce(!1)}},w=async()=>{q(!0),J(null);try{const{data:m,error:v}=await F.functions.invoke("clinic-redistribution",{body:{action:"redistribute-clinics"}});if(v)throw v;J(m),m.reassigned>0?M.success(`Reassigned ${m.reassigned} clinics to correct cities!`):M.info("All clinics are already in their nearest city."),C()}catch(m){M.error("Redistribution failed: "+m.message)}finally{q(!1)}},he=()=>d?Math.round(d.cities.withCoordinates/d.cities.total*100):0,G=()=>d?Math.round(d.clinics.withCoordinates/d.clinics.total*100):0;return Y?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-3 text-muted-foreground",children:"Loading redistribution stats..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Clinic Redistribution (UAE)"}),e.jsx("p",{className:"text-muted-foreground",children:"Ensure clinics are assigned to their correct nearest area based on UAE GPS coordinates"})]}),e.jsxs(j,{variant:"outline",onClick:C,disabled:Y,children:[e.jsx(us,{className:`h-4 w-4 mr-2 ${Y?"animate-spin":""}`}),"Refresh Stats"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(g,{children:[e.jsx(X,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(K,{className:"text-base flex items-center gap-2",children:[e.jsx(xs,{className:"h-5 w-5 text-primary"}),"City Coordinate Coverage"]}),e.jsxs(z,{variant:he()===100?"default":"secondary",children:[he(),"%"]})]})}),e.jsxs(p,{className:"space-y-3",children:[e.jsx(He,{value:he(),className:"h-2"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"text-center p-2 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold",children:d?.cities.total||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Cities"})]}),e.jsxs("div",{className:"text-center p-2 bg-primary/10 rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold text-primary",children:d?.cities.withCoordinates||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"With Coords"})]}),e.jsxs("div",{className:"text-center p-2 bg-destructive/10 rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold text-destructive",children:d?.cities.withoutCoordinates||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Missing"})]})]})]})]}),e.jsxs(g,{children:[e.jsx(X,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(K,{className:"text-base flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5 text-blue-custom"}),"Clinic Coordinate Coverage"]}),e.jsxs(z,{variant:G()>=95?"default":"secondary",children:[G(),"%"]})]})}),e.jsxs(p,{className:"space-y-3",children:[e.jsx(He,{value:G(),className:"h-2"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"text-center p-2 bg-muted rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold",children:d?.clinics.total||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Clinics"})]}),e.jsxs("div",{className:"text-center p-2 bg-primary/10 rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold text-primary",children:d?.clinics.withCoordinates||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"With Coords"})]}),e.jsxs("div",{className:"text-center p-2 bg-destructive/10 rounded-lg",children:[e.jsx("p",{className:"text-xl font-bold text-destructive",children:d?.clinics.withoutCoordinates||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Missing"})]})]})]})]})]}),d?.cities.withoutCoordinates>0&&e.jsx(is,{open:T,onOpenChange:je,children:e.jsxs(g,{className:"border-destructive/50",children:[e.jsxs(X,{className:"pb-2",children:[e.jsx(ns,{asChild:!0,children:e.jsxs(j,{variant:"ghost",className:"w-full justify-between p-0 h-auto hover:bg-transparent",children:[e.jsxs(K,{className:"text-base flex items-center gap-2 text-destructive",children:[e.jsx(rs,{className:"h-5 w-5"}),d.cities.withoutCoordinates," Cities Missing Coordinates"]}),T?e.jsx(es,{className:"h-5 w-5"}):e.jsx(ss,{className:"h-5 w-5"})]})}),e.jsx(Xe,{children:"These cities need coordinates added to the system database"})]}),e.jsx(ls,{children:e.jsx(p,{children:e.jsx(ts,{className:"h-[200px]",children:e.jsxs(Ee,{children:[e.jsx(Le,{children:e.jsxs(R,{children:[e.jsx(u,{children:"City"}),e.jsx(u,{children:"State"}),e.jsx(u,{className:"text-right",children:"Clinics"})]})}),e.jsx(Me,{children:d.cities.missingList?.map((m,v)=>e.jsxs(R,{children:[e.jsx(h,{className:"font-medium",children:m.name}),e.jsx(h,{className:"text-muted-foreground",children:m.state}),e.jsx(h,{className:"text-right",children:e.jsx(z,{variant:m.clinicCount>0?"destructive":"secondary",children:m.clinicCount})})]},v))})]})})})})]})}),e.jsxs(g,{children:[e.jsxs(X,{children:[e.jsx(K,{children:"Redistribution Actions"}),e.jsx(Xe,{children:"Follow these steps to ensure all clinics are in the correct city"})]}),e.jsxs(p,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-4 p-4 border rounded-xl",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold flex-shrink-0",children:"1"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:"Geocode Cities"}),N&&e.jsxs(z,{variant:"default",className:"gap-1",children:[e.jsx(we,{className:"h-3 w-3"}),"Updated ",N.updated]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add latitude/longitude coordinates to areas using the built-in UAE coordinate database. This enables distance-based matching across all 7 Emirates."}),e.jsx(j,{onClick:ye,disabled:D,size:"sm",children:D?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),"Run Geocoding"]})}),N&&e.jsxs("div",{className:"mt-3 p-3 bg-muted rounded-lg space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4 text-primary"}),e.jsxs("span",{children:["Updated: ",e.jsx("strong",{children:N.updated})," cities"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Rs,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("span",{children:["Not in database: ",e.jsx("strong",{children:N.notFound})," cities"]})]})]}),N.notFoundCities?.length>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsx("p",{className:"font-medium mb-1",children:"Cities not in coordinate database:"}),e.jsx("p",{className:"line-clamp-2",children:N.notFoundCities.join(", ")})]})]})]})]}),e.jsxs("div",{className:"flex items-start gap-4 p-4 border rounded-xl",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center text-sm font-bold flex-shrink-0",children:"2"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"font-semibold",children:"Redistribute Clinics"}),k&&e.jsx(z,{variant:k.reassigned>0?"default":"secondary",className:"gap-1",children:k.reassigned>0?e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-3 w-3"}),"Moved ",k.reassigned]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-3 w-3"}),"All correct"]})})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Reassign clinics to their nearest area based on UAE GPS coordinates. Only clinics with coordinates will be processed."}),e.jsx(j,{onClick:w,disabled:H||d?.cities.withCoordinates===0,size:"sm",children:H?e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"Run Redistribution"]})}),k&&e.jsxs("div",{className:"mt-3 p-3 bg-muted rounded-lg space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-sm",children:[e.jsxs("div",{className:"text-center p-2 bg-background rounded",children:[e.jsx("p",{className:"text-lg font-bold",children:k.totalProcessed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Processed"})]}),e.jsxs("div",{className:"text-center p-2 bg-primary/10 rounded",children:[e.jsx("p",{className:"text-lg font-bold text-primary",children:k.reassigned}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reassigned"})]}),e.jsxs("div",{className:"text-center p-2 bg-background rounded",children:[e.jsx("p",{className:"text-lg font-bold",children:k.unchanged}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Unchanged"})]})]}),k.sampleChanges?.length>0&&e.jsxs(is,{open:y,onOpenChange:be,children:[e.jsx(ns,{asChild:!0,children:e.jsxs(j,{variant:"ghost",size:"sm",className:"w-full justify-between",children:[e.jsxs("span",{className:"text-sm font-medium",children:["View Sample Changes (",k.sampleChanges.length,")"]}),y?e.jsx(es,{className:"h-4 w-4"}):e.jsx(ss,{className:"h-4 w-4"})]})}),e.jsx(ls,{children:e.jsx(ts,{className:"h-[150px] mt-2",children:e.jsx("div",{className:"space-y-1",children:k.sampleChanges.map((m,v)=>e.jsxs("div",{className:"flex items-center gap-2 text-xs p-2 bg-background rounded",children:[e.jsx("span",{className:"font-medium truncate max-w-[150px]",title:m.clinic,children:m.clinic}),e.jsx("span",{className:"text-muted-foreground",children:m.from}),e.jsx(Fs,{className:"h-3 w-3 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-primary",children:m.to}),e.jsxs(z,{variant:"outline",className:"text-xs ml-auto",children:[m.distance,"km"]})]},v))})})})]})]})]})]})]})]}),e.jsx(g,{className:"bg-muted/50 border-dashed",children:e.jsx(p,{className:"pt-4",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx(rs,{className:"h-5 w-5 text-muted-foreground flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"How it works:"})," The system uses GPS coordinates to calculate the distance between each clinic and all cities in the same state. Each clinic is assigned to the nearest city."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Requirements:"})," Both cities and clinics need latitude/longitude coordinates. Clinics without coordinates will be skipped. Cities without coordinates won't be considered as destinations."]})]})]})})})]})}function Bs(){os();const[d,f]=a.useState(new Set),[Y,Z]=a.useState(!1),[D,ce]=a.useState({current:0,total:0,status:""}),[H,q]=a.useState(null),[N,U]=a.useState(null),[k,J]=a.useState(!1),[T,je]=a.useState("all"),[y,be]=a.useState("all"),[C,ye]=a.useState(""),[w,he]=a.useState("all"),[G,m]=a.useState(700),[v,Ce]=a.useState(!1),W=a.useRef(null),[de,ee]=a.useState(0),[ge,O]=a.useState(600),Se=t=>{const n=t??0;return n>=300?"good":n>=1?"thin":"missing"},ze=["ca","ct","ma","nj"],me=a.useCallback((t,n)=>{if(!t)return!1;if(["static","blog","treatment","clinic"].includes(n))return!0;const l=t.toLowerCase().replace(/^\//,"");if(l.startsWith("clinic/")||l.startsWith("dentist/")||l.startsWith("services")||l.startsWith("blog")||l.startsWith("insurance"))return!0;for(const r of ze)if(l===r||l.startsWith(`${r}/`))return!0;return!1},[]),{data:E,isLoading:oe,refetch:_e}=Je({queryKey:["content-health-stats-v2"],queryFn:async()=>{const t=await cs(async(i,x)=>{const{data:b,error:A}=await F.from("seo_pages").select("page_type, word_count, slug").range(i,x);if(A)throw A;return b||[]}),{data:n,error:l}=await F.from("blog_posts").select("id, slug, content, status").eq("status","published");if(l)throw l;const r={total:0,good:0,thin:0,missing:0,byType:[]},o=new Map;for(const i of t){const x=i.page_type||"unknown";if(x==="blog"||!me(i.slug,x))continue;const b=Se(i.word_count);r.total++,r[b]++,o.has(x)||o.set(x,{total:0,good:0,thin:0,missing:0});const A=o.get(x);A.total++,A[b]++}for(const i of n||[]){let x=0;if(i.content){const Ne=(typeof i.content=="object"&&i.content.body?i.content.body:"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();x=Ne?Ne.split(" ").length:0}const b=Se(x);r.total++,r[b]++;const A="blog";o.has(A)||o.set(A,{total:0,good:0,thin:0,missing:0});const s=o.get(A);s.total++,s[b]++}return r.byType=Array.from(o.entries()).map(([i,x])=>({page_type:i,...x})).sort((i,x)=>x.missing-i.missing),r},staleTime:6e4}),{data:S,isLoading:qe,refetch:ue}=Je({queryKey:["content-management-pages-v2",T,y,C],queryFn:async()=>{const t=[];if(T==="blog"||T==="all"){const{data:r,error:o}=await F.from("blog_posts").select("id, slug, title, seo_title, seo_description, content, status, updated_at, published_at").eq("status","published");if(o)throw o;for(const i of r||[]){let x=0;if(i.content){const s=(typeof i.content=="object"&&i.content.body?i.content.body:"").replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim();x=s?s.split(" ").length:0}const b=Se(x);if(!(y==="good"&&b!=="good")&&!(y==="thin"&&b!=="thin")&&!(y==="missing"&&b!=="missing")){if(C){const A=C.toLowerCase();if(!i.slug?.toLowerCase().includes(A)&&!i.title?.toLowerCase().includes(A))continue}t.push({id:i.id,page_type:"blog",slug:`/blog/${i.slug}`,title:i.title,meta_title:i.seo_title,meta_description:i.seo_description,h1:i.title,content:null,word_count:x,is_thin_content:x>0&&x<300,is_duplicate:!1,is_indexed:!0,updated_at:i.updated_at||i.published_at||"",last_generated_at:null})}}}if(T==="blog")return t.sort((r,o)=>new Date(o.updated_at).getTime()-new Date(r.updated_at).getTime());const l=await cs(async(r,o)=>{let i=F.from("seo_pages").select("id, page_type, slug, title, h1, word_count, is_thin_content, is_duplicate, is_indexed, updated_at, last_generated_at").neq("page_type","blog").order("updated_at",{ascending:!1});T!=="all"&&(i=i.eq("page_type",T)),C&&(i=i.or(`slug.ilike.%${C}%,title.ilike.%${C}%`)),y==="good"?i=i.gte("word_count",300):y==="thin"?i=i.gte("word_count",1).lt("word_count",300):y==="missing"&&(i=i.or("word_count.is.null,word_count.eq.0"));const{data:x,error:b}=await i.range(r,o);if(b)throw b;return x||[]},{chunkSize:1e3});for(const r of l)me(r.slug,r.page_type)&&t.push(r);return t.sort((r,o)=>new Date(o.updated_at).getTime()-new Date(r.updated_at).getTime())}}),xe=a.useMemo(()=>w==="all"?1/0:Number(w),[w]),_=a.useMemo(()=>S?Number.isFinite(xe)?S.slice(0,xe):S:[],[S,xe]),I=a.useMemo(()=>{const t=_.length;if(!(w==="all"&&t>0))return{isVirtual:!1,total:t,start:0,end:t,topSpacer:0,bottomSpacer:0,visible:_};const l=56,r=12,o=Math.max(0,Math.floor(de/l)-r),i=Math.ceil(ge/l)+r*2,x=Math.min(t,o+i),b=o*l,A=(t-x)*l;return{isVirtual:!0,total:t,start:o,end:x,topSpacer:b,bottomSpacer:A,visible:_.slice(o,x)}},[_,w,de,ge]),pe=a.useCallback((t,n)=>{t(n),f(new Set)},[]);a.useEffect(()=>{const t=W.current;if(!t)return;const n=()=>O(t.clientHeight||600);return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const fe=Oe({mutationFn:async t=>{Z(!0),ce({current:0,total:t.length,status:"Starting..."});const n={success:0,failed:0,errors:[]};for(let l=0;l<t.length;l++){const r=t[l];ce({current:l+1,total:t.length,status:`Generating content for page ${l+1}/${t.length}...`});try{const{data:o}=await F.auth.getSession(),{data:i,error:x}=await F.functions.invoke("content-generation-studio",{body:{action:"generate_content",page_id:r,config:{word_count:G}},headers:{Authorization:`Bearer ${o?.session?.access_token}`}});if(x)throw x;if(i?.error)throw new Error(i.error);n.success++}catch(o){n.failed++,n.errors.push(`Page ${r}: ${o instanceof Error?o.message:"Unknown error"}`)}l<t.length-1&&await new Promise(o=>setTimeout(o,2e3))}return n},onSuccess:t=>{Z(!1),f(new Set),ue(),_e(),t.failed===0?M.success(`Successfully generated content for ${t.success} pages`):(M.warning(`Generated ${t.success} pages, ${t.failed} failed`),console.error("Generation errors:",t.errors))},onError:t=>{Z(!1),M.error(`Generation failed: ${t instanceof Error?t.message:"Unknown error"}`)}}),Ae=Oe({mutationFn:async t=>{const{data:n}=await F.auth.getSession(),{data:l,error:r}=await F.functions.invoke("content-generation-studio",{body:{action:"preview_content",page_id:t,config:{word_count:700}},headers:{Authorization:`Bearer ${n?.session?.access_token}`}});if(r)throw r;if(l?.error)throw new Error(l.error);return l},onSuccess:t=>{U(t),J(!1)},onError:t=>{J(!1),M.error(`Preview failed: ${t instanceof Error?t.message:"Unknown error"}`)}}),L=Oe({mutationFn:async({pageId:t,content:n})=>{const{data:l}=await F.auth.getSession(),{data:r,error:o}=await F.functions.invoke("content-generation-studio",{body:{action:"apply_content",page_id:t,content:n},headers:{Authorization:`Bearer ${l?.session?.access_token}`}});if(o)throw o;if(r?.error)throw new Error(r.error);return r},onSuccess:()=>{q(null),U(null),ue(),_e(),M.success("Content applied successfully")},onError:t=>{M.error(`Apply failed: ${t instanceof Error?t.message:"Unknown error"}`)}}),se=()=>{if(w==="all"){$();return}if(!_)return;const t=_.map(l=>l.id);if(t.every(l=>d.has(l))){const l=new Set(d);t.forEach(r=>l.delete(r)),f(l)}else{const l=new Set(d);t.forEach(r=>l.add(r)),f(l)}},$=()=>{if(!S)return;const t=S.map(n=>n.id);d.size===t.length?f(new Set):f(new Set(t)),M.success(`Selected ${t.length} pages matching current filters`)},te=t=>{const n=new Set(d);n.has(t)?n.delete(t):n.add(t),f(n)},V=()=>{if(d.size===0){M.error("Please select at least one page");return}fe.mutate(Array.from(d))},ae=t=>{q(t),J(!0),U(null),Ae.mutate(t.id)},$e=()=>{!H||!N||L.mutate({pageId:H.id,content:N})},ke=t=>{const n=t??0;return n>=300?{status:"good",label:"Good",color:"bg-green-500"}:n>=1?{status:"thin",label:"Thin",color:"bg-yellow-500"}:{status:"missing",label:"Missing",color:"bg-red-500"}},Re=E?Math.round(E.good/E.total*100):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(g,{children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-muted flex items-center justify-center",children:e.jsx(gs,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:oe?"...":E?.total||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Pages"})]})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(Vs,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:oe?"...":E?.good||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Good (≥300 words)"})]})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-yellow-100 flex items-center justify-center",children:e.jsx(Ds,{className:"h-6 w-6 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:oe?"...":E?.thin||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Thin (1-299 words)"})]})]})}),e.jsx(g,{children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(Os,{className:"h-6 w-6 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:oe?"...":E?.missing||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Missing (no content)"})]})]})})]}),e.jsxs(g,{children:[e.jsx(X,{className:"pb-2",children:e.jsx(K,{className:"text-sm font-medium",children:"Content Coverage"})}),e.jsxs(p,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-baseline justify-between",children:[e.jsxs("span",{className:"text-3xl font-bold",children:[Re,"%"]}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[E?.good||0," of ",E?.total||0," pages have quality content"]})]}),e.jsx(He,{value:Re,className:"h-3"})]})]}),E?.byType&&E.byType.length>0&&e.jsxs(g,{children:[e.jsx(X,{children:e.jsx(K,{className:"text-sm font-medium",children:"Content Health by Page Type"})}),e.jsx(p,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:E.byType.map(t=>e.jsxs("div",{className:"p-3 rounded-lg border bg-card hover:bg-accent/50 cursor-pointer transition-colors",onClick:()=>je(t.page_type),children:[e.jsx("p",{className:"font-medium text-sm capitalize",children:t.page_type.replace(/_/g," ")}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[e.jsx("span",{className:"text-green-600",children:t.good})," / ",e.jsx("span",{className:"text-yellow-600",children:t.thin})," / ",e.jsx("span",{className:"text-red-600",children:t.missing})]}),e.jsxs("div",{className:"flex gap-0.5 mt-2",children:[e.jsx("div",{className:"h-1.5 bg-green-500 rounded-l",style:{width:`${t.good/t.total*100}%`}}),e.jsx("div",{className:"h-1.5 bg-yellow-500",style:{width:`${t.thin/t.total*100}%`}}),e.jsx("div",{className:"h-1.5 bg-red-500 rounded-r",style:{width:`${t.missing/t.total*100}%`}})]})]},t.page_type))})})]}),Y&&e.jsx(g,{className:"border-primary",children:e.jsxs(p,{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 animate-spin text-primary"}),e.jsx("span",{className:"font-medium",children:"Generating Content..."})]}),e.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>Z(!1),children:[e.jsx(Us,{className:"h-4 w-4 mr-1"}),"Stop"]})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:D.status}),e.jsx(He,{value:D.current/D.total*100,className:"h-2"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[D.current," of ",D.total," pages"]})]})}),e.jsxs(g,{children:[e.jsxs(X,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(K,{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"h-5 w-5"}),"Content Generation"]}),e.jsxs(Xe,{children:["Select pages to generate unique, SEO-optimized content • ",S?.length||0," pages match filters"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>Ce(!v),children:[e.jsx(Hs,{className:"h-4 w-4 mr-1"}),"Settings"]}),e.jsxs(j,{variant:"outline",size:"sm",onClick:$,disabled:!S||S.length===0,children:[e.jsx(qs,{className:"h-4 w-4 mr-1"}),"Select All (",S?.length||0,")"]}),e.jsxs(j,{onClick:V,disabled:d.size===0||Y,children:[Y?e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(Ls,{className:"h-4 w-4 mr-2"}),"Generate (",d.size,")"]}),e.jsx(j,{variant:"outline",onClick:()=>{ue(),_e()},children:e.jsx(us,{className:"h-4 w-4"})})]})]}),v&&e.jsx(g,{className:"mt-4 border-dashed",children:e.jsx(p,{className:"p-4 space-y-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Target Word Count"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Gs,{value:[G],onValueChange:t=>m(t[0]),min:300,max:2e3,step:100,className:"flex-1"}),e.jsx("span",{className:"text-sm font-mono w-16 text-right",children:G})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Words per page (300-2000)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Rows Per Page"}),e.jsxs(ie,{value:w,onValueChange:t=>he(t),children:[e.jsx(ne,{children:e.jsx(le,{})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All (single scroll)"}),e.jsx(c,{value:"25",children:"25 rows"}),e.jsx(c,{value:"50",children:"50 rows"}),e.jsx(c,{value:"100",children:"100 rows"}),e.jsx(c,{value:"200",children:"200 rows"}),e.jsx(c,{value:"500",children:"500 rows"}),e.jsx(c,{value:"1000",children:"1,000 rows"}),e.jsx(c,{value:"2500",children:"2,500 rows"}),e.jsx(c,{value:"5000",children:"5,000 rows"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{className:"text-sm font-medium",children:"Quick Actions"}),e.jsx("div",{className:"flex gap-2",children:e.jsx(j,{variant:"outline",size:"sm",onClick:()=>f(new Set),disabled:d.size===0,children:"Clear Selection"})})]})]})})}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search by slug or title...",value:C,onChange:t=>ye(t.target.value),className:"pl-9"})]}),e.jsxs(ie,{value:T,onValueChange:t=>pe(je,t),children:[e.jsx(ne,{className:"w-[160px]",children:e.jsx(le,{placeholder:"Page Type"})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All Types"}),e.jsx(c,{value:"state",children:"State"}),e.jsx(c,{value:"city",children:"City"}),e.jsx(c,{value:"treatment",children:"Treatment"}),e.jsx(c,{value:"service_location",children:"Service Location"}),e.jsx(c,{value:"clinic",children:"Clinic"}),e.jsx(c,{value:"dentist",children:"Dentist"}),e.jsx(c,{value:"blog",children:"Blog"})]})]}),e.jsxs(ie,{value:y,onValueChange:t=>pe(be,t),children:[e.jsx(ne,{className:"w-[160px]",children:e.jsx(le,{placeholder:"Content Status"})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"good",children:"Good (≥300 words)"}),e.jsx(c,{value:"thin",children:"Thin (1-299 words)"}),e.jsx(c,{value:"missing",children:"Missing (no content)"})]})]})]})]}),e.jsx(p,{children:qe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Q,{className:"h-6 w-6 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsx("div",{ref:W,className:w==="all"?"max-h-[70vh] overflow-y-auto":void 0,onScroll:t=>{w==="all"&&ee(t.currentTarget.scrollTop)},children:e.jsxs(Ee,{children:[e.jsx(Le,{children:e.jsxs(R,{children:[e.jsx(u,{className:"w-12",children:e.jsx(as,{checked:_&&_.length>0&&(w==="all"?d.size===_.length:_.every(t=>d.has(t.id))),onCheckedChange:se})}),e.jsx(u,{children:"Page"}),e.jsx(u,{children:"Type"}),e.jsx(u,{children:"Words"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Updated"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsxs(Me,{children:[I.topSpacer>0&&e.jsx(R,{children:e.jsx(h,{colSpan:7,style:{height:I.topSpacer}})}),I.visible?.map(t=>{const n=ke(t.word_count);return e.jsxs(R,{children:[e.jsx(h,{children:e.jsx(as,{checked:d.has(t.id),onCheckedChange:()=>te(t.id)})}),e.jsx(h,{children:e.jsxs("div",{className:"max-w-[300px]",children:[e.jsx("p",{className:"font-medium truncate",children:t.title||t.h1||t.slug}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.slug})]})}),e.jsx(h,{children:e.jsx(z,{variant:"outline",className:"capitalize",children:t.page_type?.replace(/_/g," ")})}),e.jsx(h,{children:e.jsx("span",{className:n.status==="missing"?"text-red-600":n.status==="thin"?"text-yellow-600":"text-green-600",children:t.word_count||0})}),e.jsx(h,{children:e.jsx(z,{variant:n.status==="good"?"default":n.status==="thin"?"secondary":"destructive",children:n.label})}),e.jsx(h,{className:"text-muted-foreground text-sm",children:new Date(t.updated_at).toLocaleDateString()}),e.jsx(h,{className:"text-right",children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>ae(t),children:e.jsx(Ye,{className:"h-4 w-4"})})})]},t.id)}),I.bottomSpacer>0&&e.jsx(R,{children:e.jsx(h,{colSpan:7,style:{height:I.bottomSpacer}})}),(!_||_.length===0)&&e.jsx(R,{children:e.jsx(h,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No pages found matching your filters"})})]})]})})}),S&&S.length>0&&e.jsxs("p",{className:"text-sm text-muted-foreground mt-3",children:["Showing ",_.length," of ",S.length," pages",w==="all"?" (single scroll)":"",d.size>0?` • ${d.size} selected`:""]})]})})]}),e.jsx(Ge,{open:!!H,onOpenChange:()=>{q(null),U(null)},children:e.jsxs(Ve,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(De,{children:[e.jsx(Ue,{children:"Content Preview"}),e.jsx(Ms,{children:H?.slug})]}),k?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(Q,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("span",{className:"ml-3",children:"Generating preview..."})]}):N?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Meta Title"}),e.jsx("p",{className:"text-sm text-muted-foreground border rounded p-2 mt-1",children:N.meta_title})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"H1"}),e.jsx("p",{className:"text-sm text-muted-foreground border rounded p-2 mt-1",children:N.h1})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Meta Description"}),e.jsx("p",{className:"text-sm text-muted-foreground border rounded p-2 mt-1",children:N.meta_description})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:["Content",e.jsxs(z,{variant:"outline",children:[N.word_count," words"]})]}),e.jsx("div",{className:"border rounded p-4 mt-1 max-h-[400px] overflow-y-auto prose prose-sm dark:prose-invert",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:N.content?.replace(/^## (.+)$/gm,"<h2>$1</h2>")?.replace(/^### (.+)$/gm,"<h3>$1</h3>")?.replace(/\n\n/g,"</p><p>")?.replace(/^/gm,"<p>")?.replace(/$/gm,"</p>")||""}})})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(j,{variant:"outline",onClick:()=>{q(null),U(null)},children:"Cancel"}),e.jsxs(j,{onClick:$e,disabled:L.isPending,children:[L.isPending?e.jsx(Q,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(we,{className:"h-4 w-4 mr-2"}),"Apply Content"]})]})]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"Failed to generate preview"})]})})]})}function Ht(){os();const{data:d}=ps(),{data:f,isLoading:Y}=fs(),{data:Z}=vs(),D=Ns(),ce=ws(),H=bs(),q=ys(),N=Cs(),U=Ss(),k=_s(),J=As(),[T,je]=a.useState(""),[y,be]=a.useState("all"),[C,ye]=a.useState("all"),[w,he]=a.useState("all"),[G,m]=a.useState(""),[v,Ce]=a.useState("all"),[W,de]=a.useState("all"),[ee,ge]=a.useState("all"),{data:O,isLoading:Se}=ks(w!=="all"?w:void 0),{data:ze}=Ts(),me=a.useMemo(()=>new Set(ze?.map(s=>s.id)||[]),[ze]),[E,oe]=a.useState(!1),[_e,S]=a.useState(!1),[qe,ue]=a.useState(!1),[xe,_]=a.useState(null),[I,pe]=a.useState(null),[fe,Ae]=a.useState(null),[L,se]=a.useState({name:"",slug:"",state_id:"",is_active:!0}),[$,te]=a.useState({name:"",slug:"",city_id:"",is_active:!0}),[V,ae]=a.useState({name:"",abbreviation:"",slug:"",country_code:"US",is_active:!0}),$e=a.useMemo(()=>f?f.filter(s=>{const ve=T===""||s.name.toLowerCase().includes(T.toLowerCase())||s.abbreviation?.toLowerCase().includes(T.toLowerCase()),Ne=y==="all"||y==="active"&&s.is_active||y==="inactive"&&!s.is_active,We=C==="all"||s.seo_status===C;return ve&&Ne&&We}):[],[f,T,y,C]),ke=a.useMemo(()=>O?O.filter(s=>{const ve=G===""||s.name.toLowerCase().includes(G.toLowerCase()),Ne=v==="all"||v==="active"&&s.is_active||v==="inactive"&&!s.is_active,We=W==="all"||s.seo_status===W,Ze=me.has(s.id);return ve&&Ne&&We&&(ee==="all"||ee==="yes"&&Ze||ee==="no"&&!Ze)}):[],[O,G,v,W,ee,me]),Re=async()=>{xe?await ce.mutateAsync({id:xe.id,updates:L}):await D.mutateAsync(L),oe(!1),_(null),se({name:"",slug:"",state_id:"",is_active:!0})},t=async()=>{I?await q.mutateAsync({id:I.id,updates:$}):await H.mutateAsync($),S(!1),pe(null),te({name:"",slug:"",city_id:"",is_active:!0})},n=async()=>{fe?await U.mutateAsync({id:fe.id,updates:V}):await N.mutateAsync(V),ue(!1),Ae(null),ae({name:"",abbreviation:"",slug:"",country_code:"US",is_active:!0})},l=async s=>{await k.mutateAsync({id:s.id,isActive:!s.is_active})},r=async s=>{await J.mutateAsync({id:s.id,isActive:!s.is_active})},o=s=>{_(s),se({name:s.name,slug:s.slug,state_id:s.state_id||"",is_active:s.is_active}),oe(!0)},i=s=>{Ae(s),ae({name:s.name,abbreviation:s.abbreviation||"",slug:s.slug,country_code:s.country_code||"US",is_active:s.is_active}),ue(!0)},x=s=>{pe(s),te({name:s.name,slug:s.slug,city_id:s.city_id,is_active:s.is_active}),S(!0)},b=f?.filter(s=>s.is_active).length||0;O?.filter(s=>s.is_active).length;const A=me.size;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"Locations Management"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage states, cities, and areas - Toggle visibility across the website"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(g,{className:"card-modern",children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(xs,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:d?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Countries"})]})]})}),e.jsx(g,{className:"card-modern",children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal/10 flex items-center justify-center",children:e.jsx(Ws,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:f?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total States"})]})]})}),e.jsx(g,{className:"card-modern",children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(we,{className:"h-6 w-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:b}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active States"})]})]})}),e.jsx(g,{className:"card-modern",children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-blue-light flex items-center justify-center",children:e.jsx(js,{className:"h-6 w-6 text-blue-custom"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:O?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Cities"})]})]})}),e.jsx(g,{className:"card-modern",children:e.jsxs(p,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-coral-light flex items-center justify-center",children:e.jsx(hs,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:A}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cities with Clinics"})]})]})})]}),e.jsxs(zs,{defaultValue:"states",className:"space-y-4",children:[e.jsxs($s,{children:[e.jsxs(Pe,{value:"states",children:["States (",f?.length||0,")"]}),e.jsx(Pe,{value:"cities",children:"Cities"}),e.jsx(Pe,{value:"areas",children:"Areas"}),e.jsxs(Pe,{value:"redistribution",children:[e.jsx(ms,{className:"h-4 w-4 mr-1"}),"Redistribution"]}),e.jsxs(Pe,{value:"content",children:[e.jsx(gs,{className:"h-4 w-4 mr-1"}),"Content Management"]})]}),e.jsx(Fe,{value:"states",children:e.jsxs(g,{className:"card-modern",children:[e.jsxs(X,{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx(K,{children:"States Management"}),e.jsxs(Ge,{open:qe,onOpenChange:ue,children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(j,{onClick:()=>{Ae(null),ae({name:"",abbreviation:"",slug:"",country_code:"US",is_active:!0})},children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Add State"]})}),e.jsxs(Ve,{children:[e.jsx(De,{children:e.jsx(Ue,{children:fe?"Edit State":"Add State"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Name"}),e.jsx(B,{value:V.name,onChange:s=>ae({...V,name:s.target.value,slug:s.target.value.toLowerCase().replace(/\s+/g,"-")}),placeholder:"State name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Abbreviation"}),e.jsx(B,{value:V.abbreviation,onChange:s=>ae({...V,abbreviation:s.target.value.toUpperCase()}),placeholder:"e.g. CA",maxLength:2})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Slug"}),e.jsx(B,{value:V.slug,onChange:s=>ae({...V,slug:s.target.value}),placeholder:"state-slug"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{children:"Active"}),e.jsx(Te,{checked:V.is_active,onCheckedChange:s=>ae({...V,is_active:s})})]}),e.jsxs(j,{onClick:n,className:"w-full",disabled:N.isPending||U.isPending,children:[fe?"Update":"Create"," State"]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search states...",value:T,onChange:s=>je(s.target.value),className:"pl-9"})]}),e.jsxs(ie,{value:y,onValueChange:be,children:[e.jsx(ne,{className:"w-[140px]",children:e.jsx(le,{placeholder:"Status"})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"inactive",children:"Inactive"})]})]}),e.jsxs(ie,{value:C,onValueChange:ye,children:[e.jsx(ne,{className:"w-[140px]",children:e.jsx(le,{placeholder:"SEO Status"})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All SEO"}),e.jsx(c,{value:"live",children:"Live"}),e.jsx(c,{value:"draft",children:"Draft"}),e.jsx(c,{value:"inactive",children:"Inactive"})]})]})]})]}),e.jsxs(p,{children:[Y?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Q,{className:"h-6 w-6 animate-spin text-primary"})}):e.jsxs(Ee,{children:[e.jsx(Le,{children:e.jsxs(R,{children:[e.jsx(u,{children:"Name"}),e.jsx(u,{children:"Abbreviation"}),e.jsx(u,{children:"Slug"}),e.jsx(u,{children:"SEO Status"}),e.jsx(u,{children:"Visibility"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(Me,{children:$e.map(s=>e.jsxs(R,{children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{children:s.abbreviation}),e.jsx(h,{className:"text-muted-foreground",children:s.slug}),e.jsx(h,{children:e.jsx(z,{variant:s.seo_status==="live"?"default":"secondary",children:s.seo_status||"inactive"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{checked:s.is_active,onCheckedChange:()=>l(s),disabled:k.isPending}),e.jsx("span",{className:s.is_active?"text-green-600":"text-muted-foreground",children:s.is_active?"Visible":"Hidden"})]})}),e.jsxs(h,{className:"text-right space-x-1",children:[s.is_active&&s.seo_status==="live"?e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>window.open(`/${s.slug}`,"_blank"),children:e.jsx(Ye,{className:"h-4 w-4 text-primary"})}):e.jsx(j,{variant:"ghost",size:"sm",disabled:!0,children:e.jsx(ds,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>i(s),children:e.jsx(Qe,{className:"h-4 w-4"})})]})]},s.id))})]}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Showing ",$e.length," of ",f?.length||0," states"]})]})]})}),e.jsx(Fe,{value:"cities",children:e.jsxs(g,{className:"card-modern",children:[e.jsxs(X,{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row items-center justify-between",children:[e.jsx(K,{children:"Cities Management"}),e.jsxs(Ge,{open:E,onOpenChange:oe,children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(j,{onClick:()=>{_(null),se({name:"",slug:"",state_id:f?.[0]?.id||"",is_active:!0})},children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Add City"]})}),e.jsxs(Ve,{children:[e.jsx(De,{children:e.jsx(Ue,{children:xe?"Edit City":"Add City"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"State"}),e.jsxs("select",{className:"w-full rounded-xl border border-input bg-background px-3 py-2",value:L.state_id,onChange:s=>se({...L,state_id:s.target.value}),children:[e.jsx("option",{value:"",children:"Select State"}),f?.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Name"}),e.jsx(B,{value:L.name,onChange:s=>se({...L,name:s.target.value,slug:s.target.value.toLowerCase().replace(/\s+/g,"-")}),placeholder:"City name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Slug"}),e.jsx(B,{value:L.slug,onChange:s=>se({...L,slug:s.target.value}),placeholder:"city-slug"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{children:"Active"}),e.jsx(Te,{checked:L.is_active,onCheckedChange:s=>se({...L,is_active:s})})]}),e.jsxs(j,{onClick:Re,className:"w-full",disabled:D.isPending||ce.isPending,children:[xe?"Update":"Create"," City"]})]})]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(ie,{value:w,onValueChange:he,children:[e.jsx(ne,{className:"w-[180px]",children:e.jsx(le,{placeholder:"Filter by State"})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All States"}),f?.map(s=>e.jsx(c,{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Ke,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Search cities...",value:G,onChange:s=>m(s.target.value),className:"pl-9"})]}),e.jsxs(ie,{value:v,onValueChange:Ce,children:[e.jsx(ne,{className:"w-[140px]",children:e.jsx(le,{placeholder:"Status"})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All Status"}),e.jsx(c,{value:"active",children:"Active"}),e.jsx(c,{value:"inactive",children:"Inactive"})]})]}),e.jsxs(ie,{value:W,onValueChange:de,children:[e.jsx(ne,{className:"w-[140px]",children:e.jsx(le,{placeholder:"SEO Status"})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All SEO"}),e.jsx(c,{value:"live",children:"Live"}),e.jsx(c,{value:"draft",children:"Draft"}),e.jsx(c,{value:"inactive",children:"Inactive"})]})]}),e.jsxs(ie,{value:ee,onValueChange:ge,children:[e.jsx(ne,{className:"w-[160px]",children:e.jsx(le,{placeholder:"Has Clinics"})}),e.jsxs(re,{children:[e.jsx(c,{value:"all",children:"All Cities"}),e.jsx(c,{value:"yes",children:"Has Clinics"}),e.jsx(c,{value:"no",children:"No Clinics"})]})]})]})]}),e.jsxs(p,{children:[Se?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(Q,{className:"h-6 w-6 animate-spin text-primary"})}):e.jsxs(Ee,{children:[e.jsx(Le,{children:e.jsxs(R,{children:[e.jsx(u,{children:"Name"}),e.jsx(u,{children:"State"}),e.jsx(u,{children:"Slug"}),e.jsx(u,{children:"Clinics"}),e.jsx(u,{children:"SEO Status"}),e.jsx(u,{children:"Visibility"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(Me,{children:ke.slice(0,100).map(s=>{const ve=me.has(s.id);return e.jsxs(R,{children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{className:"text-muted-foreground",children:s.state?.abbreviation||"-"}),e.jsx(h,{className:"text-muted-foreground",children:s.slug}),e.jsx(h,{children:ve?e.jsx(z,{className:"bg-green-100 text-green-700",children:"Has Clinics"}):e.jsx(z,{variant:"secondary",children:"None"})}),e.jsx(h,{children:e.jsx(z,{variant:s.seo_status==="live"?"default":"secondary",children:s.seo_status||"inactive"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Te,{checked:s.is_active,onCheckedChange:()=>r(s),disabled:J.isPending}),e.jsx("span",{className:s.is_active?"text-green-600":"text-muted-foreground",children:s.is_active?"Visible":"Hidden"})]})}),e.jsxs(h,{className:"text-right space-x-1",children:[s.is_active?e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>window.open(`/dentists-in-${s.slug}`,"_blank"),children:e.jsx(Ye,{className:"h-4 w-4 text-primary"})}):e.jsx(j,{variant:"ghost",size:"sm",disabled:!0,children:e.jsx(ds,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>o(s),children:e.jsx(Qe,{className:"h-4 w-4"})})]})]},s.id)})})]}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground",children:["Showing ",Math.min(ke.length,100)," of ",ke.length," filtered cities",w!=="all"&&` (${O?.length||0} in selected state)`]})]})]})}),e.jsx(Fe,{value:"areas",children:e.jsxs(g,{className:"card-modern",children:[e.jsxs(X,{className:"flex flex-row items-center justify-between",children:[e.jsx(K,{children:"Areas"}),e.jsxs(Ge,{open:_e,onOpenChange:S,children:[e.jsx(Ie,{asChild:!0,children:e.jsxs(j,{onClick:()=>{pe(null),te({name:"",slug:"",city_id:O?.[0]?.id||"",is_active:!0})},children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Add Area"]})}),e.jsxs(Ve,{children:[e.jsx(De,{children:e.jsx(Ue,{children:I?"Edit Area":"Add Area"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"City"}),e.jsx("select",{className:"w-full rounded-xl border border-input bg-background px-3 py-2",value:$.city_id,onChange:s=>te({...$,city_id:s.target.value}),children:O?.slice(0,100).map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Name"}),e.jsx(B,{value:$.name,onChange:s=>te({...$,name:s.target.value,slug:s.target.value.toLowerCase().replace(/\s+/g,"-")}),placeholder:"Area name"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(P,{children:"Slug"}),e.jsx(B,{value:$.slug,onChange:s=>te({...$,slug:s.target.value}),placeholder:"area-slug"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{children:"Active"}),e.jsx(Te,{checked:$.is_active,onCheckedChange:s=>te({...$,is_active:s})})]}),e.jsxs(j,{onClick:t,className:"w-full",disabled:H.isPending||q.isPending,children:[I?"Update":"Create"," Area"]})]})]})]})]}),e.jsx(p,{children:e.jsxs(Ee,{children:[e.jsx(Le,{children:e.jsxs(R,{children:[e.jsx(u,{children:"Name"}),e.jsx(u,{children:"City"}),e.jsx(u,{children:"Slug"}),e.jsx(u,{children:"Status"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(Me,{children:Z?.slice(0,100).map(s=>e.jsxs(R,{children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsx(h,{className:"text-muted-foreground",children:s.city?.name||"-"}),e.jsx(h,{className:"text-muted-foreground",children:s.slug}),e.jsx(h,{children:e.jsx(z,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"})}),e.jsx(h,{className:"text-right",children:e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>x(s),children:e.jsx(Qe,{className:"h-4 w-4"})})})]},s.id))})]})})]})}),e.jsx(Fe,{value:"redistribution",children:e.jsx(Is,{})}),e.jsx(Fe,{value:"content",children:e.jsx(Bs,{})})]})]})}export{Ht as default};
