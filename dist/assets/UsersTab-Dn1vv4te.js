import{b as de,u as Se,c as _e,j as e}from"./chunk-CPh6voF3.js";import{r as j}from"./chunk-CffrGP6S.js";import{u as Ve,a as Ge,b as He}from"./chunk-LOsYkUiN.js";import{f as Ae,ak as De,a9 as me,aa as ue,ab as he,ac as xe,a as O,p as ge,I as q,S as Te,L as $,w as ie,x as ze,i as y,aK as ce,B as k,s as v,b as ve,o as J,ad as Ke,b7 as we,ae as Qe,bc as We,a2 as H,a3 as z,a5 as K,a6 as Q,a7 as h,U as X,a4 as Je,G as re,m as Xe,A as Ye,Q as Ze,D as es,h as ss,j as as,V as U,W as Ce,bD as ts,bE as ls,bF as rs,bG as ns,X as is}from"./index-DflORfjh.js";import{C as F,d as P}from"./chunk-Dwq_v72W.js";import{T as cs,a as os,b as ne,c as R,d as ds,e as E}from"./chunk-NLs5Ye4A.js";import{U as ms}from"./chunk-D2X27E5n.js";import{A as us,a as hs,b as xs,c as gs}from"./chunk-BMzWzDrf.js";import{A as ps,a as js,b as ys,c as fs,d as bs,e as Ns,f as vs,g as ws}from"./chunk--UsBvJF_.js";import{a as Cs}from"./chunk-Drd-rt-S.js";import{P as ks}from"./chunk-HAC-i_a2.js";import{U as Ue}from"./chunk-D3rEHCqk.js";import{F as Ee}from"./chunk-DFAtUk_4.js";import{P as ke}from"./chunk-D2pmmVk_.js";import{E as Ss}from"./chunk-j3aWteJX.js";import{E as _s}from"./chunk-CcezodbN.js";import{E as As}from"./chunk-CbETxTmt.js";import{S as Ds}from"./chunk-Beq7cUgv.js";import{K as Ts}from"./chunk-B7tIy7xU.js";import{U as Us}from"./chunk-B-oTuC6Z.js";import{T as Es}from"./chunk-BRVan1jG.js";import{H as Ms}from"./chunk-DKBZeOHc.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-CKWDY2Lf.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=Ae("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ps=Ae("Megaphone",[["path",{d:"m3 11 18-5v12L3 14v-3z",key:"n962bs"}],["path",{d:"M11.6 16.8a3 3 0 1 1-5.8-1.6",key:"1yl0tm"}]]);function Rs({open:i,onOpenChange:c,userId:o,userName:_,userEmail:A}){const{toast:x}=De(),D=de(),[u,f]=j.useState(""),[d,g]=j.useState(null),{data:w,isLoading:L}=Se({queryKey:["clinics-for-assignment",u],queryFn:async()=>{let t=v.from("clinics").select("id, name, slug, address, claim_status, claimed_by, city:cities(name)").order("name",{ascending:!0}).limit(50);u.length>=2&&(t=t.ilike("name",`%${u}%`));const{data:b,error:N}=await t;if(N)throw N;return b},enabled:i}),S=_e({mutationFn:async t=>{const{error:b}=await v.from("clinics").update({claimed_by:o,claim_status:"claimed",claimed_at:new Date().toISOString()}).eq("id",t);if(b)throw b;const{data:N}=await v.from("user_roles").select("id").eq("user_id",o).eq("role","dentist").maybeSingle();if(!N){const{error:l}=await v.from("user_roles").insert({user_id:o,role:"dentist"});if(l)throw l}return await v.from("audit_logs").insert({action:"CLINIC_ASSIGNED_BY_ADMIN",entity_type:"clinic",entity_id:t,user_id:o,new_values:{assigned_to_user:o,assigned_to_email:A}}),{clinicId:t}},onSuccess:()=>{x({title:"Clinic Assigned",description:`Successfully assigned clinic to ${_||A}`}),D.invalidateQueries({queryKey:["admin-users"]}),D.invalidateQueries({queryKey:["clinics-for-assignment"]}),c(!1),g(null),f("")},onError:t=>{console.error("Assignment error:",t),x({title:"Assignment Failed",description:t.message||"Failed to assign clinic",variant:"destructive"})}}),I=()=>{d&&S.mutate(d.id)};return e.jsx(me,{open:i,onOpenChange:c,children:e.jsxs(ue,{className:"sm:max-w-lg",children:[e.jsx(he,{children:e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(ms,{className:"h-5 w-5 text-primary"}),"Assign Clinic to User"]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Assigning clinic to:"}),e.jsx("p",{className:"font-medium",children:_||"Unnamed User"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:A})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(O,{children:"Search Clinics"}),e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(q,{placeholder:"Type clinic name to search...",value:u,onChange:t=>f(t.target.value),className:"pl-10"})]})]}),e.jsx(Te,{className:"h-[300px] border rounded-lg",children:e.jsx("div",{className:"p-2 space-y-1",children:L?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx($,{className:"h-5 w-5 animate-spin mx-auto mb-2"}),"Searching clinics..."]}):w&&w.length>0?w.map(t=>{const b=d?.id===t.id,N=t.claim_status==="claimed"&&t.claimed_by;return e.jsx("button",{onClick:()=>g(t),disabled:N&&t.claimed_by!==o,className:`w-full p-3 rounded-lg text-left transition-colors ${b?"bg-primary/10 border-2 border-primary":"hover:bg-muted/50 border border-transparent"} ${N&&t.claimed_by!==o?"opacity-50 cursor-not-allowed":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(ie,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:t.name}),t.city?.name&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ze,{className:"h-3 w-3"}),t.city.name]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N&&t.claimed_by!==o&&e.jsx(y,{variant:"secondary",className:"text-xs",children:"Claimed"}),b&&e.jsx(ce,{className:"h-5 w-5 text-primary"})]})]})},t.id)}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(ie,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:u.length>=2?"No clinics found":"Type to search clinics"})]})})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>c(!1),className:"flex-1",children:"Cancel"}),e.jsx(k,{onClick:I,disabled:!d||S.isPending,className:"flex-1",children:S.isPending?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}),"Assigning..."]}):"Assign Clinic"})]})]})]})})}const oe=[{key:"overview",label:"Command Center",category:"Overview"},{key:"weekly",label:"Weekly Report",category:"Overview"},{key:"visitor-analytics",label:"Visitor Analytics",category:"Overview"},{key:"pages",label:"Page Manager",category:"Content & SEO"},{key:"blog",label:"Blog",category:"Content & SEO"},{key:"static-pages",label:"Static Pages",category:"Content & SEO"},{key:"seo-health",label:"SEO Health Check",category:"Content & SEO"},{key:"seo",label:"SEO Management",category:"Content & SEO"},{key:"seo-expert",label:"SEO Expert",category:"Content & SEO"},{key:"seo-bot",label:"SEO Bot",category:"Content & SEO"},{key:"seo-copilot",label:"SEO Copilot",category:"Content & SEO"},{key:"seo-content-optimizer",label:"Content Optimizer",category:"Content & SEO"},{key:"ranking-rules",label:"Ranking Rules",category:"Content & SEO"},{key:"pinned-profiles",label:"Pinned Profiles",category:"Content & SEO"},{key:"top-dentists",label:"Top Dentists",category:"Content & SEO"},{key:"clinics",label:"Dental Offices",category:"Users & Clinics"},{key:"clinic-enrichment",label:"Content Enrichment",category:"Users & Clinics"},{key:"users",label:"Users",category:"Users & Clinics"},{key:"claims",label:"Claims",category:"Users & Clinics"},{key:"treatments",label:"Treatments",category:"Users & Clinics"},{key:"locations",label:"Locations",category:"Users & Clinics"},{key:"review-insights",label:"Review Insights",category:"Reputation"},{key:"gmb-connections",label:"GMB Connections",category:"Reputation"},{key:"gmb-scraper",label:"Scraper Bot",category:"Marketing"},{key:"email-enrichment",label:"Email Enrichment",category:"Marketing"},{key:"gmb-bridge",label:"Google Import",category:"Marketing"},{key:"outreach",label:"Outreach Center",category:"Marketing"},{key:"promotions",label:"Promotions",category:"Marketing"},{key:"booking-system",label:"Booking System",category:"Appointments"},{key:"appointments",label:"Appointments",category:"Appointments"},{key:"leads",label:"Lead CRM",category:"Appointments"},{key:"api-control",label:"API Control",category:"Integrations"},{key:"crm-numbers",label:"CRM Numbers",category:"Integrations"},{key:"messaging-control",label:"Messaging",category:"Integrations"},{key:"marketplace-control",label:"Marketplace Control",category:"System"},{key:"system-audit",label:"System Audit",category:"System"},{key:"feature-flags",label:"Feature Flags",category:"System"},{key:"roles",label:"Access Control",category:"System"},{key:"platform-services",label:"Platform Services",category:"System"},{key:"plans",label:"Plans & Features",category:"System"},{key:"subscriptions",label:"Revenue",category:"System"},{key:"ai-controls",label:"AI Controls",category:"System"},{key:"automation",label:"Automation Rules",category:"System"},{key:"support-admin",label:"Support Tickets",category:"System"},{key:"audit",label:"Audit Logs",category:"System"},{key:"smoke-test",label:"URL Smoke Test",category:"System"},{key:"site-config",label:"Header / Footer",category:"System"},{key:"contact-details",label:"Contact Details",category:"System"},{key:"tab-visibility",label:"Tab Visibility",category:"System"},{key:"settings",label:"Settings",category:"System"}];function Os(i){return Se({queryKey:["tab-permissions",i],queryFn:async()=>{if(!i)return[];const{data:c,error:o}=await v.from("user_tab_permissions").select("*").eq("user_id",i);if(o)throw o;return c},enabled:!!i})}function Ls(){const i=de();return _e({mutationFn:async({userId:c,tabs:o})=>{const{error:_}=await v.from("user_tab_permissions").delete().eq("user_id",c);if(_)throw _;if(o.length>0){const{data:{user:A}}=await v.auth.getUser(),x=o.map(u=>({user_id:c,tab_key:u,can_access:!0,granted_by:A?.id||null})),{error:D}=await v.from("user_tab_permissions").insert(x);if(D)throw D}},onSuccess:(c,o)=>{i.invalidateQueries({queryKey:["tab-permissions",o.userId]}),ve.success("Tab permissions updated")},onError:c=>ve.error("Failed to save: "+c.message)})}function Is(){return oe.reduce((i,c)=>(i[c.category]||(i[c.category]=[]),i[c.category].push(c),i),{})}function Bs({open:i,onOpenChange:c,userId:o,userName:_,userRole:A}){const{data:x,isLoading:D}=Os(o),u=Ls(),[f,d]=j.useState([]),g=Is();j.useEffect(()=>{x&&d(x.filter(l=>l.can_access).map(l=>l.tab_key))},[x]);const w=l=>{d(p=>p.includes(l)?p.filter(r=>r!==l):[...p,l])},L=(l,p)=>{const r=g[l]?.map(n=>n.key)||[];d(p?n=>[...new Set([...n,...r])]:n=>n.filter(T=>!r.includes(T)))},S=l=>(g[l]?.map(r=>r.key)||[]).every(r=>f.includes(r)),I=l=>{const p=g[l]?.map(n=>n.key)||[],r=p.filter(n=>f.includes(n)).length;return r>0&&r<p.length},t=()=>d(oe.map(l=>l.key)),b=()=>d([]),N=()=>{u.mutate({userId:o,tabs:f},{onSuccess:()=>c(!1)})};return e.jsx(me,{open:i,onOpenChange:c,children:e.jsxs(ue,{className:"max-w-2xl max-h-[85vh] flex flex-col",children:[e.jsxs(he,{children:[e.jsxs(xe,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-primary"}),"Tab Permissions for ",_]}),e.jsxs(Ke,{children:["Select which admin tabs this user can access. Current role: ",e.jsx(y,{variant:"outline",children:A})]})]}),D?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx($,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-border",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[f.length," of ",oe.length," tabs selected"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(k,{variant:"outline",size:"sm",onClick:t,children:"Select All"}),e.jsx(k,{variant:"ghost",size:"sm",onClick:b,children:"Clear All"})]})]}),e.jsx(Te,{className:"flex-1 pr-4",children:e.jsx(us,{type:"multiple",defaultValue:Object.keys(g),className:"w-full",children:Object.entries(g).map(([l,p])=>e.jsxs(hs,{value:l,children:[e.jsx(xs,{className:"py-3 hover:no-underline",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(we,{checked:S(l),onCheckedChange:r=>L(l,!!r),onClick:r=>r.stopPropagation(),className:I(l)?"data-[state=checked]:bg-primary/50":""}),e.jsx(Fs,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:l}),e.jsxs(y,{variant:"secondary",className:"ml-2",children:[p.filter(r=>f.includes(r.key)).length,"/",p.length]})]})}),e.jsx(gs,{children:e.jsx("div",{className:"grid grid-cols-2 gap-2 pl-10 pb-2",children:p.map(r=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg border cursor-pointer transition-colors ${f.includes(r.key)?"border-primary/50 bg-primary/5":"border-border hover:border-primary/30"}`,onClick:()=>w(r.key),children:[e.jsx(we,{checked:f.includes(r.key),onCheckedChange:()=>w(r.key)}),e.jsx(O,{className:"cursor-pointer text-sm",children:r.label})]},r.key))})})]},l))})}),e.jsxs(Qe,{className:"pt-4 border-t border-border",children:[e.jsx(k,{variant:"outline",onClick:()=>c(!1),children:"Cancel"}),e.jsxs(k,{onClick:N,disabled:u.isPending,className:"gap-2",children:[u.isPending&&e.jsx($,{className:"h-4 w-4 animate-spin"}),"Save Permissions"]})]})]})]})})}const W=[{value:"super_admin",label:"Super Admin",color:"purple",icon:J},{value:"district_manager",label:"District Manager",color:"blue-custom",icon:Ue},{value:"dentist",label:"Dentist",color:"primary",icon:X},{value:"seo_team",label:"SEO Team",color:"teal",icon:ge},{value:"content_team",label:"Content Team",color:"gold",icon:Ee},{value:"marketing_team",label:"Marketing Team",color:"coral",icon:Ps},{value:"support_team",label:"Support Team",color:"emerald",icon:Ms},{value:"patient",label:"Patient",color:"muted",icon:X}];function ga(){const{data:i,isLoading:c,error:o}=Ve(),_=Ge(),A=He(),{toast:x}=De(),D=de();Cs();const[u,f]=j.useState(""),[d,g]=j.useState("all"),[w,L]=j.useState("all"),[S,I]=j.useState("all"),[t,b]=j.useState("all"),[N,l]=j.useState(!1),[p,r]=j.useState(!1),[n,T]=j.useState({email:"",password:"",fullName:"",role:"dentist",clinicId:""}),[se,ae]=j.useState(null),[V,pe]=j.useState(null),[B,je]=j.useState(null),[ye,fe]=j.useState(null),Me=async s=>{if(!s.email){x({title:"No email",description:"This user has no email address",variant:"destructive"});return}fe(s.user_id);try{const{data:{session:a}}=await v.auth.getSession();if(!a?.access_token)throw new Error("Not authenticated");const{data:m,error:C}=await v.functions.invoke("admin-send-password-reset",{headers:{Authorization:`Bearer ${a.access_token}`},body:{email:s.email}});if(C){const M=typeof C=="object"&&C.message?C.message:"Could not send password reset";throw new Error(M)}if(m?.error)throw new Error(m.error);x({title:"Password Reset Sent",description:`Email sent to ${s.email}`})}catch(a){console.error("Password reset error:",a);const m=a.message||"Could not send password reset",C=m.includes("wait")||m.includes("60 seconds");x({title:C?"Please Wait":"Failed",description:m,variant:"destructive"})}finally{fe(null)}},te=i?.filter(s=>{const a=s.email?.toLowerCase().includes(u.toLowerCase())||s.full_name?.toLowerCase().includes(u.toLowerCase())||s.phone?.toLowerCase().includes(u.toLowerCase()),m=s.roles?.[0]||"patient",C=d==="all"||m===d,M=S==="all"||s.signup_method===S,Ie=t==="all"||s.account_status===t;let G=!0;if(w!=="all"&&s.created_at){const Z=new Date(s.created_at),ee=new Date;switch(w){case"today":G=Z.toDateString()===ee.toDateString();break;case"week":const Be=new Date(ee.getTime()-7*24*60*60*1e3);G=Z>=Be;break;case"month":const qe=new Date(ee.getTime()-30*24*60*60*1e3);G=Z>=qe;break;case"quarter":const $e=new Date(ee.getTime()-90*24*60*60*1e3);G=Z>=$e;break}}return a&&C&&M&&Ie&&G})||[],Fe=async(s,a,m)=>{(a?.[0]||"patient")!==m&&await _.mutateAsync({userId:s,role:m})},Pe=async()=>{if(!n.email||!n.password||!n.fullName){x({title:"Missing Fields",description:"Please fill in all required fields.",variant:"destructive"});return}r(!0);try{const{data:s,error:a}=await v.functions.invoke("admin-create-user",{body:{email:n.email,password:n.password,fullName:n.fullName,role:n.role,clinicId:n.clinicId||void 0}});if(a)throw a;if(s.success)x({title:"User Created",description:`Successfully created ${n.role} account for ${n.email}`}),l(!1),T({email:"",password:"",fullName:"",role:"dentist",clinicId:""}),D.invalidateQueries({queryKey:["admin-users"]});else throw new Error(s.error||"Failed to create user")}catch(s){console.error("Create user error:",s),x({title:"Failed to Create User",description:s.message||"Please try again.",variant:"destructive"})}finally{r(!1)}},Re=s=>{const a=s?.[0]||"patient",m=W.find(M=>M.value===a)||W.find(M=>M.value==="patient"),C=m.icon;return e.jsxs(y,{className:`bg-${m.color}/10 text-${m.color} border-0 gap-1`,children:[e.jsx(C,{className:"h-3 w-3"}),m.label]})},Oe=s=>{switch(s){case"google":return e.jsxs(y,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),"Google"]});case"gmb":return e.jsxs(y,{className:"bg-teal/20 text-teal border-0 text-xs gap-1",children:[e.jsx(re,{className:"h-3 w-3"}),"GMB"]});case"admin_created":return e.jsxs(y,{variant:"outline",className:"text-xs gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),"Admin"]});case"manual":return e.jsx(y,{variant:"secondary",className:"text-xs",children:"Manual"});default:return e.jsx(y,{variant:"secondary",className:"text-xs",children:"Unknown"})}},Le=s=>{switch(s){case"active":return e.jsxs(y,{className:"bg-teal/20 text-teal border-0 text-xs gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),"Active"]});case"pending":return e.jsx(y,{className:"bg-amber/20 text-amber border-0 text-xs gap-1",children:"Pending"});case"suspended":return e.jsxs(y,{className:"bg-coral/20 text-coral border-0 text-xs gap-1",children:[e.jsx(is,{className:"h-3 w-3"}),"Suspended"]})}},Y={super_admin:i?.filter(s=>s.roles?.includes("super_admin")).length||0,district_manager:i?.filter(s=>s.roles?.includes("district_manager")).length||0,dentist:i?.filter(s=>s.roles?.includes("dentist")).length||0,team:i?.filter(s=>s.roles?.some(a=>["seo_team","content_team","marketing_team","support_team"].includes(a))).length||0,patient:i?.filter(s=>!s.roles?.length||s.roles?.includes("patient")).length||0},le=async(s,a)=>{try{await A.mutateAsync({userId:s,action:a}),a==="delete"&&ae(null)}catch(m){console.error("User action failed:",m)}},be=()=>{f(""),g("all"),L("all"),I("all"),b("all")},Ne=u||d!=="all"||w!=="all"||S!=="all"||t!=="all";return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"Users & Patients"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage platform users and their roles"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(me,{open:N,onOpenChange:l,children:[e.jsx(We,{asChild:!0,children:e.jsxs(k,{className:"rounded-xl font-bold",children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"Create User"]})}),e.jsxs(ue,{className:"sm:max-w-md",children:[e.jsx(he,{children:e.jsx(xe,{children:"Create New User"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(O,{htmlFor:"fullName",children:"Full Name *"}),e.jsx(q,{id:"fullName",placeholder:"Dr. John Smith",value:n.fullName,onChange:s=>T(a=>({...a,fullName:s.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"email",children:"Email *"}),e.jsx(q,{id:"email",type:"email",placeholder:"user@example.com",value:n.email,onChange:s=>T(a=>({...a,email:s.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"password",children:"Password *"}),e.jsx(q,{id:"password",type:"password",placeholder:"Min 6 characters",value:n.password,onChange:s=>T(a=>({...a,password:s.target.value})),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(O,{htmlFor:"role",children:"Role *"}),e.jsxs(H,{value:n.role,onValueChange:s=>T(a=>({...a,role:s})),children:[e.jsx(z,{className:"mt-1",children:e.jsx(K,{})}),e.jsx(Q,{children:W.filter(s=>s.value!=="patient").map(s=>e.jsx(h,{value:s.value,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(s.icon,{className:"h-4 w-4"}),s.label]})},s.value))})]})]}),n.role==="dentist"&&e.jsxs("div",{children:[e.jsx(O,{htmlFor:"clinicId",children:"Clinic ID (Optional)"}),e.jsx(q,{id:"clinicId",placeholder:"UUID of clinic to link",value:n.clinicId,onChange:s=>T(a=>({...a,clinicId:s.target.value})),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Link this dentist to a specific clinic"})]}),e.jsx(k,{onClick:Pe,className:"w-full rounded-xl font-bold",disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx($,{className:"h-4 w-4 mr-2 animate-spin"}),"Creating..."]}):"Create User"})]})]})]}),e.jsxs(y,{variant:"outline",className:"text-sm py-1 px-3",children:[te.length," of ",i?.length||0," users"]})]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsx(F,{className:"card-modern cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>g("all"),children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:i?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Users"})]})]})}),e.jsx(F,{className:`card-modern cursor-pointer transition-colors ${d==="super_admin"?"border-purple":"hover:border-purple/50"}`,onClick:()=>g("super_admin"),children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-purple-light flex items-center justify-center",children:e.jsx(J,{className:"h-6 w-6 text-purple"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Y.super_admin}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Super Admins"})]})]})}),e.jsx(F,{className:`card-modern cursor-pointer transition-colors ${d==="district_manager"?"border-blue-custom":"hover:border-blue-custom/50"}`,onClick:()=>g("district_manager"),children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-blue-light flex items-center justify-center",children:e.jsx(Ue,{className:"h-6 w-6 text-blue-custom"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Y.district_manager}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"District Mgrs"})]})]})}),e.jsx(F,{className:`card-modern cursor-pointer transition-colors ${d==="dentist"?"border-teal":"hover:border-teal/50"}`,onClick:()=>g("dentist"),children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal-light flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Y.dentist}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dentists"})]})]})}),e.jsx(F,{className:"card-modern cursor-pointer transition-colors hover:border-gold/50",onClick:()=>g("all"),children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gold/10 flex items-center justify-center",children:e.jsx(Ee,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Y.team}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Team Members"})]})]})})]}),e.jsx(F,{className:"card-modern",children:e.jsx(P,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex-1 min-w-64 relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(q,{placeholder:"Search by name, email, or phone...",value:u,onChange:s=>f(s.target.value),className:"pl-10"})]}),e.jsxs(H,{value:d,onValueChange:g,children:[e.jsxs(z,{className:"w-48",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),e.jsx(K,{placeholder:"Filter by Role"})]}),e.jsxs(Q,{children:[e.jsx(h,{value:"all",children:"All Roles"}),W.map(s=>e.jsx(h,{value:s.value,children:s.label},s.value))]})]}),e.jsxs(H,{value:S,onValueChange:I,children:[e.jsxs(z,{className:"w-40",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),e.jsx(K,{placeholder:"Source"})]}),e.jsxs(Q,{children:[e.jsx(h,{value:"all",children:"All Sources"}),e.jsx(h,{value:"manual",children:"Manual"}),e.jsx(h,{value:"google",children:"Google"}),e.jsx(h,{value:"gmb",children:"GMB"}),e.jsx(h,{value:"admin_created",children:"Admin Created"})]})]}),e.jsxs(H,{value:t,onValueChange:b,children:[e.jsxs(z,{className:"w-40",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),e.jsx(K,{placeholder:"Status"})]}),e.jsxs(Q,{children:[e.jsx(h,{value:"all",children:"All Status"}),e.jsx(h,{value:"active",children:"Active"}),e.jsx(h,{value:"pending",children:"Pending"}),e.jsx(h,{value:"suspended",children:"Suspended"})]})]}),e.jsxs(H,{value:w,onValueChange:L,children:[e.jsxs(z,{className:"w-48",children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),e.jsx(K,{placeholder:"Filter by Date"})]}),e.jsxs(Q,{children:[e.jsx(h,{value:"all",children:"All Time"}),e.jsx(h,{value:"today",children:"Today"}),e.jsx(h,{value:"week",children:"Last 7 Days"}),e.jsx(h,{value:"month",children:"Last 30 Days"}),e.jsx(h,{value:"quarter",children:"Last 90 Days"})]})]}),Ne&&e.jsx(k,{variant:"ghost",size:"sm",onClick:be,className:"text-muted-foreground",children:"Clear Filters"})]})})}),e.jsx(F,{className:"card-modern",children:e.jsx(P,{className:"p-0",children:e.jsxs(cs,{children:[e.jsx(os,{children:e.jsxs(ne,{children:[e.jsx(R,{children:"User"}),e.jsx(R,{children:"Role"}),e.jsx(R,{children:"Source"}),e.jsx(R,{children:"Status"}),e.jsx(R,{children:"GMB"}),e.jsx(R,{children:"Joined"}),e.jsx(R,{className:"text-right",children:"Actions"})]})}),e.jsxs(ds,{children:[te.map(s=>e.jsxs(ne,{children:[e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-primary",children:s.full_name?.[0]?.toUpperCase()||s.email?.[0]?.toUpperCase()||"U"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.full_name||"No name"}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Ye,{className:"h-3 w-3"}),s.email||"No email"]})]})]})}),e.jsx(E,{children:Re(s.roles)}),e.jsx(E,{children:Oe(s.signup_method)}),e.jsx(E,{children:Le(s.account_status)}),e.jsx(E,{children:s.gmb_connected?e.jsxs(y,{className:"bg-teal/20 text-teal border-0 text-xs gap-1",children:[e.jsx(ce,{className:"h-3 w-3"}),"Connected"]}):e.jsx(y,{variant:"outline",className:"text-xs text-muted-foreground",children:"Not Connected"})}),e.jsx(E,{className:"text-muted-foreground text-sm",children:s.created_at?Ze(new Date(s.created_at),"MMM d, yyyy"):"-"}),e.jsx(E,{className:"text-right",children:e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"icon",children:e.jsx(Ss,{className:"h-4 w-4"})})}),e.jsxs(as,{align:"end",className:"w-56",children:[e.jsxs(U,{className:"gap-2",onClick:()=>{s.clinic_slug?window.open(`/clinic/${s.clinic_slug}`,"_blank"):x({title:"No Profile Available",description:"This user doesn't have a claimed clinic profile yet.",variant:"destructive"})},children:[e.jsx(_s,{className:"h-4 w-4"})," View Profile",s.clinic_slug&&e.jsx(As,{className:"h-3 w-3 ml-auto text-muted-foreground"})]}),e.jsxs(U,{className:"gap-2",onClick:()=>pe(s),children:[e.jsx(ie,{className:"h-4 w-4"})," Assign Clinic"]}),e.jsxs(U,{className:"gap-2",onClick:()=>je(s),children:[e.jsx(Ds,{className:"h-4 w-4"})," Tab Permissions"]}),e.jsxs(U,{className:"gap-2",onClick:()=>Me(s),disabled:ye===s.user_id,children:[ye===s.user_id?e.jsx($,{className:"h-4 w-4 animate-spin"}):e.jsx(Ts,{className:"h-4 w-4"}),"Send Password Reset"]}),e.jsx(Ce,{}),e.jsxs(ts,{children:[e.jsxs(ls,{className:"gap-2",children:[e.jsx(J,{className:"h-4 w-4"})," Change Role"]}),e.jsx(rs,{children:e.jsx(ns,{children:W.map(a=>e.jsxs(U,{className:"gap-2",onClick:()=>Fe(s.user_id,s.roles||[],a.value),children:[e.jsx(a.icon,{className:"h-4 w-4"}),a.label]},a.value))})})]}),e.jsx(Ce,{}),s.account_status==="suspended"?e.jsxs(U,{className:"gap-2 text-teal",onClick:()=>le(s.user_id,"activate"),children:[e.jsx(ke,{className:"h-4 w-4"})," Activate User"]}):e.jsxs(U,{className:"gap-2 text-amber",onClick:()=>le(s.user_id,"suspend"),children:[e.jsx(Us,{className:"h-4 w-4"})," Suspend User"]}),e.jsxs(U,{className:"gap-2 text-coral",onClick:()=>ae(s.user_id),children:[e.jsx(Es,{className:"h-4 w-4"})," Delete User"]})]})]})})]},s.id)),te.length===0&&e.jsx(ne,{children:e.jsxs(E,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No users found"}),Ne&&e.jsx(k,{variant:"link",size:"sm",onClick:be,className:"mt-2",children:"Clear filters to see all users"})]})})]})]})})}),e.jsx(ps,{open:!!se,onOpenChange:()=>ae(null),children:e.jsxs(js,{children:[e.jsxs(ys,{children:[e.jsx(fs,{children:"Are you sure?"}),e.jsx(bs,{children:"This action cannot be undone. This will permanently delete the user account and remove their data from our servers."})]}),e.jsxs(Ns,{children:[e.jsx(vs,{children:"Cancel"}),e.jsx(ws,{className:"bg-coral hover:bg-coral/90",onClick:()=>se&&le(se,"delete"),children:"Delete"})]})]})}),V&&e.jsx(Rs,{open:!!V,onOpenChange:s=>!s&&pe(null),userId:V.user_id,userName:V.full_name||"",userEmail:V.email||""}),B&&e.jsx(Bs,{open:!!B,onOpenChange:s=>!s&&je(null),userId:B.user_id,userName:B.full_name||B.email||"User",userRole:B.roles?.[0]||"patient"})]})}export{ga as default};
