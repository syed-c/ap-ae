import{b as me,u as b,c as he,j as e}from"./chunk-CPh6voF3.js";import{r as o}from"./chunk-CffrGP6S.js";import{B as p,x as Y,a2 as w,a3 as S,a5 as _,a6 as k,a7 as j,ao as xe,i as I,n as Z,X as ue,p as ge,I as pe,S as je,o as fe,C as ye,b as V,s as d,bB as ve}from"./index-DflORfjh.js";import{C as P,a as z,b as E,c as H,d as q}from"./chunk-Dwq_v72W.js";import{T as be,a as Ne,b as D,c as N,d as Ce,e as y}from"./chunk-NLs5Ye4A.js";import{S as we}from"./chunk-DfjE-bP6.js";import{S as Se}from"./chunk-C7BdFRQZ.js";import{P as M}from"./chunk-BrfF1Wgp.js";import{T as _e}from"./chunk-BRVan1jG.js";import{A as ke,a as Pe}from"./chunk-BRjFAgpB.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function Re(){const ee=me(),[n,se]=o.useState("homepage"),[l,Q]=o.useState(""),[m,T]=o.useState(""),[L,U]=o.useState(""),[t,c]=o.useState([]),[ae,h]=o.useState(!1),[v,ie]=o.useState(""),{data:A}=b({queryKey:["admin-states-active"],queryFn:async()=>{const{data:s}=await d.from("states").select("id, name, slug").eq("is_active",!0).in("slug",ve).order("name");return s||[]}}),{data:$}=b({queryKey:["admin-cities",l],queryFn:async()=>{if(!l)return[];const{data:s}=await d.from("cities").select("id, name, slug").eq("state_id",l).eq("is_active",!0).order("name");return s||[]},enabled:!!l}),{data:R}=b({queryKey:["admin-treatments"],queryFn:async()=>{const{data:s}=await d.from("treatments").select("id, name, slug").eq("is_active",!0).order("display_order");return s||[]}}),r=(()=>{if(n==="homepage")return"pinned_clinics_homepage";if(n==="state"&&l)return`pinned_clinics_state_${A?.find(a=>a.id===l)?.slug}`;if(n==="city"&&m){const s=$?.find(i=>i.id===m);return`pinned_clinics_city_${A?.find(i=>i.id===l)?.slug}_${s?.slug}`}return n==="service"&&L?`pinned_clinics_service_${R?.find(a=>a.id===L)?.slug}`:null})(),{data:C,isLoading:te}=b({queryKey:["pinned-clinics",r],queryFn:async()=>{if(!r)return null;const{data:s}=await d.from("global_settings").select("*").eq("key",r).maybeSingle();return s},enabled:!!r}),O=()=>{if(C?.value)try{const s=typeof C.value=="string"?JSON.parse(C.value):C.value;c(Array.isArray(s)?s:[])}catch{c([])}else c([]);h(!1)},ne=async()=>{const s=[];let a=0;const i=1e3;let x=!0,u=[];if(n==="state"&&l){const{data:g}=await d.from("cities").select("id").eq("state_id",l);u=g?.map(f=>f.id)||[]}for(;x;){let g=d.from("clinics").select(`
          id, name, slug, rating, review_count, verification_status, claim_status,
          city:cities(id, name, slug, state:states(id, name, slug, abbreviation))
        `).eq("is_active",!0).order("rating",{ascending:!1}).range(a,a+i-1);n==="city"&&m?g=g.eq("city_id",m):n==="state"&&l&&u.length>0&&(g=g.in("city_id",u));const{data:f,error:W}=await g;if(W)throw W;f&&f.length>0?(s.push(...f),a+=i,x=f.length===i):x=!1}return s},{data:G}=b({queryKey:["available-clinics-unlimited",n,l,m],queryFn:ne,enabled:n==="homepage"||!!l||!!m}),J=he({mutationFn:async()=>{if(!r)throw new Error("No page selected");const{data:s}=await d.from("global_settings").select("id").eq("key",r).maybeSingle();s?await d.from("global_settings").update({value:t,updated_at:new Date().toISOString()}).eq("id",s.id):await d.from("global_settings").insert({key:r,value:t})},onSuccess:()=>{V.success("Pinned profiles saved!"),ee.invalidateQueries({queryKey:["pinned-clinics"]}),h(!1)},onError:s=>V.error(s.message)}),X=s=>{if(t.find(i=>i.id===s))c(t.filter(i=>i.id!==s));else{if(t.length>=10){V.error("Maximum 10 pinned profiles allowed");return}c([...t,{id:s,position:t.length+1,featured:!1}])}h(!0)},le=(s,a)=>{c(t.map(i=>i.id===s?{...i,featured:a}:i)),h(!0)},ce=s=>{const a=t.findIndex(i=>i.id===s);if(a>0){const i=[...t];[i[a-1],i[a]]=[i[a],i[a-1]],c(i.map((x,u)=>({...x,position:u+1}))),h(!0)}},re=s=>{const a=t.findIndex(i=>i.id===s);if(a<t.length-1){const i=[...t];[i[a],i[a+1]]=[i[a+1],i[a]],c(i.map((x,u)=>({...x,position:u+1}))),h(!0)}},de=()=>{c([]),h(!0)},oe=s=>G?.find(a=>a.id===s),K=t.map(s=>({...s,clinic:oe(s.id)})).filter(s=>s.clinic),F=G?.filter(s=>!t.some(a=>a.id===s.id))||[],B=o.useMemo(()=>{if(!v.trim())return F;const s=v.toLowerCase();return F.filter(a=>a.name?.toLowerCase().includes(s)||a.slug?.toLowerCase().includes(s)||a.city?.name?.toLowerCase().includes(s)||a.city?.state?.name?.toLowerCase().includes(s)||a.city?.state?.abbreviation?.toLowerCase().includes(s))},[F,v]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"Pinned Profiles"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Select which clinics appear at the top of each page"})]}),ae&&e.jsxs(p,{onClick:()=>J.mutate(),disabled:J.isPending,children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]}),e.jsxs(P,{className:"card-modern",children:[e.jsxs(z,{children:[e.jsxs(E,{className:"text-lg flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-primary"}),"Select Page"]}),e.jsx(H,{children:"Choose which page you want to configure pinned profiles for"})]}),e.jsx(q,{children:e.jsxs("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Page Type"}),e.jsxs(w,{value:n,onValueChange:s=>{se(s),Q(""),T(""),U(""),c([])},children:[e.jsx(S,{children:e.jsx(_,{})}),e.jsxs(k,{children:[e.jsx(j,{value:"homepage",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Homepage"]})}),e.jsx(j,{value:"state",children:"State Page"}),e.jsx(j,{value:"city",children:"City Page"}),e.jsx(j,{value:"service",children:"Service Page"})]})]})]}),(n==="state"||n==="city")&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"State"}),e.jsxs(w,{value:l,onValueChange:s=>{Q(s),T(""),c([])},children:[e.jsx(S,{children:e.jsx(_,{placeholder:"Select state"})}),e.jsx(k,{children:A?.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))})]})]}),n==="city"&&l&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"City"}),e.jsxs(w,{value:m,onValueChange:s=>{T(s),c([]),O()},children:[e.jsx(S,{children:e.jsx(_,{placeholder:"Select city"})}),e.jsx(k,{children:$?.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))})]})]}),n==="service"&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Service"}),e.jsxs(w,{value:L,onValueChange:s=>{U(s),c([])},children:[e.jsx(S,{children:e.jsx(_,{placeholder:"Select service"})}),e.jsx(k,{children:R?.map(s=>e.jsx(j,{value:s.id,children:s.name},s.id))})]})]}),r&&e.jsx("div",{className:"flex items-end",children:e.jsx(p,{variant:"outline",onClick:O,className:"w-full",children:"Load Current Pins"})})]})})]}),r&&e.jsxs(P,{className:"card-modern",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(E,{className:"text-lg flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-primary"}),"Pinned Clinics (",t.length,"/10)"]}),e.jsx(H,{children:"These clinics will appear at the top of the page in order"})]}),t.length>0&&e.jsxs(p,{variant:"outline",size:"sm",onClick:de,children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})}),e.jsx(q,{children:K.length>0?e.jsx("div",{className:"space-y-2",children:K.map((s,a)=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-primary/5 border border-primary/20 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>ce(s.id),disabled:a===0,children:e.jsx(ke,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>re(s.id),disabled:a===K.length-1,children:e.jsx(Pe,{className:"h-4 w-4"})})]}),e.jsxs(I,{className:"bg-primary text-primary-foreground font-bold",children:["#",a+1]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold",children:s.clinic?.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.clinic?.city?.name,", ",s.clinic?.city?.state?.abbreviation]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{checked:s.featured,onCheckedChange:i=>le(s.id,i)}),e.jsx("span",{className:"text-sm font-medium",children:"Featured"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4 text-gold fill-gold"}),e.jsx("span",{className:"font-medium",children:s.clinic?.rating||0})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>X(s.id),children:e.jsx(ue,{className:"h-4 w-4"})})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"No pinned clinics yet. Select clinics from the list below."})]})})]}),r&&e.jsxs(P,{className:"card-modern",children:[e.jsx(z,{children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(E,{className:"text-lg",children:["Available Clinics (",B.length.toLocaleString(),")"]}),e.jsx(H,{children:"Click to pin clinics to the top of the page"})]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(pe,{placeholder:"Search clinics...",value:v,onChange:s=>ie(s.target.value),className:"pl-9"})]})]})}),e.jsx(q,{className:"p-0",children:e.jsx(je,{className:"h-[500px]",children:e.jsxs(be,{children:[e.jsx(Ne,{children:e.jsxs(D,{children:[e.jsx(N,{className:"w-16 sticky top-0 bg-background",children:"Pin"}),e.jsx(N,{className:"sticky top-0 bg-background",children:"Clinic"}),e.jsx(N,{className:"sticky top-0 bg-background",children:"Location"}),e.jsx(N,{className:"sticky top-0 bg-background",children:"Status"}),e.jsx(N,{className:"sticky top-0 bg-background",children:"Rating"})]})}),e.jsxs(Ce,{children:[B.map(s=>e.jsxs(D,{className:"cursor-pointer hover:bg-muted/50",onClick:()=>X(s.id),children:[e.jsx(y,{children:e.jsx(p,{variant:"outline",size:"icon",className:"h-8 w-8",children:e.jsx(M,{className:"h-4 w-4"})})}),e.jsx(y,{children:e.jsx("div",{className:"font-medium",children:s.name})}),e.jsxs(y,{className:"text-muted-foreground",children:[s.city?.name,", ",s.city?.state?.abbreviation]}),e.jsx(y,{children:e.jsxs("div",{className:"flex gap-2",children:[s.verification_status==="verified"&&e.jsxs(I,{className:"bg-teal/20 text-teal",children:[e.jsx(fe,{className:"h-3 w-3 mr-1"}),"Verified"]}),s.claim_status==="claimed"&&e.jsxs(I,{className:"bg-primary/20 text-primary",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"Claimed"]})]})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4 text-gold fill-gold"}),e.jsx("span",{className:"font-medium",children:s.rating||0}),e.jsxs("span",{className:"text-muted-foreground text-xs",children:["(",s.review_count||0,")"]})]})})]},s.id)),B.length===0&&e.jsx(D,{children:e.jsx(y,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:te?"Loading...":v?"No clinics match your search":"No clinics available for this page"})})]})]})})})]}),!r&&e.jsx(P,{className:"card-modern",children:e.jsxs(q,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(Y,{className:"h-12 w-12 mx-auto mb-4 opacity-20"}),e.jsx("p",{children:"Select a page type and location above to manage pinned profiles."})]})})]})}export{Re as default};
