import{j as e,b as J,u as q,c as k}from"./chunk-CPh6voF3.js";import{r as E}from"./chunk-CffrGP6S.js";import{D as Z,h as ee,B as A,j as se,V as R,W as ae,i as B,n as Y,v as U,U as F,P as te,w as ie,a9 as le,aa as re,ab as ne,ac as oe,ad as ce,L as K,a as d,I as j,a2 as de,a3 as me,a5 as pe,a6 as ue,a7 as xe,al as he,s as f,b as h,u as ge}from"./index-DflORfjh.js";import{C as b,d as _}from"./chunk-Dwq_v72W.js";import{S as L}from"./chunk-CQtADEjB.js";import{c as O}from"./chunk-BSjc5zjM.js";import{N as je}from"./chunk-BQwaAkM6.js";import{A as G,a as H,b as $}from"./chunk-Df_5lNy2.js";import{C as fe}from"./chunk-DI0yTdYZ.js";import{E as ye}from"./chunk-CzCas5F3.js";import{S as Ne}from"./chunk-B51FxpoB.js";import{T as ve}from"./chunk-BRVan1jG.js";import{G as z}from"./chunk-DrzOALbo.js";import{A as N}from"./chunk-bmpXwoJk.js";import{U as W}from"./chunk-D3rEHCqk.js";import{S as be}from"./chunk-DfjE-bP6.js";import{U as _e}from"./chunk-BcKWIjsB.js";import{P as X}from"./chunk-HAC-i_a2.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-Cq66vzLV.js";import"./chunk-fofMllkR.js";import"./chunk-DSDQubI6.js";import"./chunk-BaL04tya.js";const V=[{value:"dentist",label:"Dentist",icon:U,color:"bg-primary/10 text-primary"},{value:"orthodontist",label:"Orthodontist",icon:N,color:"bg-purple-light text-purple"},{value:"endodontist",label:"Endodontist",icon:N,color:"bg-coral-light text-coral"},{value:"periodontist",label:"Periodontist",icon:N,color:"bg-blue-light text-blue-custom"},{value:"prosthodontist",label:"Prosthodontist",icon:N,color:"bg-gold-light text-gold"},{value:"oral_surgeon",label:"Oral Surgeon",icon:N,color:"bg-teal-light text-teal"},{value:"pediatric_dentist",label:"Pediatric Dentist",icon:N,color:"bg-pink-100 text-pink-600"},{value:"hygienist",label:"Dental Hygienist",icon:W,color:"bg-teal-light text-teal"},{value:"assistant",label:"Dental Assistant",icon:F,color:"bg-blue-light text-blue-custom"},{value:"receptionist",label:"Receptionist",icon:te,color:"bg-gold-light text-gold"},{value:"practice_manager",label:"Practice Manager",icon:ie,color:"bg-purple-light text-purple"}];function Q({member:l,onEdit:g,onDelete:w}){const i=(m=>V.find(o=>o.value===m)||V[0])(l.professional_type),u=i.icon;return e.jsx(b,{className:"card-modern overflow-hidden group",children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsxs(G,{className:"h-16 w-16 border-2 border-border",children:[e.jsx(H,{src:l.image_url||void 0,alt:l.name}),e.jsx($,{className:"bg-primary/10 text-primary text-lg font-bold",children:l.name.split(" ").map(m=>m[0]).join("").slice(0,2)})]}),l.is_primary&&e.jsx("div",{className:"absolute -top-1 -right-1 h-6 w-6 rounded-full bg-gold flex items-center justify-center",children:e.jsx(fe,{className:"h-3 w-3 text-white"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-foreground truncate",children:l.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.title||i.label})]}),e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsx(A,{variant:"ghost",size:"icon",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(ye,{className:"h-4 w-4"})})}),e.jsxs(se,{align:"end",children:[e.jsxs(R,{onClick:()=>g(l),children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"})," Edit"]}),e.jsx(ae,{}),e.jsxs(R,{onClick:()=>w(l.id),className:"text-destructive",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"})," Remove"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsxs(B,{variant:"outline",className:`${i.color} border-0 text-xs`,children:[e.jsx(u,{className:"h-3 w-3 mr-1"}),i.label]}),l.years_experience&&e.jsxs(B,{variant:"secondary",className:"text-xs",children:[e.jsx(z,{className:"h-3 w-3 mr-1"}),l.years_experience,"y exp"]})]}),(l.rating||0)>0&&e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm",children:[e.jsx(Y,{className:"h-3.5 w-3.5 text-gold fill-gold"}),e.jsx("span",{className:"font-medium",children:Number(l.rating).toFixed(1)}),e.jsxs("span",{className:"text-muted-foreground",children:["(",l.review_count||0,")"]})]})]})]})})})}const we=[{value:"dentist",label:"Dentist"},{value:"orthodontist",label:"Orthodontist"},{value:"endodontist",label:"Endodontist"},{value:"periodontist",label:"Periodontist"},{value:"prosthodontist",label:"Prosthodontist"},{value:"oral_surgeon",label:"Oral Surgeon"},{value:"pediatric_dentist",label:"Pediatric Dentist"},{value:"hygienist",label:"Dental Hygienist"},{value:"assistant",label:"Dental Assistant"},{value:"receptionist",label:"Receptionist"},{value:"practice_manager",label:"Practice Manager"}];function Ce({isOpen:l,onClose:g,title:w,clinicId:p,formData:i,onFormChange:u,onSubmit:m,isSubmitting:o,isEdit:c}){const M=E.useRef(null),[r,P]=E.useState(!1),D=async t=>{const x=t.target.files?.[0];if(!(!x||!p)){P(!0);try{const C=x.name.split(".").pop(),I=`${p}/team-${Date.now()}.${C}`,{error:y}=await f.storage.from("clinic-assets").upload(I,x,{upsert:!0});if(y)throw y;const{data:{publicUrl:S}}=f.storage.from("clinic-assets").getPublicUrl(I);u({...i,image_url:S}),h.success("Photo uploaded")}catch(C){h.error(C.message||"Failed to upload photo")}finally{P(!1)}}},n=(t,x)=>{u({...i,[t]:x})};return e.jsx(le,{open:l,onOpenChange:g,children:e.jsxs(re,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(ne,{children:[e.jsx(oe,{children:w}),e.jsx(ce,{children:"Add doctors, hygienists, and support staff to your practice"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"relative",children:i.image_url?e.jsxs(G,{className:"h-20 w-20 border-2 border-border",children:[e.jsx(H,{src:i.image_url}),e.jsx($,{children:i.name.split(" ").map(t=>t[0]).join("").slice(0,2)||"TM"})]}):e.jsx("div",{className:"h-20 w-20 rounded-full bg-muted flex items-center justify-center border-2 border-dashed border-border",children:e.jsx(F,{className:"h-8 w-8 text-muted-foreground"})})}),e.jsxs("div",{children:[e.jsx("input",{ref:M,type:"file",accept:"image/*",onChange:D,className:"hidden"}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>M.current?.click(),disabled:r,children:[r?e.jsx(K,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Upload Photo"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Recommended: 400x400px"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Full Name *"}),e.jsx(j,{value:i.name,onChange:t=>n("name",t.target.value),placeholder:"Dr. Ahmed Khan"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Title"}),e.jsx(j,{value:i.title,onChange:t=>n("title",t.target.value),placeholder:"Senior Dentist"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Professional Type *"}),e.jsxs(de,{value:i.professional_type,onValueChange:t=>n("professional_type",t),children:[e.jsx(me,{children:e.jsx(pe,{})}),e.jsx(ue,{children:we.map(t=>e.jsx(xe,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Department"}),e.jsx(j,{value:i.department,onChange:t=>n("department",t.target.value),placeholder:"Cosmetic Dentistry"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"License Number"}),e.jsx(j,{value:i.license_number,onChange:t=>n("license_number",t.target.value),placeholder:"DHA-XXX-XXXX"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Years of Experience"}),e.jsx(j,{type:"number",value:i.years_experience,onChange:t=>n("years_experience",parseInt(t.target.value)||0),placeholder:"10"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Email"}),e.jsx(j,{type:"email",value:i.email,onChange:t=>n("email",t.target.value),placeholder:"doctor@clinic.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Phone"}),e.jsx(j,{value:i.phone,onChange:t=>n("phone",t.target.value),placeholder:"+971 50 XXX XXXX"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Bio"}),e.jsx(he,{value:i.bio,onChange:t=>n("bio",t.target.value),placeholder:"Brief professional background...",rows:3})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-gold-light/50 border border-gold/20",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Lead Practitioner"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Mark as primary dentist/owner"})]}),e.jsx(be,{checked:i.is_primary,onCheckedChange:t=>n("is_primary",t)})]}),e.jsxs(A,{className:"w-full",onClick:m,disabled:!i.name||o,children:[o?e.jsx(K,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(X,{className:"h-4 w-4 mr-2"}),c?"Update Team Member":"Add Team Member"]})]})]})})}const v={name:"",title:"",professional_type:"dentist",is_primary:!1,license_number:"",department:"",email:"",phone:"",bio:"",years_experience:0,image_url:""};function es(){const{user:l}=ge(),g=J(),[w,p]=E.useState(!1),[i,u]=E.useState(null),[m,o]=E.useState(v),{data:c,isLoading:M}=q({queryKey:["dentist-clinic-team",l?.id],queryFn:async()=>{const{data:s,error:a}=await f.from("clinics").select("id, name").eq("claimed_by",l?.id).limit(1).single();if(a&&a.code!=="PGRST116")throw a;return s},enabled:!!l?.id}),{data:r,isLoading:P}=q({queryKey:["clinic-team",c?.id],queryFn:async()=>{const{data:s,error:a}=await f.from("dentists").select("*").eq("clinic_id",c?.id).order("is_primary",{ascending:!1}).order("name");if(a)throw a;return s||[]},enabled:!!c?.id}),D=k({mutationFn:async s=>{if(!c?.id)throw new Error("No clinic found");const a=s.name.toLowerCase().replace(/\s+/g,"-")+"-"+Date.now().toString(36),{error:T}=await f.from("dentists").insert({clinic_id:c.id,name:s.name,slug:a,title:s.title||null,professional_type:s.professional_type,is_primary:s.is_primary,license_number:s.license_number||null,department:s.department||null,email:s.email||null,phone:s.phone||null,bio:s.bio||null,years_experience:s.years_experience||null,image_url:s.image_url||null,is_active:!0});if(T)throw T;await O({action:"CREATE",entityType:"team_member",entityId:c.id,newValues:{name:s.name,professional_type:s.professional_type}})},onSuccess:()=>{g.invalidateQueries({queryKey:["clinic-team"]}),h.success("Team member added"),p(!1),o(v)},onError:s=>h.error(s.message||"Failed to add team member")}),n=k({mutationFn:async({id:s,data:a})=>{const{error:T}=await f.from("dentists").update({name:a.name,title:a.title||null,professional_type:a.professional_type,is_primary:a.is_primary,license_number:a.license_number||null,department:a.department||null,email:a.email||null,phone:a.phone||null,bio:a.bio||null,years_experience:a.years_experience||null,image_url:a.image_url||null,updated_at:new Date().toISOString()}).eq("id",s);if(T)throw T;await O({action:"UPDATE",entityType:"team_member",entityId:s,newValues:{name:a.name,professional_type:a.professional_type}})},onSuccess:()=>{g.invalidateQueries({queryKey:["clinic-team"]}),h.success("Team member updated"),u(null),o(v)},onError:s=>h.error(s.message||"Failed to update team member")}),t=k({mutationFn:async s=>{const{error:a}=await f.from("dentists").update({is_active:!1}).eq("id",s);if(a)throw a;await O({action:"DELETE",entityType:"team_member",entityId:s})},onSuccess:()=>{g.invalidateQueries({queryKey:["clinic-team"]}),h.success("Team member removed")},onError:s=>h.error(s.message||"Failed to remove team member")}),x=s=>{u(s),o({name:s.name,title:s.title||"",professional_type:s.professional_type||"dentist",is_primary:s.is_primary||!1,license_number:s.license_number||"",department:s.department||"",email:s.email||"",phone:s.phone||"",bio:s.bio||"",years_experience:s.years_experience||0,image_url:s.image_url||""})},C=()=>{i?n.mutate({id:i.id,data:m}):D.mutate(m)},I=()=>{p(!1),u(null),o(v)},y=r?.filter(s=>["dentist","orthodontist","endodontist","periodontist","prosthodontist","oral_surgeon","pediatric_dentist"].includes(s.professional_type))||[],S=r?.filter(s=>["hygienist","assistant","receptionist","practice_manager"].includes(s.professional_type))||[];return M?e.jsxs("div",{className:"space-y-6",children:[e.jsx(L,{className:"h-12 w-64"}),e.jsx(L,{className:"h-96"})]}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold",children:"Team Management"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your clinic's doctors and staff"})]}),e.jsxs(A,{onClick:()=>{o(v),p(!0)},children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add Team Member"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(b,{className:"card-modern",children:e.jsxs(_,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(U,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:y.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dentists"})]})]})}),e.jsx(b,{className:"card-modern",children:e.jsxs(_,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal-light flex items-center justify-center",children:e.jsx(W,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:S.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Support Staff"})]})]})}),e.jsx(b,{className:"card-modern",children:e.jsxs(_,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gold-light flex items-center justify-center",children:e.jsx(Y,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r&&r.length>0?(r.reduce((s,a)=>s+(Number(a.rating)||0),0)/r.filter(s=>s.rating).length||0).toFixed(1):"-"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Rating"})]})]})}),e.jsx(b,{className:"card-modern",children:e.jsxs(_,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-purple-light flex items-center justify-center",children:e.jsx(z,{className:"h-6 w-6 text-purple"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r&&r.length>0?Math.round(r.reduce((s,a)=>s+(a.years_experience||0),0)/r.length):"-"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Experience"})]})]})})]}),y.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),"Dentists & Specialists"]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:y.map(s=>e.jsx(Q,{member:s,onEdit:x,onDelete:a=>t.mutate(a)},s.id))})]}),S.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5 text-teal"}),"Support Staff"]}),e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:S.map(s=>e.jsx(Q,{member:s,onEdit:x,onDelete:a=>t.mutate(a)},s.id))})]}),P?e.jsx("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(3)].map((s,a)=>e.jsx(L,{className:"h-32"},a))}):r?.length===0&&e.jsx(b,{className:"card-modern",children:e.jsxs(_,{className:"py-12 text-center",children:[e.jsx(F,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Team Members Yet"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Add dentists, hygienists, and support staff to your practice"}),e.jsxs(A,{onClick:()=>{o(v),p(!0)},children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Add Your First Team Member"]})]})}),e.jsx(Ce,{isOpen:w||!!i,onClose:I,title:i?"Edit Team Member":"Add Team Member",clinicId:c?.id,formData:m,onFormChange:o,onSubmit:C,isSubmitting:D.isPending||n.isPending,isEdit:!!i})]}):e.jsx(je,{compact:!0})}export{es as default};
