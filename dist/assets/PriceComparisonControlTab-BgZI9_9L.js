import{b as V,u as o,c as Y,j as e}from"./chunk-CPh6voF3.js";import{r as d}from"./chunk-CffrGP6S.js";import{v as G,ap as p,o as q,i as y,x as J,I as A,B as g,s as c,b as F}from"./index-DflORfjh.js";import{C as n,d as i,a as j,b as v,c as f}from"./chunk-Dwq_v72W.js";import{T as O,a as U,b,c as N}from"./chunk-k8HiDHrE.js";import{C as W}from"./chunk-wy0nNZZG.js";import{S as X}from"./chunk-C2VW2Ml6.js";import{S as Z}from"./chunk-C7BdFRQZ.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function ue(){const x=V(),[a,l]=d.useState(null),[_,w]=d.useState(""),[C,S]=d.useState(""),[m,T]=d.useState("all"),[h,k]=d.useState("all"),{data:r,isLoading:P}=o({queryKey:["admin-price-ranges"],queryFn:async()=>{const{data:s,error:t}=await c.from("service_price_ranges").select("*, state:states(id, name, slug), treatment:treatments(id, name, slug)").order("treatment_id").order("price_min");if(t)throw t;return s||[]}}),{data:R}=o({queryKey:["admin-states"],queryFn:async()=>{const{data:s}=await c.from("states").select("id, name, slug").eq("is_active",!0).order("display_order");return s||[]}}),{data:E}=o({queryKey:["admin-treatments"],queryFn:async()=>{const{data:s}=await c.from("treatments").select("id, name, slug").eq("is_active",!0).order("display_order");return s||[]}}),{data:u}=o({queryKey:["admin-insurance-coverage"],queryFn:async()=>{const{data:s,error:t}=await c.from("insurance_service_coverage").select("*, insurance:insurances(id, name), treatment:treatments(id, name, slug)").order("insurance_id");if(t)throw t;return s||[]}}),I=Y({mutationFn:async({id:s,price_min:t,price_max:H})=>{const{error:M}=await c.from("service_price_ranges").update({price_min:t,price_max:H}).eq("id",s);if(M)throw M},onSuccess:()=>{x.invalidateQueries({queryKey:["admin-price-ranges"]}),F.success("Price range updated"),l(null)},onError:s=>F.error(s.message)}),L=r?.filter(s=>!(m!=="all"&&s.state?.slug!==m||h!=="all"&&s.treatment?.slug!==h)),D=s=>{l(s.id),w(s.price_min?.toString()||""),S(s.price_max?.toString()||"")},B=s=>{I.mutate({id:s,price_min:parseFloat(_),price_max:parseFloat(C)})},K=r?.length||0,z=r?.length?Math.round(r.reduce((s,t)=>s+t.price_min,0)/r.length):0,Q=r?.length?Math.round(r.reduce((s,t)=>s+t.price_max,0)/r.length):0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(n,{children:e.jsxs(i,{className:"pt-4 text-center",children:[e.jsx(W,{className:"h-5 w-5 text-primary mx-auto mb-1"}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:K}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Price Ranges"})]})}),e.jsx(n,{children:e.jsxs(i,{className:"pt-4 text-center",children:[e.jsx(G,{className:"h-5 w-5 text-primary mx-auto mb-1"}),e.jsx("div",{className:"text-2xl font-bold text-foreground",children:E?.length||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Services"})]})}),e.jsx(n,{children:e.jsxs(i,{className:"pt-4 text-center",children:[e.jsx(p,{className:"h-5 w-5 text-primary mx-auto mb-1"}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:["AED ",z]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg Min Price"})]})}),e.jsx(n,{children:e.jsxs(i,{className:"pt-4 text-center",children:[e.jsx(p,{className:"h-5 w-5 text-primary mx-auto mb-1"}),e.jsxs("div",{className:"text-2xl font-bold text-foreground",children:["AED ",Q]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg Max Price"})]})})]}),e.jsxs(O,{defaultValue:"market-prices",className:"space-y-4",children:[e.jsxs(U,{children:[e.jsxs(b,{value:"market-prices",children:[e.jsx(p,{className:"h-4 w-4 mr-1"})," Market Prices"]}),e.jsxs(b,{value:"insurance-coverage",children:[e.jsx(q,{className:"h-4 w-4 mr-1"})," Insurance Coverage"]}),e.jsxs(b,{value:"budget-ranges",children:[e.jsx(X,{className:"h-4 w-4 mr-1"})," Budget Ranges"]})]}),e.jsx(N,{value:"market-prices",children:e.jsxs(n,{children:[e.jsxs(j,{children:[e.jsx(v,{children:"Service Price Ranges by Emirate"}),e.jsx(f,{children:"Edit market-level price ranges for each service per emirate"}),e.jsxs("div",{className:"flex gap-3 mt-3",children:[e.jsxs("select",{className:"border border-border rounded-lg px-3 py-2 text-sm bg-background",value:m,onChange:s=>T(s.target.value),children:[e.jsx("option",{value:"all",children:"All Emirates"}),R?.map(s=>e.jsx("option",{value:s.slug,children:s.name},s.id))]}),e.jsxs("select",{className:"border border-border rounded-lg px-3 py-2 text-sm bg-background",value:h,onChange:s=>k(s.target.value),children:[e.jsx("option",{value:"all",children:"All Services"}),E?.map(s=>e.jsx("option",{value:s.slug,children:s.name},s.id))]})]})]}),e.jsx(i,{children:P?e.jsx("p",{className:"text-muted-foreground",children:"Loading..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-3 px-2 font-bold",children:"Service"}),e.jsx("th",{className:"text-left py-3 px-2 font-bold",children:"Emirate"}),e.jsx("th",{className:"text-right py-3 px-2 font-bold",children:"Min (AED)"}),e.jsx("th",{className:"text-right py-3 px-2 font-bold",children:"Max (AED)"}),e.jsx("th",{className:"text-right py-3 px-2 font-bold",children:"Actions"})]})}),e.jsx("tbody",{children:L?.map(s=>e.jsxs("tr",{className:"border-b border-border/50 hover:bg-muted/30",children:[e.jsx("td",{className:"py-3 px-2",children:e.jsx(y,{variant:"outline",className:"font-bold",children:s.treatment?.name})}),e.jsxs("td",{className:"py-3 px-2 flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3 text-primary"}),s.state?.name]}),a===s.id?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx(A,{value:_,onChange:t=>w(t.target.value),className:"w-24 ml-auto text-right h-8",type:"number"})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx(A,{value:C,onChange:t=>S(t.target.value),className:"w-24 ml-auto text-right h-8",type:"number"})}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsx(g,{size:"sm",onClick:()=>B(s.id),className:"h-7",children:e.jsx(Z,{className:"h-3 w-3"})}),e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>l(null),className:"h-7",children:"Cancel"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-3 px-2 text-right font-mono",children:s.price_min?.toLocaleString()}),e.jsx("td",{className:"py-3 px-2 text-right font-mono",children:s.price_max?.toLocaleString()}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx(g,{size:"sm",variant:"ghost",onClick:()=>D(s),className:"h-7 text-xs",children:"Edit"})})]})]},s.id))})]})})})]})}),e.jsx(N,{value:"insurance-coverage",children:e.jsxs(n,{children:[e.jsxs(j,{children:[e.jsx(v,{children:"Insurance Coverage by Service"}),e.jsx(f,{children:"Manage coverage percentages per insurance provider and service"})]}),e.jsx(i,{children:u&&u.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-3 px-2 font-bold",children:"Insurance"}),e.jsx("th",{className:"text-left py-3 px-2 font-bold",children:"Service"}),e.jsx("th",{className:"text-right py-3 px-2 font-bold",children:"Coverage %"}),e.jsx("th",{className:"text-right py-3 px-2 font-bold",children:"Covered"})]})}),e.jsx("tbody",{children:u.map(s=>e.jsxs("tr",{className:"border-b border-border/50",children:[e.jsx("td",{className:"py-3 px-2",children:s.insurance?.name}),e.jsx("td",{className:"py-3 px-2",children:s.treatment?.name}),e.jsxs("td",{className:"py-3 px-2 text-right font-mono",children:[s.coverage_percentage,"%"]}),e.jsx("td",{className:"py-3 px-2 text-right",children:e.jsx(y,{variant:s.is_covered?"default":"destructive",className:"text-xs",children:s.is_covered?"Yes":"No"})})]},s.id))})]})}):e.jsxs("div",{className:"text-center py-10 text-muted-foreground",children:[e.jsx(q,{className:"h-8 w-8 mx-auto mb-3 text-muted-foreground/50"}),e.jsx("p",{className:"font-bold mb-1",children:"No coverage data yet"}),e.jsx("p",{className:"text-sm",children:"Add insurance coverage percentages per service to enable the coverage filter for patients"})]})})]})}),e.jsx(N,{value:"budget-ranges",children:e.jsxs(n,{children:[e.jsxs(j,{children:[e.jsx(v,{children:"Budget Slider Ranges"}),e.jsx(f,{children:"These ranges power the budget filter across the platform"})]}),e.jsx(i,{children:e.jsx($,{})})]})})]})]})}function $(){const{data:x}=o({queryKey:["admin-budget-ranges"],queryFn:async()=>{const{data:a,error:l}=await c.from("budget_ranges").select("*").order("display_order");if(l)throw l;return a||[]}});return e.jsx("div",{className:"space-y-2",children:x?.map(a=>e.jsxs("div",{className:"flex items-center justify-between bg-muted/30 rounded-xl px-4 py-3",children:[e.jsx("span",{className:"font-bold text-sm",children:a.label}),e.jsxs("span",{className:"text-sm text-muted-foreground font-mono",children:["AED ",a.min_value?.toLocaleString()||"0"," – ",a.max_value?.toLocaleString()||"∞"]}),e.jsx(y,{variant:a.is_active?"default":"secondary",className:"text-xs",children:a.is_active?"Active":"Inactive"})]},a.id))})}export{ue as default};
