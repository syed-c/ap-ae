import{b as Ye,u as q,j as e}from"./chunk-CPh6voF3.js";import{r as n}from"./chunk-CffrGP6S.js";import{u as es,s as m,b as F,w as ss,A as as,G as Y,y as ts,a2 as Ee,a3 as ke,a5 as Re,a6 as Ie,a7 as O,B as x,bA as ee,bC as is,L as Ae,C as qe,S as se,i,Z as ns,aK as Fe,b7 as Pe,a9 as rs,aa as ls,ab as cs,ac as ds,ad as os,x as ms,I as us,ae as hs,X as xs,bB as ps}from"./index-DflORfjh.js";import{C as v,d as y,a as H,b as U,c as ae}from"./chunk-Dwq_v72W.js";import{P as Te}from"./chunk-DSDQubI6.js";import{T as te,a as ie,b as P,c,d as ne,e as d}from"./chunk-NLs5Ye4A.js";import{T as js,a as fs,b as re,c as le}from"./chunk-k8HiDHrE.js";import{C as Be}from"./chunk-CbEmr7WL.js";import{B as Me}from"./chunk-Bl7VVhKV.js";import{S as $e}from"./chunk-D0B-jfny.js";import{C as De}from"./chunk-GLPyMM0F.js";import{D as gs}from"./chunk-CedtSHBb.js";import{E as ce}from"./chunk-CcezodbN.js";import{E as Ns}from"./chunk-CbETxTmt.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";const ze="email-enrichment-state";function Ls(){const{user:G}=es(),J=Ye(),[p,Ke]=n.useState("all"),[S,Le]=n.useState("all"),[o,$]=n.useState(null),[f,g]=n.useState(!1),[de,E]=n.useState(!1),[oe,me]=n.useState([]),[We,T]=n.useState(!1),[h,ue]=n.useState(null),[D,z]=n.useState(""),[j,K]=n.useState(new Set),[he,xe]=n.useState(!1),[ws,pe]=n.useState(0),je=n.useRef(null),N=n.useRef(!1);n.useEffect(()=>{try{const s=localStorage.getItem(ze);if(s){const a=JSON.parse(s);a.sessionId&&$(a.sessionId)}}catch(s){console.error("Error loading saved state:",s)}},[]),n.useEffect(()=>{const s={sessionId:o,isRunning:f,isPaused:de};localStorage.setItem(ze,JSON.stringify(s))},[o,f,de]);const{data:Qe}=q({queryKey:["states-active"],queryFn:async()=>{const{data:s}=await m.from("states").select("*").eq("is_active",!0).in("slug",ps).order("name");return s||[]}}),{data:k}=q({queryKey:["cities-for-enrichment",p],queryFn:async()=>{if(p==="all")return[];const{data:s}=await m.from("cities").select("*").eq("state_id",p).eq("is_active",!0).order("name");return s||[]},enabled:p!=="all"}),{data:R,refetch:L}=q({queryKey:["clinic-email-stats",p,S],queryFn:async()=>{const s=Ce=>{let C=Ce.eq("is_active",!0).eq("is_duplicate",!1);if(p!=="all"){const M=k?.map(Q=>Q.id)||[];S!=="all"?C=C.eq("city_id",S):M.length>0&&(C=C.in("city_id",M))}return C},[a,t,l,A,W]=await Promise.all([s(m.from("clinics").select("id",{count:"exact",head:!0})),s(m.from("clinics").select("id",{count:"exact",head:!0})).not("email","is",null),s(m.from("clinics").select("id",{count:"exact",head:!0})).is("email",null),s(m.from("clinics").select("id",{count:"exact",head:!0})).not("website","is",null),s(m.from("clinics").select("id",{count:"exact",head:!0})).not("website","is",null).is("email",null)]);return{total:a.count||0,withEmail:t.count||0,withoutEmail:l.count||0,withWebsite:A.count||0,withWebsiteNoEmail:W.count||0}}}),{data:fe,refetch:w}=q({queryKey:["enrichment-sessions"],queryFn:async()=>{const{data:s}=await m.from("email_enrichment_sessions").select("*").order("created_at",{ascending:!1}).limit(10);return s||[]},refetchInterval:f?2e3:1e4}),{data:b,refetch:I}=q({queryKey:["enrichment-results",o],queryFn:async()=>{if(!o)return[];const{data:s}=await m.from("email_enrichment_results").select(`
          *,
          clinic:clinics(id, name, website, email, phone, address, city:cities(name))
        `).eq("session_id",o).order("match_confidence",{ascending:!1});return s||[]},enabled:!!o,refetchInterval:f?2e3:!1}),{data:B}=q({queryKey:["enrichment-review-queue"],queryFn:async()=>{const{data:s}=await m.from("email_enrichment_results").select(`
          *,
          clinic:clinics(id, name, website, email, phone, address, city:cities(name))
        `).eq("needs_review",!0).is("applied_at",null).order("match_confidence",{ascending:!1}).limit(50);return s||[]}}),r=n.useCallback((s,a)=>{me(t=>[...t.slice(-100),{time:new Date,type:s,message:a}])},[]),ge=n.useCallback(async s=>{try{const{data:a,error:t}=await m.functions.invoke("email-enrichment",{body:{action:"process-batch",sessionId:s,batchSize:5}});if(t)return r("error",`Batch error: ${t.message}`),{hasMore:!0,processed:0};if(!a.success)return a.message==="No pending items"?{hasMore:!1,processed:0}:(r("error",`Batch failed: ${a.error}`),{hasMore:!0,processed:0});const{processed:l,successCount:A,failedCount:W,noEmailCount:Ce,pauseRecommended:C,pauseReason:M,retryAfterSeconds:Q,results:V}=a;if(pe(_=>_+1),A>0&&r("success",`âœ“ Found ${A} email(s)`),W>0){const _=Array.isArray(V)?V.find(Z=>Z?.status==="failed"||Z?.status==="rate_limited"||Z?.status==="credits_exhausted")?.error:null,Ze=_?` (e.g. ${String(_).slice(0,120)})`:"";r("warning",`âš  ${W} failed to scrape${Ze}`)}if(Array.isArray(V)&&V.some(_=>_?.creditsExhausted))return r("error","ðŸš« Firecrawl credits exhausted! Please upgrade at firecrawl.dev/pricing"),F.error("Firecrawl credits exhausted",{description:"Please upgrade your plan at firecrawl.dev/pricing to continue scraping.",duration:1e4}),N.current=!1,g(!1),E(!0),w(),{hasMore:!1,processed:l};if(C){const _=Q?` Retry in ~${Q}s.`:"";return r("warning",`â¸ï¸ Rate limited by Firecrawl.${_} ${M?String(M).slice(0,160):""}`),N.current=!1,g(!1),E(!0),w(),{hasMore:!0,processed:l}}return{hasMore:l>0,processed:l}}catch(a){return r("error",`Error: ${a instanceof Error?a.message:"Unknown"}`),{hasMore:!0,processed:0}}},[r]),Ne=n.useCallback(async s=>{if(!N.current)for(N.current=!0;N.current&&N.current;){if(!(await ge(s)).hasMore){r("success","ðŸŽ‰ Enrichment complete!"),g(!1),N.current=!1,L(),w();break}I(),w(),await new Promise(t=>setTimeout(t,1e3))}},[ge,r,L,w,I]),Ve=async()=>{if(G)try{g(!0),E(!1),me([]),pe(0),r("info","ðŸš€ Starting email enrichment session...");const{data:s,error:a}=await m.functions.invoke("email-enrichment",{body:{action:"start-session",stateId:p!=="all"?p:null,cityId:S!=="all"?S:null,cityIds:p!=="all"&&S==="all"?k?.map(t=>t.id):null,userId:G.id}});if(a){if(a.message?.includes("not configured")){r("error","âš ï¸ Firecrawl API key not configured. Please add it in Settings."),g(!1);return}throw a}if(!s.success){r("error",`âœ— Error: ${s.error}`),g(!1);return}$(s.sessionId),r("success",`âœ“ Session started: ${s.sessionId.slice(0,8)}`),r("info",`ðŸ“‹ Processing ${s.totalClinics} clinics...`),w(),I(),Ne(s.sessionId)}catch(s){console.error("Start enrichment error:",s),r("error",`âœ— Error: ${s instanceof Error?s.message:"Unknown error"}`),g(!1)}},we=async()=>{o&&(g(!0),E(!1),r("info","â–¶ï¸ Resuming enrichment..."),await m.from("email_enrichment_sessions").update({status:"running"}).eq("id",o),w(),Ne(o))},Oe=async()=>{N.current=!1,E(!0),g(!1),r("info","â¸ï¸ Paused enrichment"),o&&(await m.from("email_enrichment_sessions").update({status:"paused"}).eq("id",o),w())},ve=async()=>{N.current=!1,g(!1),E(!1),r("info","â¹ï¸ Stopped enrichment"),o&&(await m.from("email_enrichment_sessions").update({status:"stopped"}).eq("id",o),w())};n.useEffect(()=>()=>{je.current&&clearInterval(je.current),N.current=!1},[]);const u=fe?.find(s=>s.id===o),ye=u&&["paused","stopped","running"].includes(u.status)&&u.processed_count<u.total_to_process&&!f,He=async()=>{if(j.size===0)return;xe(!0);let s=0,a=0;try{const t=b?.filter(l=>j.has(l.id)&&l.status==="success"&&!l.applied_at&&l.email_selected)||[];for(const l of t)try{const{error:A}=await m.functions.invoke("email-enrichment",{body:{action:"apply-email",resultId:l.id,email:l.email_selected}});A?a++:s++}catch{a++}F.success(`Applied ${s} emails${a>0?`, ${a} failed`:""}`),K(new Set),I(),L(),J.invalidateQueries({queryKey:["enrichment-review-queue"]})}catch{F.error("Failed to apply emails")}finally{xe(!1)}},be=()=>{const s=b?.filter(a=>a.status==="success"&&!a.applied_at&&a.email_selected).map(a=>a.id)||[];K(new Set(s))},_e=()=>{K(new Set)},Ue=s=>{K(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},Ge=async(s,a)=>{try{const{data:t,error:l}=await m.functions.invoke("email-enrichment",{body:{action:"apply-email",resultId:s,email:a}});if(l||!t.success)throw new Error(t?.error||"Failed to apply email");F.success("Email applied to clinic"),I(),L(),J.invalidateQueries({queryKey:["enrichment-review-queue"]}),T(!1)}catch(t){F.error(t instanceof Error?t.message:"Failed to apply email")}},Je=async s=>{await m.from("email_enrichment_results").update({needs_review:!1,reviewed_by:G?.id,reviewed_at:new Date().toISOString()}).eq("id",s),F.success("Marked as reviewed"),J.invalidateQueries({queryKey:["enrichment-review-queue"]}),T(!1)},Xe=s=>{switch(s){case"success":return e.jsx(i,{className:"bg-green-500",children:"Success"});case"failed":return e.jsx(i,{variant:"destructive",children:"Failed"});case"no_email":return e.jsx(i,{variant:"secondary",children:"No Email Found"});case"pending":return e.jsx(i,{variant:"outline",children:"Pending"});case"processing":return e.jsx(i,{className:"bg-blue-500",children:"Processing"});case"skipped":return e.jsx(i,{variant:"secondary",children:"Skipped"});default:return e.jsx(i,{variant:"outline",children:s})}},X=s=>s>=90?e.jsxs(i,{className:"bg-green-500",children:[s,"%"]}):s>=70?e.jsxs(i,{className:"bg-yellow-500",children:[s,"%"]}):e.jsxs(i,{variant:"destructive",children:[s,"%"]}),Se=s=>{switch(s){case"completed":return e.jsx(i,{className:"bg-green-500",children:"Completed"});case"running":return e.jsx(i,{className:"bg-blue-500",children:"Running"});case"paused":return e.jsx(i,{className:"bg-yellow-500",children:"Paused"});case"stopped":return e.jsx(i,{variant:"destructive",children:"Stopped"});default:return e.jsx(i,{variant:"outline",children:s})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(v,{children:e.jsx(y,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:R?.total||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Clinics"})]})]})})}),e.jsx(v,{children:e.jsx(y,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-5 w-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:R?.withEmail||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Have Email"})]})]})})}),e.jsx(v,{children:e.jsx(y,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-red-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:R?.withoutEmail||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Missing Email"})]})]})})}),e.jsx(v,{children:e.jsx(y,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:R?.withWebsite||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Have Website"})]})]})})}),e.jsx(v,{className:"border-2 border-primary",children:e.jsx(y,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ts,{className:"h-5 w-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:R?.withWebsiteNoEmail||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Can Enrich"})]})]})})})]}),e.jsxs(v,{children:[e.jsxs(H,{children:[e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),"Email Enrichment Bot"]}),e.jsx(ae,{children:"Scrape clinic websites to discover email addresses and enrich profiles"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"State Filter"}),e.jsxs(Ee,{value:p,onValueChange:Ke,disabled:f,children:[e.jsx(ke,{children:e.jsx(Re,{placeholder:"All States"})}),e.jsxs(Ie,{children:[e.jsx(O,{value:"all",children:"All States"}),Qe?.map(s=>e.jsx(O,{value:s.id,children:s.name},s.id))]})]})]}),p!=="all"&&k&&k.length>0&&e.jsxs("div",{className:"flex-1 min-w-[200px]",children:[e.jsx("label",{className:"text-sm font-medium mb-1 block",children:"City Filter"}),e.jsxs(Ee,{value:S,onValueChange:Le,disabled:f,children:[e.jsx(ke,{children:e.jsx(Re,{placeholder:"All Cities"})}),e.jsxs(Ie,{children:[e.jsxs(O,{value:"all",children:["All Cities (",k.length,")"]}),k.map(s=>e.jsx(O,{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[!f&&!ye&&e.jsxs(x,{onClick:Ve,disabled:(R?.withWebsiteNoEmail||0)===0,className:"gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Start Enrichment"]}),ye&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:we,className:"gap-2 bg-green-600 hover:bg-green-700",children:[e.jsx(ee,{className:"h-4 w-4"}),"Resume (",u.total_to_process-u.processed_count," remaining)"]}),e.jsxs(x,{variant:"destructive",onClick:ve,className:"gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"Stop"]})]}),f&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{variant:"outline",onClick:Oe,className:"gap-2",children:[e.jsx(is,{className:"h-4 w-4"}),"Pause"]}),e.jsxs(x,{variant:"destructive",onClick:ve,className:"gap-2",children:[e.jsx($e,{className:"h-4 w-4"}),"Stop"]})]})]})]}),o&&u&&e.jsx("div",{className:"space-y-2 p-4 bg-muted/30 rounded-lg",children:(()=>{const s=u.total_to_process>0?u.processed_count/u.total_to_process*100:0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[f&&e.jsx(Ae,{className:"h-4 w-4 animate-spin"}),"Progress: ",u.processed_count," / ",u.total_to_process]}),e.jsxs("span",{className:"font-medium",children:[Math.round(s),"%"]})]}),e.jsx(Te,{value:s,className:"h-2"}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(qe,{className:"h-3 w-3"})," ",u.success_count," success"]}),e.jsxs("span",{className:"text-yellow-600 flex items-center gap-1",children:[e.jsx(De,{className:"h-3 w-3"})," ",u.skipped_count," skipped"]}),e.jsxs("span",{className:"text-red-600 flex items-center gap-1",children:[e.jsx(Be,{className:"h-3 w-3"})," ",u.failed_count," failed"]}),e.jsx("span",{className:"ml-auto",children:Se(u.status)})]})]})})()}),oe.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Activity Log"}),e.jsx(se,{className:"h-32 border rounded-md p-2 bg-muted/30",children:oe.map((s,a)=>e.jsxs("div",{className:"text-xs font-mono py-0.5",children:[e.jsx("span",{className:"text-muted-foreground",children:s.time.toLocaleTimeString()})," ",e.jsx("span",{className:s.type==="error"?"text-red-500":s.type==="success"?"text-green-500":s.type==="warning"?"text-yellow-500":"",children:s.message})]},a))})]})]})]}),e.jsxs(js,{defaultValue:"results",className:"space-y-4",children:[e.jsxs(fs,{children:[e.jsxs(re,{value:"results",className:"gap-2",children:[e.jsx(gs,{className:"h-4 w-4"}),"Session Results"]}),e.jsxs(re,{value:"review",className:"gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"Review Queue",(B?.length||0)>0&&e.jsx(i,{variant:"destructive",className:"ml-1",children:B?.length})]}),e.jsxs(re,{value:"sessions",className:"gap-2",children:[e.jsx(ns,{className:"h-4 w-4"}),"Past Sessions"]})]}),e.jsx(le,{value:"results",children:e.jsxs(v,{children:[e.jsxs(H,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Enrichment Results"}),e.jsxs(ae,{children:[b?.length||0," results from current session",j.size>0&&e.jsxs("span",{className:"ml-2 text-primary font-medium",children:["(",j.size," selected)"]})]})]}),o&&b&&b.some(s=>s.status==="success"&&!s.applied_at)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:j.size>0?_e:be,children:j.size>0?"Clear Selection":"Select All"}),e.jsx(x,{size:"sm",onClick:He,disabled:j.size===0||he,className:"gap-2",children:he?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"h-4 w-4 animate-spin"}),"Applying..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4"}),"Apply Selected (",j.size,")"]})})]})]}),e.jsx(y,{children:o?e.jsx(se,{className:"h-[400px]",children:e.jsxs(te,{children:[e.jsx(ie,{children:e.jsxs(P,{children:[e.jsx(c,{className:"w-12",children:e.jsx(Pe,{checked:b?.filter(s=>s.status==="success"&&!s.applied_at&&s.email_selected).length>0&&b?.filter(s=>s.status==="success"&&!s.applied_at&&s.email_selected).every(s=>j.has(s.id)),onCheckedChange:s=>{s?be():_e()}})}),e.jsx(c,{children:"Clinic"}),e.jsx(c,{children:"Website"}),e.jsx(c,{children:"Emails Found"}),e.jsx(c,{children:"Confidence"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ne,{children:b?.map(s=>{const a=s.status==="success"&&!s.applied_at&&s.email_selected;return e.jsxs(P,{className:j.has(s.id)?"bg-muted/50":"",children:[e.jsx(d,{children:a?e.jsx(Pe,{checked:j.has(s.id),onCheckedChange:()=>Ue(s.id)}):e.jsx("span",{className:"w-4"})}),e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.clinic?.name||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.clinic?.city?.name})]})}),e.jsx(d,{children:s.website_url?e.jsxs("a",{href:s.website_url,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),"Visit"]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(d,{children:s.emails_found?.length>0?e.jsxs("div",{className:"space-y-1",children:[s.emails_found.slice(0,2).map((t,l)=>e.jsx(i,{variant:l===0?"default":"outline",className:"text-xs",children:t},l)),s.emails_found.length>2&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",s.emails_found.length-2," more"]})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}),e.jsx(d,{children:s.match_confidence>0&&X(s.match_confidence)}),e.jsx(d,{title:s.error_message||void 0,children:Xe(s.status)}),e.jsxs(d,{children:[s.status==="success"&&!s.applied_at&&e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>{ue(s),z(s.email_selected||""),T(!0)},children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Review"]}),s.applied_at&&e.jsx(i,{className:"bg-green-500",children:"Applied"})]})]},s.id)})})]})}):e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(Me,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Start an enrichment session to see results"})]})})]})}),e.jsx(le,{value:"review",children:e.jsxs(v,{children:[e.jsxs(H,{children:[e.jsx(U,{children:"Manual Review Queue"}),e.jsxs(ae,{children:[B?.length||0," items need manual verification"]})]}),e.jsx(y,{children:(B?.length||0)===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(qe,{className:"h-12 w-12 mx-auto mb-4 opacity-50 text-green-500"}),e.jsx("p",{children:"No items need review"})]}):e.jsx(se,{className:"h-[400px]",children:e.jsxs(te,{children:[e.jsx(ie,{children:e.jsxs(P,{children:[e.jsx(c,{children:"Clinic"}),e.jsx(c,{children:"Website"}),e.jsx(c,{children:"Suggested Email"}),e.jsx(c,{children:"Confidence"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ne,{children:B?.map(s=>e.jsxs(P,{children:[e.jsx(d,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.clinic?.name||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.clinic?.city?.name})]})}),e.jsx(d,{children:s.clinic?.website?e.jsxs("a",{href:s.clinic.website,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline flex items-center gap-1",children:[e.jsx(Ns,{className:"h-3 w-3"}),"Visit"]}):"-"}),e.jsx(d,{children:e.jsx(i,{children:s.email_selected})}),e.jsx(d,{children:X(s.match_confidence)}),e.jsx(d,{children:e.jsx("div",{className:"flex gap-2",children:e.jsxs(x,{size:"sm",variant:"default",onClick:()=>{ue(s),z(s.email_selected||""),T(!0)},children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"Review"]})})})]},s.id))})]})})})]})}),e.jsx(le,{value:"sessions",children:e.jsxs(v,{children:[e.jsx(H,{children:e.jsx(U,{children:"Past Enrichment Sessions"})}),e.jsx(y,{children:e.jsxs(te,{children:[e.jsx(ie,{children:e.jsxs(P,{children:[e.jsx(c,{children:"Session ID"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Progress"}),e.jsx(c,{children:"Success"}),e.jsx(c,{children:"Failed"}),e.jsx(c,{children:"Created"}),e.jsx(c,{children:"Actions"})]})}),e.jsx(ne,{children:fe?.map(s=>{const a=["paused","stopped","running"].includes(s.status)&&s.processed_count<s.total_to_process;return e.jsxs(P,{children:[e.jsx(d,{className:"font-mono text-xs",children:s.id.slice(0,8)}),e.jsx(d,{children:Se(s.status)}),e.jsxs(d,{children:[s.processed_count," / ",s.total_to_process,e.jsx(Te,{value:s.processed_count/s.total_to_process*100,className:"h-1 mt-1 w-20"})]}),e.jsx(d,{className:"text-green-600",children:s.success_count}),e.jsx(d,{className:"text-red-600",children:s.failed_count}),e.jsx(d,{children:new Date(s.created_at).toLocaleDateString()}),e.jsx(d,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>{$(s.id),I()},children:[e.jsx(ce,{className:"h-3 w-3 mr-1"}),"View"]}),a&&s.id!==o&&e.jsxs(x,{size:"sm",variant:"default",onClick:()=>{$(s.id),we()},className:"gap-1",children:[e.jsx(ee,{className:"h-3 w-3"}),"Resume"]})]})})]},s.id)})})]})})]})})]}),e.jsx(rs,{open:We,onOpenChange:T,children:e.jsxs(ls,{className:"max-w-lg",children:[e.jsxs(cs,{children:[e.jsx(ds,{children:"Review Email Match"}),e.jsx(os,{children:"Verify the email before applying to the clinic profile"})]}),h&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-muted/30 p-4 rounded-lg space-y-2",children:[e.jsx("p",{className:"font-medium",children:h.clinic?.name}),h.clinic?.address&&e.jsxs("p",{className:"text-sm text-muted-foreground flex items-center gap-1",children:[e.jsx(ms,{className:"h-3 w-3"}),h.clinic.address]}),h.clinic?.website&&e.jsxs("a",{href:h.clinic.website,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-500 hover:underline flex items-center gap-1",children:[e.jsx(Y,{className:"h-3 w-3"}),h.clinic.website]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Emails Found:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h.emails_found?.map((s,a)=>e.jsx(i,{variant:s===D?"default":"outline",className:"cursor-pointer",onClick:()=>z(s),children:s},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Email to Apply:"}),e.jsx(us,{value:D,onChange:s=>z(s.target.value),placeholder:"Enter email address"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{children:"Confidence:"}),X(h.match_confidence),h.match_method&&e.jsx(i,{variant:"outline",children:h.match_method})]})]}),e.jsxs(hs,{className:"gap-2",children:[e.jsxs(x,{variant:"outline",onClick:()=>h&&Je(h.id),children:[e.jsx(xs,{className:"h-4 w-4 mr-1"}),"Skip"]}),e.jsxs(x,{onClick:()=>h&&Ge(h.id,D),disabled:!D,children:[e.jsx(Fe,{className:"h-4 w-4 mr-1"}),"Apply Email"]})]})]})})]})}export{Ls as default};
