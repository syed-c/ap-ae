import{b as de,u as me,j as e}from"./chunk-CPh6voF3.js";import{r as c}from"./chunk-CffrGP6S.js";import{E as xe,B as w,v as Q,x as q,a4 as ue,a as B,a2 as he,a3 as ge,a5 as pe,a6 as je,a7 as v,I as fe,y as Ne,i as C,L as D,bA as we,bC as Ce,S as be,b7 as ve,C as ye,Q as Se,a9 as _e,aa as Pe,ab as Te,ac as ke,ad as We,b as F,s as I,bK as Le}from"./index-DflORfjh.js";import{C as y,a as S,b as _,c as Re,d as P}from"./chunk-Dwq_v72W.js";import{P as V}from"./chunk-DSDQubI6.js";import{T as $e,a as Ge,b as E,c as Ae}from"./chunk-k8HiDHrE.js";import{S as Be}from"./chunk-FxOzQZIr.js";import{T as De,a as Fe,b as J,c as $,d as Ie,e as G}from"./chunk-NLs5Ye4A.js";import{R as Ee}from"./chunk-BOvFDp2b.js";import{B as K}from"./chunk-B_ghW3Ra.js";import{C as ze}from"./chunk-wy0nNZZG.js";import{E as He}from"./chunk-CcezodbN.js";import{C as U}from"./chunk-GLPyMM0F.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";const Me={"2.1":{name:"Service Page Optimization",weeks:"Week 5-7",pageType:"treatment",targetWordCount:3500,maxWordCount:5e3,priority:["dental-implants","teeth-whitening","invisalign","root-canal","dental-crowns","veneers","cosmetic-dentistry","emergency-dental-care","dentures","dental-bridges"],template:"service"},"2.2":{name:"City Page Transformation",weeks:"Week 8-10",pageType:"city",targetWordCount:2500,maxWordCount:3500,priority:["los-angeles","san-francisco","san-diego","boston","san-jose","newark","hartford","sacramento","oakland","fresno"],template:"city"},"2.3":{name:"Blog Content Engine",weeks:"Week 11-12",pageType:"blog",targetWordCount:2e3,maxWordCount:2800,priority:[],template:"blog",categories:{"cost-guides":5,comparisons:5,"how-to":5,"local-content":5}}};function cs(){de();const[m,X]=c.useState("2.1"),[h,T]=c.useState([]),[k,Y]=c.useState(""),[p,Z]=c.useState("__all__"),[j,ee]=c.useState([0,1e4]),[d,f]=c.useState(null),[A,z]=c.useState(!1),W=c.useRef(!1),L=c.useRef(null),[b,se]=c.useState(null),[te,H]=c.useState(!1),n=Me[m];c.useEffect(()=>{L.current&&(L.current.scrollTop=L.current.scrollHeight)},[d?.logs]);const{data:x,isLoading:ae,refetch:M}=me({queryKey:["phase2-sprint-pages",m],queryFn:async()=>{if(m==="2.3"){const{data:o,error:u}=await I.from("blog_posts").select("id, slug, title, content, status, updated_at").order("updated_at",{ascending:!1});if(u)throw u;return(o||[]).map(i=>({id:i.id,slug:`blog/${i.slug}`,page_type:"blog",h1:i.title,content:typeof i.content=="object"&&i.content!==null&&i.content.body||"",word_count:typeof i.content=="object"&&i.content!==null?(i.content.body||"").split(/\s+/).filter(Boolean).length:0,is_optimized:i.status==="published",updated_at:i.updated_at}))}const s=1e3,t=[];let l=0;for(;;){const{data:o,error:u}=await I.from("seo_pages").select("id, slug, page_type, h1, content, word_count, is_optimized, updated_at").eq("page_type",n.pageType).order("updated_at",{ascending:!1}).range(l,l+s-1);if(u)throw u;const i=o||[],r=i.filter(a=>Le(a.slug,a.page_type));if(t.push(...r),i.length<s)break;l+=s}return t}}),g=c.useMemo(()=>{if(!x)return null;const s=x.length,t=x.filter(r=>(r.word_count||0)>=n.targetWordCount).length,l=x.filter(r=>(r.word_count||0)>0&&(r.word_count||0)<n.targetWordCount).length,o=x.filter(r=>!r.content||(r.word_count||0)===0).length,u=x.filter(r=>n.priority.some(a=>r.slug.toLowerCase().includes(a.toLowerCase()))),i=u.filter(r=>(r.word_count||0)>=n.targetWordCount).length;return{total:s,goodContent:t,thinContent:l,noContent:o,priorityPages:u.length,priorityComplete:i,completionRate:s>0?Math.round(t/s*100):0,avgWordCount:s>0?Math.round(x.reduce((r,a)=>r+(a.word_count||0),0)/s):0}},[x,n]),R=c.useMemo(()=>x?x.filter(s=>{if(p==="good"&&(s.word_count||0)<n.targetWordCount||p==="thin"&&((s.word_count||0)===0||(s.word_count||0)>=n.targetWordCount)||p==="missing"&&(s.word_count||0)>0||p==="priority"&&!n.priority.some(l=>s.slug.toLowerCase().includes(l.toLowerCase())))return!1;const t=s.word_count||0;if(t<j[0]||t>j[1])return!1;if(k){const l=k.toLowerCase();if(!s.slug.toLowerCase().includes(l)&&!(s.h1||"").toLowerCase().includes(l))return!1}return!0}):[],[x,p,j,k,n]),ne=()=>T(R.map(s=>s.id)),re=()=>T([]),le=s=>{T(t=>t.includes(s)?t.filter(l=>l!==s):[...t,s])},N=s=>{f(t=>t?{...t,logs:[...t.logs,{...s,timestamp:new Date}]}:null)},ie=()=>{W.current=!0,F.info("Stopping generation...")},oe=async()=>{if(h.length===0){F.error("Please select at least one page");return}z(!0),W.current=!1;const s=`phase2_${m}_${Date.now()}`;f({id:s,status:"running",total:h.length,processed:0,success:0,errors:0,logs:[],startedAt:new Date}),N({page:"",action:"started",message:`Starting Sprint ${m} generation for ${h.length} pages...`});let t=0,l=0;for(let o=0;o<h.length;o++){if(W.current){N({page:"",action:"stopped",message:`Generation stopped. ${h.length-o} pages skipped.`}),f(a=>a?{...a,status:"stopped"}:null);break}const u=h[o],r=x?.find(a=>a.id===u)?.slug||u;f(a=>a?{...a,processed:o,currentPage:r}:null),N({page:r,action:"generating",message:`Generating Phase 2 content (target: ${n.targetWordCount}+ words)...`});try{const{data:a,error:O}=await I.functions.invoke("phase2-content-generator",{body:{action:"generate",page_id:u,sprint:m,template:n.template,target_word_count:n.targetWordCount,max_word_count:n.maxWordCount}});if(O)throw O;t++,N({page:r,action:"completed",message:`✓ Generated ${a?.word_count||"N/A"} words, ${a?.sections_count||0} sections`})}catch(a){l++,N({page:r,action:"error",message:`✗ Failed: ${a instanceof Error?a.message:"Unknown error"}`})}f(a=>a?{...a,processed:o+1,success:t,errors:l}:null),o<h.length-1&&await new Promise(a=>setTimeout(a,500))}W.current||(f(o=>o?{...o,status:"completed"}:null),N({page:"",action:"completed",message:`Sprint ${m} generation complete: ${t} success, ${l} errors`}),F.success(`Generated content for ${t} pages`)),z(!1),M()},ce=s=>{const t=s||0;return t>=n.targetWordCount?e.jsxs(C,{className:"bg-green-500/20 text-green-400",children:[t.toLocaleString()," words"]}):t>0?e.jsxs(C,{className:"bg-amber-500/20 text-amber-400",children:[t.toLocaleString()," words (thin)"]}):e.jsx(C,{className:"bg-red-500/20 text-red-400",children:"No content"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(xe,{className:"h-6 w-6 text-primary"}),"Phase 2: Content Architecture"]}),e.jsx("p",{className:"text-muted-foreground",children:"Sprint-based content development for services, cities, and blog"})]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>M(),children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs($e,{value:m,onValueChange:s=>{X(s),T([])},children:[e.jsxs(Ge,{className:"grid grid-cols-3 w-full max-w-xl",children:[e.jsxs(E,{value:"2.1",className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sprint 2.1:"})," Services"]}),e.jsxs(E,{value:"2.2",className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sprint 2.2:"})," Cities"]}),e.jsxs(E,{value:"2.3",className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sprint 2.3:"})," Blog"]})]}),e.jsxs(Ae,{value:m,className:"mt-6",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs(y,{children:[e.jsxs(S,{className:"pb-3",children:[e.jsxs(_,{className:"text-lg flex items-center gap-2",children:[m==="2.1"&&e.jsx(Q,{className:"h-5 w-5"}),m==="2.2"&&e.jsx(q,{className:"h-5 w-5"}),m==="2.3"&&e.jsx(K,{className:"h-5 w-5"}),n.name]}),e.jsxs(Re,{children:[n.weeks," • Target: ",n.targetWordCount.toLocaleString(),"+ words"]})]}),e.jsx(P,{className:"space-y-4",children:g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Completion"}),e.jsxs("span",{className:"font-medium",children:[g.completionRate,"%"]})]}),e.jsx(V,{value:g.completionRate,className:"h-2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsxs("span",{children:["Good: ",g.goodContent]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-amber-500"}),e.jsxs("span",{children:["Thin: ",g.thinContent]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsxs("span",{children:["Missing: ",g.noContent]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{children:["Avg: ",g.avgWordCount]})]})]}),n.priority.length>0&&e.jsx("div",{className:"pt-2 border-t",children:e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Priority Pages"}),e.jsxs("span",{className:"font-medium",children:[g.priorityComplete,"/",g.priorityPages]})]})})]})})]}),e.jsxs(y,{children:[e.jsx(S,{className:"pb-3",children:e.jsxs(_,{className:"text-sm flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Filters"]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(B,{className:"text-xs",children:"Content Status"}),e.jsxs(he,{value:p,onValueChange:Z,children:[e.jsx(ge,{className:"mt-1",children:e.jsx(pe,{})}),e.jsxs(je,{children:[e.jsx(v,{value:"__all__",children:"All Pages"}),e.jsx(v,{value:"missing",children:"Missing Content"}),e.jsx(v,{value:"thin",children:"Thin Content"}),e.jsx(v,{value:"good",children:"Good Content"}),n.priority.length>0&&e.jsx(v,{value:"priority",children:"Priority Pages Only"})]})]})]}),e.jsxs("div",{children:[e.jsx(B,{className:"text-xs",children:"Search"}),e.jsx(fe,{className:"mt-1",placeholder:"Search pages...",value:k,onChange:s=>Y(s.target.value)})]}),e.jsxs("div",{children:[e.jsxs(B,{className:"text-xs",children:["Word Count Range: ",j[0]," - ",j[1]]}),e.jsx(Be,{value:j,onValueChange:s=>ee(s),min:0,max:1e4,step:100,className:"mt-2"})]})]})]}),e.jsxs(y,{children:[e.jsx(S,{className:"pb-3",children:e.jsxs(_,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ne,{className:"h-4 w-4"}),"Generate Content"]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Selected"}),e.jsxs(C,{variant:"outline",children:[h.length," pages"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(w,{variant:"outline",size:"sm",className:"flex-1",onClick:ne,children:["Select All (",R.length,")"]}),e.jsx(w,{variant:"outline",size:"sm",onClick:re,children:"Clear"})]}),e.jsx(w,{className:"w-full",onClick:oe,disabled:A||h.length===0,children:A?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Generate Phase 2 Content"]})}),A&&e.jsxs(w,{variant:"outline",className:"w-full",onClick:ie,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Stop Generation"]})]})]})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(y,{className:"h-[600px] flex flex-col",children:[e.jsx(S,{className:"pb-3 flex-shrink-0",children:e.jsxs(_,{className:"text-sm",children:[n.pageType==="blog"?"Blog Posts":`${n.name} Pages`,e.jsxs(C,{variant:"outline",className:"ml-2",children:[R.length," pages"]})]})}),e.jsx(P,{className:"flex-1 overflow-hidden p-0",children:ae?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx(D,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):e.jsx(be,{className:"h-full",children:e.jsxs(De,{children:[e.jsx(Fe,{children:e.jsxs(J,{children:[e.jsx($,{className:"w-10"}),e.jsx($,{children:"Page"}),e.jsx($,{className:"text-right",children:"Word Count"}),e.jsx($,{className:"w-20"})]})}),e.jsx(Ie,{children:R.map(s=>{const t=n.priority.some(l=>s.slug.toLowerCase().includes(l.toLowerCase()));return e.jsxs(J,{className:h.includes(s.id)?"bg-muted/50":"",children:[e.jsx(G,{children:e.jsx(ve,{checked:h.includes(s.id),onCheckedChange:()=>le(s.id)})}),e.jsx(G,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[t&&e.jsx(C,{variant:"secondary",className:"text-xs",children:"Priority"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm truncate max-w-[300px]",children:s.h1||s.slug}),e.jsxs("div",{className:"text-xs text-muted-foreground truncate max-w-[300px]",children:["/",s.slug]})]})]})}),e.jsx(G,{className:"text-right",children:ce(s.word_count)}),e.jsx(G,{children:e.jsx(w,{variant:"ghost",size:"icon",onClick:()=>{se(s),H(!0)},children:e.jsx(He,{className:"h-4 w-4"})})})]},s.id)})})]})})})]})})]}),d&&e.jsxs(y,{className:"mt-6",children:[e.jsx(S,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(_,{className:"text-sm flex items-center gap-2",children:[d.status==="running"&&e.jsx(D,{className:"h-4 w-4 animate-spin"}),d.status==="completed"&&e.jsx(ye,{className:"h-4 w-4 text-green-500"}),d.status==="stopped"&&e.jsx(U,{className:"h-4 w-4 text-amber-500"}),d.status==="error"&&e.jsx(U,{className:"h-4 w-4 text-red-500"}),"Generation Progress"]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-500",children:[d.success," success"]}),e.jsxs("span",{className:"text-red-500",children:[d.errors," errors"]}),e.jsxs("span",{className:"text-muted-foreground",children:[d.processed,"/",d.total]})]})]})}),e.jsxs(P,{children:[e.jsx(V,{value:d.processed/d.total*100,className:"h-2 mb-4"}),e.jsx("div",{ref:L,className:"bg-muted/50 rounded-lg p-3 h-48 overflow-y-auto font-mono text-xs space-y-1",children:d.logs.map((s,t)=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx("span",{className:"text-muted-foreground",children:Se(s.timestamp,"HH:mm:ss")}),e.jsxs("span",{className:s.action==="error"?"text-red-400":s.action==="completed"?"text-green-400":"text-foreground",children:[s.page&&`[${s.page}] `,s.message]})]},t))})]})]})]})]}),e.jsx(_e,{open:te,onOpenChange:H,children:e.jsxs(Pe,{className:"max-w-3xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Te,{children:[e.jsx(ke,{children:b?.h1||b?.slug}),e.jsxs(We,{children:["/",b?.slug]})]}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",children:b?.content?e.jsx("pre",{className:"whitespace-pre-wrap text-sm",children:b.content}):e.jsx("p",{className:"text-muted-foreground italic",children:"No content generated yet"})})]})})]})}export{cs as default};
