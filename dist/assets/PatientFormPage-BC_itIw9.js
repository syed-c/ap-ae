import{u as q,c as D,j as e}from"./chunk-CPh6voF3.js";import{r as x}from"./chunk-CffrGP6S.js";import{b as R,c as B}from"./chunk-Drd-rt-S.js";import{ai as g,C as L,a as h,B as M,aj as Y,o as O,b as p,b7 as A,I as v,al as G,s as w}from"./index-DflORfjh.js";import{P as c}from"./chunk-D3ia1n3Z.js";import{S as l}from"./chunk-DXeotKgJ.js";import{R as H,a as K}from"./chunk-DV8-8yGh.js";import{C,d as F}from"./chunk-Dwq_v72W.js";import{S as j}from"./chunk-CQtADEjB.js";import{C as Q}from"./chunk-GLPyMM0F.js";import{F as V}from"./chunk-BaL04tya.js";import{C as W,a as z}from"./chunk-j7XJPWWF.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";const J={medical_history:Y,consent:O,insurance:W,custom:z};function he(){const{submissionId:n}=R(),[S]=B(),d=S.get("token"),[r,b]=x.useState({}),[k,f]=x.useState(!1),{data:a,isLoading:P,error:I}=q({queryKey:["patient-form-submission",n,d],queryFn:async()=>{if(!n)return null;const{data:s,error:t}=await w.functions.invoke("patient-form",{body:{mode:"get",submissionId:n,token:d}});if(t)throw t;return s?.submission??null},enabled:!!n});x.useEffect(()=>{(a?.status==="completed"||a?.submitted_at)&&f(!0),a?.form_data&&typeof a.form_data=="object"&&b(a.form_data)},[a]);const u=D({mutationFn:async s=>{if(!n)throw new Error("Missing submissionId");const{error:t}=await w.functions.invoke("patient-form",{body:{mode:"submit",submissionId:n,token:d,formData:s}});if(t)throw t},onSuccess:()=>{f(!0),p.success("Form submitted successfully!")},onError:s=>{p.error("Failed to submit form. Please try again."),console.error("Form submission error:",s)}}),o=(s,t)=>{b(N=>({...N,[s]:t}))},_=s=>{if(s.preventDefault(),(a?.template?.fields||[]).filter(y=>y.required&&!r[y.id]).length>0){p.error("Please fill in all required fields");return}u.mutate(r)},E=s=>{switch(s.type){case"text":return e.jsx(v,{id:s.id,placeholder:s.placeholder,value:r[s.id]||"",onChange:t=>o(s.id,t.target.value),className:"rounded-xl"});case"textarea":return e.jsx(G,{id:s.id,placeholder:s.placeholder,value:r[s.id]||"",onChange:t=>o(s.id,t.target.value),className:"rounded-xl",rows:4});case"date":return e.jsx(v,{id:s.id,type:"date",value:r[s.id]||"",onChange:t=>o(s.id,t.target.value),className:"rounded-xl"});case"checkbox":return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(A,{id:s.id,checked:r[s.id]||!1,onCheckedChange:t=>o(s.id,t)}),e.jsx(h,{htmlFor:s.id,className:"text-sm",children:s.label})]});case"radio":return e.jsx(H,{value:r[s.id]||"",onValueChange:t=>o(s.id,t),children:s.options?.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{value:t,id:`${s.id}-${t}`}),e.jsx(h,{htmlFor:`${s.id}-${t}`,children:t})]},t))});case"select":return e.jsxs("select",{id:s.id,value:r[s.id]||"",onChange:t=>o(s.id,t.target.value),className:"w-full rounded-xl border border-border p-3 bg-background",children:[e.jsx("option",{value:"",children:"Select..."}),s.options?.map(t=>e.jsx("option",{value:t,children:t},t))]});default:return null}};if(P)return e.jsx(c,{children:e.jsx(l,{children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsx(j,{className:"h-12 w-3/4 mb-4"}),e.jsx(j,{className:"h-6 w-1/2 mb-8"}),e.jsx(j,{className:"h-96"})]})})});if(I||!a)return e.jsx(c,{children:e.jsx(l,{children:e.jsxs("div",{className:"max-w-2xl mx-auto text-center py-20",children:[e.jsx("div",{className:"h-16 w-16 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(Q,{className:"h-8 w-8 text-destructive"})}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"Form Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"This form link may be expired or invalid."})]})})});const i=a.template,m=a.clinic,T=J[i?.form_type]||V,$=i?.fields||[];return k?e.jsxs(c,{children:[e.jsx(g,{title:"Form Submitted",description:"Your form has been submitted successfully",noindex:!0}),e.jsx(l,{children:e.jsxs("div",{className:"max-w-2xl mx-auto text-center py-20",children:[e.jsx("div",{className:"h-20 w-20 rounded-full bg-teal/10 flex items-center justify-center mx-auto mb-6",children:e.jsx(L,{className:"h-10 w-10 text-teal"})}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Form Submitted!"}),e.jsxs("p",{className:"text-lg text-muted-foreground mb-8",children:["Thank you for completing your ",i?.name||"intake form",".",e.jsx("br",{}),e.jsx("span",{className:"font-medium text-foreground",children:m?.name})," has received your information."]}),e.jsx(C,{className:"card-modern max-w-md mx-auto",children:e.jsxs(F,{className:"p-6",children:[e.jsx("h3",{className:"font-bold mb-2",children:"What happens next?"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-2 text-left",children:[e.jsx("li",{children:"• The clinic will review your information"}),e.jsx("li",{children:"• You may receive a confirmation email"}),e.jsx("li",{children:"• Arrive 10-15 minutes early for your appointment"})]})]})})]})})]}):e.jsxs(c,{children:[e.jsx(g,{title:`${i?.name||"Patient Form"} - ${m?.name||"Dental Clinic"}`,description:i?.description||"Complete your patient intake form",noindex:!0}),e.jsx(l,{className:"py-8 md:py-12",children:e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"h-16 w-16 rounded-2xl bg-primary/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(T,{className:"h-8 w-8 text-primary"})}),e.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:i?.name||"Patient Intake Form"}),e.jsxs("p",{className:"text-muted-foreground",children:[m?.name&&e.jsx("span",{className:"font-medium text-foreground",children:m.name}),i?.description&&e.jsx("span",{className:"block mt-1",children:i.description})]})]}),e.jsx(C,{className:"card-modern",children:e.jsx(F,{className:"p-6 md:p-8",children:e.jsxs("form",{onSubmit:_,className:"space-y-6",children:[$.map(s=>e.jsxs("div",{className:"space-y-2",children:[s.type!=="checkbox"&&e.jsxs(h,{htmlFor:s.id,className:"font-medium",children:[s.label,s.required&&e.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),E(s)]},s.id)),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(M,{type:"submit",className:"w-full rounded-xl h-12 font-bold",disabled:u.isPending,children:u.isPending?"Submitting...":"Submit Form"})})]})})}),e.jsxs("p",{className:"text-xs text-center text-muted-foreground mt-6",children:["Your information is secure and encrypted. By submitting this form, you agree to share your health information with ",m?.name||"the dental clinic","."]})]})})]})}export{he as default};
