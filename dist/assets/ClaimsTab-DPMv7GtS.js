import{u as I,b as q,c as R,j as e}from"./chunk-CPh6voF3.js";import{r as g}from"./chunk-CffrGP6S.js";import{s as l,b as p,o as b,t as _,C as N,w as M,A as Q,P as F,i as h,Q as L,B as j,a9 as O,aa as H,ab as K,ac as U,a as V,al as z}from"./index-DflORfjh.js";import{c as S}from"./chunk-BSjc5zjM.js";import{C as x,d as u,a as J,b as X}from"./chunk-Dwq_v72W.js";import{T as G,a as W,b as y,c as m,d as Y,e as d}from"./chunk-NLs5Ye4A.js";import{C as v}from"./chunk-CbEmr7WL.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function Z(a){return I({queryKey:["claim-requests",a],queryFn:async()=>{let t=l.from("claim_requests").select("*, clinic:clinics(id, name, slug)").order("created_at",{ascending:!1});const{data:r,error:i}=await t;if(i)throw i;return r}})}function $(){const a=q();return R({mutationFn:async({claimId:t,clinicId:r})=>{const{data:{user:i}}=await l.auth.getUser(),{data:n}=await l.from("claim_requests").select("user_id").eq("id",t).single(),{error:c}=await l.from("claim_requests").update({status:"approved",reviewed_by:i?.id,reviewed_at:new Date().toISOString()}).eq("id",t);if(c)throw c;const{error:o}=await l.from("clinics").update({claim_status:"claimed",claimed_by:n?.user_id,claimed_at:new Date().toISOString()}).eq("id",r);if(o)throw o;n?.user_id&&await l.from("user_roles").upsert([{user_id:n.user_id,role:"dentist"}],{onConflict:"user_id,role"}),await S({action:"APPROVE_CLAIM",entityType:"claim_request",entityId:t,metadata:{clinicId:r,userId:n?.user_id}})},onSuccess:()=>{a.invalidateQueries({queryKey:["claim-requests"]}),a.invalidateQueries({queryKey:["admin-clinics"]}),p.success("Claim approved")},onError:t=>p.error("Failed: "+t.message)})}function ee(){const a=q();return R({mutationFn:async({claimId:t,reason:r})=>{const{data:{user:i}}=await l.auth.getUser(),{error:n}=await l.from("claim_requests").update({status:"rejected",admin_notes:r,reviewed_by:i?.id,reviewed_at:new Date().toISOString()}).eq("id",t);if(n)throw n;await S({action:"REJECT_CLAIM",entityType:"claim_request",entityId:t,metadata:{reason:r}})},onSuccess:()=>{a.invalidateQueries({queryKey:["claim-requests"]}),p.success("Claim rejected")},onError:t=>p.error("Failed: "+t.message)})}function he(){const{data:a,isLoading:t}=Z(),r=$(),i=ee(),[n,c]=g.useState(!1),[o,w]=g.useState(null),[f,C]=g.useState(""),T=async s=>{await r.mutateAsync({claimId:s.id,clinicId:s.clinic_id})},A=async()=>{o&&(await i.mutateAsync({claimId:o.id,reason:f}),c(!1),w(null),C(""))},D=s=>{w(s),c(!0)},E=s=>{switch(s){case"approved":return e.jsxs(h,{className:"bg-primary text-primary-foreground",children:[e.jsx(N,{className:"h-3 w-3 mr-1"}),"Approved"]});case"rejected":return e.jsxs(h,{variant:"destructive",children:[e.jsx(v,{className:"h-3 w-3 mr-1"}),"Rejected"]});default:return e.jsxs(h,{variant:"outline",className:"text-gold border-gold",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"Pending"]})}},P=a?.filter(s=>s.status==="pending").length||0,k=a?.filter(s=>s.status==="approved").length||0,B=a?.filter(s=>s.status==="rejected").length||0;return t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"Claims & Verification"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Review and manage clinic ownership claims"})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(x,{className:"card-modern",children:e.jsxs(u,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(b,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:a?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Claims"})]})]})}),e.jsx(x,{className:"card-modern",children:e.jsxs(u,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gold-light flex items-center justify-center",children:e.jsx(_,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:P}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})]})}),e.jsx(x,{className:"card-modern",children:e.jsxs(u,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal-light flex items-center justify-center",children:e.jsx(N,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:k}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Approved"})]})]})}),e.jsx(x,{className:"card-modern",children:e.jsxs(u,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-coral-light flex items-center justify-center",children:e.jsx(v,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:B}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Rejected"})]})]})})]}),e.jsxs(x,{className:"card-modern",children:[e.jsx(J,{children:e.jsx(X,{children:"Claim Requests"})}),e.jsx(u,{className:"p-0",children:e.jsxs(G,{children:[e.jsx(W,{children:e.jsxs(y,{children:[e.jsx(m,{children:"Clinic"}),e.jsx(m,{children:"Contact"}),e.jsx(m,{children:"Verification"}),e.jsx(m,{children:"Submitted"}),e.jsx(m,{children:"Status"}),e.jsx(m,{className:"text-right",children:"Actions"})]})}),e.jsxs(Y,{children:[a?.map(s=>e.jsxs(y,{children:[e.jsx(d,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(M,{className:"h-5 w-5 text-primary"})}),e.jsx("div",{children:e.jsx("p",{className:"font-medium",children:s.clinic?.name||"Unknown Clinic"})})]})}),e.jsx(d,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[s.business_email&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(Q,{className:"h-3 w-3"}),s.business_email]}),s.business_phone&&e.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[e.jsx(F,{className:"h-3 w-3"}),s.business_phone]})]})}),e.jsx(d,{children:e.jsx(h,{variant:"outline",children:s.verification_method||"email"})}),e.jsx(d,{className:"text-muted-foreground",children:s.created_at?L(new Date(s.created_at),"MMM d, yyyy"):"-"}),e.jsx(d,{children:E(s.status||"pending")}),e.jsx(d,{className:"text-right",children:s.status==="pending"&&e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsxs(j,{size:"sm",onClick:()=>T(s),disabled:r.isPending,children:[e.jsx(N,{className:"h-4 w-4 mr-1"}),"Approve"]}),e.jsxs(j,{size:"sm",variant:"outline",className:"text-destructive",onClick:()=>D(s),children:[e.jsx(v,{className:"h-4 w-4 mr-1"}),"Reject"]})]})})]},s.id)),(!a||a.length===0)&&e.jsx(y,{children:e.jsxs(d,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:[e.jsx(b,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No claim requests yet"})]})})]})]})})]}),e.jsx(O,{open:n,onOpenChange:c,children:e.jsxs(H,{children:[e.jsx(K,{children:e.jsx(U,{children:"Reject Claim"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("p",{className:"text-muted-foreground",children:["Rejecting claim for: ",e.jsx("span",{className:"font-medium text-foreground",children:o?.clinic?.name})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(V,{children:"Rejection Reason"}),e.jsx(z,{value:f,onChange:s=>C(s.target.value),placeholder:"Please provide a reason for rejection...",rows:4})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>c(!1),className:"flex-1",children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:A,className:"flex-1",disabled:i.isPending||!f.trim(),children:"Confirm Rejection"})]})]})]})})]})}export{he as default};
