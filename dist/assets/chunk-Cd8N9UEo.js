import{u as g,b as u,c}from"./chunk-CPh6voF3.js";import{s,b as r}from"./index-DflORfjh.js";import{c as l}from"./chunk-BSjc5zjM.js";import{g as y,a as d}from"./chunk-D4Vl1TkM.js";function w(e){return e?.content?y(e.content):""}function q(e){return g({queryKey:["admin-blog-posts",e],queryFn:async()=>{let t=s.from("blog_posts").select("*").order("created_at",{ascending:!1});e&&(t=t.eq("status",e));const{data:o,error:n}=await t;if(n)throw n;return o}})}function _(){const e=u();return c({mutationFn:async t=>{const{data:{user:o}}=await s.auth.getUser(),n=t.content?d(t.content,"markdown"):null,{data:a,error:i}=await s.from("blog_posts").insert([{...t,content:n,author_id:o?.id}]).select().single();if(i)throw i;return await l({action:"CREATE",entityType:"blog_post",entityId:a.id,newValues:t}),a},onSuccess:()=>{e.invalidateQueries({queryKey:["admin-blog-posts"]}),r.success("Blog post created")},onError:t=>r.error("Failed: "+t.message)})}function h(){const e=u();return c({mutationFn:async({id:t,updates:o})=>{const{data:n}=await s.from("blog_posts").select("*").eq("id",t).single(),a={...o};typeof o.content=="string"&&(a.content=d(o.content,"markdown")),o.status==="published"&&!n?.published_at&&(a.published_at=new Date().toISOString());const{error:i}=await s.from("blog_posts").update(a).eq("id",t);if(i)throw i;await l({action:"UPDATE",entityType:"blog_post",entityId:t,oldValues:n,newValues:o})},onSuccess:()=>{e.invalidateQueries({queryKey:["admin-blog-posts"]}),r.success("Blog post updated")},onError:t=>r.error("Failed: "+t.message)})}function C(){const e=u();return c({mutationFn:async t=>{const{data:o}=await s.from("blog_posts").select("*").eq("id",t).single(),{error:n}=await s.from("blog_posts").delete().eq("id",t);if(n)throw n;await l({action:"DELETE",entityType:"blog_post",entityId:t,oldValues:o})},onSuccess:()=>{e.invalidateQueries({queryKey:["admin-blog-posts"]}),r.success("Blog post deleted")},onError:t=>r.error("Failed: "+t.message)})}export{_ as a,h as b,C as c,w as g,q as u};
