import{u as _,j as e,b as Ne,c as Y}from"./chunk-CPh6voF3.js";import{r as k}from"./chunk-CffrGP6S.js";import{c as ns}from"./chunk-Drd-rt-S.js";import{f as we,u as $,s as w,l as g,y as Ge,i as P,n as G,S as ls,F as Ke,H as He,B as h,w as ce,m as F,t as Q,v as Ae,U as _e,Z as K,o as Z,J as os,K as cs,N as ds,O as ms,p as Qe,I as H,Q as M,D as Ue,h as $e,j as Ye,R as xs,V as L,W as be,L as us,T as fe,Y as B,G as J,C as U,$ as Me,x as Pe,P as ke,A as Ce,a0 as ge,a1 as je,a2 as re,a3 as ne,a4 as hs,a5 as le,a6 as oe,a7 as D,a8 as De,b as I,a as E,a9 as ps,aa as fs,ab as gs,ac as js,ad as ys,ae as bs}from"./index-DflORfjh.js";import{A as Fe,a as vs,b as Ee}from"./chunk-Df_5lNy2.js";import{L as Ns,a as ws,I as Re,S as Ze,B as de}from"./chunk-C2VW2Ml6.js";import{a as _s}from"./chunk-j7XJPWWF.js";import{F as Se}from"./chunk-BaL04tya.js";import{C as Je}from"./chunk-C14yCe0w.js";import{M as qe}from"./chunk-B7d2qnKb.js";import{C as ue}from"./chunk-GLPyMM0F.js";import{P as ks}from"./chunk-DSDQubI6.js";import{T as ye}from"./chunk-C76wK-Kz.js";import{N as Cs}from"./chunk-BQwaAkM6.js";import{Q as Ss}from"./chunk-I5uVO93-.js";import{T as Ie,a as qs}from"./chunk-BLd3XU4A.js";import{P as me}from"./chunk-HAC-i_a2.js";import{E as Ts}from"./chunk-CcezodbN.js";import{S as O}from"./chunk-CzOt8Wyl.js";import{S as As}from"./chunk-B51FxpoB.js";import{E as Ms}from"./chunk-CbETxTmt.js";import{D as Ps}from"./chunk-z-mlRDN4.js";import{P as Ds}from"./chunk-DR0VO1o8.js";import{E as Fs}from"./chunk-CzCas5F3.js";import{R as Es}from"./chunk-BOvFDp2b.js";import{C as Xe}from"./chunk-CbEmr7WL.js";import Rs from"./AvailabilityManagementTab-C2I0Pfgs.js";import Is from"./AppointmentTypesTab-ocNpb1T1.js";import Ws from"./PatientsTab-BpDLXaxA.js";import zs from"./MessagesTab-Cc7rag-7.js";import Ls from"./IntakeFormsTab-B3-tzEK5.js";import Os from"./OperationsTab-D7Sf_jmG.js";import Bs from"./ProfileEditorTab-CP7kEL-t.js";import Vs from"./TeamManagementTab-BXX6UetM.js";import Gs from"./ServicesTab-6OXmIxP6.js";import Ks from"./InsuranceManagementTab-DhekUl8B.js";import Hs from"./DentistReputationHub-BWOUGhBI.js";import Qs from"./TemplatesTab-a_xO-NUp.js";import Us from"./DentistSettingsTab-D1NsW7r4.js";import $s from"./SupportTicketsTab-Bwfk6ffo.js";import{C as W,d as z,a as ee,b as se,c as te}from"./chunk-Dwq_v72W.js";import{S as C}from"./chunk-DfjE-bP6.js";import{S as es}from"./chunk-CQtADEjB.js";import{u as ss}from"./chunk-BdAozh8S.js";import{T as We}from"./chunk-9wfNkVpc.js";import{S as ts}from"./chunk-C7BdFRQZ.js";import{T as ze}from"./chunk-BRVan1jG.js";import{A as Ys,a as Zs}from"./chunk-BRjFAgpB.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-Cq66vzLV.js";import"./chunk-fofMllkR.js";import"./chunk-k8HiDHrE.js";import"./chunk-Beq7cUgv.js";import"./chunk-C8UDNHIm.js";import"./chunk-DZK1lt0q.js";import"./chunk-BcKWIjsB.js";import"./chunk-z7Kqt5JR.js";import"./chunk-8Vpa5_RZ.js";import"./chunk-aAsotRsv.js";import"./chunk-C_nua8Pg.js";import"./chunk-DncHrJ4I.js";import"./chunk-BcyAVLmp.js";import"./chunk-B2Rulxe9.js";import"./chunk-C4_bt_FT.js";import"./chunk-BZxg8uu_.js";import"./chunk-4cd3rYYj.js";import"./chunk-D2X27E5n.js";import"./chunk-j3aWteJX.js";import"./chunk-DnhFyEPV.js";import"./chunk-Dq1MrkKO.js";import"./chunk-8P_iFEn-.js";import"./chunk-CyKl6YHG.js";import"./chunk-BvZfqwfW.js";import"./chunk-B46JjdBY.js";import"./chunk-DI0yTdYZ.js";import"./chunk-B0DPEAZ9.js";import"./chunk-DV8-8yGh.js";import"./chunk-DqEkDSiw.js";import"./chunk-oOYeAGgD.js";import"./chunk-qKgaU6ML.js";import"./chunk-BSjc5zjM.js";import"./chunk-kjwVS8vq.js";import"./chunk-CG1o0-Xj.js";import"./chunk-DrzOALbo.js";import"./chunk-bmpXwoJk.js";import"./chunk-D3rEHCqk.js";import"./chunk-7oaXC-Tp.js";import"./chunk-DbdCK11k.js";import"./chunk-B0x3dbdo.js";import"./chunk-wy0nNZZG.js";import"./chunk-BFhD_ct7.js";import"./chunk-C077LRJi.js";import"./chunk-I1o_Hd8I.js";import"./chunk--UsBvJF_.js";import"./chunk-Dfi7JVLs.js";import"./chunk-B7tIy7xU.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Js=we("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=we("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=we("Workflow",[["rect",{width:"8",height:"8",x:"3",y:"3",rx:"2",key:"by2w9f"}],["path",{d:"M7 11v4a2 2 0 0 0 2 2h4",key:"xkn7yn"}],["rect",{width:"8",height:"8",x:"13",y:"13",rx:"2",key:"1cgmvn"}]]),et=[{title:"Dashboard",items:[{id:"my-dashboard",label:"Overview",icon:ws}]},{title:"My Practice",items:[{id:"my-practice",label:"Practice Info",icon:ce}]},{title:"Operations",items:[{id:"my-appointments",label:"Appointments",icon:F,showBadge:!0},{id:"my-availability",label:"Availability",icon:Q},{id:"my-appointment-types",label:"Appointment Types",icon:Ae},{id:"my-patients",label:"Patients",icon:_e},{id:"my-messages",label:"Messages",icon:Re},{id:"my-intake-forms",label:"Intake Forms",icon:_s},{id:"my-form-workflows",label:"Form Automation",icon:K,badge:"AI"},{id:"my-operations",label:"Automation",icon:K}]},{title:"Profile",items:[{id:"my-profile",label:"Edit Profile",icon:ce},{id:"my-team",label:"Team",icon:Xs},{id:"my-services",label:"Treatments",icon:Ae},{id:"my-insurance",label:"Insurance",icon:Z}]},{title:"Reputation",items:[{id:"my-reputation",label:"Reputation Suite",icon:G,badge:"PRO"}]},{title:"Communication",items:[{id:"my-templates",label:"Templates",icon:Se},{id:"my-notifications",label:"Notifications",icon:Re}]},{title:"Settings",items:[{id:"my-settings",label:"Settings",icon:Ze},{id:"my-support",label:"Support",icon:Je}]}];function st({activeTab:n,onTabChange:o,collapsed:s,onCollapsedChange:p}){const{user:a,signOut:i}=$(),{data:t}=_({queryKey:["sidebar-clinic",a?.id],queryFn:async()=>{const{data:m,error:l}=await w.from("clinics").select("id, name, slug, cover_image_url, verification_status, rating, review_count").eq("claimed_by",a?.id).limit(1).single();if(l&&l.code!=="PGRST116")throw l;return m},enabled:!!a?.id}),{data:j=0}=_({queryKey:["sidebar-pending-count",t?.id],queryFn:async()=>{const{count:m}=await w.from("appointments").select("id",{count:"exact",head:!0}).eq("clinic_id",t?.id).eq("status","pending");return m||0},enabled:!!t?.id}),x=({item:m})=>{const l=n===m.id,v=m.icon,c=m.showBadge&&j>0,N=e.jsxs("button",{onClick:()=>o(m.id),className:g("w-full flex items-center gap-2.5 px-3 py-2 rounded-lg transition-all duration-200","text-[13px] font-medium relative group",l?"bg-gradient-to-r from-primary to-primary/90 text-white shadow-md shadow-primary/25":"text-slate-600 hover:text-slate-900 hover:bg-slate-100",s&&"justify-center px-2"),children:[e.jsx(v,{className:g("h-4 w-4 flex-shrink-0 transition-colors",l?"text-white":"text-slate-500 group-hover:text-primary")}),!s&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"flex-1 text-left truncate",children:m.label}),c&&e.jsx(P,{className:"h-5 min-w-5 px-1 text-[10px] font-bold bg-coral text-white border-0",children:j>9?"9+":j}),m.badge==="AI"&&e.jsx(P,{className:"h-4 px-1 text-[9px] font-bold bg-gradient-to-r from-purple-500 to-indigo-500 text-white border-0",children:"AI"}),m.badge==="PRO"&&e.jsx(P,{className:"h-4 px-1 text-[9px] font-bold bg-gradient-to-r from-amber-500 to-orange-500 text-white border-0",children:"PRO"})]})]});return s?e.jsx(os,{delayDuration:0,children:e.jsxs(cs,{children:[e.jsx(ds,{asChild:!0,children:N}),e.jsxs(ms,{side:"right",className:"flex items-center gap-2 bg-slate-900 text-white border-slate-700",children:[m.label,c&&e.jsx(P,{className:"h-4 min-w-4 px-1 text-[9px] bg-coral text-white border-0",children:j})]})]})}):N};return e.jsxs("aside",{className:g("fixed inset-y-0 left-0 z-50 flex flex-col","bg-white border-r border-slate-200 shadow-sm","transition-all duration-300 ease-out",s?"w-[60px]":"w-56"),children:[e.jsxs("div",{className:g("h-14 flex items-center gap-2 px-3 border-b border-slate-100",s&&"justify-center"),children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-gradient-to-br from-primary to-teal flex items-center justify-center shadow-sm flex-shrink-0",children:e.jsx(Ge,{className:"h-4 w-4 text-white"})}),!s&&e.jsx("span",{className:"font-bold text-sm text-slate-800",children:"AppointPanda"})]}),!s&&t&&e.jsx("div",{className:"p-3 border-b border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-gradient-to-r from-slate-50 to-slate-100",children:[e.jsxs(Fe,{className:"h-8 w-8 rounded-lg border border-slate-200",children:[e.jsx(vs,{src:t.cover_image_url||void 0}),e.jsx(Ee,{className:"rounded-lg bg-primary/10 text-primary font-bold text-xs",children:t.name.charAt(0)})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-semibold text-slate-800 truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[t.verification_status==="verified"&&e.jsx(P,{variant:"outline",className:"h-3 px-1 text-[8px] bg-emerald-50 text-emerald-600 border-emerald-200",children:"âœ“"}),(t.rating||0)>0&&e.jsxs("span",{className:"flex items-center gap-0.5 text-[9px] text-slate-500",children:[e.jsx(G,{className:"h-2.5 w-2.5 fill-amber-400 text-amber-400"}),Number(t.rating).toFixed(1)]})]})]})]})}),e.jsx(ls,{className:"flex-1 px-2",children:e.jsx("nav",{className:"space-y-4 py-3",children:et.map(m=>e.jsxs("div",{children:[!s&&e.jsx("p",{className:"px-3 mb-1 text-[9px] font-bold uppercase tracking-widest text-slate-400",children:m.title}),e.jsx("div",{className:"space-y-0.5",children:m.items.map(l=>e.jsx(x,{item:l},l.id))})]},m.title))})}),e.jsxs("div",{className:"border-t border-slate-100",children:[e.jsx("button",{onClick:()=>p(!s),className:g("w-full flex items-center gap-2 px-3 py-2 text-slate-500 hover:text-slate-700 hover:bg-slate-50 transition-colors text-xs",s&&"justify-center"),children:s?e.jsx(Ke,{className:"h-4 w-4"}):e.jsxs(e.Fragment,{children:[e.jsx(He,{className:"h-4 w-4"}),e.jsx("span",{children:"Collapse"})]})}),e.jsxs("div",{className:g("p-2 border-t border-slate-100",s&&"flex flex-col items-center"),children:[e.jsxs("div",{className:g("flex items-center gap-2",s&&"flex-col"),children:[e.jsx(Fe,{className:g("h-7 w-7 border border-slate-200"),children:e.jsx(Ee,{className:"bg-slate-100 text-slate-600 font-medium text-xs",children:a?.email?.charAt(0).toUpperCase()})}),!s&&e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("p",{className:"text-xs font-medium text-slate-700 truncate",children:a?.email?.split("@")[0]})})]}),e.jsxs(h,{variant:"ghost",size:"sm",onClick:i,className:g("mt-1 text-coral hover:text-coral hover:bg-coral/10 h-7 text-xs",s?"w-7 p-0":"w-full justify-start gap-1.5"),children:[e.jsx(Ns,{className:"h-3.5 w-3.5"}),!s&&e.jsx("span",{children:"Sign Out"})]})]})]})]})}function tt({pageTitle:n,pageDescription:o,breadcrumbs:s}){const{user:p}=$(),[a,i]=k.useState(""),{data:t}=_({queryKey:["topbar-clinic",p?.id],queryFn:async()=>{const{data:l}=await w.from("clinics").select("id, name").eq("claimed_by",p?.id).limit(1).single();return l},enabled:!!p?.id}),{data:j=[]}=_({queryKey:["topbar-notifications",t?.id],queryFn:async()=>{const{data:l}=await w.from("booking_notifications").select("*").eq("is_read",!1).order("created_at",{ascending:!1}).limit(10);return l||[]},enabled:!!t?.id}),x=async l=>{await w.from("booking_notifications").update({is_read:!0}).eq("id",l)},m={appointment:{icon:F,color:"text-primary bg-primary/10"},review:{icon:G,color:"text-amber-500 bg-amber-50"},message:{icon:qe,color:"text-blue-500 bg-blue-50"},alert:{icon:ue,color:"text-red-500 bg-red-50"}};return e.jsx("header",{className:"sticky top-0 z-40 bg-background/95 backdrop-blur-sm border-b border-border",children:e.jsxs("div",{className:"flex items-center justify-between h-16 px-6",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[s&&s.length>0&&e.jsx("nav",{className:"flex items-center gap-1.5 text-sm text-muted-foreground mb-0.5",children:s.map((l,v)=>e.jsxs("span",{className:"flex items-center gap-1.5",children:[v>0&&e.jsx("span",{className:"text-border",children:"/"}),l.onClick?e.jsx("button",{onClick:l.onClick,className:"hover:text-primary transition-colors",children:l.label}):e.jsx("span",{className:"text-foreground font-medium",children:l.label})]},v))}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-6 w-1 rounded-full bg-gradient-to-b from-primary to-teal"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-foreground",children:n}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o})]})]})]}),e.jsx("div",{className:"hidden lg:flex items-center max-w-md flex-1 mx-8",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Search patients, appointments...",value:a,onChange:l=>i(l.target.value),className:"pl-10 bg-muted/50 border-0 focus-visible:ring-1 focus-visible:ring-primary rounded-xl"})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-2 px-3 py-1.5 rounded-xl bg-muted/50 text-sm",children:[e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-foreground",children:M(new Date,"EEE, MMM d")})]}),e.jsxs(Ue,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(h,{variant:"ghost",size:"icon",className:"relative h-10 w-10 rounded-xl hover:bg-muted",children:[e.jsx(de,{className:"h-5 w-5"}),j.length>0&&e.jsx("span",{className:"absolute top-1 right-1 h-2.5 w-2.5 rounded-full bg-destructive ring-2 ring-background"})]})}),e.jsxs(Ye,{align:"end",className:"w-80 rounded-xl p-0",children:[e.jsxs(xs,{className:"flex items-center justify-between px-4 py-3 border-b",children:[e.jsx("span",{className:"font-semibold",children:"Notifications"}),j.length>0&&e.jsxs(P,{variant:"secondary",className:"h-5 px-1.5 text-xs",children:[j.length," new"]})]}),j.length===0?e.jsxs("div",{className:"py-8 text-center",children:[e.jsx(de,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No new notifications"})]}):e.jsx("div",{className:"max-h-[300px] overflow-y-auto",children:j.map(l=>{const v=l.notification_type||"alert",c=m[v]||m.alert,N=c.icon;return e.jsxs(L,{className:"flex items-start gap-3 p-4 cursor-pointer focus:bg-muted",onClick:()=>x(l.id),children:[e.jsx("div",{className:g("h-9 w-9 rounded-xl flex items-center justify-center flex-shrink-0",c.color),children:e.jsx(N,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:l.title}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:l.message}),e.jsx("p",{className:"text-[10px] text-muted-foreground mt-1",children:M(new Date(l.created_at),"MMM d, h:mm a")})]})]},l.id)})}),e.jsx(be,{}),e.jsx("div",{className:"p-2",children:e.jsx(h,{variant:"ghost",size:"sm",className:"w-full justify-center text-primary",children:"View all notifications"})})]})]}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-10 w-10 rounded-xl hover:bg-muted",children:e.jsx(Je,{className:"h-5 w-5"})})]})]})})}const at={"my-dashboard":{title:"Dashboard",description:"Your practice at a glance"},"my-practice":{title:"My Practice",description:"Clinic details and performance"},"my-appointments":{title:"Appointments",description:"Manage your schedule"},"my-availability":{title:"Availability",description:"Set your working hours"},"my-appointment-types":{title:"Appointment Types",description:"Configure service types"},"my-patients":{title:"Patients",description:"Patient records and history"},"my-messages":{title:"Messages",description:"Patient communications"},"my-intake-forms":{title:"Intake Forms",description:"Patient intake management"},"my-operations":{title:"Automation",description:"Automated workflows"},"my-profile":{title:"Edit Profile",description:"Update your practice profile"},"my-team":{title:"Team",description:"Manage team members"},"my-services":{title:"Treatments",description:"Services you offer"},"my-insurance":{title:"Insurance",description:"Accepted insurance providers"},"my-reputation":{title:"Reputation Suite",description:"Reviews and reputation management"},"my-templates":{title:"Templates",description:"Message templates"},"my-settings":{title:"Settings",description:"Account preferences"},"my-support":{title:"Support",description:"Get help and support"}};function it({children:n,activeTab:o,onTabChange:s}){const[p,a]=k.useState(!1),i=at[o]||{title:"Dashboard"},t=()=>{const x=[{label:"Dashboard",onClick:()=>s("my-dashboard")}];if(o.startsWith("my-")&&o!=="my-dashboard"){const m=j(o);m&&x.push({label:m})}return x},j=x=>{const m=["my-appointments","my-availability","my-appointment-types","my-patients","my-messages","my-intake-forms","my-operations"],l=["my-profile","my-team","my-services","my-insurance"],v=["my-settings","my-support"];return m.includes(x)?"Operations":l.includes(x)?"Profile":x==="my-reputation"?"Reputation":x==="my-templates"?"Communication":v.includes(x)?"Settings":null};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(st,{activeTab:o,onTabChange:s,collapsed:p,onCollapsedChange:a}),e.jsxs("div",{className:g("min-h-screen transition-all duration-300 ease-out",p?"ml-[72px]":"ml-64"),children:[e.jsx(tt,{pageTitle:i.title,pageDescription:i.description,breadcrumbs:t()}),e.jsx("main",{className:"p-6",children:n})]})]})}const rt={radius:{sm:"rounded-xl",md:"rounded-2xl",lg:"rounded-3xl",xl:"rounded-[2rem]",full:"rounded-full"},shadow:{sm:"shadow-sm",md:"shadow-md shadow-black/5",lg:"shadow-lg shadow-black/8",xl:"shadow-xl shadow-black/10",glow:"shadow-lg shadow-primary/20"},transition:"transition-all duration-200 ease-out"},S=k.forwardRef(({children:n,className:o,variant:s="default",hover:p=!1,padding:a="md",onClick:i},t)=>{const j="relative overflow-hidden",x={default:"bg-card border border-border/50 shadow-sm",glass:"bg-white/80 backdrop-blur-xl border border-white/20 shadow-lg",gradient:"bg-gradient-to-br from-card to-muted/30 border border-border/30",elevated:"bg-card shadow-xl shadow-black/5 border-0",outlined:"bg-transparent border-2 border-border"},m={none:"",sm:"p-4",md:"p-6",lg:"p-8"},l=p?"cursor-pointer hover:shadow-xl hover:shadow-primary/5 hover:-translate-y-1 hover:border-primary/20":"";return e.jsx("div",{ref:t,onClick:i,className:g(j,"rounded-2xl",x[s],m[a],l,rt.transition,o),children:n})});S.displayName="PremiumCard";const as=k.forwardRef(({children:n,className:o,variant:s="primary",size:p="md",loading:a=!1,icon:i,iconPosition:t="left",disabled:j,...x},m)=>{const l="inline-flex items-center justify-center font-semibold rounded-xl transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",v={primary:"bg-primary text-primary-foreground hover:bg-primary/90 shadow-lg shadow-primary/25 focus:ring-primary",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 focus:ring-secondary",outline:"border-2 border-border bg-transparent hover:bg-muted text-foreground focus:ring-primary",ghost:"bg-transparent hover:bg-muted text-foreground focus:ring-primary",danger:"bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-lg shadow-destructive/25 focus:ring-destructive",success:"bg-emerald-600 text-white hover:bg-emerald-700 shadow-lg shadow-emerald-600/25 focus:ring-emerald-600"},c={sm:"h-9 px-4 text-sm gap-2",md:"h-11 px-6 text-sm gap-2",lg:"h-14 px-8 text-base gap-3",icon:"h-10 w-10"};return e.jsx("button",{ref:m,disabled:j||a,className:g(l,v[s],c[p],o),...x,children:a?e.jsx(us,{className:"h-4 w-4 animate-spin"}):e.jsxs(e.Fragment,{children:[i&&t==="left"&&e.jsx(i,{className:"h-4 w-4"}),n,i&&t==="right"&&e.jsx(i,{className:"h-4 w-4"})]})})});as.displayName="PremiumButton";const V=({title:n,description:o,icon:s,iconColor:p="text-primary",action:a,badge:i})=>e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s&&e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(s,{className:g("h-4 w-4",p)})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-base font-bold text-foreground",children:n}),i&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-semibold bg-primary/10 text-primary rounded-full",children:i})]}),o&&e.jsx("p",{className:"text-xs text-muted-foreground",children:o})]})]}),a]}),is=({title:n,subtitle:o,breadcrumbs:s,primaryAction:p,secondaryActions:a})=>e.jsxs("div",{className:"mb-8",children:[s&&s.length>0&&e.jsx("nav",{className:"flex items-center gap-2 text-sm text-muted-foreground mb-3",children:s.map((i,t)=>e.jsxs("span",{className:"flex items-center gap-2",children:[t>0&&e.jsx("span",{children:"/"}),i.href?e.jsx("a",{href:i.href,className:"hover:text-primary transition-colors",children:i.label}):e.jsx("span",{className:"text-foreground font-medium",children:i.label})]},t))}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-foreground tracking-tight",children:n}),o&&e.jsx("p",{className:"text-muted-foreground mt-1",children:o})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[a,p]})]})]}),xe=({icon:n,title:o,description:s,action:p})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center",children:[n&&e.jsx("div",{className:"h-16 w-16 rounded-3xl bg-muted/50 flex items-center justify-center mb-4",children:e.jsx(n,{className:"h-8 w-8 text-muted-foreground"})}),e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-1",children:o}),s&&e.jsx("p",{className:"text-sm text-muted-foreground max-w-sm mb-4",children:s}),p]}),R=({status:n,label:o,dot:s=!0})=>{const p={success:"bg-emerald-50 text-emerald-700 border-emerald-200",warning:"bg-amber-50 text-amber-700 border-amber-200",error:"bg-red-50 text-red-700 border-red-200",info:"bg-blue-50 text-blue-700 border-blue-200",neutral:"bg-slate-50 text-slate-700 border-slate-200"},a={success:"bg-emerald-500",warning:"bg-amber-500",error:"bg-red-500",info:"bg-blue-500",neutral:"bg-slate-400"};return e.jsxs("span",{className:g("inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium border",p[n]),children:[s&&e.jsx("span",{className:g("h-1.5 w-1.5 rounded-full",a[n])}),o]})},ae=({icon:n,label:o,description:s,onClick:p,color:a="from-primary to-teal",disabled:i=!1})=>e.jsxs("button",{onClick:p,disabled:i,className:g("flex flex-col items-center gap-2 p-4 rounded-xl border border-border/50 bg-card","hover:shadow-md hover:-translate-y-0.5 hover:border-primary/20","transition-all duration-200 w-full text-center group",i&&"opacity-50 cursor-not-allowed hover:shadow-none hover:translate-y-0"),children:[e.jsx("div",{className:g("h-10 w-10 rounded-xl bg-gradient-to-br flex items-center justify-center",a),children:e.jsx(n,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground group-hover:text-primary transition-colors",children:o}),s&&e.jsx("p",{className:"text-[10px] text-muted-foreground",children:s})]})]}),ve=({className:n})=>e.jsxs("div",{className:g("bg-card rounded-2xl border border-border/50 p-6 animate-pulse",n),children:[e.jsx("div",{className:"h-12 w-12 bg-muted rounded-2xl mb-4"}),e.jsx("div",{className:"h-8 w-24 bg-muted rounded-lg mb-2"}),e.jsx("div",{className:"h-4 w-32 bg-muted rounded-md"})]}),nt=({count:n=3})=>e.jsx("div",{className:"space-y-3",children:Array.from({length:n}).map((o,s)=>e.jsxs("div",{className:"flex items-center gap-4 p-4 bg-card rounded-xl border border-border/50 animate-pulse",children:[e.jsx("div",{className:"h-10 w-10 bg-muted rounded-xl"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 w-32 bg-muted rounded-md mb-2"}),e.jsx("div",{className:"h-3 w-24 bg-muted rounded-md"})]})]},s))});function ie({label:n,value:o,icon:s,iconColor:p="text-primary",iconBg:a="bg-primary/10",variant:i="default",trend:t,trendValue:j,maxValue:x=100,suffix:m,onClick:l,action:v,className:c,delay:N=0}){const[b,q]=k.useState(!1),[u,r]=k.useState(0),f=typeof o=="number"?o:parseFloat(o)||0;k.useEffect(()=>{const T=setTimeout(()=>{q(!0);const he=1e3,X=30,rs=f/X;let pe=0;const Te=setInterval(()=>{pe+=rs,pe>=f?(r(f),clearInterval(Te)):r(Math.floor(pe))},he/X);return()=>clearInterval(Te)},N);return()=>clearTimeout(T)},[f,N]);const y=Math.min(f/x*100,100),d=2*Math.PI*42,A=d-y/100*d;return i==="circular"?e.jsxs("div",{className:g("relative group p-5 rounded-2xl border bg-card shadow-sm hover:shadow-md transition-all duration-300","hover:-translate-y-0.5 cursor-pointer overflow-hidden",c),onClick:l,children:[e.jsx("div",{className:"absolute -top-10 -right-10 w-32 h-32 bg-primary/5 rounded-full blur-2xl opacity-0 group-hover:opacity-100 transition-opacity"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative h-20 w-20 flex-shrink-0",children:[e.jsxs("svg",{className:"h-20 w-20 -rotate-90 transform",children:[e.jsx("circle",{cx:"40",cy:"40",r:"35",stroke:"currentColor",strokeWidth:"6",fill:"none",className:"text-muted/30"}),e.jsx("circle",{cx:"40",cy:"40",r:"35",stroke:"url(#gradient)",strokeWidth:"6",fill:"none",strokeLinecap:"round",strokeDasharray:d,strokeDashoffset:b?A:d,className:"transition-all duration-1000 ease-out"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))"}),e.jsx("stop",{offset:"100%",stopColor:"#14b8a6"})]})})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:e.jsxs("span",{className:"text-xl font-bold text-foreground",children:[typeof o=="string"?o:u,m]})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:n}),t&&j&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[t==="up"?e.jsx(fe,{className:"h-3 w-3 text-emerald-500"}):t==="down"?e.jsx(ye,{className:"h-3 w-3 text-red-500"}):null,e.jsx("span",{className:g("text-xs font-medium",t==="up"?"text-emerald-500":t==="down"?"text-red-500":"text-muted-foreground"),children:j})]}),v&&e.jsxs(h,{variant:"ghost",size:"sm",className:"h-7 px-2 mt-2 text-xs text-primary hover:text-primary hover:bg-primary/10",onClick:T=>{T.stopPropagation(),v.onClick()},children:[v.label,e.jsx(B,{className:"h-3 w-3 ml-1"})]})]})]})]}):i==="dark"||i==="gradient"?e.jsxs("div",{className:g("relative group p-5 rounded-2xl overflow-hidden transition-all duration-300","hover:-translate-y-0.5 cursor-pointer",i==="dark"?"bg-gradient-to-br from-slate-800 to-slate-900 text-white shadow-lg":"bg-gradient-to-br from-primary/90 to-teal text-white shadow-lg shadow-primary/20",c),onClick:l,children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 right-0 w-20 h-20 bg-white/5 rounded-full blur-2xl animate-pulse"}),e.jsx("div",{className:"absolute -bottom-5 -left-5 w-16 h-16 bg-white/5 rounded-full blur-xl"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("div",{className:g("h-10 w-10 rounded-xl flex items-center justify-center",i==="dark"?"bg-white/10":"bg-white/20"),children:e.jsx(s,{className:"h-5 w-5 text-white"})}),t&&e.jsxs("div",{className:g("flex items-center gap-1 px-2 py-1 rounded-full text-xs","bg-white/20 backdrop-blur-sm"),children:[t==="up"?e.jsx(fe,{className:"h-3 w-3"}):t==="down"?e.jsx(ye,{className:"h-3 w-3"}):null,j&&e.jsx("span",{children:j})]})]}),e.jsxs("p",{className:g("text-3xl font-bold tracking-tight transition-all duration-1000",b?"translate-y-0 opacity-100":"translate-y-2 opacity-0"),children:[typeof o=="string"?o:u,m]}),e.jsx("p",{className:"text-sm text-white/70 mt-1",children:n}),v&&e.jsxs(h,{variant:"ghost",size:"sm",className:"h-7 px-0 mt-3 text-xs text-white/80 hover:text-white hover:bg-transparent",onClick:T=>{T.stopPropagation(),v.onClick()},children:[v.label,e.jsx(B,{className:"h-3 w-3 ml-1"})]})]})]}):e.jsx("div",{className:g("relative group p-4 rounded-xl border bg-card shadow-sm hover:shadow-md transition-all duration-300","hover:-translate-y-0.5 cursor-pointer",c),onClick:l,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("h-10 w-10 rounded-xl flex items-center justify-center flex-shrink-0",a),children:e.jsx(s,{className:g("h-5 w-5",p)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:n}),e.jsxs("p",{className:g("text-xl font-bold text-foreground transition-all duration-700",b?"translate-y-0 opacity-100":"translate-y-1 opacity-0"),children:[typeof o=="string"?o:u,m]})]}),t&&e.jsxs("div",{className:g("flex items-center gap-0.5 text-xs font-medium",t==="up"?"text-emerald-500":t==="down"?"text-red-500":"text-muted-foreground"),children:[t==="up"?e.jsx(fe,{className:"h-3 w-3"}):t==="down"?e.jsx(ye,{className:"h-3 w-3"}):null,j]})]})})}function Oe({onNavigate:n}){const{user:o,isAdmin:s,isSuperAdmin:p}=$(),{data:a,isLoading:i}=_({queryKey:["dashboard-v2-clinic",o?.id],queryFn:async()=>{const{data:u,error:r}=await w.from("clinics").select("*, clinic_hours(*), clinic_images(*)").eq("claimed_by",o?.id).limit(1).single();if(r&&r.code!=="PGRST116")throw r;return u},enabled:!!o?.id&&!s&&!p}),{data:t=[]}=_({queryKey:["dashboard-v2-today-appointments",a?.id],queryFn:async()=>{const u=new Date().toISOString().split("T")[0],{data:r}=await w.from("appointments").select("*, treatment:treatments(name)").eq("clinic_id",a?.id).gte("preferred_date",u).lte("preferred_date",u).order("preferred_time");return r||[]},enabled:!!a?.id}),{data:j=[]}=_({queryKey:["dashboard-v2-funnel-events",a?.id],queryFn:async()=>{const{data:u}=await w.from("review_funnel_events").select("*").eq("clinic_id",a?.id).order("created_at",{ascending:!1}).limit(100);return u||[]},enabled:!!a?.id}),{data:x}=_({queryKey:["dashboard-v2-patient-stats",a?.id],queryFn:async()=>{const{count:u}=await w.from("patients").select("id",{count:"exact",head:!0}).eq("clinic_id",a?.id).or("is_deleted_by_dentist.is.null,is_deleted_by_dentist.eq.false"),r=new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString(),{count:f}=await w.from("patients").select("id",{count:"exact",head:!0}).eq("clinic_id",a?.id).gte("created_at",r);return{total:u||0,newThisMonth:f||0}},enabled:!!a?.id});if(i)return e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[...Array(4)].map((u,r)=>e.jsx(ve,{},r))})});if(!a&&!s&&!p)return e.jsx(Cs,{});const m=t.filter(u=>u.status==="pending").length;t.filter(u=>u.status==="confirmed").length,t.filter(u=>u.status==="completed").length;const l=j.filter(u=>u.event_type==="thumbs_up").length,v=j.filter(u=>u.event_type==="thumbs_down").length,c=j.length>0?Math.round(l/j.length*100):0,N=[a.name,a.description,a.address,a.phone,a.email,a.website,a.cover_image_url,a.google_place_id,(a.clinic_hours?.length||0)>0,(a.clinic_images?.length||0)>0],b=Math.round(N.filter(Boolean).length/10*100),q=[m>0&&{icon:Q,type:"urgent",title:`${m} pending appointments`,action:"Review and confirm appointments",onClick:()=>n("my-appointments")},v>l&&{icon:ue,type:"warning",title:"High negative feedback",action:"Review private feedback and address concerns",onClick:()=>n("my-reputation")},!a.google_place_id&&{icon:J,type:"action",title:"Connect Google Business",action:"Link GMB to boost visibility and reviews",onClick:()=>n("my-reputation")},b<80&&{icon:Z,type:"action",title:`Profile ${b}% complete`,action:"Complete your profile for better visibility",onClick:()=>n("my-profile")},a.verification_status!=="verified"&&{icon:U,type:"action",title:"Get verified",action:"Verified clinics get 3x more bookings",onClick:()=>n("my-profile")}].filter(Boolean).slice(0,3);return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-bold text-foreground tracking-tight",children:"Welcome back! ðŸ‘‹"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Here's what's happening at ",e.jsx("span",{className:"font-medium text-foreground",children:a.name})," today"]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(h,{variant:"outline",className:"gap-2 rounded-xl",onClick:()=>n("my-reputation"),children:[e.jsx(Ss,{className:"h-4 w-4"}),"QR Code"]}),e.jsxs(h,{className:"gap-2 rounded-xl shadow-lg shadow-primary/20",onClick:()=>n("my-patients"),children:[e.jsx(Me,{className:"h-4 w-4"}),"Send Review Request"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(ie,{label:"Today's Appointments",value:t.length,icon:F,variant:"circular",maxValue:Math.max(10,t.length),onClick:()=>n("my-appointments"),action:{label:"View schedule",onClick:()=>n("my-appointments")},delay:0}),e.jsx(ie,{label:"Total Patients",value:x?.total||0,icon:_e,variant:"dark",trend:x?.newThisMonth?"up":"neutral",trendValue:x?.newThisMonth?`+${x.newThisMonth}`:void 0,onClick:()=>n("my-patients"),delay:100}),e.jsx(ie,{label:"Average Rating",value:a.rating?Number(a.rating).toFixed(1):0,icon:G,variant:"circular",maxValue:5,onClick:()=>n("my-reputation"),action:{label:"View reviews",onClick:()=>n("my-reputation")},delay:200}),e.jsx(ie,{label:"Positive Rate",value:c,icon:Ie,variant:"gradient",suffix:"%",trend:c>=70?"up":c>=50?"neutral":"down",trendValue:c>=70?"Great!":c>=50?"Good":"Improve",onClick:()=>n("my-reputation"),delay:300})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(S,{padding:"none",className:"overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-primary via-teal to-emerald-500"}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(V,{title:"Today's Schedule",description:M(new Date,"EEEE, MMMM d, yyyy"),icon:F}),e.jsxs(h,{variant:"ghost",size:"sm",className:"text-primary hover:text-primary hover:bg-primary/10 rounded-xl",onClick:()=>n("my-appointments"),children:["View All",e.jsx(B,{className:"h-4 w-4 ml-1"})]})]}),t.length===0?e.jsx(xe,{icon:F,title:"No appointments today",description:"Your schedule is clear. Set up your availability to start receiving bookings.",action:e.jsx(h,{variant:"outline",size:"sm",className:"rounded-xl",onClick:()=>n("my-availability"),children:"Set Availability"})}):e.jsx("div",{className:"space-y-3",children:t.slice(0,5).map(u=>e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl bg-muted/30 hover:bg-muted/50 transition-colors cursor-pointer group",onClick:()=>n("my-appointments"),children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(Q,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-foreground truncate",children:u.patient_name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[u.preferred_time||"Time TBD"," â€¢ ",u.treatment?.name||"General"]})]}),e.jsx(R,{status:u.status==="confirmed"?"success":u.status==="pending"?"warning":u.status==="completed"?"info":"neutral",label:u.status||"pending"}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity"})]},u.id))})]})]}),e.jsxs(S,{children:[e.jsx(V,{title:"Quick Actions",description:"Common tasks at your fingertips",icon:K,iconColor:"text-amber-500"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(ae,{icon:Me,label:"Send Request",description:"Review request",onClick:()=>n("my-reputation"),color:"from-primary to-teal"}),e.jsx(ae,{icon:me,label:"Add Patient",description:"New patient",onClick:()=>n("my-patients"),color:"from-teal to-emerald-500"}),e.jsx(ae,{icon:F,label:"Appointments",description:"View schedule",onClick:()=>n("my-appointments"),color:"from-purple-500 to-indigo-500"}),e.jsx(ae,{icon:Ts,label:"View Profile",description:"Public profile",onClick:()=>n("my-profile"),color:"from-amber-500 to-orange-500"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsx(V,{title:"Profile Health",icon:Z,iconColor:"text-emerald-500"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-3xl font-bold text-foreground",children:[b,"%"]}),e.jsx(R,{status:b>=80?"success":b>=50?"warning":"error",label:b>=80?"Good":b>=50?"Fair":"Needs work"})]}),e.jsx(ks,{value:b,className:"h-2"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.verification_status==="verified"?e.jsx(R,{status:"success",label:"Verified"}):e.jsx(R,{status:"neutral",label:"Unverified"}),a.google_place_id?e.jsx(R,{status:"success",label:"GMB Connected"}):e.jsx(R,{status:"neutral",label:"No GMB"})]}),e.jsxs(h,{variant:"outline",size:"sm",className:"w-full rounded-xl",onClick:()=>n("my-profile"),children:["Edit Profile",e.jsx(B,{className:"h-4 w-4 ml-2"})]})]})]}),e.jsxs(S,{variant:"gradient",children:[e.jsx(V,{title:"AI Suggestions",icon:Ge,iconColor:"text-primary"}),e.jsx("div",{className:"space-y-3",children:q.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(U,{className:"h-10 w-10 text-emerald-500 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"All looking good! No suggestions at this time."})]}):q.map((u,r)=>e.jsx("button",{onClick:u.onClick,className:g("w-full p-4 rounded-xl border text-left transition-all hover:-translate-y-0.5 hover:shadow-md",u.type==="warning"?"bg-red-50 border-red-200 hover:border-red-300":u.type==="urgent"?"bg-amber-50 border-amber-200 hover:border-amber-300":"bg-primary/5 border-primary/20 hover:border-primary/30"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:g("h-10 w-10 rounded-xl flex items-center justify-center flex-shrink-0",u.type==="warning"?"bg-red-100":u.type==="urgent"?"bg-amber-100":"bg-primary/10"),children:e.jsx(u.icon,{className:g("h-5 w-5",u.type==="warning"?"text-red-600":u.type==="urgent"?"text-amber-600":"text-primary")})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-foreground",children:u.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:u.action})]}),e.jsx(B,{className:"h-4 w-4 text-muted-foreground mt-1"})]})},r))})]}),e.jsxs(S,{children:[e.jsx(V,{title:"Reputation",icon:G,iconColor:"text-amber-500"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-14 w-14 rounded-2xl bg-amber-50 flex items-center justify-center",children:e.jsx(G,{className:"h-7 w-7 text-amber-500 fill-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a.rating?Number(a.rating).toFixed(1):"â€”"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[a.review_count||0," reviews"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 border-t border-border",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"h-4 w-4 text-emerald-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:l}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"positive"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qs,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:v}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"negative"})]})]}),e.jsxs(h,{variant:"outline",size:"sm",className:"w-full rounded-xl",onClick:()=>n("my-reputation"),children:["Open Reputation Suite",e.jsx(B,{className:"h-4 w-4 ml-2"})]})]})]})]})]})]})}const lt=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function ot({onNavigate:n}){const{user:o}=$(),{data:s,isLoading:p}=_({queryKey:["my-practice-clinic",o?.id],queryFn:async()=>{const{data:x,error:m}=await w.from("clinics").select(`
          *,
          clinic_hours(*),
          clinic_images(*),
          clinic_insurances(*, insurance:insurances(*)),
          city:cities(name, state:states(name, abbreviation))
        `).eq("claimed_by",o?.id).limit(1).single();if(m&&m.code!=="PGRST116")throw m;return x},enabled:!!o?.id}),{data:a=0}=_({queryKey:["my-practice-team-count",s?.id],queryFn:async()=>{const{count:x}=await w.from("dentists").select("id",{count:"exact",head:!0}).eq("clinic_id",s?.id);return x||0},enabled:!!s?.id}),{data:i=0}=_({queryKey:["my-practice-services-count",s?.id],queryFn:async()=>{const{count:x}=await w.from("clinic_treatments").select("id",{count:"exact",head:!0}).eq("clinic_id",s?.id);return x||0},enabled:!!s?.id});if(p)return e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(ve,{className:"h-64"})}),e.jsx(ve,{className:"h-64"})]});if(!s)return e.jsx(xe,{icon:ce,title:"No Practice Found",description:"Your account is not linked to any practice. Claim your profile or add a new practice.",action:e.jsx(h,{onClick:()=>n("claim-profile"),children:"Claim Profile"})});const t=lt.map((x,m)=>{const l=s.clinic_hours?.find(v=>v.day_of_week===m);return!l||l.is_closed?{day:x,hours:"Closed"}:{day:x,hours:`${l.open_time} - ${l.close_time}`}}),j=[{name:"Google Business",connected:!!s.google_place_id,icon:J,action:"Connect GMB"},{name:"Online Booking",connected:!0,icon:F,action:"Configure"},{name:"Review Automation",connected:!!s.google_place_id,icon:K,action:"Setup"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsx(is,{title:"My Practice",subtitle:"Clinic details and performance snapshot",primaryAction:e.jsxs(h,{className:"rounded-xl gap-2",onClick:()=>n("my-profile"),children:[e.jsx(As,{className:"h-4 w-4"}),"Edit Profile"]})}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(S,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:s.cover_image_url?e.jsx("img",{src:s.cover_image_url,alt:s.name,className:"h-32 w-32 rounded-2xl object-cover"}):e.jsx("div",{className:"h-32 w-32 rounded-2xl bg-primary/10 flex items-center justify-center",children:e.jsx(ce,{className:"h-12 w-12 text-primary"})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-foreground",children:s.name}),s.city&&e.jsxs("p",{className:"text-muted-foreground flex items-center gap-1 mt-1",children:[e.jsx(Pe,{className:"h-4 w-4"}),s.city.name,", ",s.city.state?.abbreviation]})]}),e.jsx("div",{className:"flex gap-2",children:s.verification_status==="verified"?e.jsx(R,{status:"success",label:"Verified"}):e.jsx(R,{status:"warning",label:"Unverified"})})]}),e.jsx(O,{className:"my-4"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.address&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Pe,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:s.address})]}),s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(ke,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"truncate",children:s.email})]}),s.website&&e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("a",{href:s.website,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline flex items-center gap-1",children:["Website ",e.jsx(Ms,{className:"h-3 w-3"})]})]})]})]})]})}),e.jsxs(S,{children:[e.jsx(V,{title:"Operating Hours",icon:Q,action:e.jsx(h,{variant:"ghost",size:"sm",className:"text-primary",onClick:()=>n("my-availability"),children:"Update Hours"})}),s.clinic_hours?.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:t.map(({day:x,hours:m})=>e.jsxs("div",{className:g("p-3 rounded-xl border",m==="Closed"?"bg-muted/30 border-border/50":"bg-primary/5 border-primary/20"),children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground",children:x}),e.jsx("p",{className:g("text-sm font-semibold",m==="Closed"?"text-muted-foreground":"text-foreground"),children:m})]},x))}):e.jsx(xe,{icon:Q,title:"No hours set",description:"Add your operating hours to help patients find you",action:e.jsx(h,{size:"sm",variant:"outline",onClick:()=>n("my-availability"),children:"Add Hours"})})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs(S,{hover:!0,onClick:()=>n("my-team"),className:"text-center",children:[e.jsx(_e,{className:"h-8 w-8 text-primary mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:a}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Team Members"})]}),e.jsxs(S,{hover:!0,onClick:()=>n("my-services"),className:"text-center",children:[e.jsx(K,{className:"h-8 w-8 text-teal mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:i}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Services"})]}),e.jsxs(S,{hover:!0,onClick:()=>n("my-insurance"),className:"text-center",children:[e.jsx(Z,{className:"h-8 w-8 text-amber-500 mx-auto mb-2"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:s.clinic_insurances?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Insurances"})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(S,{variant:"gradient",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-2xl bg-amber-50 flex items-center justify-center mx-auto mb-4",children:e.jsx(G,{className:"h-8 w-8 text-amber-500 fill-amber-500"})}),e.jsx("p",{className:"text-4xl font-bold text-foreground",children:s.rating?Number(s.rating).toFixed(1):"â€”"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:[s.review_count||0," reviews"]}),e.jsx(h,{className:"w-full mt-4 rounded-xl",onClick:()=>n("my-reputation"),children:"Manage Reviews"})]})}),e.jsxs(S,{children:[e.jsx(V,{title:"Integrations",icon:K,action:e.jsx(h,{variant:"ghost",size:"sm",className:"text-primary",onClick:()=>n("my-settings"),children:"Open Setup"})}),e.jsx("div",{className:"space-y-3",children:j.map(x=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:g("h-9 w-9 rounded-lg flex items-center justify-center",x.connected?"bg-emerald-50":"bg-muted"),children:e.jsx(x.icon,{className:g("h-4 w-4",x.connected?"text-emerald-600":"text-muted-foreground")})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:x.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:x.connected?"Connected":"Not configured"})]})]}),x.connected?e.jsx(U,{className:"h-5 w-5 text-emerald-500"}):e.jsx(h,{size:"sm",variant:"ghost",className:"text-primary text-xs",children:x.action})]},x.name))})]})]})]})]})}const Be={pending:{label:"Pending",status:"warning",color:"bg-amber-500"},confirmed:{label:"Confirmed",status:"info",color:"bg-blue-500"},completed:{label:"Completed",status:"success",color:"bg-emerald-500"},cancelled:{label:"Cancelled",status:"error",color:"bg-red-500"},no_show:{label:"No Show",status:"neutral",color:"bg-slate-400"}};function ct({onNavigate:n}){const{user:o}=$(),s=Ne(),[p,a]=k.useState("day"),[i,t]=k.useState(new Date),[j,x]=k.useState("all"),[m,l]=k.useState(""),{data:v}=_({queryKey:["appointments-v2-clinic",o?.id],queryFn:async()=>{const{data:d}=await w.from("clinics").select("id, name").eq("claimed_by",o?.id).limit(1).single();return d},enabled:!!o?.id}),{data:c=[],isLoading:N}=_({queryKey:["appointments-v2",v?.id,M(i,"yyyy-MM-dd"),j],queryFn:async()=>{let d=w.from("appointments").select("*, treatment:treatments(name)").eq("clinic_id",v?.id).order("preferred_time",{ascending:!0});const A=M(i,"yyyy-MM-dd");if(p==="day")d=d.eq("preferred_date",A);else{const he=M(ge(i),"yyyy-MM-dd"),X=M(je(ge(i),6),"yyyy-MM-dd");d=d.gte("preferred_date",he).lte("preferred_date",X)}j!=="all"&&(d=d.eq("status",j));const{data:T}=await d;return T||[]},enabled:!!v?.id}),b=Y({mutationFn:async({id:d,status:A})=>{const{error:T}=await w.from("appointments").update({status:A}).eq("id",d);if(T)throw T},onSuccess:()=>{s.invalidateQueries({queryKey:["appointments-v2"]}),I.success("Appointment updated")},onError:()=>{I.error("Failed to update appointment")}}),q=c.filter(d=>d.patient_name?.toLowerCase().includes(m.toLowerCase())||d.patient_phone?.includes(m));q.reduce((d,A)=>{const T=A.preferred_date||M(new Date(A.created_at),"yyyy-MM-dd");return d[T]||(d[T]=[]),d[T].push(A),d},{});const u=()=>t(new Date),r=()=>t(d=>je(d,p==="day"?-1:-7)),f=()=>t(d=>je(d,p==="day"?1:7)),y={total:q.length,pending:q.filter(d=>d.status==="pending").length,confirmed:q.filter(d=>d.status==="confirmed").length,completed:q.filter(d=>d.status==="completed").length};return e.jsxs("div",{className:"space-y-6",children:[e.jsx(is,{title:"Appointments",subtitle:"Manage your schedule and patient bookings",primaryAction:e.jsx(as,{icon:me,children:"Create Appointment"}),secondaryActions:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",size:"icon",className:"rounded-xl",children:e.jsx(Ps,{className:"h-4 w-4"})}),e.jsx(h,{variant:"outline",size:"icon",className:"rounded-xl",children:e.jsx(Ds,{className:"h-4 w-4"})})]})}),e.jsx(S,{padding:"sm",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(h,{variant:"outline",size:"icon",className:"rounded-xl",onClick:r,children:e.jsx(He,{className:"h-4 w-4"})}),e.jsx(h,{variant:"outline",className:"rounded-xl px-4",onClick:u,children:"Today"}),e.jsx(h,{variant:"outline",size:"icon",className:"rounded-xl",onClick:f,children:e.jsx(Ke,{className:"h-4 w-4"})}),e.jsx("div",{className:"text-lg font-semibold text-foreground",children:p==="day"?M(i,"EEEE, MMMM d, yyyy"):`Week of ${M(ge(i),"MMM d")}`})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Qe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(H,{placeholder:"Search patient...",value:m,onChange:d=>l(d.target.value),className:"pl-10 w-48 rounded-xl"})]}),e.jsxs(re,{value:j,onValueChange:x,children:[e.jsxs(ne,{className:"w-36 rounded-xl",children:[e.jsx(hs,{className:"h-4 w-4 mr-2"}),e.jsx(le,{placeholder:"Status"})]}),e.jsxs(oe,{children:[e.jsx(D,{value:"all",children:"All Status"}),e.jsx(D,{value:"pending",children:"Pending"}),e.jsx(D,{value:"confirmed",children:"Confirmed"}),e.jsx(D,{value:"completed",children:"Completed"}),e.jsx(D,{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{className:"flex rounded-xl border overflow-hidden",children:[e.jsx(h,{variant:p==="day"?"secondary":"ghost",size:"sm",className:"rounded-none",onClick:()=>a("day"),children:"Day"}),e.jsx(h,{variant:p==="week"?"secondary":"ghost",size:"sm",className:"rounded-none",onClick:()=>a("week"),children:"Week"})]})]})]})}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[{label:"Total",value:y.total,color:"bg-slate-100 text-slate-700"},{label:"Pending",value:y.pending,color:"bg-amber-50 text-amber-700"},{label:"Confirmed",value:y.confirmed,color:"bg-blue-50 text-blue-700"},{label:"Completed",value:y.completed,color:"bg-emerald-50 text-emerald-700"}].map(d=>e.jsxs("div",{className:g("rounded-xl p-4 text-center",d.color),children:[e.jsx("p",{className:"text-2xl font-bold",children:d.value}),e.jsx("p",{className:"text-sm opacity-80",children:d.label})]},d.label))}),e.jsxs(S,{padding:"none",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-primary via-teal to-emerald-500"}),e.jsx("div",{className:"p-6",children:N?e.jsx(nt,{count:5}):q.length===0?e.jsx(xe,{icon:F,title:"No appointments",description:`No appointments scheduled for ${M(i,"MMMM d, yyyy")}`,action:e.jsx(h,{onClick:()=>n("my-availability"),children:"Set Availability"})}):e.jsx("div",{className:"space-y-3",children:q.map(d=>{const A=Be[d.status]||Be.pending;return e.jsxs("div",{className:"flex items-center gap-4 p-4 rounded-xl border border-border hover:border-primary/20 hover:shadow-md transition-all group",children:[e.jsxs("div",{className:"flex flex-col items-center w-16 flex-shrink-0",children:[e.jsx("div",{className:g("h-3 w-3 rounded-full mb-1",A.color)}),e.jsx("span",{className:"text-sm font-semibold text-foreground",children:d.preferred_time||"TBD"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(De,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("p",{className:"font-semibold text-foreground truncate",children:d.patient_name})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-1 text-sm text-muted-foreground",children:[d.patient_phone&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ke,{className:"h-3 w-3"}),d.patient_phone]}),d.treatment?.name&&e.jsx("span",{children:d.treatment.name})]})]}),e.jsx(R,{status:A.status,label:A.label}),e.jsxs(Ue,{children:[e.jsx($e,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"icon",className:"rounded-xl opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Fs,{className:"h-4 w-4"})})}),e.jsxs(Ye,{align:"end",className:"w-48 rounded-xl",children:[e.jsxs(L,{className:"gap-2",children:[e.jsx(De,{className:"h-4 w-4"}),"View Details"]}),e.jsxs(L,{className:"gap-2",children:[e.jsx(qe,{className:"h-4 w-4"}),"Message Patient"]}),e.jsx(be,{}),d.status==="pending"&&e.jsxs(L,{className:"gap-2 text-emerald-600",onClick:()=>b.mutate({id:d.id,status:"confirmed"}),children:[e.jsx(U,{className:"h-4 w-4"}),"Confirm"]}),d.status==="confirmed"&&e.jsxs(L,{className:"gap-2 text-blue-600",onClick:()=>b.mutate({id:d.id,status:"completed"}),children:[e.jsx(U,{className:"h-4 w-4"}),"Mark Complete"]}),e.jsxs(L,{className:"gap-2",children:[e.jsx(Es,{className:"h-4 w-4"}),"Reschedule"]}),e.jsx(be,{}),e.jsxs(L,{className:"gap-2 text-destructive",onClick:()=>b.mutate({id:d.id,status:"cancelled"}),children:[e.jsx(Xe,{className:"h-4 w-4"}),"Cancel"]})]})]})]},d.id)})})})]})]})}function dt(){const{user:n}=$(),o=Ne(),{data:s,isLoading:p}=ss(),[a,i]=k.useState({notification_new_appointment:!0,notification_form_submission:!0,notification_cancellation:!0,notification_message:!0,notification_channel_email:!0,notification_channel_whatsapp:!1,notification_channel_dashboard:!0,notification_email_secondary:null,notification_whatsapp_number:null,reminder_sms_enabled:!0,confirmation_email_enabled:!0}),{data:t,isLoading:j}=_({queryKey:["dentist-notification-settings",s?.id],queryFn:async()=>{const{data:c,error:N}=await w.from("dentist_settings").select("*").eq("clinic_id",s?.id).single();if(N&&N.code!=="PGRST116")throw N;return c},enabled:!!s?.id});k.useEffect(()=>{t&&i({notification_new_appointment:t.notification_new_appointment??!0,notification_form_submission:t.notification_form_submission??!0,notification_cancellation:t.notification_cancellation??!0,notification_message:t.notification_message??!0,notification_channel_email:t.notification_channel_email??!0,notification_channel_whatsapp:t.notification_channel_whatsapp??!1,notification_channel_dashboard:t.notification_channel_dashboard??!0,notification_email_secondary:t.notification_email_secondary??null,notification_whatsapp_number:t.notification_whatsapp_number??null,reminder_sms_enabled:t.reminder_sms_enabled??!0,confirmation_email_enabled:t.confirmation_email_enabled??!0})},[t]);const x=Y({mutationFn:async c=>{const{data:N}=await w.from("dentist_settings").select("id").eq("clinic_id",s?.id).single();if(N){const{error:b}=await w.from("dentist_settings").update(c).eq("clinic_id",s?.id);if(b)throw b}else{const{error:b}=await w.from("dentist_settings").insert({clinic_id:s?.id,...c});if(b)throw b}},onSuccess:()=>{I.success("Notification preferences saved"),o.invalidateQueries({queryKey:["dentist-notification-settings"]})},onError:c=>{I.error("Failed to save: "+c.message)}}),m=Y({mutationFn:async c=>{const N=c==="email"?a.notification_email_secondary||n?.email:a.notification_whatsapp_number;if(!N)throw new Error(`No ${c} destination configured`);const{error:b}=await w.functions.invoke("send-review-request",{body:{to:N,type:c==="email"?"email":"whatsapp",subject:"Test Notification from AppointPanda",html:"<p>This is a test notification from AppointPanda.</p><p>Your notification preferences are working correctly!</p>",message:"This is a test notification from AppointPanda. Your preferences are working correctly!"}});if(b)throw b},onSuccess:(c,N)=>{I.success(`Test ${N} sent successfully`)},onError:c=>{I.error(c.message)}}),l=(c,N)=>{i(b=>({...b,[c]:N}))},v=(c,N)=>{i(b=>({...b,[c]:N||null}))};return p||j?e.jsx(es,{className:"h-96"}):s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-display font-bold flex items-center gap-2",children:[e.jsx(de,{className:"h-6 w-6"}),"Notifications & Communication Preferences"]}),e.jsx("p",{className:"text-muted-foreground",children:"Control how and when you receive notifications about appointments and patients"})]}),e.jsxs(W,{children:[e.jsxs(ee,{children:[e.jsx(se,{className:"text-lg",children:"Notification Types"}),e.jsx(te,{children:"Choose which events trigger notifications"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(F,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"New Appointment Request"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"When a patient books or requests an appointment"})]})]}),e.jsx(C,{checked:a.notification_new_appointment,onCheckedChange:c=>l("notification_new_appointment",c)})]}),e.jsx(O,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-teal-light flex items-center justify-center",children:e.jsx(Se,{className:"h-5 w-5 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Form Submission Received"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"When a patient completes an intake form"})]})]}),e.jsx(C,{checked:a.notification_form_submission,onCheckedChange:c=>l("notification_form_submission",c)})]}),e.jsx(O,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-coral-light flex items-center justify-center",children:e.jsx(Xe,{className:"h-5 w-5 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Appointment Cancellation"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"When a patient cancels their appointment"})]})]}),e.jsx(C,{checked:a.notification_cancellation,onCheckedChange:c=>l("notification_cancellation",c)})]}),e.jsx(O,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-gold-light flex items-center justify-center",children:e.jsx(qe,{className:"h-5 w-5 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Message Received"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"When you receive a message from a patient"})]})]}),e.jsx(C,{checked:a.notification_message,onCheckedChange:c=>l("notification_message",c)})]})]})]}),e.jsxs(W,{children:[e.jsxs(ee,{children:[e.jsx(se,{className:"text-lg",children:"Communication Channels"}),e.jsx(te,{children:"Select how you want to receive notifications"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-blue-100 flex items-center justify-center",children:e.jsx(Ce,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via email"})]})]}),e.jsx(C,{checked:a.notification_channel_email,onCheckedChange:c=>l("notification_channel_email",c)})]}),e.jsx(O,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-green-100 flex items-center justify-center",children:e.jsx(ke,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via WhatsApp"})]})]}),e.jsx(C,{checked:a.notification_channel_whatsapp,onCheckedChange:c=>l("notification_channel_whatsapp",c)})]}),e.jsx(O,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-purple-100 flex items-center justify-center",children:e.jsx(de,{className:"h-5 w-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Dashboard Alerts"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"See notifications in your dashboard"})]})]}),e.jsx(C,{checked:a.notification_channel_dashboard,onCheckedChange:c=>l("notification_channel_dashboard",c)})]})]})]}),e.jsxs(W,{children:[e.jsxs(ee,{children:[e.jsx(se,{className:"text-lg",children:"Notification Destinations"}),e.jsx(te,{children:"Configure where notifications are sent"})]}),e.jsxs(z,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Primary Email"}),e.jsx(H,{value:n?.email||"",disabled:!0,className:"bg-muted"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"This is your login email and cannot be changed here"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Secondary Email (Optional)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{type:"email",placeholder:"backup@example.com",value:a.notification_email_secondary||"",onChange:c=>v("notification_email_secondary",c.target.value)}),e.jsx(h,{variant:"outline",size:"icon",onClick:()=>m.mutate("email"),disabled:m.isPending,title:"Send test email",children:e.jsx(We,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Notifications will be sent to both primary and secondary email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"WhatsApp Number"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{type:"tel",placeholder:"+1 234 567 8900",value:a.notification_whatsapp_number||"",onChange:c=>v("notification_whatsapp_number",c.target.value)}),e.jsx(h,{variant:"outline",size:"icon",onClick:()=>m.mutate("whatsapp"),disabled:m.isPending||!a.notification_whatsapp_number,title:"Send test WhatsApp",children:e.jsx(We,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Include country code (e.g., +1 for US)"})]})]})]}),e.jsxs(W,{children:[e.jsxs(ee,{children:[e.jsx(se,{className:"text-lg",children:"Patient Notifications"}),e.jsx(te,{children:"Control what patients receive"})]}),e.jsxs(z,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Confirmation Email"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send confirmation when booking is confirmed"})]}),e.jsx(C,{checked:a.confirmation_email_enabled??!0,onCheckedChange:c=>l("confirmation_email_enabled",c)})]}),e.jsx(O,{}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"SMS Reminders"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Send reminder before appointment"})]}),e.jsx(C,{checked:a.reminder_sms_enabled??!0,onCheckedChange:c=>l("reminder_sms_enabled",c)})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx(h,{variant:"outline",onClick:()=>{t&&i({notification_new_appointment:t.notification_new_appointment??!0,notification_form_submission:t.notification_form_submission??!0,notification_cancellation:t.notification_cancellation??!0,notification_message:t.notification_message??!0,notification_channel_email:t.notification_channel_email??!0,notification_channel_whatsapp:t.notification_channel_whatsapp??!1,notification_channel_dashboard:t.notification_channel_dashboard??!0,notification_email_secondary:t.notification_email_secondary??null,notification_whatsapp_number:t.notification_whatsapp_number??null,reminder_sms_enabled:t.reminder_sms_enabled??!0,confirmation_email_enabled:t.confirmation_email_enabled??!0})},children:"Reset"}),e.jsxs(h,{onClick:()=>x.mutate(a),disabled:x.isPending,className:"gap-2",children:[e.jsx(ts,{className:"h-4 w-4"}),x.isPending?"Saving...":"Save Preferences"]})]})]}):e.jsx(W,{children:e.jsxs(z,{className:"py-12 text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Practice Linked"}),e.jsx("p",{className:"text-muted-foreground",children:"You need to claim or create a practice to configure notifications"})]})})}const Ve=[{value:"booking_confirmed",label:"When Booking is Confirmed",icon:U},{value:"booking_pending",label:"When Booking Request Received",icon:Q},{value:"manual",label:"Manual Send Only",icon:Ze}];function mt(){const n=Ne(),{data:o,isLoading:s}=ss(),[p,a]=k.useState(!1),[i,t]=k.useState(null),{data:j}=_({queryKey:["intake-templates-for-workflow",o?.id],queryFn:async()=>{const{data:r}=await w.from("intake_form_templates").select("id, name, form_type").or(`clinic_id.eq.${o?.id},clinic_id.is.null`).eq("is_active",!0);return r||[]},enabled:!!o?.id}),{data:x,isLoading:m}=_({queryKey:["form-workflows",o?.id],queryFn:async()=>{const{data:r,error:f}=await w.from("form_workflow_settings").select("*").eq("clinic_id",o?.id).order("created_at");if(f)throw f;return(r||[]).map(y=>({...y,form_sequence:y.form_sequence||[],delivery_destinations:y.delivery_destinations||{email:!0,dashboard:!0,google_drive:!1},trigger_event:y.trigger_event}))},enabled:!!o?.id}),l=Y({mutationFn:async r=>{if(r.id){const{error:f}=await w.from("form_workflow_settings").update({name:r.name,is_active:r.is_active,trigger_event:r.trigger_event,form_sequence:r.form_sequence,delivery_destinations:r.delivery_destinations,require_otp_verification:r.require_otp_verification,capture_ip_address:r.capture_ip_address}).eq("id",r.id);if(f)throw f}else{const{error:f}=await w.from("form_workflow_settings").insert({clinic_id:o?.id,name:r.name,is_active:r.is_active,trigger_event:r.trigger_event,form_sequence:r.form_sequence,delivery_destinations:r.delivery_destinations,require_otp_verification:r.require_otp_verification,capture_ip_address:r.capture_ip_address});if(f)throw f}},onSuccess:()=>{I.success("Workflow saved"),n.invalidateQueries({queryKey:["form-workflows"]}),a(!1),t(null)},onError:r=>{I.error("Failed to save: "+r.message)}}),v=Y({mutationFn:async r=>{const{error:f}=await w.from("form_workflow_settings").delete().eq("id",r);if(f)throw f},onSuccess:()=>{I.success("Workflow deleted"),n.invalidateQueries({queryKey:["form-workflows"]})}}),c=()=>{t({name:"New Workflow",is_active:!0,trigger_event:"booking_confirmed",form_sequence:[],delivery_destinations:{email:!0,dashboard:!0,google_drive:!1},require_otp_verification:!1,capture_ip_address:!0}),a(!0)},N=()=>{i&&t({...i,form_sequence:[...i.form_sequence,{form_template_id:"",delay_hours:0,delivery_method:"email"}]})},b=(r,f)=>{if(!i)return;const y=[...i.form_sequence];y[r]={...y[r],...f},t({...i,form_sequence:y})},q=r=>{i&&t({...i,form_sequence:i.form_sequence.filter((f,y)=>y!==r)})},u=(r,f)=>{if(!i)return;const y=[...i.form_sequence],d=f==="up"?r-1:r+1;d<0||d>=y.length||([y[r],y[d]]=[y[d],y[r]],t({...i,form_sequence:y}))};return s||m?e.jsx(es,{className:"h-96"}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-display font-bold flex items-center gap-2",children:[e.jsx(Le,{className:"h-6 w-6"}),"Form Automation Workflows"]}),e.jsx("p",{className:"text-muted-foreground",children:"Design automated form sequences that trigger based on booking events"})]}),e.jsxs(h,{onClick:c,className:"gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Create Workflow"]})]}),x?.length===0?e.jsx(W,{children:e.jsxs(z,{className:"py-12 text-center",children:[e.jsx(Le,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Workflows Yet"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Create your first automation workflow to send forms automatically"}),e.jsx(h,{onClick:c,children:"Create Workflow"})]})}):e.jsx("div",{className:"grid gap-4",children:x?.map(r=>e.jsx(W,{className:r.is_active?"":"opacity-60",children:e.jsx(z,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`h-12 w-12 rounded-xl flex items-center justify-center ${r.is_active?"bg-primary/10":"bg-muted"}`,children:e.jsx(K,{className:`h-6 w-6 ${r.is_active?"text-primary":"text-muted-foreground"}`})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold",children:r.name}),r.is_active?e.jsx(P,{variant:"default",className:"bg-teal text-white",children:"Active"}):e.jsx(P,{variant:"secondary",children:"Inactive"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Trigger: ",Ve.find(f=>f.value===r.trigger_event)?.label]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r.form_sequence?.length||0," forms in sequence"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>{t(r),a(!0)},children:"Edit"}),e.jsx(h,{variant:"ghost",size:"sm",className:"text-destructive",onClick:()=>{confirm("Delete this workflow?")&&v.mutate(r.id)},children:e.jsx(ze,{className:"h-4 w-4"})})]})]})})},r.id))}),e.jsx(ps,{open:p,onOpenChange:a,children:e.jsxs(fs,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(gs,{children:[e.jsx(js,{children:i?.id?"Edit Workflow":"Create Workflow"}),e.jsx(ys,{children:"Design your form automation sequence"})]}),i&&e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Workflow Name"}),e.jsx(H,{value:i.name,onChange:r=>t({...i,name:r.target.value}),placeholder:"e.g., New Patient Intake"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Status"}),e.jsxs("div",{className:"flex items-center gap-2 h-10",children:[e.jsx(C,{checked:i.is_active,onCheckedChange:r=>t({...i,is_active:r})}),e.jsx("span",{className:"text-sm",children:i.is_active?"Active":"Inactive"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(E,{children:"Trigger Event"}),e.jsxs(re,{value:i.trigger_event,onValueChange:r=>t({...i,trigger_event:r}),children:[e.jsx(ne,{children:e.jsx(le,{})}),e.jsx(oe,{children:Ve.map(r=>e.jsx(D,{value:r.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r.icon,{className:"h-4 w-4"}),r.label]})},r.value))})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{children:"Form Sequence"}),e.jsxs(h,{variant:"outline",size:"sm",onClick:N,className:"gap-1",children:[e.jsx(me,{className:"h-3 w-3"}),"Add Form"]})]}),i.form_sequence.length===0?e.jsxs("div",{className:"text-center py-8 border-2 border-dashed rounded-lg",children:[e.jsx(Se,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No forms added yet"}),e.jsx(h,{variant:"link",size:"sm",onClick:N,children:"Add your first form"})]}):e.jsx("div",{className:"space-y-2",children:i.form_sequence.map((r,f)=>e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>u(f,"up"),disabled:f===0,children:e.jsx(Ys,{className:"h-3 w-3"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>u(f,"down"),disabled:f===i.form_sequence.length-1,children:e.jsx(Zs,{className:"h-3 w-3"})})]}),e.jsx(P,{variant:"outline",className:"h-6 w-6 flex items-center justify-center p-0",children:f+1}),e.jsxs(re,{value:r.form_template_id,onValueChange:y=>b(f,{form_template_id:y}),children:[e.jsx(ne,{className:"flex-1",children:e.jsx(le,{placeholder:"Select form..."})}),e.jsx(oe,{children:j?.map(y=>e.jsx(D,{value:y.id,children:y.name},y.id))})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(H,{type:"number",className:"w-16",value:r.delay_hours,onChange:y=>b(f,{delay_hours:parseInt(y.target.value)||0}),min:0}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"hrs"})]}),e.jsxs(re,{value:r.delivery_method,onValueChange:y=>b(f,{delivery_method:y}),children:[e.jsx(ne,{className:"w-32",children:e.jsx(le,{})}),e.jsxs(oe,{children:[e.jsx(D,{value:"email",children:"Email"}),e.jsx(D,{value:"whatsapp",children:"WhatsApp"}),e.jsx(D,{value:"dashboard",children:"Dashboard Link"})]})]}),e.jsx(h,{variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>q(f),children:e.jsx(ze,{className:"h-4 w-4"})})]},f))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(E,{children:"Signed Form Delivery"}),e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",children:[e.jsx(C,{checked:i.delivery_destinations.email,onCheckedChange:r=>t({...i,delivery_destinations:{...i.delivery_destinations,email:r}})}),e.jsx(Ce,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Email"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg",children:[e.jsx(C,{checked:i.delivery_destinations.dashboard,onCheckedChange:r=>t({...i,delivery_destinations:{...i.delivery_destinations,dashboard:r}})}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Dashboard"})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 border rounded-lg opacity-50",children:[e.jsx(C,{checked:i.delivery_destinations.google_drive,onCheckedChange:r=>t({...i,delivery_destinations:{...i.delivery_destinations,google_drive:r}}),disabled:!0}),e.jsx(Js,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:"Google Drive"}),e.jsx(P,{variant:"secondary",className:"text-[10px]",children:"Soon"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(E,{children:"Security & Consent"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Require OTP Verification"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Patient must verify via OTP before signing"})]})]}),e.jsx(C,{checked:i.require_otp_verification,onCheckedChange:r=>t({...i,require_otp_verification:r})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Capture IP Address"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Record IP address for consent proof"})]})]}),e.jsx(C,{checked:i.capture_ip_address,onCheckedChange:r=>t({...i,capture_ip_address:r})})]})]})]})]}),e.jsxs(bs,{children:[e.jsx(h,{variant:"outline",onClick:()=>a(!1),children:"Cancel"}),e.jsxs(h,{onClick:()=>i&&l.mutate(i),disabled:l.isPending,className:"gap-2",children:[e.jsx(ts,{className:"h-4 w-4"}),l.isPending?"Saving...":"Save Workflow"]})]})]})})]}):e.jsx(W,{children:e.jsxs(z,{className:"py-12 text-center",children:[e.jsx(ue,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Practice Linked"}),e.jsx("p",{className:"text-muted-foreground",children:"You need to claim or create a practice to configure workflows"})]})})}function ii(){const[n,o]=ns(),[s,p]=k.useState(()=>n.get("tab")||"my-dashboard"),a=t=>{p(t),o({tab:t},{replace:!0})},i=()=>{switch(s){case"my-dashboard":return e.jsx(Oe,{onNavigate:a});case"my-practice":return e.jsx(ot,{onNavigate:a});case"my-appointments":return e.jsx(ct,{onNavigate:a});case"my-availability":return e.jsx(Rs,{});case"my-appointment-types":return e.jsx(Is,{});case"my-patients":return e.jsx(Ws,{});case"my-messages":return e.jsx(zs,{});case"my-intake-forms":return e.jsx(Ls,{});case"my-form-workflows":return e.jsx(mt,{});case"my-operations":return e.jsx(Os,{});case"my-profile":return e.jsx(Bs,{});case"my-team":return e.jsx(Vs,{});case"my-services":return e.jsx(Gs,{});case"my-insurance":return e.jsx(Ks,{});case"my-reputation":return e.jsx(Hs,{});case"my-templates":return e.jsx(Qs,{});case"my-notifications":return e.jsx(dt,{});case"my-settings":return e.jsx(Us,{});case"my-support":return e.jsx($s,{});default:return e.jsx(Oe,{onNavigate:a})}};return e.jsx(it,{activeTab:s,onTabChange:a,children:i()})}export{ii as default};
