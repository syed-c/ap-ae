import{u as v,j as e}from"./chunk-CPh6voF3.js";import{r as B}from"./chunk-CffrGP6S.js";import{a0 as E,Q as N,i as w,m as P,w as K,C as k,n as U,U as V,T as H,x as Q,E as G,s}from"./index-DflORfjh.js";import{C as o,d as m,a as u,b as h,c as S}from"./chunk-Dwq_v72W.js";import{P as z}from"./chunk-DSDQubI6.js";import{B as J}from"./chunk-HiDpIwK7.js";import{L as X}from"./chunk-DR32GIZ2.js";import{T as R}from"./chunk-DbdCK11k.js";import{C as Y}from"./chunk-wy0nNZZG.js";import{A as Z,a as ee}from"./chunk-BRjFAgpB.js";import{e as te}from"./chunk-B2Rulxe9.js";import{s as j}from"./chunk-aAsotRsv.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function Ne(){B.useState("overview");const l=new Date,c=E(l),_=te(l),p=j(c,7);j(_,7);const{data:n,isLoading:L}=v({queryKey:["founder-weekly-stats"],queryFn:async()=>{const t=j(l,30).toISOString(),[{count:a},{count:i},{count:x},{count:d},{count:f},{count:C},{count:W},{count:q},{count:I},{count:O},{count:A}]=await Promise.all([s.from("clinics").select("*",{count:"exact",head:!0}).gte("created_at",c.toISOString()),s.from("clinics").select("*",{count:"exact",head:!0}).gte("created_at",p.toISOString()).lt("created_at",c.toISOString()),s.from("clinics").select("*",{count:"exact",head:!0}).eq("claim_status","claimed").gte("claimed_at",c.toISOString()),s.from("clinics").select("*",{count:"exact",head:!0}).eq("claim_status","claimed").gte("claimed_at",p.toISOString()).lt("claimed_at",c.toISOString()),s.from("clinics").select("*",{count:"exact",head:!0}).eq("verification_status","verified").gte("updated_at",c.toISOString()),s.from("clinics").select("*",{count:"exact",head:!0}).eq("verification_status","verified").gte("updated_at",p.toISOString()).lt("updated_at",c.toISOString()),s.from("appointments").select("*",{count:"exact",head:!0}).gte("created_at",c.toISOString()),s.from("appointments").select("*",{count:"exact",head:!0}).gte("created_at",p.toISOString()).lt("created_at",c.toISOString()),s.from("leads").select("*",{count:"exact",head:!0}).gte("created_at",c.toISOString()),s.from("leads").select("*",{count:"exact",head:!0}).gte("created_at",p.toISOString()).lt("created_at",c.toISOString()),s.from("clinics").select("*",{count:"exact",head:!0}).eq("claim_status","claimed").gte("updated_at",t)]),g=(M,b)=>b?Math.round((M-b)/b*100):M>0?100:0,T=(await s.from("clinics").select("*",{count:"exact",head:!0}).eq("claim_status","claimed")).count||0,F=T?Math.round((A||0)/T*100):0;return{clinics:{thisWeek:a||0,lastWeek:i||0,change:g(a||0,i||0)},claimed:{thisWeek:x||0,lastWeek:d||0,change:g(x||0,d||0)},verified:{thisWeek:f||0,lastWeek:C||0,change:g(f||0,C||0)},appointments:{thisWeek:W||0,lastWeek:q||0,change:g(W||0,q||0)},leads:{thisWeek:I||0,lastWeek:O||0,change:g(I||0,O||0)},activeClinics:A||0,retentionRate:F}}}),{data:r}=v({queryKey:["conversion-funnel"],queryFn:async()=>{const[{count:t},{count:a},{count:i},{count:x},{count:d}]=await Promise.all([s.from("clinics").select("*",{count:"exact",head:!0}),s.from("clinics").select("*",{count:"exact",head:!0}).eq("claim_status","claimed"),s.from("clinics").select("*",{count:"exact",head:!0}).eq("verification_status","verified"),s.from("clinics").select("*",{count:"exact",head:!0}).eq("claim_status","claimed").eq("is_active",!0),s.from("clinic_subscriptions").select("*",{count:"exact",head:!0}).eq("status","active")]);return{imported:t||0,claimed:a||0,verified:i||0,active:x||0,revenue:d||0}}}),{data:$}=v({queryKey:["top-locations"],queryFn:async()=>{const{data:t}=await s.from("cities").select("id, name, dentist_count").order("dentist_count",{ascending:!1}).limit(5);return t||[]}}),{data:y}=v({queryKey:["action-tasks"],queryFn:async()=>{const t=[],{count:a}=await s.from("clinics").select("*",{count:"exact",head:!0}).eq("claim_status","unclaimed");(a||0)>10&&t.push({priority:"high",task:`${a} unclaimed clinics need outreach`,impact:"Increase claimed rate by 20%"});const{count:i}=await s.from("claim_requests").select("*",{count:"exact",head:!0}).eq("status","pending");(i||0)>0&&t.push({priority:"high",task:`${i} claim requests awaiting review`,impact:"Faster onboarding"});const x=j(l,30).toISOString(),{count:d}=await s.from("clinics").select("*",{count:"exact",head:!0}).eq("claim_status","claimed").lt("updated_at",x);(d||0)>5&&t.push({priority:"medium",task:`${d} claimed profiles haven't updated in 30d`,impact:"Re-engagement opportunity"});const{count:f}=await s.from("review_funnel_events").select("*",{count:"exact",head:!0}).eq("event_type","thumbs_down").gte("created_at",j(l,7).toISOString());return(f||0)>5&&t.push({priority:"medium",task:`${f} negative feedback this week`,impact:"Review quality issues"}),t.slice(0,5)}}),D=({value:t})=>{const a=t>0,i=t===0;return e.jsxs("div",{className:`flex items-center gap-1 text-sm font-medium ${a?"text-teal":i?"text-muted-foreground":"text-coral"}`,children:[a?e.jsx(Z,{className:"h-3 w-3"}):i?null:e.jsx(ee,{className:"h-3 w-3"}),e.jsx("span",{children:i?"0%":`${Math.abs(t)}%`})]})};return L?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"Weekly Founder Dashboard"}),e.jsxs("p",{className:"text-muted-foreground mt-1",children:["Week of ",N(c,"MMM d")," - ",N(_,"MMM d, yyyy")]})]}),e.jsxs(w,{variant:"outline",className:"text-sm py-2 px-4",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Week ",N(l,"w")," of ",N(l,"yyyy")]})]}),e.jsx("div",{className:"grid grid-cols-5 gap-4",children:[{label:"New Clinics",icon:K,...n?.clinics,color:"primary"},{label:"New Claims",icon:k,...n?.claimed,color:"teal"},{label:"Verified",icon:U,...n?.verified,color:"gold"},{label:"Appointments",icon:P,...n?.appointments,color:"blue-custom"},{label:"Leads",icon:V,...n?.leads,color:"purple"}].map(t=>{const a=t.icon;return e.jsx(o,{className:"card-modern",children:e.jsxs(m,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:`h-10 w-10 rounded-xl bg-${t.color}/10 flex items-center justify-center`,children:e.jsx(a,{className:`h-5 w-5 text-${t.color}`})}),e.jsx(D,{value:t.change||0})]}),e.jsx("p",{className:"text-2xl font-bold",children:t.thisWeek}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.label}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["vs ",t.lastWeek," last week"]})]})},t.label)})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs(o,{className:"card-modern",children:[e.jsx(u,{children:e.jsxs(h,{className:"text-lg flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-teal"}),"Clinic Retention (30 Days)"]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-teal",children:[n?.retentionRate||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"of claimed clinics active"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(z,{value:n?.retentionRate||0,className:"h-3"}),e.jsxs("div",{className:"flex justify-between mt-2 text-xs text-muted-foreground",children:[e.jsxs("span",{children:[n?.activeClinics||0," active"]}),e.jsx("span",{children:"of claimed clinics"})]})]})]})})]}),e.jsxs(o,{className:"card-modern",children:[e.jsx(u,{children:e.jsxs(h,{className:"text-lg flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-primary"}),"Revenue Pipeline"]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-4xl font-bold text-primary",children:r?.revenue||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"paying clinics"})]}),e.jsxs("div",{className:"flex-1 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Conversion Rate"}),e.jsxs("span",{className:"font-medium",children:[r?.claimed?Math.round(r.revenue/r.claimed*100):0,"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Claimed → Verified"}),e.jsxs("span",{className:"font-medium",children:[r?.claimed?Math.round(r.verified/r.claimed*100):0,"%"]})]})]})]})})]})]}),e.jsxs(o,{className:"card-modern",children:[e.jsxs(u,{children:[e.jsx(h,{className:"text-lg",children:"Marketplace Conversion Funnel"}),e.jsx(S,{children:"From import to revenue"})]}),e.jsx(m,{children:e.jsx("div",{className:"flex items-center justify-between",children:[{label:"Imported",value:r?.imported||0,color:"bg-muted"},{label:"Claimed",value:r?.claimed||0,color:"bg-primary/50"},{label:"Verified",value:r?.verified||0,color:"bg-primary/70"},{label:"Active",value:r?.active||0,color:"bg-primary/90"},{label:"Paying",value:r?.revenue||0,color:"bg-primary"}].map((t,a,i)=>e.jsxs("div",{className:"flex items-center flex-1",children:[e.jsxs("div",{className:"text-center flex-1",children:[e.jsx("div",{className:`h-16 w-16 mx-auto rounded-full ${t.color} flex items-center justify-center mb-2`,children:e.jsx("span",{className:"text-lg font-bold text-white",children:t.value})}),e.jsx("p",{className:"text-sm font-medium",children:t.label}),a>0&&i[a-1].value>0&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:[Math.round(t.value/i[a-1].value*100),"%"]})]}),a<i.length-1&&e.jsx("div",{className:"w-12 h-0.5 bg-border"})]},t.label))})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs(o,{className:"card-modern",children:[e.jsx(u,{children:e.jsxs(h,{className:"text-lg flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-primary"}),"Top Performing Locations"]})}),e.jsx(m,{className:"space-y-3",children:$?.map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(w,{variant:"outline",className:"w-6 h-6 flex items-center justify-center p-0",children:a+1}),e.jsx("span",{className:"font-medium",children:t.name})]}),e.jsxs(w,{children:[t.dentist_count||0," dentists"]})]},t.id))})]}),e.jsxs(o,{className:"card-modern",children:[e.jsxs(u,{children:[e.jsxs(h,{className:"text-lg flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5 text-gold"}),"This Week's Priorities"]}),e.jsx(S,{children:"Top 5 actions to improve growth"})]}),e.jsxs(m,{className:"space-y-3",children:[y?.map((t,a)=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-xl bg-muted/50",children:[e.jsx("div",{className:`h-6 w-6 rounded-full flex items-center justify-center shrink-0 ${t.priority==="high"?"bg-coral/20":t.priority==="medium"?"bg-gold/20":"bg-muted"}`,children:e.jsx(R,{className:`h-3 w-3 ${t.priority==="high"?"text-coral":t.priority==="medium"?"text-gold":"text-muted-foreground"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:t.task}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t.impact})]})]},a)),(!y||y.length===0)&&e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(k,{className:"h-8 w-8 mx-auto mb-2 text-teal"}),e.jsx("p",{children:"All caught up! No urgent tasks."})]})]})]})]}),e.jsxs(o,{className:"card-modern border-primary/20 bg-gradient-to-r from-primary/5 to-transparent",children:[e.jsxs(u,{children:[e.jsxs(h,{className:"text-lg flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-primary"}),"AI Platform Health Summary"]}),e.jsx(S,{children:"Automated weekly analysis and recommendations"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-background border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(k,{className:"h-4 w-4 text-teal"}),e.jsx("span",{className:"font-medium",children:"Strengths"})]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Clinic onboarding funnel healthy"}),e.jsx("li",{children:"• Review collection trending up"}),e.jsx("li",{children:"• SEO coverage expanding"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-background border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-4 w-4 text-gold"}),e.jsx("span",{className:"font-medium",children:"Watch Areas"})]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Claim conversion could improve"}),e.jsx("li",{children:"• Some locations under-represented"}),e.jsx("li",{children:"• Response time on claims"})]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-background border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"Priority Actions"})]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Launch outreach to top 20 unclaimed"}),e.jsx("li",{children:"• Review pending claims within 24h"}),e.jsx("li",{children:"• Add content for low-coverage areas"})]})]})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-4 flex items-center gap-1",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-teal animate-pulse"}),"AI analysis generated from live platform data. Connect Gemini API for enhanced insights."]})]})]})]})}export{Ne as default};
