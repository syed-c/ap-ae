import{b as Z,u as A,c as R,j as e}from"./chunk-CPh6voF3.js";import{r as h}from"./chunk-CffrGP6S.js";import{C as ee,w as S,T as se,i as l,B as u,p as ae,I as B,Q as P,bC as ne,bA as ie,a9 as te,aa as le,ab as re,ac as ce,P as de,s as g,b as D}from"./index-DflORfjh.js";import{C as r,d as c,a as f,b as N,c as v}from"./chunk-Dwq_v72W.js";import{S as oe}from"./chunk-DfjE-bP6.js";import{T as me,a as xe,b as w,c as b}from"./chunk-k8HiDHrE.js";import{T as y,a as _,b as t,c as n,d as C,e as a}from"./chunk-NLs5Ye4A.js";import{M as L}from"./chunk-B7d2qnKb.js";import{C as he}from"./chunk-CbEmr7WL.js";import{T as Q}from"./chunk-DbdCK11k.js";import{E as ue}from"./chunk-CcezodbN.js";import{S as je}from"./chunk-C8UDNHIm.js";import{M as pe}from"./chunk-_WnrCass.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";const ge=[{id:"appointment_reminder",name:"Appointment Reminder",channel:"sms",template:`Hi {{patient_name}}, this is a reminder for your appointment at {{clinic_name}} on {{date}} at {{time}}. Reply CONFIRM to confirm or RESCHEDULE to change.

â€“ {{clinic_name}}`},{id:"review_request",name:"Review Request",channel:"sms",template:`Hi {{patient_name}}, thank you for visiting {{clinic_name}}. We'd love your feedback! Please share your experience: {{review_link}}

â€“ {{clinic_name}}`},{id:"booking_confirmation",name:"Booking Confirmation",channel:"sms",template:`Your appointment is confirmed! âœ“

ðŸ“ {{clinic_name}}
ðŸ“… {{date}} at {{time}}
ðŸ¦· {{treatment}}

To reschedule: {{reschedule_link}}
To cancel: {{cancel_link}}`},{id:"welcome_message",name:"Welcome Message",channel:"whatsapp",template:`Welcome to {{clinic_name}}! ðŸ‘‹

Thank you for choosing us for your dental care. We're here to help you maintain a healthy smile.

Book your next appointment: {{booking_link}}

â€“ The {{clinic_name}} Team`},{id:"followup",name:"Post-Treatment Follow-up",channel:"sms",template:`Hi {{patient_name}}, we hope you're feeling great after your visit to {{clinic_name}}! If you have any questions or concerns, please don't hesitate to contact us.

Reply HELP for assistance.`}];function Ae(){const H=Z(),[U,z]=h.useState("overview"),[m,I]=h.useState(""),[W,q]=h.useState(!1),[x,K]=h.useState(null),[M,E]=h.useState("mobile"),F={patient_name:"Sarah Johnson",clinic_name:"Premium Dental Care",date:"January 15, 2026",time:"10:30 AM",treatment:"Teeth Cleaning",review_link:"https://appointpanda.ae/review/abc123",booking_link:"https://appointpanda.ae/book/abc123",reschedule_link:"https://appointpanda.ae/reschedule/abc123",cancel_link:"https://appointpanda.ae/cancel/abc123"},O=s=>{let i=s;return Object.entries(F).forEach(([d,G])=>{i=i.replace(new RegExp(`{{${d}}}`,"g"),G)}),i},$=s=>{K(s),q(!0)},{data:o,isLoading:J}=A({queryKey:["admin-all-messages"],queryFn:async()=>{const{data:s,error:i}=await g.from("clinic_messages").select("*, clinic:clinics(id, name)").order("created_at",{ascending:!1}).limit(200);if(i)throw i;return s}}),{data:j,isLoading:V}=A({queryKey:["admin-automation-settings"],queryFn:async()=>{const{data:s,error:i}=await g.from("clinic_automation_settings").select("*, clinic:clinics(id, name)").order("clinic_id");if(i)throw i;return s}}),T=R({mutationFn:async({id:s,enabled:i})=>{const{error:d}=await g.from("clinic_automation_settings").update({is_messaging_enabled:i}).eq("id",s);if(d)throw d},onSuccess:()=>{H.invalidateQueries({queryKey:["admin-automation-settings"]}),D.success("Messaging status updated")},onError:s=>D.error(s.message||"Failed to update")}),X=R({mutationFn:async({id:s,limit:i})=>{const{error:d}=await g.from("clinic_automation_settings").update({daily_message_limit:i}).eq("id",s);if(d)throw d},onSuccess:()=>{H.invalidateQueries({queryKey:["admin-automation-settings"]}),D.success("Limit updated")}}),k=o?.filter(s=>!m||s.recipient_phone.includes(m)||s.clinic?.name?.toLowerCase().includes(m.toLowerCase())||s.message_content.toLowerCase().includes(m.toLowerCase())),p={totalMessages:o?.length||0,delivered:o?.filter(s=>s.status==="delivered").length||0,failed:o?.filter(s=>s.status==="failed").length||0,clinicsMessaging:j?.filter(s=>s.is_messaging_enabled).length||0},Y=s=>{switch(s){case"delivered":return e.jsx(l,{className:"bg-green-100 text-green-800",children:"Delivered"});case"sent":return e.jsx(l,{className:"bg-blue-100 text-blue-800",children:"Sent"});case"pending":case"queued":return e.jsx(l,{variant:"secondary",children:"Pending"});case"failed":return e.jsx(l,{variant:"destructive",children:"Failed"});default:return e.jsx(l,{variant:"outline",children:s})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"Messaging Control"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor and control all clinic messaging"})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(r,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(L,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.totalMessages}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Messages"})]})]})})}),e.jsx(r,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-green-100 flex items-center justify-center",children:e.jsx(ee,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.delivered}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Delivered"})]})]})})}),e.jsx(r,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-red-100 flex items-center justify-center",children:e.jsx(he,{className:"h-5 w-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.failed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Failed"})]})]})})}),e.jsx(r,{children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-blue-100 flex items-center justify-center",children:e.jsx(S,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:p.clinicsMessaging}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clinics Active"})]})]})})})]}),e.jsxs(me,{value:U,onValueChange:z,children:[e.jsxs(xe,{className:"grid w-full grid-cols-4 rounded-xl",children:[e.jsxs(w,{value:"overview",className:"rounded-xl",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Message Log"]}),e.jsxs(w,{value:"templates",className:"rounded-xl",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Templates"]}),e.jsxs(w,{value:"clinics",className:"rounded-xl",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Clinic Controls"]}),e.jsxs(w,{value:"failures",className:"rounded-xl",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Failures"]})]}),e.jsx(b,{value:"templates",className:"mt-4",children:e.jsxs(r,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"Message Templates"}),e.jsx(v,{children:"Preview and manage message templates"})]}),e.jsx(c,{className:"p-0",children:e.jsxs(y,{children:[e.jsx(_,{children:e.jsxs(t,{children:[e.jsx(n,{children:"Template Name"}),e.jsx(n,{children:"Channel"}),e.jsx(n,{children:"Preview"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(C,{children:ge.map(s=>e.jsxs(t,{children:[e.jsx(a,{children:e.jsx("span",{className:"font-medium",children:s.name})}),e.jsx(a,{children:e.jsx(l,{variant:"outline",className:"uppercase text-xs",children:s.channel})}),e.jsxs(a,{className:"max-w-xs truncate text-sm text-muted-foreground",children:[s.template.substring(0,50),"..."]}),e.jsx(a,{className:"text-right",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>$(s),children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),"Preview"]})})]},s.id))})]})})]})}),e.jsx(b,{value:"overview",className:"mt-4",children:e.jsxs(r,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"Message Log"}),e.jsx(v,{children:"All messages sent from the platform"})]}),e.jsxs(c,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{className:"pl-10",placeholder:"Search by phone, clinic, or content...",value:m,onChange:s=>I(s.target.value)})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(y,{children:[e.jsx(_,{children:e.jsxs(t,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Clinic"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Channel"}),e.jsx(n,{children:"Message"}),e.jsx(n,{children:"Status"})]})}),e.jsx(C,{children:J?e.jsx(t,{children:e.jsx(a,{colSpan:6,className:"text-center py-8",children:"Loading..."})}):k&&k.length>0?k.slice(0,50).map(s=>e.jsxs(t,{children:[e.jsx(a,{className:"text-muted-foreground text-sm",children:P(new Date(s.created_at),"MMM d, HH:mm")}),e.jsx(a,{children:e.jsx("span",{className:"font-medium",children:s.clinic?.name||"Unknown"})}),e.jsx(a,{children:e.jsx("span",{className:"font-mono text-sm",children:s.recipient_phone})}),e.jsx(a,{children:e.jsx(l,{variant:"outline",className:"uppercase text-xs",children:s.channel})}),e.jsx(a,{className:"max-w-xs truncate text-sm",children:s.message_content}),e.jsx(a,{children:Y(s.status)})]},s.id)):e.jsx(t,{children:e.jsx(a,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:"No messages found"})})})]})})]})]})}),e.jsx(b,{value:"clinics",className:"mt-4",children:e.jsxs(r,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"Clinic Messaging Controls"}),e.jsx(v,{children:"Enable/disable messaging and set limits per clinic"})]}),e.jsx(c,{className:"p-0",children:e.jsxs(y,{children:[e.jsx(_,{children:e.jsxs(t,{children:[e.jsx(n,{children:"Clinic"}),e.jsx(n,{children:"Messaging"}),e.jsx(n,{children:"Daily Limit"}),e.jsx(n,{className:"text-right",children:"Actions"})]})}),e.jsx(C,{children:V?e.jsx(t,{children:e.jsx(a,{colSpan:4,className:"text-center py-8",children:"Loading..."})}):j&&j.length>0?j.map(s=>e.jsxs(t,{children:[e.jsx(a,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.clinic?.name||"Unknown Clinic"})]})}),e.jsx(a,{children:e.jsx(oe,{checked:s.is_messaging_enabled,onCheckedChange:i=>T.mutate({id:s.id,enabled:i})})}),e.jsx(a,{children:e.jsx(B,{type:"number",className:"w-24",value:s.daily_message_limit,onChange:i=>X.mutate({id:s.id,limit:parseInt(i.target.value)||0})})}),e.jsx(a,{className:"text-right",children:s.is_messaging_enabled?e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>T.mutate({id:s.id,enabled:!1}),children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Pause"]}):e.jsxs(u,{size:"sm",onClick:()=>T.mutate({id:s.id,enabled:!0}),children:[e.jsx(ie,{className:"h-4 w-4 mr-1"}),"Enable"]})})]},s.id)):e.jsx(t,{children:e.jsx(a,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No clinic settings configured"})})})]})})]})}),e.jsx(b,{value:"failures",className:"mt-4",children:e.jsxs(r,{children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-5 w-5 text-destructive"}),"Failed Messages"]}),e.jsx(v,{children:"Messages that failed to deliver"})]}),e.jsx(c,{className:"p-0",children:e.jsxs(y,{children:[e.jsx(_,{children:e.jsxs(t,{children:[e.jsx(n,{children:"Date"}),e.jsx(n,{children:"Clinic"}),e.jsx(n,{children:"Phone"}),e.jsx(n,{children:"Error"})]})}),e.jsx(C,{children:o?.filter(s=>s.status==="failed").length===0?e.jsx(t,{children:e.jsx(a,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"No failed messages"})}):o?.filter(s=>s.status==="failed").slice(0,50).map(s=>e.jsxs(t,{children:[e.jsx(a,{className:"text-muted-foreground text-sm",children:P(new Date(s.created_at),"MMM d, HH:mm")}),e.jsx(a,{children:s.clinic?.name||"Unknown"}),e.jsx(a,{className:"font-mono text-sm",children:s.recipient_phone}),e.jsx(a,{className:"text-red-500 text-sm",children:s.error_message||"Unknown error"})]},s.id))})]})})]})})]}),e.jsx(te,{open:W,onOpenChange:q,children:e.jsxs(le,{className:"sm:max-w-2xl",children:[e.jsx(re,{children:e.jsxs(ce,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Preview: ",x?.name]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{variant:M==="mobile"?"default":"outline",size:"sm",onClick:()=>E("mobile"),children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(u,{variant:M==="desktop"?"default":"outline",size:"sm",onClick:()=>E("desktop"),children:e.jsx(pe,{className:"h-4 w-4"})})]})]})}),e.jsxs("div",{className:"py-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:`bg-muted rounded-2xl p-4 ${M==="mobile"?"w-80 min-h-96":"w-full min-h-48"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4 pb-2 border-b",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/20 flex items-center justify-center",children:x?.channel==="whatsapp"?e.jsx(L,{className:"h-4 w-4 text-green-600"}):e.jsx(de,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:x?.channel==="whatsapp"?"WhatsApp":"SMS"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+971 50 123 4567"})]})]}),e.jsx("div",{className:"bg-background rounded-xl p-4 shadow-sm",children:e.jsx("p",{className:"whitespace-pre-wrap text-sm",children:x?O(x.template):""})}),e.jsx("p",{className:"text-xs text-muted-foreground text-right mt-2",children:P(new Date,"HH:mm")})]})}),e.jsxs("div",{className:"mt-4 p-3 bg-muted/50 rounded-lg",children:[e.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2",children:"Variables used:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.keys(F).map(s=>e.jsx(l,{variant:"outline",className:"text-xs",children:`{{${s}}}`},s))})]})]})]})})]})}export{Ae as default};
