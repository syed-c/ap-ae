import{b as Me,u as L,c as he,j as e}from"./chunk-CPh6voF3.js";import{r as u}from"./chunk-CffrGP6S.js";import{f as Le,z as Ee,B as v,m as qe,t as Fe,C as S,T as J,w as ue,Z as Ae,i as g,p as Pe,I as Ie,a2 as ne,a3 as le,a4 as Ke,a5 as ie,a6 as re,a7 as F,S as ge,G as je,Q as E,a9 as Ve,aa as ze,ab as He,ac as Oe,ad as Qe,b as q,a as D,A as $e,U as We,ae as Ge,s as l}from"./index-DflORfjh.js";import{C as c,d as o,a as b,b as N,c as fe}from"./chunk-Dwq_v72W.js";import{S as Ue}from"./chunk-CQtADEjB.js";import{S as V}from"./chunk-DfjE-bP6.js";import{T as Xe,a as Ye,b as z,c as H}from"./chunk-k8HiDHrE.js";import{P as O}from"./chunk-DSDQubI6.js";import{T as pe,a as be,b as Q,c as x,d as Ne,e as h}from"./chunk-NLs5Ye4A.js";import{L as Ze}from"./chunk-Drd-rt-S.js";import{P as Je}from"./chunk-D2pmmVk_.js";import{R as ee}from"./chunk-BOvFDp2b.js";import{C as es}from"./chunk-CbEmr7WL.js";import{A as se,L as ss}from"./chunk-C2VW2Ml6.js";import{M as ts}from"./chunk-DLwp5n63.js";import{C as as}from"./chunk-wy0nNZZG.js";import{T as ve}from"./chunk-C4_bt_FT.js";import{R as ye,B as ns,X as ls,Y as is,T as we,d as rs,P as cs,b as os,C as ds}from"./chunk-DK8nT4cj.js";import{S as te}from"./chunk-Beq7cUgv.js";import{E as ms}from"./chunk-CbETxTmt.js";import{s as ae}from"./chunk-aAsotRsv.js";import"./chunk-B8auUmee.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=Le("RectangleEllipsis",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M17 12h.01",key:"1m0b6t"}],["path",{d:"M7 12h.01",key:"eqddd0"}]]);async function hs(){const j=[];let y=0,d=!0;for(;d;){const{data:m,error:w}=await l.from("clinics").select(`
        id, name, slug, claim_status, is_active, gmb_connected,
        city:cities(name, state:states(abbreviation)),
        dentist_settings(
          booking_enabled,
          allow_same_day_booking,
          min_advance_booking_hours,
          max_advance_booking_days,
          confirmation_email_enabled,
          reminder_sms_enabled
        )
      `).eq("is_active",!0).order("name").range(y,y+1e3-1);if(w)throw w;m&&m.length>0?(j.push(...m),y+=1e3,d=m.length===1e3):d=!1}return j}function Ks(){const j=Me(),[f,y]=u.useState(""),[d,m]=u.useState(null),[w,C]=u.useState(!1),[A,$]=u.useState("overview"),[p,W]=u.useState("all"),[R,P]=u.useState(!1),{data:i,isLoading:G,refetch:I}=L({queryKey:["booking-system-stats"],queryFn:async()=>{const s=E(new Date,"yyyy-MM-dd"),t=E(ae(new Date,7),"yyyy-MM-dd"),r=E(ae(new Date,30),"yyyy-MM-dd"),[k,B,_,T,Z,M,Be,Te]=await Promise.all([l.from("appointments").select("*",{count:"exact",head:!0}),l.from("appointments").select("*",{count:"exact",head:!0}).eq("status","pending"),l.from("appointments").select("*",{count:"exact",head:!0}).eq("status","confirmed"),l.from("appointments").select("*",{count:"exact",head:!0}).eq("preferred_date",s),l.from("appointments").select("*",{count:"exact",head:!0}).gte("created_at",t),l.from("appointments").select("*",{count:"exact",head:!0}).eq("status","cancelled"),l.from("appointments").select("*",{count:"exact",head:!0}).eq("status","no_show"),l.from("appointments").select("*",{count:"exact",head:!0}).gte("created_at",r)]);return{total:k.count||0,pending:B.count||0,confirmed:_.count||0,today:T.count||0,thisWeek:Z.count||0,thisMonth:Te.count||0,cancelled:M.count||0,noShow:Be.count||0}}}),{data:n}=L({queryKey:["booking-funnel-stats"],queryFn:async()=>{const s=ae(new Date,7).toISOString(),[t,r,k,B]=await Promise.all([l.from("visitor_events").select("*",{count:"exact",head:!0}).eq("event_type","booking_start").gte("created_at",s),l.from("visitor_events").select("*",{count:"exact",head:!0}).eq("event_type","booking_complete").gte("created_at",s),l.from("visitor_events").select("*",{count:"exact",head:!0}).eq("event_type","booking_abandoned").gte("created_at",s),l.from("profile_analytics").select("*",{count:"exact",head:!0}).eq("event_type","view").gte("created_at",s)]),_=t.count||0,T=r.count||0,Z=k.count||_-T,M=B.count||0;return{profileViews:M,bookingStarts:_,bookingCompletes:T,formDropoffs:Math.max(0,Z),conversionRate:_>0?Math.round(T/_*100):0,viewToBookingRate:M>0?Math.round(_/M*100):0}}}),{data:U=[]}=L({queryKey:["booking-trend-data"],queryFn:async()=>{const s=[];for(let t=6;t>=0;t--){const r=new Date;r.setDate(r.getDate()-t),r.setHours(0,0,0,0);const k=new Date(r);k.setHours(23,59,59,999);const{count:B}=await l.from("appointments").select("*",{count:"exact",head:!0}).gte("created_at",r.toISOString()).lte("created_at",k.toISOString());s.push({day:E(r,"EEE"),bookings:B||0})}return s}}),{data:a,isLoading:ke,refetch:ce}=L({queryKey:["booking-clinics-with-settings-all"],queryFn:hs,staleTime:5*60*1e3}),{data:_e,refetch:oe}=L({queryKey:["recent-appointments"],queryFn:async()=>{const{data:s}=await l.from("appointments").select("id, patient_name, status, preferred_date, preferred_time, created_at, source, clinic:clinics(name)").order("created_at",{ascending:!1}).limit(25);return s||[]}}),de=u.useMemo(()=>a?a.filter(s=>{const t=!f||s.name.toLowerCase().includes(f.toLowerCase())||s.slug.toLowerCase().includes(f.toLowerCase())||s.city?.name?.toLowerCase().includes(f.toLowerCase()),r=s.dentist_settings?.booking_enabled??!0;return t&&(p==="all"||p==="enabled"&&r||p==="disabled"&&!r)}):[],[a,f,p]),me=he({mutationFn:async s=>{const{error:t}=await l.from("dentist_settings").upsert({clinic_id:s.clinicId,...s.settings,updated_at:new Date().toISOString()},{onConflict:"clinic_id"});if(t)throw t},onSuccess:()=>{j.invalidateQueries({queryKey:["booking-clinics-with-settings-all"]}),q.success("Settings updated successfully"),C(!1)},onError:s=>{q.error(`Failed to update settings: ${s.message}`)}}),xe=he({mutationFn:async()=>{if(!a)return;const s=a.filter(r=>!r.dentist_settings);for(const r of s)await l.from("dentist_settings").upsert({clinic_id:r.id,booking_enabled:!0,allow_same_day_booking:!0,min_advance_booking_hours:2,max_advance_booking_days:60,confirmation_email_enabled:!0,reminder_sms_enabled:!1},{onConflict:"clinic_id"});const{error:t}=await l.from("dentist_settings").update({booking_enabled:!0}).eq("booking_enabled",!1);if(t)throw t},onSuccess:()=>{j.invalidateQueries({queryKey:["booking-clinics-with-settings-all"]}),q.success("Booking enabled for all clinics!")},onError:s=>{q.error(`Failed to enable booking: ${s.message}`)}}),Se=s=>{m(s),C(!0)},Ce=s=>{d&&me.mutate({clinicId:d.id,settings:s})},De=async()=>{P(!0),await Promise.all([I(),ce(),oe(),j.invalidateQueries({queryKey:["booking-funnel-stats"]}),j.invalidateQueries({queryKey:["booking-trend-data"]})]),P(!1),q.success("Data refreshed!")},X=a?.filter(s=>s.dentist_settings?.booking_enabled).length||0,Re=a?.filter(s=>s.claim_status==="claimed").length||0,K=a?.length||0,Y=[{name:"Enabled",value:X,color:"hsl(var(--teal))"},{name:"Disabled",value:K-X,color:"hsl(var(--muted))"}];return G?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(Ue,{className:"h-24 rounded-xl"},s))})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-primary/10 via-teal/10 to-primary/5 p-6 border border-primary/20",children:[e.jsxs("div",{className:"absolute inset-0 opacity-20",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 rounded-full bg-primary blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-1/3 w-48 h-48 rounded-full bg-teal blur-3xl"})]}),e.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-display font-bold text-foreground flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary flex items-center justify-center",children:e.jsx(Ee,{className:"h-6 w-6 text-primary-foreground"})}),"Booking System Control"]}),e.jsxs("p",{className:"text-muted-foreground mt-2",children:["Full control over platform-wide booking settings • ",K.toLocaleString()," clinics"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(v,{onClick:()=>xe.mutate(),disabled:xe.isPending,className:"bg-teal hover:bg-teal/90",children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Enable All"]}),e.jsxs(v,{variant:"outline",onClick:De,disabled:R,className:"border-primary/30",children:[e.jsx(ee,{className:`h-4 w-4 mr-2 ${R?"animate-spin":""}`}),"Refresh"]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(c,{className:"bg-gradient-to-br from-primary/10 to-primary/5 border-primary/20",children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/20 flex items-center justify-center",children:e.jsx(qe,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-primary",children:i?.total?.toLocaleString()||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Bookings"})]})]})})}),e.jsx(c,{className:"bg-gradient-to-br from-amber-500/10 to-amber-500/5 border-amber-500/20",children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-amber-500/20 flex items-center justify-center",children:e.jsx(Fe,{className:"h-6 w-6 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-amber-500",children:i?.pending||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending"})]})]})})}),e.jsx(c,{className:"bg-gradient-to-br from-teal/10 to-teal/5 border-teal/20",children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal/20 flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-teal",children:i?.confirmed||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Confirmed"})]})]})})}),e.jsx(c,{className:"bg-gradient-to-br from-coral/10 to-coral/5 border-coral/20",children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-coral/20 flex items-center justify-center",children:e.jsx(es,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-3xl font-bold text-coral",children:i?.cancelled||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cancelled"})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(c,{children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-purple/10 flex items-center justify-center",children:e.jsx(se,{className:"h-5 w-5 text-purple"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:n?.profileViews?.toLocaleString()||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Profile Views (7d)"})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-blue-500/10 flex items-center justify-center",children:e.jsx(ts,{className:"h-5 w-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:n?.bookingStarts||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Booking Attempts"})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-coral/10 flex items-center justify-center",children:e.jsx(ss,{className:"h-5 w-5 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:n?.formDropoffs||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Form Dropoffs"})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-teal/10 flex items-center justify-center",children:e.jsx(J,{className:"h-5 w-5 text-teal"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-2xl font-bold",children:[n?.conversionRate||0,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Conversion Rate"})]})]})})}),e.jsx(c,{children:e.jsx(o,{className:"pt-5",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-gold/10 flex items-center justify-center",children:e.jsx(xs,{className:"h-5 w-5 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:i?.noShow||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"No-Shows"})]})]})})})]}),e.jsxs(Xe,{value:A,onValueChange:$,children:[e.jsxs(Ye,{className:"grid w-full grid-cols-4 h-12",children:[e.jsxs(z,{value:"overview",className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Overview"]}),e.jsxs(z,{value:"clinics",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Clinic Settings (",K.toLocaleString(),")"]}),e.jsxs(z,{value:"analytics",className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Analytics"]}),e.jsxs(z,{value:"recent",className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Recent Bookings"]})]}),e.jsxs(H,{value:"overview",className:"space-y-6",children:[e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs(c,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5 text-primary"}),"System Overview"]})}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center py-3 border-b",children:[e.jsx("span",{className:"text-muted-foreground",children:"Clinics with Booking Enabled"}),e.jsx(g,{className:"bg-teal text-white text-lg px-3",children:X.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 border-b",children:[e.jsx("span",{className:"text-muted-foreground",children:"Claimed Clinics"}),e.jsx(g,{variant:"outline",className:"text-lg px-3",children:Re.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 border-b",children:[e.jsx("span",{className:"text-muted-foreground",children:"This Week"}),e.jsx(g,{className:"bg-blue-500 text-white text-lg px-3",children:i?.thisWeek||0})]}),e.jsxs("div",{className:"flex justify-between items-center py-3 border-b",children:[e.jsx("span",{className:"text-muted-foreground",children:"This Month"}),e.jsx(g,{className:"bg-purple text-white text-lg px-3",children:i?.thisMonth||0})]}),e.jsxs("div",{className:"flex justify-between items-center py-3",children:[e.jsx("span",{className:"text-muted-foreground",children:"Today"}),e.jsx(g,{className:"bg-gold text-white text-lg px-3",children:i?.today||0})]})]})]}),e.jsxs(c,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-teal"}),"7-Day Trend"]})}),e.jsx(o,{children:e.jsx("div",{className:"h-48",children:e.jsx(ye,{width:"100%",height:"100%",children:e.jsxs(ns,{data:U,children:[e.jsx(ls,{dataKey:"day",axisLine:!1,tickLine:!1}),e.jsx(is,{hide:!0}),e.jsx(we,{content:({active:s,payload:t})=>s&&t&&t.length?e.jsxs("div",{className:"bg-foreground text-background px-3 py-1.5 rounded-lg text-sm font-bold shadow-lg",children:[t[0].value," bookings"]}):null}),e.jsx(rs,{dataKey:"bookings",fill:"hsl(var(--primary))",radius:[6,6,0,0]})]})})})})]}),e.jsxs(c,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-purple"}),"Booking Status"]})}),e.jsxs(o,{children:[e.jsx("div",{className:"h-48 flex items-center justify-center",children:e.jsx(ye,{width:"100%",height:"100%",children:e.jsxs(cs,{children:[e.jsx(os,{data:Y,cx:"50%",cy:"50%",innerRadius:50,outerRadius:70,dataKey:"value",paddingAngle:3,children:Y.map((s,t)=>e.jsx(ds,{fill:s.color},`cell-${t}`))}),e.jsx(we,{})]})})}),e.jsx("div",{className:"flex items-center justify-center gap-4 mt-4",children:Y.map(s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:s.color}}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[s.name,": ",s.value.toLocaleString()]})]},s.name))})]})]})]}),e.jsxs(c,{className:"bg-primary/5 border-primary/20",children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),"Platform Booking Features"]})}),e.jsxs(o,{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-teal mt-0.5"}),e.jsx("span",{children:"Inline calendar booking on clinic & dentist profiles"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-teal mt-0.5"}),e.jsx("span",{children:"GMB-synced clinic hours for accurate time slots"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-teal mt-0.5"}),e.jsx("span",{children:"Email confirmations & SMS reminders"})]})]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-teal mt-0.5"}),e.jsx("span",{children:"Returning patient detection"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-teal mt-0.5"}),e.jsx("span",{children:"Per-clinic booking settings control"})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(S,{className:"h-4 w-4 text-teal mt-0.5"}),e.jsx("span",{children:"Real-time slot locking to prevent double-booking"})]})]})]})]})]}),e.jsx(H,{value:"clinics",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(b,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"}),"All Clinic Booking Settings"]}),e.jsxs(fe,{children:["Showing ",de.length.toLocaleString()," of ",K.toLocaleString()," clinics"]})]}),e.jsxs(o,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Pe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ie,{placeholder:"Search by name, slug, or city...",value:f,onChange:s=>y(s.target.value),className:"pl-10"})]}),e.jsxs(ne,{value:p,onValueChange:s=>W(s),children:[e.jsxs(le,{className:"w-[180px]",children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),e.jsx(ie,{placeholder:"Filter by status"})]}),e.jsxs(re,{children:[e.jsx(F,{value:"all",children:"All Clinics"}),e.jsx(F,{value:"enabled",children:"Booking Enabled"}),e.jsx(F,{value:"disabled",children:"Booking Disabled"})]})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>ce(),children:e.jsx(ee,{className:"h-4 w-4"})})]}),e.jsx(ge,{className:"h-[500px] border rounded-xl",children:ke?e.jsx("div",{className:"p-8 text-center text-muted-foreground",children:"Loading all clinics..."}):e.jsxs(pe,{children:[e.jsx(be,{children:e.jsxs(Q,{className:"bg-muted/50",children:[e.jsx(x,{className:"font-bold",children:"Clinic"}),e.jsx(x,{className:"font-bold",children:"Location"}),e.jsx(x,{className:"font-bold",children:"Status"}),e.jsx(x,{className:"font-bold",children:"Booking"}),e.jsx(x,{className:"font-bold",children:"GMB"}),e.jsx(x,{className:"text-right font-bold",children:"Actions"})]})}),e.jsx(Ne,{children:de.map(s=>e.jsxs(Q,{className:"hover:bg-muted/30",children:[e.jsx(h,{className:"font-medium",children:s.name}),e.jsxs(h,{className:"text-muted-foreground",children:[s.city?.name,s.city?.state?.abbreviation?`, ${s.city.state.abbreviation}`:""]}),e.jsx(h,{children:s.claim_status==="claimed"?e.jsx(g,{className:"bg-teal text-white",children:"Claimed"}):e.jsx(g,{variant:"outline",children:"Unclaimed"})}),e.jsx(h,{children:s.dentist_settings?.booking_enabled?e.jsx(g,{className:"bg-green-500 text-white",children:"Enabled"}):e.jsx(g,{variant:"secondary",children:"Disabled"})}),e.jsx(h,{children:s.gmb_connected?e.jsx(je,{className:"h-4 w-4 text-teal"}):e.jsx(je,{className:"h-4 w-4 text-muted-foreground/30"})}),e.jsx(h,{className:"text-right",children:e.jsxs("div",{className:"flex gap-1 justify-end",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>Se(s),children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"Settings"]}),e.jsx(v,{variant:"ghost",size:"sm",asChild:!0,children:e.jsx(Ze,{to:`/clinic/${s.slug}`,target:"_blank",children:e.jsx(ms,{className:"h-3 w-3"})})})]})})]},s.id))})]})})]})]})}),e.jsx(H,{value:"analytics",className:"space-y-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5 text-primary"}),"Booking Funnel (7 Days)"]})}),e.jsx(o,{className:"space-y-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Profile Views"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:n?.profileViews?.toLocaleString()||0})]}),e.jsx(O,{value:100,className:"h-3"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Booking Started"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n?.bookingStarts||0," (",n?.viewToBookingRate||0,"%)"]})]}),e.jsx(O,{value:n?.viewToBookingRate||0,className:"h-3 [&>div]:bg-blue-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Booking Completed"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[n?.bookingCompletes||0," (",n?.conversionRate||0,"%)"]})]}),e.jsx(O,{value:n?.conversionRate||0,className:"h-3 [&>div]:bg-teal"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-coral",children:"Form Dropoffs"}),e.jsx("span",{className:"text-sm text-coral",children:n?.formDropoffs||0})]}),e.jsx(O,{value:n?.bookingStarts?(n?.formDropoffs||0)/n.bookingStarts*100:0,className:"h-3 [&>div]:bg-coral"})]})]})})]}),e.jsxs(c,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-teal"}),"Conversion Metrics"]})}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-xl text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-primary",children:[n?.viewToBookingRate||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"View → Booking Rate"})]}),e.jsxs("div",{className:"p-4 bg-muted/50 rounded-xl text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-teal",children:[n?.conversionRate||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Completion Rate"})]}),e.jsxs("div",{className:"p-4 bg-muted/50 rounded-xl text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-coral",children:[i?.total?Math.round(i.cancelled/i.total*100):0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Cancellation Rate"})]}),e.jsxs("div",{className:"p-4 bg-muted/50 rounded-xl text-center",children:[e.jsxs("p",{className:"text-4xl font-bold text-gold",children:[i?.total?Math.round(i.noShow/i.total*100):0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"No-Show Rate"})]})]})})]})]})}),e.jsx(H,{value:"recent",className:"space-y-4",children:e.jsxs(c,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-primary"}),"Recent Booking Requests"]}),e.jsx(fe,{children:"Latest 25 booking requests"})]}),e.jsx(v,{variant:"ghost",size:"sm",onClick:()=>oe(),children:e.jsx(ee,{className:"h-4 w-4"})})]}),e.jsx(o,{children:e.jsx(ge,{className:"h-[500px]",children:e.jsxs(pe,{children:[e.jsx(be,{children:e.jsxs(Q,{className:"bg-muted/50",children:[e.jsx(x,{className:"font-bold",children:"Patient"}),e.jsx(x,{className:"font-bold",children:"Clinic"}),e.jsx(x,{className:"font-bold",children:"Date"}),e.jsx(x,{className:"font-bold",children:"Time"}),e.jsx(x,{className:"font-bold",children:"Source"}),e.jsx(x,{className:"font-bold",children:"Status"}),e.jsx(x,{className:"font-bold",children:"Created"})]})}),e.jsx(Ne,{children:_e?.map(s=>e.jsxs(Q,{children:[e.jsx(h,{className:"font-medium",children:s.patient_name}),e.jsx(h,{className:"text-muted-foreground",children:s.clinic?.name||"-"}),e.jsx(h,{children:s.preferred_date||"-"}),e.jsx(h,{children:s.preferred_time||"-"}),e.jsx(h,{children:e.jsx(g,{variant:"outline",className:"text-xs",children:s.source||"direct"})}),e.jsx(h,{children:e.jsx(g,{className:s.status==="confirmed"?"bg-teal text-white":s.status==="cancelled"?"bg-coral text-white":s.status==="no_show"?"bg-gold text-white":"",variant:s.status==="pending"?"secondary":"default",children:s.status})}),e.jsx(h,{className:"text-muted-foreground text-xs",children:E(new Date(s.created_at),"MMM d, h:mm a")})]},s.id))})]})})})]})})]}),e.jsx(Ve,{open:w,onOpenChange:C,children:e.jsxs(ze,{className:"max-w-md",children:[e.jsxs(He,{children:[e.jsx(Oe,{children:"Booking Settings"}),e.jsxs(Qe,{children:["Configure booking settings for ",d?.name]})]}),d&&e.jsx(us,{clinic:d,onSave:Ce,onCancel:()=>C(!1),isLoading:me.isPending})]})})]})}function us({clinic:j,onSave:f,onCancel:y,isLoading:d}){const m=j.dentist_settings,[w,C]=u.useState(m?.booking_enabled??!0),[A,$]=u.useState(m?.allow_same_day_booking??!0),[p,W]=u.useState(m?.min_advance_booking_hours??2),[R,P]=u.useState(m?.max_advance_booking_days??60),[i,G]=u.useState(m?.confirmation_email_enabled??!0),[I,n]=u.useState(m?.reminder_sms_enabled??!1),U=()=>{f({booking_enabled:w,allow_same_day_booking:A,min_advance_booking_hours:p,max_advance_booking_days:R,confirmation_email_enabled:i,reminder_sms_enabled:I})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-muted/50 rounded-lg",children:[e.jsx(D,{htmlFor:"booking-enabled",className:"font-medium",children:"Enable Booking"}),e.jsx(V,{id:"booking-enabled",checked:w,onCheckedChange:C})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-muted/50 rounded-lg",children:[e.jsx(D,{htmlFor:"same-day",className:"font-medium",children:"Allow Same-Day Booking"}),e.jsx(V,{id:"same-day",checked:A,onCheckedChange:$})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"min-hours",children:"Minimum Advance Hours"}),e.jsxs(ne,{value:String(p),onValueChange:a=>W(Number(a)),children:[e.jsx(le,{children:e.jsx(ie,{})}),e.jsx(re,{children:[1,2,4,6,12,24,48].map(a=>e.jsxs(F,{value:String(a),children:[a," hours"]},a))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(D,{htmlFor:"max-days",children:"Maximum Advance Days"}),e.jsxs(ne,{value:String(R),onValueChange:a=>P(Number(a)),children:[e.jsx(le,{children:e.jsx(ie,{})}),e.jsx(re,{children:[7,14,30,60,90,120].map(a=>e.jsxs(F,{value:String(a),children:[a," days"]},a))})]})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(D,{htmlFor:"email-enabled",children:"Email Confirmations"})]}),e.jsx(V,{id:"email-enabled",checked:i,onCheckedChange:G})]}),e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(D,{htmlFor:"sms-enabled",children:"SMS Reminders"})]}),e.jsx(V,{id:"sms-enabled",checked:I,onCheckedChange:n})]}),e.jsxs(Ge,{className:"pt-4",children:[e.jsx(v,{variant:"outline",onClick:y,disabled:d,children:"Cancel"}),e.jsx(v,{onClick:U,disabled:d,className:"bg-primary",children:d?"Saving...":"Save Settings"})]})]})}export{Ks as default};
