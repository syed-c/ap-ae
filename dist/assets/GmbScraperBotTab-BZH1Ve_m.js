import{b as ds,u as se,j as e}from"./chunk-CPh6voF3.js";import{r as o}from"./chunk-CffrGP6S.js";import{f as Qe,u as ms,s as u,i as N,L as Le,y as us,B as P,x as Me,a as te,b7 as ge,a2 as ps,a3 as gs,a5 as hs,a6 as xs,a7 as he,S as ae,p as fs,bA as Be,bC as Oe,G as js,n as ws,C as ys,Z as bs,b as C,bB as _s}from"./index-DflORfjh.js";import{C as T,a as A,b as I,d as L}from"./chunk-Dwq_v72W.js";import{P as Ns}from"./chunk-DSDQubI6.js";import{A as ze,a as Ge}from"./chunk-BY_S87Nl.js";import{S as vs}from"./chunk-FxOzQZIr.js";import{B as Ss}from"./chunk-Bl7VVhKV.js";import{D as Cs}from"./chunk-CedtSHBb.js";import{T as ks}from"./chunk-BRVan1jG.js";import{S as xe}from"./chunk-D0B-jfny.js";import{S as fe}from"./chunk-qKgaU6ML.js";import{T as je}from"./chunk-DbdCK11k.js";import{D as qs}from"./chunk-z-mlRDN4.js";import{S as Ps}from"./chunk-Beq7cUgv.js";import{R as $s}from"./chunk-BOvFDp2b.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=Qe("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fs=Qe("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),K=[{id:"dentist",label:"Dentist"},{id:"dental clinic",label:"Dental Clinic"},{id:"orthodontist",label:"Orthodontist"},{id:"dental surgeon",label:"Dental Surgeon"},{id:"pediatric dentist",label:"Pediatric Dentist"},{id:"cosmetic dentist",label:"Cosmetic Dentist"},{id:"endodontist",label:"Endodontist"},{id:"periodontist",label:"Periodontist"},{id:"prosthodontist",label:"Prosthodontist"},{id:"oral surgeon",label:"Oral Surgeon"},{id:"dental office",label:"Dental Office"},{id:"family dentist",label:"Family Dentist"},{id:"emergency dentist",label:"Emergency Dentist"}];function tt(){const{user:we}=ms(),O=ds(),{data:M}=se({queryKey:["states-active"],queryFn:async()=>{const{data:s}=await u.from("states").select("*").eq("is_active",!0).in("slug",_s).order("name");return s||[]}}),[w,re]=o.useState([]),[k,V]=o.useState([]),[v,ie]=o.useState(["dentist","dental clinic"]),[x,ne]=o.useState(null),[Z,Ue]=o.useState("all"),[H,We]=o.useState(5),{data:_}=se({queryKey:["cities-for-states",w],queryFn:async()=>{if(w.length===0)return[];const{data:s}=await u.from("cities").select("*, state:states(id, name, abbreviation)").in("state_id",w).eq("is_active",!0).order("name");if(!s||s.length===0)return[];const t=s.map(i=>i.id),{data:r}=await u.from("clinics").select("city_id").in("city_id",t).eq("is_active",!0),a=new Map;return(r||[]).forEach(i=>{a.set(i.city_id,(a.get(i.city_id)||0)+1)}),s.map(i=>({...i,dentist_count:a.get(i.id)||0}))},enabled:w.length>0}),$=o.useMemo(()=>{if(!_)return[];switch(Z){case"empty":return _.filter(s=>(s.dentist_count??0)===0);case"with-dentists":return _.filter(s=>(s.dentist_count??0)>0);default:return _}},[_,Z]),{data:Y}=se({queryKey:["gmb-scraper-sessions"],queryFn:async()=>{const{data:s}=await u.from("gmb_scraper_sessions").select("*").order("created_at",{ascending:!1}).limit(10);return s||[]}}),{data:q,refetch:ye}=se({queryKey:["gmb-scraper-results",x],queryFn:async()=>{if(!x)return[];const{data:s}=await u.from("gmb_scraper_results").select("*").eq("session_id",x).order("name");return(s||[]).map(t=>({place_id:t.place_id,name:t.name,address:t.address,rating:t.rating,reviews_count:t.reviews_count,lat:t.lat,lng:t.lng,city_id:t.city_id,city_name:t.city_name,category:t.category,already_imported:t.import_status==="imported"||t.import_status==="duplicate",import_status:t.import_status}))},enabled:!!x,refetchInterval:x?3e3:!1}),[f,B]=o.useState(!1),[z,G]=o.useState(!1),[le,oe]=o.useState([]),[F,J]=o.useState([]),[R,be]=o.useState({current:0,total:0,city:"",phase:""}),[y,X]=o.useState({totalFound:0,newFound:0,imported:0,duplicates:0,errors:0}),[Ke,_e]=o.useState(navigator.onLine),[Ne,ve]=o.useState(""),[Se,Ce]=o.useState(""),ee=o.useRef(!1),S=o.useRef(!1),ke=o.useRef(null),ce=o.useRef(0),qe=()=>++ce.current,p=s=>ee.current||ce.current!==s,Pe=()=>{ee.current=!0,ce.current+=1,S.current=!1},$e=M?.filter(s=>w.includes(s.id))||[],Ve=_?.filter(s=>k.includes(s.id))||[],Ee=s=>{re(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},Ze=()=>{w.length===M?.length?re([]):re(M?.map(s=>s.id)||[])};o.useEffect(()=>{const s=()=>{_e(!0),n("success","üåê Connection restored - resuming...")},t=()=>{_e(!1),n("warning","‚ö†Ô∏è Connection lost - waiting for reconnection...")};return window.addEventListener("online",s),window.addEventListener("offline",t),()=>{window.removeEventListener("online",s),window.removeEventListener("offline",t)}},[]),o.useEffect(()=>{if(q&&q.length>0){J(q);const s=q.filter(i=>i.import_status==="pending").length,t=q.filter(i=>i.import_status==="imported").length,r=q.filter(i=>i.import_status==="duplicate").length,a=q.filter(i=>i.import_status==="error").length;X({totalFound:q.length,newFound:s,imported:t,duplicates:r,errors:a})}},[q]),o.useEffect(()=>{ke.current?.scrollIntoView({behavior:"smooth"})},[le]),o.useEffect(()=>{V([])},[w.length]),o.useEffect(()=>{S.current=z},[z]);const n=o.useCallback((s,t)=>{oe(r=>[...r.slice(-500),{timestamp:new Date,type:s,message:t}])},[]),He=(s,t)=>{const r=new Map;for(const a of s)r.set(a.place_id,a);for(const a of t)r.set(a.place_id,a);return Array.from(r.values())},Ye=()=>{k.length===$?.length?V([]):V($?.map(s=>s.id)||[])},Fe=s=>{V(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},Je=()=>{v.length===K.length?ie([]):ie(K.map(s=>s.id))},Re=s=>{ie(t=>t.includes(s)?t.filter(r=>r!==s):[...t,s])},Xe=async(s=3e5)=>{const t=Date.now();let r=1e3;for(;!navigator.onLine&&Date.now()-t<s;)await new Promise(a=>setTimeout(a,r)),r=Math.min(r*1.5,1e4);return navigator.onLine},De=async(s,t,r=5,a=1e3)=>{let i=null,c=a;for(let l=0;l<r;l++){if(p(t))throw new Error("Operation cancelled");if(!navigator.onLine&&(n("warning","‚è≥ Waiting for network connection..."),!await Xe()))throw new Error("Network timeout - please check your connection");for(;S.current&&!p(t);)await new Promise(d=>setTimeout(d,500));if(p(t))throw new Error("Operation cancelled");try{return await s()}catch(d){if(i=d instanceof Error?d:new Error(String(d)),p(t))throw new Error("Operation cancelled");l<r-1&&(n("warning",`‚ö†Ô∏è Retry ${l+1}/${r} in ${c/1e3}s: ${i.message}`),await new Promise(g=>setTimeout(g,c)),c=Math.min(c*2,3e4))}}throw i||new Error("Max retries exceeded")},es=async(s,t,r,a,i)=>{const c=[];for(const l of a){if(p(i))break;for(;S.current&&!p(i);)await new Promise(g=>setTimeout(g,500));let d=null;for(let g=0;g<H&&!p(i);g++)try{const b=await De(async()=>{const{data:m,error:Q}=await u.functions.invoke("gmb-import",{body:{action:"search",category:l,city:s,state:r,area:"",pageToken:d||void 0}});if(Q)throw Q;if(!m?.success){if(m?.requiresSetup)throw new Error("API key not configured");return{results:[],next_page_token:null}}return m},i),j=(b.results||[]).map(m=>({...m,city_id:t,city_name:s,category:l,import_status:m.already_imported?"duplicate":"pending"}));if(c.push(...j),d=b.next_page_token||null,!d)break;await new Promise(m=>setTimeout(m,2e3))}catch(b){if(p(i))break;n("error",`  ‚úó ${l}: ${b instanceof Error?b.message:"Failed"}`);break}c.length>0&&n("success",`  ‚úì ${l}: ${c.filter(g=>g.category===l).length} found`),await new Promise(g=>setTimeout(g,200))}return c},Te=async(s,t,r,a)=>{try{const i=await De(async()=>{const{data:c,error:l}=await u.functions.invoke("gmb-import",{body:{action:"import",placeIds:[s],cityId:t,sessionId:r}});if(l)throw l;return c},a,3,500);return i?.success?{imported:(i.imported||0)>0,duplicate:(i.duplicates||0)>0}:{imported:!1,duplicate:!1,error:i?.error||"Import failed"}}catch(i){return{imported:!1,duplicate:!1,error:i instanceof Error?i.message:"Unknown error"}}},ss=async(s,t)=>{if(t.length===0)return;const r=t.map(a=>({session_id:s,place_id:a.place_id,name:a.name,address:a.address,rating:a.rating,reviews_count:a.reviews_count,lat:a.lat,lng:a.lng,city_id:a.city_id,city_name:a.city_name,category:a.category,import_status:a.import_status||"pending"}));for(let a=0;a<r.length;a+=500){const i=r.slice(a,a+500);await u.from("gmb_scraper_results").upsert(i,{onConflict:"session_id,place_id",ignoreDuplicates:!0})}},Ae=async(s,t)=>{const r={updated_at:new Date().toISOString()};t.imported!==void 0&&(r.imported_count=t.imported),t.duplicates!==void 0&&(r.duplicate_count=t.duplicates),t.errors!==void 0&&(r.error_count=t.errors),t.total!==void 0&&(r.total_found=t.total),await u.from("gmb_scraper_sessions").update(r).eq("id",s)},ts=async()=>{if(!we){C.error("You must be logged in");return}if(w.length===0||k.length===0){C.error("Please select at least one emirate and area");return}if(v.length===0){C.error("Please select at least one category");return}const s=$e.map(j=>j.name).join(", "),{data:t,error:r}=await u.from("gmb_scraper_sessions").insert({user_id:we.id,state_id:w[0],state_name:s,city_ids:k,categories:v,status:"running"}).select().single();if(r||!t){C.error("Failed to create session"),console.error(r);return}ne(t.id),B(!0),G(!1),ee.current=!1,S.current=!1,oe([]),J([]),X({totalFound:0,newFound:0,imported:0,duplicates:0,errors:0});const a=qe();Ce(s);const i=[...Ve];n("info",`ü§ñ Starting bot for ${s}`),n("info",`üìä ${i.length} areas, ${v.length} categories`),n("info","üíæ Auto-save enabled - progress persists even if connection drops"),n("info","üìç Using precise lat/lng matching (10km radius) for accurate area assignment in UAE");let c=0,l=0,d=0,g=0;for(let j=0;j<i.length;j++){const m=i[j];if(p(a)){n("warning","‚õî Bot stopped by user");break}for(;S.current&&!p(a);)await new Promise(h=>setTimeout(h,500));if(p(a))break;ve(m.name),be({current:j+1,total:i.length,city:m.name,phase:"Searching"}),n("info",`
üìç [${j+1}/${i.length}] ${m.name}`),n("info","  üîç Searching...");const Q=m.state,cs=Q?.abbreviation||Q?.name||"",U=(await es(m.name,m.id,cs,v,a)).reduce((h,E)=>(h.find(W=>W.place_id===E.place_id)||h.push(E),h),[]),D=U.filter(h=>h.import_status==="pending");if(g+=U.length,n("success",`  üìä Found ${U.length} total, ${D.length} new`),await ss(t.id,U),J(h=>He(h,U)),D.length===0){n("info","  ‚è≠Ô∏è No new listings to import, moving to next city");continue}be(h=>({...h,phase:"Importing"})),n("info",`  ‚¨áÔ∏è Importing ${D.length} listings...`);let de=0,me=0,ue=0;for(let h=0;h<D.length&&!p(a);h++){for(;S.current&&!p(a);)await new Promise(pe=>setTimeout(pe,500));if(p(a))break;const E=D[h];await u.from("gmb_scraper_results").update({import_status:"importing"}).eq("session_id",t.id).eq("place_id",E.place_id);const W=await Te(E.place_id,m.id,t.id,a);W.imported?(de++,await u.from("gmb_scraper_results").update({import_status:"imported"}).eq("session_id",t.id).eq("place_id",E.place_id)):W.duplicate?(me++,await u.from("gmb_scraper_results").update({import_status:"duplicate"}).eq("session_id",t.id).eq("place_id",E.place_id)):(ue++,await u.from("gmb_scraper_results").update({import_status:"error",error_message:W.error}).eq("session_id",t.id).eq("place_id",E.place_id)),((h+1)%10===0||h===D.length-1)&&(c+=de,l+=me,d+=ue,X({totalFound:g,newFound:g-c-l,imported:c,duplicates:l,errors:d}),await Ae(t.id,{total:g,imported:c,duplicates:l,errors:d}),de=0,me=0,ue=0,n("info",`    üìà Progress: ${h+1}/${D.length} processed`)),await new Promise(pe=>setTimeout(pe,100))}n("success",`  ‚úÖ ${m.name} complete!`),ye()}await u.from("gmb_scraper_sessions").update({status:p(a)?"cancelled":"completed",total_found:g,imported_count:c,duplicate_count:l,error_count:d,updated_at:new Date().toISOString()}).eq("id",t.id),O.invalidateQueries({queryKey:["gmb-scraper-sessions"]}),O.invalidateQueries({queryKey:["clinics"]}),n("success",`
üéâ Bot completed!`),n("success",`   Total found: ${g}`),n("success",`   Imported: ${c}`),n("success",`   Duplicates: ${l}`),n("success",`   Errors: ${d}`),B(!1),ve("");const b=$e.map(j=>j.name).join(", ")||"selected states";C.success(`Imported ${c} clinics from ${b}!`)},as=async()=>{if(!x){C.error("No session selected");return}const s=F.filter(l=>l.import_status==="pending");if(s.length===0){C.info("No pending listings to import");return}B(!0),G(!1),ee.current=!1,S.current=!1;const t=qe();n("info",`‚ñ∂Ô∏è Resuming import of ${s.length} pending listings...`);const r=new Map;for(const l of s){const d=l.city_id||"unknown";r.has(d)||r.set(d,[]),r.get(d).push(l)}let a=y.imported,i=y.duplicates,c=y.errors;for(const[l,d]of r){if(p(t))break;const g=d[0]?.city_name||"Unknown";n("info",`üìç Processing ${g} (${d.length} pending)...`);for(const b of d){if(p(t))break;for(;S.current&&!p(t);)await new Promise(m=>setTimeout(m,500));if(p(t))break;await u.from("gmb_scraper_results").update({import_status:"importing"}).eq("session_id",x).eq("place_id",b.place_id);const j=await Te(b.place_id,l,x,t);j.imported?(a++,await u.from("gmb_scraper_results").update({import_status:"imported"}).eq("session_id",x).eq("place_id",b.place_id)):j.duplicate?(i++,await u.from("gmb_scraper_results").update({import_status:"duplicate"}).eq("session_id",x).eq("place_id",b.place_id)):(c++,await u.from("gmb_scraper_results").update({import_status:"error",error_message:j.error}).eq("session_id",x).eq("place_id",b.place_id)),X({totalFound:y.totalFound,newFound:y.totalFound-a-i,imported:a,duplicates:i,errors:c}),await new Promise(m=>setTimeout(m,100))}}await Ae(x,{imported:a,duplicates:i,errors:c}),O.invalidateQueries({queryKey:["gmb-scraper-sessions"]}),O.invalidateQueries({queryKey:["clinics"]}),ye(),n("success",`‚úÖ Resume complete! Imported: ${a}, Duplicates: ${i}, Errors: ${c}`),B(!1),C.success("Import resumed and completed!")},rs=async s=>{ne(s),oe([]),n("info",`üìÇ Loading session ${s.slice(0,8)}...`);const t=Y?.find(r=>r.id===s);t&&(n("success",`‚úì Loaded ${t.state_name} session with ${t.total_found} results`),n("info",`   Imported: ${t.imported_count}, Duplicates: ${t.duplicate_count}`))},is=async s=>{if(window.confirm("Are you sure you want to delete this session and all its results? This action cannot be undone.")){x===s&&f&&(Pe(),B(!1),G(!1),n("warning","‚õî Session deleted - bot stopped"));try{const{error:t}=await u.from("gmb_scraper_results").delete().eq("session_id",s);if(t)throw console.error("Error deleting results:",t),t;const{error:r}=await u.from("gmb_scraper_sessions").delete().eq("id",s);if(r)throw console.error("Error deleting session:",r),r;x===s&&(ne(null),J([])),O.invalidateQueries({queryKey:["gmb-scraper-sessions"]}),C.success("Session deleted successfully")}catch(t){console.error("Delete session error:",t),C.error(`Failed to delete session: ${t.message||"Unknown error"}`)}}},ns=()=>{Pe(),B(!1),G(!1),Ce(""),n("warning","‚õî Bot stopped by user")},ls=()=>{G(s=>(S.current=!s,s?n("info","‚ñ∂Ô∏è Resuming..."):n("info","‚è∏Ô∏è Paused - click Resume to continue"),!s))},os=R.total>0?R.current/R.total*100:0,Ie=F.filter(s=>s.import_status==="pending").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-display font-bold text-foreground flex items-center gap-3",children:[e.jsx(Ss,{className:"h-8 w-8 text-primary"}),"GMB Scraper Bot"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Search and import dentists city-by-city with auto-save"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f&&Se&&e.jsxs(N,{variant:"default",className:"text-sm px-3 py-1 bg-primary animate-pulse",children:[e.jsx(Le,{className:"h-3 w-3 mr-1 animate-spin"}),"Scraping: ",Se," / ",Ne||"Starting..."]}),Ke?e.jsxs(N,{variant:"outline",className:"text-green-600 border-green-600",children:[e.jsx(Fs,{className:"h-3 w-3 mr-1"}),"Online"]}):e.jsxs(N,{variant:"destructive",children:[e.jsx(Es,{className:"h-3 w-3 mr-1"}),"Offline"]}),e.jsxs(N,{variant:"outline",className:"text-lg px-4 py-2",children:[e.jsx(us,{className:"h-4 w-4 mr-2"}),"Auto-Import"]})]})]}),Y&&Y.length>0&&e.jsxs(T,{className:"card-modern",children:[e.jsx(A,{className:"pb-3",children:e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx(Cs,{className:"h-5 w-5"}),"Previous Sessions"]})}),e.jsx(L,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Y.map(s=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs(P,{variant:x===s.id?"default":"outline",size:"sm",onClick:()=>rs(s.id),className:"gap-2",children:[e.jsx(Me,{className:"h-3 w-3"}),s.state_name," (",s.total_found,")",e.jsxs(N,{variant:"secondary",className:"ml-1 text-xs",children:[s.imported_count,"/",s.total_found]})]}),e.jsx(P,{variant:"ghost",size:"icon",className:"h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10",onClick:t=>{t.stopPropagation(),t.preventDefault(),is(s.id)},children:e.jsx(ks,{className:"h-3 w-3"})})]},s.id))})})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsxs(T,{className:"card-modern lg:col-span-2",children:[e.jsx(A,{children:e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5"}),"Location Selection"]})}),e.jsxs(L,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{children:["Select States (",w.length," of ",M?.length||0,")"]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:Ze,disabled:f,className:"gap-2",children:w.length===M?.length?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4"})," Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4"})," Select All"]})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 p-3 border rounded-xl bg-muted/20",children:M?.map(s=>e.jsxs("div",{className:`flex items-center gap-2 px-3 py-2 rounded-lg cursor-pointer transition-colors ${w.includes(s.id)?"bg-primary/10 border border-primary/30":"hover:bg-muted/50 border border-transparent"}`,onClick:()=>!f&&Ee(s.id),children:[e.jsx(ge,{checked:w.includes(s.id),disabled:f,onCheckedChange:()=>Ee(s.id)}),e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsx(N,{variant:"secondary",className:"text-xs",children:s.abbreviation||""})]},s.id))})]}),_&&_.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(te,{children:["Cities (",k.length," of ",$.length,")"]}),e.jsxs(ps,{value:Z,onValueChange:s=>Ue(s),disabled:f,children:[e.jsx(gs,{className:"w-[180px] h-8",children:e.jsx(hs,{})}),e.jsxs(xs,{children:[e.jsxs(he,{value:"all",children:["All Cities (",_.length,")"]}),e.jsxs(he,{value:"empty",children:["üî¥ Empty - No Dentists (",_.filter(s=>(s.dentist_count??0)===0).length,")"]}),e.jsxs(he,{value:"with-dentists",children:["üü¢ With Dentists (",_.filter(s=>(s.dentist_count??0)>0).length,")"]})]})]})]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:Ye,disabled:f,className:"gap-2",children:k.length===$.length&&$.length>0?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4"})," Deselect All"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4"})," Select All"]})})]}),Z==="empty"&&$.length>0&&e.jsxs(ze,{className:"bg-amber-500/10 border-amber-500/30",children:[e.jsx(je,{className:"h-4 w-4 text-amber-600"}),e.jsxs(Ge,{className:"text-amber-700 text-sm",children:["Showing ",$.length," cities with zero dentists. Select these to scrape and populate them."]})]}),e.jsx(ae,{className:"h-48 border rounded-xl p-3",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2",children:$.map(s=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg cursor-pointer transition-colors ${k.includes(s.id)?"bg-primary/10 border border-primary/30":"hover:bg-muted/50"}`,onClick:()=>!f&&Fe(s.id),children:[e.jsx(ge,{checked:k.includes(s.id),disabled:f,onCheckedChange:()=>Fe(s.id)}),e.jsx("span",{className:"text-sm truncate",children:s.name}),e.jsx(N,{variant:(s.dentist_count??0)===0?"destructive":"secondary",className:"text-xs ml-auto",children:s.dentist_count??0})]},s.id))})})]})]})]}),e.jsxs(T,{className:"card-modern",children:[e.jsx(A,{children:e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx(fs,{className:"h-5 w-5"}),"Categories"]})}),e.jsxs(L,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(te,{className:"text-sm text-muted-foreground",children:[v.length," of ",K.length]}),e.jsx(P,{variant:"ghost",size:"sm",onClick:Je,disabled:f,className:"gap-2",children:v.length===K.length?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"h-4 w-4"})," None"]}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{className:"h-4 w-4"})," All"]})})]}),e.jsx(ae,{className:"h-64",children:e.jsx("div",{className:"space-y-2",children:K.map(s=>e.jsxs("div",{className:`flex items-center gap-2 p-2 rounded-lg cursor-pointer transition-colors ${v.includes(s.id)?"bg-primary/10 border border-primary/30":"hover:bg-muted/50"}`,onClick:()=>!f&&Re(s.id),children:[e.jsx(ge,{checked:v.includes(s.id),disabled:f,onCheckedChange:()=>Re(s.id)}),e.jsx("span",{className:"text-sm",children:s.label})]},s.id))})})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(T,{className:"card-modern",children:[e.jsx(A,{children:e.jsx(I,{className:"text-lg",children:"Bot Controls"})}),e.jsxs(L,{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-wrap gap-3",children:f?e.jsxs(e.Fragment,{children:[e.jsxs(P,{onClick:ls,variant:"outline",className:"gap-2",children:[z?e.jsx(Be,{className:"h-4 w-4"}):e.jsx(Oe,{className:"h-4 w-4"}),z?"Resume":"Pause"]}),e.jsxs(P,{onClick:ns,variant:"destructive",className:"gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Stop"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(P,{onClick:ts,disabled:k.length===0||v.length===0,className:"gap-2",children:[e.jsx(Be,{className:"h-4 w-4"}),"Start New Search"]}),x&&Ie>0&&e.jsxs(P,{onClick:as,variant:"outline",className:"gap-2",children:[e.jsx(qs,{className:"h-4 w-4"}),"Resume Import (",Ie,")"]})]})}),!f&&e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/20 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(te,{className:"text-sm font-medium",children:"Pagination Settings"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Max pages per category"}),e.jsxs("span",{className:"font-medium",children:[H," pages (",H*20," results max)"]})]}),e.jsx(vs,{value:[H],onValueChange:([s])=>We(s),min:1,max:10,step:1,className:"w-full"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Google limits 20 results per page. Increase to search beyond the initial results."})]})]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"font-medium",children:[R.phase,": ",Ne||R.city]}),e.jsxs("span",{children:["City ",R.current,"/",R.total]})]}),e.jsx(Ns,{value:os}),z&&e.jsxs(N,{variant:"outline",className:"text-amber-600",children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"})," Paused"]})]})]})]}),e.jsxs(T,{className:"card-modern",children:[e.jsx(A,{children:e.jsx(I,{className:"text-lg",children:"Statistics"})}),e.jsx(L,{children:e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"p-3 bg-muted/30 rounded-xl text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:y.totalFound}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Found"})]}),e.jsxs("div",{className:"p-3 bg-green-500/10 rounded-xl text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y.imported}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Imported"})]}),e.jsxs("div",{className:"p-3 bg-blue-500/10 rounded-xl text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y.newFound}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Pending"})]}),e.jsxs("div",{className:"p-3 bg-amber-500/10 rounded-xl text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:y.duplicates}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Duplicates"})]}),e.jsxs("div",{className:"p-3 bg-red-500/10 rounded-xl text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-600",children:y.errors}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Errors"})]}),e.jsxs("div",{className:"p-3 bg-purple-500/10 rounded-xl text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[y.totalFound>0?Math.round(y.imported/y.totalFound*100):0,"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Complete"})]})]})})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(T,{className:"card-modern",children:[e.jsx(A,{children:e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx($s,{className:"h-5 w-5"}),"Activity Log"]})}),e.jsx(L,{children:e.jsx(ae,{className:"h-80 border rounded-xl p-3 bg-muted/20",children:le.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground",children:"No activity yet. Start the bot to begin."}):e.jsxs("div",{className:"space-y-1 font-mono text-sm",children:[le.map((s,t)=>e.jsxs("div",{className:`flex gap-2 ${s.type==="error"?"text-red-500":s.type==="warning"?"text-amber-500":s.type==="success"?"text-green-500":"text-muted-foreground"}`,children:[e.jsx("span",{className:"text-xs opacity-50 shrink-0",children:s.timestamp.toLocaleTimeString()}),e.jsx("span",{className:"whitespace-pre-wrap",children:s.message})]},t)),e.jsx("div",{ref:ke})]})})})]}),e.jsxs(T,{className:"card-modern",children:[e.jsx(A,{children:e.jsxs(I,{className:"text-lg flex items-center gap-2",children:[e.jsx(js,{className:"h-5 w-5"}),"Listings (",F.length,")"]})}),e.jsx(L,{children:e.jsx(ae,{className:"h-80 border rounded-xl",children:F.length===0?e.jsx("div",{className:"flex items-center justify-center h-full text-muted-foreground p-4",children:"No listings yet. Start a search or load a session."}):e.jsxs("div",{className:"divide-y",children:[F.slice(0,100).map(s=>e.jsx("div",{className:`p-3 ${s.import_status==="imported"?"bg-green-500/5":s.import_status==="duplicate"?"bg-amber-500/5":s.import_status==="error"?"bg-red-500/5":s.import_status==="importing"?"bg-blue-500/5":""}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:s.name}),e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.address}),s.city_name&&e.jsx("div",{className:"text-xs text-primary",children:s.city_name})]}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[s.rating&&e.jsxs(N,{variant:"secondary",className:"gap-1 text-xs",children:[e.jsx(ws,{className:"h-3 w-3 fill-amber-400 text-amber-400"}),s.rating]}),s.import_status==="imported"?e.jsx(ys,{className:"h-4 w-4 text-green-500"}):s.import_status==="duplicate"?e.jsx(N,{variant:"outline",className:"text-amber-600 text-xs",children:"Dup"}):s.import_status==="error"?e.jsx(je,{className:"h-4 w-4 text-red-500"}):s.import_status==="importing"?e.jsx(Le,{className:"h-4 w-4 animate-spin text-blue-500"}):e.jsx(N,{variant:"outline",className:"text-blue-600 text-xs",children:"New"})]})]})},s.place_id)),F.length>100&&e.jsxs("div",{className:"p-3 text-center text-sm text-muted-foreground",children:["... and ",F.length-100," more"]})]})})})]})]}),e.jsxs(ze,{children:[e.jsx(bs,{className:"h-4 w-4"}),e.jsxs(Ge,{children:[e.jsx("strong",{children:"Smart Multi-State Import:"})," Select multiple states and cities in one run. The bot uses precise GPS coordinates (lat/lng) to assign each dentist to their exact city - not nearby areas. Progress is auto-saved continuously, so you can pause/stop anytime and resume later. The bot will wait for network reconnection if connection drops."]})]})]})}export{tt as default};
