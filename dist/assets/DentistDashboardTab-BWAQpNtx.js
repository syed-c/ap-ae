import{u as k,j as e,b as fe,c as Re}from"./chunk-CPh6voF3.js";import{r as E}from"./chunk-CffrGP6S.js";import{c as De,L as Fe}from"./chunk-Drd-rt-S.js";import{S as je,t as I,m as B,i as b,s as u,l as N,T as U,J as Pe,K as Te,N as Me,B as y,O as $e,y as X,n as L,Y as K,bk as me,a8 as Ge,P as oe,Q as Le,C as S,x as re,A as we,G as O,o as V,U as le,$ as ce,Z as Q,L as Z,a as Be,I as Ee,b as z,u as Ve,w as xe}from"./index-DflORfjh.js";import{C as j,a as D,b as F,d as w,c as Ue}from"./chunk-Dwq_v72W.js";import{S as A}from"./chunk-CQtADEjB.js";import{L as Oe}from"./chunk-CDkOFsI-.js";import{A as Ke}from"./chunk-Cq66vzLV.js";import{P as J}from"./chunk-DSDQubI6.js";import{A as W,B as he,S as ze}from"./chunk-C2VW2Ml6.js";import{U as Ye}from"./chunk-D2X27E5n.js";import{M as ee}from"./chunk-B7d2qnKb.js";import{T as te,a as de}from"./chunk-BLd3XU4A.js";import{f as Ie}from"./chunk-CyRXX0qx.js";import{T as Y}from"./chunk-C76wK-Kz.js";import{A as We}from"./chunk-B0DPEAZ9.js";import{s as pe}from"./chunk-aAsotRsv.js";import{C as Ne}from"./chunk-CbEmr7WL.js";import{C as ve}from"./chunk-GLPyMM0F.js";import{p as He}from"./chunk-CaZUr2rj.js";import{i as Qe,a as Ze}from"./chunk-CJX3t94M.js";import{F as ie}from"./chunk-BaL04tya.js";import{I as ge}from"./chunk-DZK1lt0q.js";import{s as Je}from"./chunk-C_nua8Pg.js";import{S as H}from"./chunk-DfjE-bP6.js";import{S as ae}from"./chunk-CzOt8Wyl.js";import{S as Xe}from"./chunk-C7BdFRQZ.js";import{R as ye}from"./chunk-BOvFDp2b.js";import{T as _e}from"./chunk-DbdCK11k.js";import{L as Ce}from"./chunk-DR32GIZ2.js";import{Q as ke}from"./chunk-I5uVO93-.js";import{P as ne}from"./chunk-HAC-i_a2.js";import{E as Se}from"./chunk-CcezodbN.js";import{S as et}from"./chunk-B51FxpoB.js";import{C as be}from"./chunk-j7XJPWWF.js";import{A as qe}from"./chunk-bmpXwoJk.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-fofMllkR.js";import"./chunk-DncHrJ4I.js";function tt({clinicId:i,maxItems:m=10}){const{data:s,isLoading:o}=k({queryKey:["activity-feed",i],queryFn:async()=>{const d=new Date,g=new Date(d.getTime()-7*24*60*60*1e3),[l,x,n]=await Promise.all([u.from("appointments").select("id, patient_name, status, created_at").eq("clinic_id",i).gte("created_at",g.toISOString()).order("created_at",{ascending:!1}).limit(20),u.from("review_funnel_events").select("id, event_type, rating, created_at").eq("clinic_id",i).gte("created_at",g.toISOString()).order("created_at",{ascending:!1}).limit(20),u.from("clinic_messages").select("id, recipient_phone, status, channel, created_at").eq("clinic_id",i).gte("created_at",g.toISOString()).order("created_at",{ascending:!1}).limit(20)]),t=[];return(l.data||[]).forEach(c=>{t.push({id:`apt-${c.id}`,type:"appointment",title:"New Appointment",description:`${c.patient_name} requested a booking`,timestamp:c.created_at,status:c.status})}),(x.data||[]).forEach(c=>{t.push({id:`funnel-${c.id}`,type:"funnel",title:c.event_type==="thumbs_up"?"Positive Feedback":"Feedback Received",description:c.event_type==="thumbs_up"?"Patient redirected to Google Reviews":`Patient left ${c.rating||"N/A"}-star private feedback`,timestamp:c.created_at,metadata:{event_type:c.event_type,rating:c.rating}})}),(n.data||[]).forEach(c=>{t.push({id:`msg-${c.id}`,type:"message",title:`${c.channel?.toUpperCase()||"SMS"} Sent`,description:`Message to ${c.recipient_phone.slice(-4).padStart(c.recipient_phone.length,"*")}`,timestamp:c.created_at,status:c.status})}),t.sort((c,f)=>new Date(f.timestamp).getTime()-new Date(c.timestamp).getTime()),t.slice(0,m)},enabled:!!i,refetchInterval:3e4}),a=(d,g)=>{switch(d){case"appointment":return e.jsx(B,{className:"h-4 w-4 text-primary"});case"funnel":return g?.event_type==="thumbs_up"?e.jsx(te,{className:"h-4 w-4 text-teal"}):e.jsx(de,{className:"h-4 w-4 text-coral"});case"message":return e.jsx(ee,{className:"h-4 w-4 text-purple"});case"lead":return e.jsx(Ye,{className:"h-4 w-4 text-gold"});default:return e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})}},r=d=>{if(!d)return null;switch(d){case"pending":return e.jsx(b,{variant:"outline",className:"bg-gold/10 text-gold border-gold/20 text-xs",children:"Pending"});case"confirmed":return e.jsx(b,{variant:"outline",className:"bg-teal/10 text-teal border-teal/20 text-xs",children:"Confirmed"});case"completed":return e.jsx(b,{variant:"outline",className:"bg-primary/10 text-primary border-primary/20 text-xs",children:"Completed"});case"sent":case"delivered":return e.jsx(b,{variant:"outline",className:"bg-teal/10 text-teal border-teal/20 text-xs",children:"Sent"});case"failed":return e.jsx(b,{variant:"outline",className:"bg-coral/10 text-coral border-coral/20 text-xs",children:"Failed"});default:return e.jsx(b,{variant:"outline",className:"text-xs",children:d})}};return o?e.jsxs(j,{className:"card-modern",children:[e.jsx(D,{className:"pb-3",children:e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),"Recent Activity"]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5].map(d=>e.jsx(A,{className:"h-14"},d))})})]}):e.jsxs(j,{className:"card-modern",children:[e.jsx(D,{className:"pb-3",children:e.jsxs(F,{className:"text-lg flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),"Recent Activity"]})}),e.jsx(w,{children:e.jsx(je,{className:"h-[300px] pr-4",children:s&&s.length>0?e.jsx("div",{className:"space-y-3",children:s.map(d=>e.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-lg bg-muted/30 hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-card border flex items-center justify-center flex-shrink-0",children:a(d.type,d.metadata)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:d.title}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:d.description})]}),r(d.status)]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1 flex items-center gap-1",children:[e.jsx(I,{className:"h-3 w-3"}),Ie(new Date(d.timestamp),{addSuffix:!0})]})]})]},d.id))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full py-8 text-center",children:[e.jsx(W,{className:"h-10 w-10 text-muted-foreground/50 mb-2"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No recent activity"})]})})})]})}const st={primary:"bg-gradient-to-br from-primary to-primary/80",teal:"bg-gradient-to-br from-teal to-emerald",gold:"bg-gradient-to-br from-gold to-amber-500",coral:"bg-gradient-to-br from-coral to-pink",purple:"bg-gradient-to-br from-purple to-indigo",blue:"bg-gradient-to-br from-blue-custom to-cyan",emerald:"bg-gradient-to-br from-emerald to-teal",pink:"bg-gradient-to-br from-pink to-rose-400",cyan:"bg-gradient-to-br from-cyan to-teal",indigo:"bg-gradient-to-br from-indigo to-purple"},at={primary:"bg-card border-2 border-primary/30 hover:border-primary/50",teal:"bg-card border-2 border-teal/30 hover:border-teal/50",gold:"bg-card border-2 border-gold/30 hover:border-gold/50",coral:"bg-card border-2 border-coral/30 hover:border-coral/50",purple:"bg-card border-2 border-purple/30 hover:border-purple/50",blue:"bg-card border-2 border-blue-custom/30 hover:border-blue-custom/50",emerald:"bg-card border-2 border-emerald/30 hover:border-emerald/50",pink:"bg-card border-2 border-pink/30 hover:border-pink/50",cyan:"bg-card border-2 border-cyan/30 hover:border-cyan/50",indigo:"bg-card border-2 border-indigo/30 hover:border-indigo/50"},rt={primary:"bg-white/80 backdrop-blur-xl border border-primary/20 shadow-lg shadow-primary/5",teal:"bg-white/80 backdrop-blur-xl border border-teal/20 shadow-lg shadow-teal/5",gold:"bg-white/80 backdrop-blur-xl border border-gold/20 shadow-lg shadow-gold/5",coral:"bg-white/80 backdrop-blur-xl border border-coral/20 shadow-lg shadow-coral/5",purple:"bg-white/80 backdrop-blur-xl border border-purple/20 shadow-lg shadow-purple/5",blue:"bg-white/80 backdrop-blur-xl border border-blue-custom/20 shadow-lg shadow-blue-custom/5",emerald:"bg-white/80 backdrop-blur-xl border border-emerald/20 shadow-lg shadow-emerald/5",pink:"bg-white/80 backdrop-blur-xl border border-pink/20 shadow-lg shadow-pink/5",cyan:"bg-white/80 backdrop-blur-xl border border-cyan/20 shadow-lg shadow-cyan/5",indigo:"bg-white/80 backdrop-blur-xl border border-indigo/20 shadow-lg shadow-indigo/5"},lt={primary:"bg-primary/15 text-primary",teal:"bg-teal/15 text-teal",gold:"bg-gold/15 text-gold",coral:"bg-coral/15 text-coral",purple:"bg-purple/15 text-purple",blue:"bg-blue-custom/15 text-blue-custom",emerald:"bg-emerald/15 text-emerald",pink:"bg-pink/15 text-pink",cyan:"bg-cyan/15 text-cyan",indigo:"bg-indigo/15 text-indigo"},it={primary:"text-primary",teal:"text-teal",gold:"text-gold",coral:"text-coral",purple:"text-purple",blue:"text-blue-custom",emerald:"text-emerald",pink:"text-pink",cyan:"text-cyan",indigo:"text-indigo"},nt={primary:"bg-gradient-to-r from-primary to-teal",teal:"bg-gradient-to-r from-teal to-emerald",gold:"bg-gradient-to-r from-gold to-amber-500",coral:"bg-gradient-to-r from-coral to-pink",purple:"bg-gradient-to-r from-purple to-indigo",blue:"bg-gradient-to-r from-blue-custom to-cyan",emerald:"bg-gradient-to-r from-emerald to-teal",pink:"bg-gradient-to-r from-pink to-coral",cyan:"bg-gradient-to-r from-cyan to-teal",indigo:"bg-gradient-to-r from-indigo to-purple"};function ot({stats:i,variant:m="default"}){const s=a=>{switch(m){case"vibrant":return st[a];case"glass":return rt[a];default:return at[a]}},o=m==="vibrant";return e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:i.map((a,r)=>{const d=a.icon;return e.jsxs("div",{onClick:a.onClick,className:N("group relative overflow-hidden rounded-2xl p-4 transition-all duration-300",s(a.color),a.onClick&&"cursor-pointer hover:scale-[1.03] active:scale-[0.98]",o?"text-white shadow-lg hover:shadow-xl":"shadow-sm hover:shadow-md","animate-fade-in"),style:{animationDelay:`${r*60}ms`},children:[o&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent pointer-events-none"}),e.jsx("div",{className:N("absolute -right-6 -top-6 w-20 h-20 rounded-full opacity-20 blur-2xl",o?"bg-white":"bg-current")}),e.jsx("div",{className:N("h-11 w-11 rounded-xl flex items-center justify-center mb-3 transition-transform group-hover:scale-110",o?"bg-white/20":lt[a.color]),children:e.jsx(d,{className:N("h-5 w-5",o?"text-white":"")})}),e.jsxs("div",{className:"space-y-1 relative z-10",children:[e.jsx("p",{className:N("text-2xl font-extrabold tracking-tight",o?"text-white":it[a.color]),children:typeof a.value=="number"?a.value.toLocaleString():a.value}),e.jsx("p",{className:N("text-xs font-bold uppercase tracking-wide",o?"text-white/90":"text-foreground"),children:a.label}),a.subtitle&&e.jsx("p",{className:N("text-[11px] font-medium",o?"text-white/70":"text-muted-foreground"),children:a.subtitle})]}),a.progress!==void 0&&e.jsx("div",{className:N("mt-3 h-1.5 w-full rounded-full overflow-hidden",o?"bg-white/20":"bg-muted"),children:e.jsx("div",{className:N("h-full rounded-full transition-all duration-700",o?"bg-white":nt[a.color]),style:{width:`${Math.min(100,a.progress)}%`}})}),a.trend!==void 0&&e.jsxs("div",{className:N("mt-2 flex items-center gap-1 text-xs font-bold",o?"text-white/90":a.trend>=0?"text-emerald":"text-coral"),children:[a.trend>=0?e.jsx(U,{className:"h-3.5 w-3.5"}):e.jsx(Y,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[a.trend>=0?"+":"",a.trend,"%"]})]}),a.onClick&&e.jsx("div",{className:N("absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",o?"text-white/50":"text-muted-foreground/50"),children:e.jsx(We,{className:"h-4 w-4"})})]},r)})})}const ct={default:"bg-card hover:bg-muted border-border text-foreground",primary:"bg-primary/10 hover:bg-primary/20 border-primary/30 text-primary",teal:"bg-teal/10 hover:bg-teal/20 border-teal/30 text-teal",gold:"bg-gold/10 hover:bg-gold/20 border-gold/30 text-gold",coral:"bg-coral/10 hover:bg-coral/20 border-coral/30 text-coral"};function dt({actions:i,className:m}){return e.jsx(Pe,{children:e.jsx("div",{className:N("sticky top-0 z-30 bg-background/95 backdrop-blur-xl border-b border-border -mx-6 px-6 py-3",m),children:e.jsx("div",{className:"flex items-center gap-2 overflow-x-auto scrollbar-hide pb-1",children:i.map((s,o)=>{const a=s.icon,r=s.variant||"default";return e.jsxs(Te,{children:[e.jsx(Me,{asChild:!0,children:e.jsxs(y,{variant:"outline",size:"sm",onClick:s.onClick,disabled:s.disabled,className:N("relative flex items-center gap-2 rounded-full px-4 py-2 h-auto border transition-all duration-200 whitespace-nowrap font-semibold text-sm",ct[r],s.disabled&&"opacity-50 cursor-not-allowed"),children:[e.jsx(a,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:s.label}),s.badge&&e.jsx("span",{className:"absolute -top-1 -right-1 h-4 min-w-4 px-1 rounded-full bg-coral text-white text-[10px] font-bold flex items-center justify-center",children:s.badge})]})}),e.jsx($e,{children:e.jsx("p",{children:s.label})})]},o)})})})})}function mt({clinicId:i,rating:m=0,reviewCount:s=0,onViewDetails:o}){const{data:a,isLoading:r}=k({queryKey:["reputation-widget",i],queryFn:async()=>{const t=me(pe(new Date,30)).toISOString(),c=me(pe(new Date,7)).toISOString(),[f,P,q]=await Promise.all([u.from("review_funnel_events").select("event_type").eq("clinic_id",i),u.from("review_funnel_events").select("event_type").eq("clinic_id",i).gte("created_at",t),u.from("review_funnel_events").select("event_type").eq("clinic_id",i).gte("created_at",c)]),M=f.data||[],C=P.data||[],T=q.data||[];return{allTime:{thumbsUp:M.filter(_=>_.event_type==="thumbs_up").length,thumbsDown:M.filter(_=>_.event_type==="thumbs_down").length,total:M.length},last30:{thumbsUp:C.filter(_=>_.event_type==="thumbs_up").length,thumbsDown:C.filter(_=>_.event_type==="thumbs_down").length,total:C.length},last7:{thumbsUp:T.filter(_=>_.event_type==="thumbs_up").length,thumbsDown:T.filter(_=>_.event_type==="thumbs_down").length,total:T.length}}},enabled:!!i});if(r)return e.jsx(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:e.jsx(w,{className:"p-6",children:e.jsx(A,{className:"h-32 w-full bg-slate-700/50"})})});const d=a?.allTime.total?Math.round(a.allTime.thumbsUp/a.allTime.total*100):100,g=m>=4.5?"excellent":m>=4?"good":m>=3?"fair":"needs_attention",x={excellent:{label:"Excellent",color:"text-teal bg-teal/20 border-teal/30",icon:U},good:{label:"Good",color:"text-teal bg-teal/15 border-teal/25",icon:U},fair:{label:"Fair",color:"text-gold bg-gold/20 border-gold/30",icon:Y},needs_attention:{label:"Needs Work",color:"text-coral bg-coral/20 border-coral/30",icon:Y}}[g],n=x.icon;return e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-teal to-primary"}),e.jsxs("div",{className:"relative p-6 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-teal/20 flex items-center justify-center",children:e.jsx(X,{className:"h-4 w-4 text-teal"})}),e.jsx(F,{className:"text-lg text-white",children:"Reputation Score"})]}),e.jsxs(b,{className:N("border",x.color),children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),x.label]})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-baseline gap-1",children:[e.jsx("span",{className:"text-5xl font-extrabold text-white",children:m.toFixed(1)}),e.jsx(L,{className:"h-8 w-8 text-gold fill-gold"})]}),e.jsxs("p",{className:"text-sm text-white/60 mt-1",children:[s," Google reviews"]})]}),e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"relative h-24 w-24",children:[e.jsxs("svg",{className:"h-24 w-24 -rotate-90",children:[e.jsx("circle",{className:"text-white/10",strokeWidth:"8",stroke:"currentColor",fill:"transparent",r:"40",cx:"48",cy:"48"}),e.jsx("circle",{className:"text-teal transition-all duration-500",strokeWidth:"8",strokeDasharray:`${d*2.51} 251`,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:"40",cx:"48",cy:"48"})]}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e.jsxs("span",{className:"text-2xl font-bold text-white",children:[d,"%"]}),e.jsx("span",{className:"text-[10px] text-white/50",children:"Positive"})]})]})})]})]}),e.jsxs(w,{className:"p-4 pt-3 bg-slate-900/50 border-t border-slate-700/50",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"text-center p-3 rounded-xl bg-slate-700/40 border border-slate-600/50",children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:"All Time"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsxs("span",{className:"flex items-center gap-0.5 text-sm font-bold text-teal",children:[e.jsx(te,{className:"h-3 w-3"})," ",a?.allTime.thumbsUp||0]}),e.jsx("span",{className:"text-white/30",children:"/"}),e.jsxs("span",{className:"flex items-center gap-0.5 text-sm font-bold text-coral",children:[e.jsx(de,{className:"h-3 w-3"})," ",a?.allTime.thumbsDown||0]})]})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl bg-slate-700/40 border border-slate-600/50",children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:"Last 30 Days"}),e.jsx("p",{className:"text-lg font-bold text-white",children:a?.last30.total||0})]}),e.jsxs("div",{className:"text-center p-3 rounded-xl bg-slate-700/40 border border-slate-600/50",children:[e.jsx("p",{className:"text-xs text-white/50 mb-1",children:"Last 7 Days"}),e.jsx("p",{className:"text-lg font-bold text-white",children:a?.last7.total||0})]})]}),o&&e.jsxs(y,{variant:"outline",className:"w-full justify-between text-sm font-semibold bg-transparent border-teal/30 text-teal hover:bg-teal/10 hover:border-teal/50",onClick:o,children:["View Full Analytics",e.jsx(K,{className:"h-4 w-4"})]})]})]})}const ue={pending:{label:"Pending",color:"bg-gold/10 text-gold border-gold/20",icon:I,dotColor:"bg-gold"},confirmed:{label:"Confirmed",color:"bg-blue-custom/10 text-blue-custom border-blue-custom/20",icon:S,dotColor:"bg-blue-custom"},completed:{label:"Completed",color:"bg-teal/10 text-teal border-teal/20",icon:S,dotColor:"bg-teal"},cancelled:{label:"Cancelled",color:"bg-coral/10 text-coral border-coral/20",icon:Ne,dotColor:"bg-coral"},no_show:{label:"No Show",color:"bg-muted text-muted-foreground border-border",icon:ve,dotColor:"bg-muted-foreground"}};function xt({clinicId:i,onViewAll:m}){const{data:s,isLoading:o}=k({queryKey:["appointments-timeline",i],queryFn:async()=>{const{data:r}=await u.from("appointments").select("*").eq("clinic_id",i).order("created_at",{ascending:!1}).limit(8);return r||[]},enabled:!!i}),{data:a}=k({queryKey:["today-appointments-stats",i],queryFn:async()=>{const r=new Date,d=new Date(r.getFullYear(),r.getMonth(),r.getDate()).toISOString(),g=new Date(r.getFullYear(),r.getMonth(),r.getDate()+1).toISOString(),{data:l}=await u.from("appointments").select("status").eq("clinic_id",i).gte("created_at",d).lt("created_at",g),x=l||[];return{total:x.length,pending:x.filter(n=>n.status==="pending").length,confirmed:x.filter(n=>n.status==="confirmed").length,completed:x.filter(n=>n.status==="completed").length}},enabled:!!i});return o?e.jsx(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:e.jsx(w,{className:"p-6",children:e.jsx(A,{className:"h-64 w-full bg-slate-700/50"})})}):e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg h-full overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-primary"}),e.jsxs(D,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(F,{className:"text-lg flex items-center gap-2 text-white",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/20 flex items-center justify-center",children:e.jsx(B,{className:"h-4 w-4 text-primary"})}),"Appointments"]}),e.jsxs(b,{className:"font-semibold bg-primary/20 border-primary/30 text-primary border",children:[a?.total||0," today"]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 mt-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-slate-700/40 border border-slate-600/50",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-gold"}),e.jsxs("span",{className:"text-xs font-medium text-white",children:[a?.pending||0," Pending"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-slate-700/40 border border-slate-600/50",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary"}),e.jsxs("span",{className:"text-xs font-medium text-white",children:[a?.confirmed||0," Confirmed"]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-2 rounded-lg bg-slate-700/40 border border-slate-600/50",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-teal"}),e.jsxs("span",{className:"text-xs font-medium text-white",children:[a?.completed||0," Done"]})]})]})]}),e.jsxs(w,{className:"pt-0 border-t border-slate-700/50 bg-slate-900/50",children:[e.jsx(je,{className:"h-[280px] pr-4",children:s&&s.length>0?e.jsx("div",{className:"space-y-3 pt-4",children:s.map((r,d)=>{const g=r.status||"pending",l=ue[g]||ue.pending,x=l.icon,n=r.preferred_date?He(r.preferred_date):new Date(r.created_at);return e.jsxs("div",{className:"group relative flex gap-3 animate-fade-in",style:{animationDelay:`${d*50}ms`},children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:N("h-3 w-3 rounded-full",l.dotColor)}),d<(s?.length||0)-1&&e.jsx("div",{className:"w-px h-full bg-slate-600/50 flex-1 mt-1"})]}),e.jsxs("div",{className:"flex-1 pb-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-3.5 w-3.5 text-white/50"}),e.jsx("p",{className:"font-semibold text-sm text-white",children:r.patient_name})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-xs text-white/50",children:[e.jsx(oe,{className:"h-3 w-3"}),e.jsx("span",{children:r.patient_phone})]})]}),e.jsxs(b,{className:N("border text-[10px]",l.color),children:[e.jsx(x,{className:"h-2.5 w-2.5 mr-1"}),l.label]})]}),e.jsxs("div",{className:"mt-2 text-xs text-white/50",children:[Qe(n)?e.jsx("span",{className:"text-gold font-medium",children:"Today"}):Ze(n)?e.jsx("span",{className:"text-primary font-medium",children:"Tomorrow"}):Le(n,"MMM d, yyyy"),r.preferred_time&&` at ${r.preferred_time}`]})]})]},r.id)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center py-8",children:[e.jsx(B,{className:"h-12 w-12 text-white/30 mb-3"}),e.jsx("p",{className:"text-sm font-medium text-white",children:"No appointments yet"}),e.jsx("p",{className:"text-xs text-white/50",children:"New bookings will appear here"})]})}),m&&s&&s.length>0&&e.jsxs(y,{variant:"outline",className:"w-full mt-3 justify-between text-sm font-semibold bg-transparent border-primary/30 text-primary hover:bg-primary/10 hover:border-primary/50",onClick:m,children:["View All Appointments",e.jsx(K,{className:"h-4 w-4"})]})]})]})}function ht({clinicId:i,verificationStatus:m,gmbConnected:s,onImprove:o}){const{data:a,isLoading:r}=k({queryKey:["profile-health",i],queryFn:async()=>{const{data:f}=await u.from("clinics").select("*, clinic_hours(*), clinic_images(*)").eq("id",i).single();return f},enabled:!!i});if(r)return e.jsx(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:e.jsx(w,{className:"p-6",children:e.jsx(A,{className:"h-48 w-full bg-slate-700"})})});const d=[{label:"Clinic name",icon:ie,completed:!!a?.name},{label:"Description",icon:ie,completed:!!a?.description},{label:"Address",icon:re,completed:!!a?.address},{label:"Phone number",icon:oe,completed:!!a?.phone},{label:"Email",icon:we,completed:!!a?.email},{label:"Cover image",icon:ge,completed:!!a?.cover_image_url},{label:"Business hours",icon:I,completed:(a?.clinic_hours?.length||0)>0},{label:"Gallery photos",icon:ge,completed:(a?.clinic_images?.length||0)>0},{label:"GMB connected",icon:O,completed:!!s},{label:"Verified badge",icon:V,completed:m==="verified"}],g=d.filter(f=>f.completed).length,l=Math.round(g/d.length*100),x=d.filter(f=>!f.completed),n=l>=90?"excellent":l>=70?"good":l>=50?"fair":"needs_work",c={excellent:{label:"Excellent",color:"text-teal",bgColor:"bg-teal/20",borderColor:"border-teal/40",ringColor:"text-teal",barColor:"bg-teal"},good:{label:"Good",color:"text-primary",bgColor:"bg-primary/20",borderColor:"border-primary/40",ringColor:"text-primary",barColor:"bg-primary"},fair:{label:"Fair",color:"text-gold",bgColor:"bg-gold/20",borderColor:"border-gold/40",ringColor:"text-gold",barColor:"bg-gold"},needs_work:{label:"Needs Work",color:"text-coral",bgColor:"bg-coral/20",borderColor:"border-coral/40",ringColor:"text-coral",barColor:"bg-coral"}}[n];return e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg overflow-hidden",children:[e.jsx("div",{className:N("h-1",c.barColor)}),e.jsxs("div",{className:"relative p-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:N("h-8 w-8 rounded-lg flex items-center justify-center",c.bgColor),children:e.jsx(V,{className:N("h-4 w-4",c.color)})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Profile Health"})]}),e.jsx(b,{className:N("border text-xs",c.bgColor,c.color,c.borderColor),children:c.label})]}),e.jsxs("div",{className:"flex items-center gap-5",children:[e.jsxs("div",{className:"relative h-20 w-20 flex-shrink-0",children:[e.jsxs("svg",{className:"h-20 w-20 -rotate-90",children:[e.jsx("circle",{className:"text-slate-700/50",strokeWidth:"8",stroke:"currentColor",fill:"transparent",r:"32",cx:"40",cy:"40"}),e.jsx("circle",{className:N("transition-all duration-700",c.ringColor),strokeWidth:"8",strokeDasharray:`${l*2.01} 201`,strokeLinecap:"round",stroke:"currentColor",fill:"transparent",r:"32",cx:"40",cy:"40"})]}),e.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:e.jsxs("span",{className:"text-2xl font-extrabold text-white",children:[l,"%"]})})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("p",{className:"text-sm font-medium text-white",children:[g," of ",d.length," complete"]}),e.jsx(J,{value:l,className:"h-2 bg-slate-700/50"}),l<100&&e.jsx("p",{className:"text-xs text-white/50",children:"Complete profile to rank higher"})]})]})]}),e.jsxs(w,{className:"p-4 bg-slate-900/50 border-t border-slate-700/50",children:[x.length>0&&e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsx("p",{className:"text-xs font-semibold text-white/50 uppercase tracking-wider",children:"Missing"}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[x.slice(0,3).map((f,P)=>e.jsxs(b,{variant:"outline",className:"bg-coral/10 border-coral/30 text-coral text-[10px]",children:[e.jsx(Ne,{className:"h-2.5 w-2.5 mr-1"}),f.label]},P)),x.length>3&&e.jsxs(b,{variant:"outline",className:"text-[10px] bg-slate-700/30 border-slate-600/30 text-white/50",children:["+",x.length-3," more"]})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1.5",children:[m==="verified"?e.jsxs(b,{className:"bg-teal/20 text-teal border-teal/30 border text-[10px]",children:[e.jsx(S,{className:"h-2.5 w-2.5 mr-1"})," Verified"]}):e.jsxs(b,{variant:"outline",className:"bg-slate-700/30 border-slate-600/30 text-white/50 text-[10px]",children:[e.jsx(V,{className:"h-2.5 w-2.5 mr-1"})," Not Verified"]}),s?e.jsxs(b,{className:"bg-teal/20 text-teal border-teal/30 border text-[10px]",children:[e.jsx(O,{className:"h-2.5 w-2.5 mr-1"})," GMB"]}):e.jsxs(b,{variant:"outline",className:"bg-slate-700/30 border-slate-600/30 text-white/50 text-[10px]",children:[e.jsx(O,{className:"h-2.5 w-2.5 mr-1"})," No GMB"]})]}),o&&l<100&&e.jsxs(y,{className:"w-full mt-3 bg-teal hover:bg-teal/90 text-white font-bold",onClick:o,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Improve Profile"]})]})]})}function pt({clinicId:i}){const{data:m,isLoading:s}=k({queryKey:["outreach-impact",i],queryFn:async()=>{const o=Je(new Date).toISOString(),[a,r,d,g]=await Promise.all([u.from("patients").select("id",{count:"exact",head:!0}).eq("clinic_id",i).gte("created_at",o),u.from("review_requests").select("id, status").eq("clinic_id",i).gte("created_at",o),u.from("clinic_messages").select("id, status").eq("clinic_id",i).gte("created_at",o),u.from("clinic_automation_settings").select("*").eq("clinic_id",i).single()]),l=r.data||[],x=d.data||[],n=l.filter(c=>c.status==="sent"||c.status==="delivered").length,t=l.filter(c=>c.status==="completed").length;return{patientsThisMonth:a.count||0,reviewRequestsSent:n,reviewsReceived:t,conversionRate:n>0?Math.round(t/n*100):0,messagesSent:x.filter(c=>c.status==="sent"||c.status==="delivered").length,messagesFailed:x.filter(c=>c.status==="failed").length,automationEnabled:g.data?.is_messaging_enabled||!1,reminderEnabled:g.data?.reminder_1_day||!1}},enabled:!!i});return s?e.jsx(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:e.jsx(w,{className:"p-6",children:e.jsx(A,{className:"h-48 w-full bg-slate-700"})})}):e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-purple"}),e.jsx(D,{className:"pb-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(F,{className:"text-lg flex items-center gap-2 text-white",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-purple/20 flex items-center justify-center",children:e.jsx(U,{className:"h-4 w-4 text-purple"})}),"Outreach Impact"]}),e.jsx(b,{variant:"outline",className:"text-[10px] bg-purple/20 border-purple/30 text-purple",children:"This Month"})]})}),e.jsxs(w,{className:"space-y-3 pt-0",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"p-3 rounded-xl bg-slate-700/40 border border-slate-600/30",children:[e.jsx(le,{className:"h-4 w-4 text-purple mb-1"}),e.jsx("p",{className:"text-xl font-extrabold text-white",children:m?.patientsThisMonth||0}),e.jsx("p",{className:"text-[10px] text-white/50",children:"New patients"})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-slate-700/40 border border-slate-600/30",children:[e.jsx(ce,{className:"h-4 w-4 text-purple mb-1"}),e.jsx("p",{className:"text-xl font-extrabold text-white",children:m?.reviewRequestsSent||0}),e.jsx("p",{className:"text-[10px] text-white/50",children:"Review requests"})]})]}),e.jsxs("div",{className:"p-3 rounded-xl bg-slate-700/40 border border-slate-600/30 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium text-white",children:"Review Conversion"}),e.jsxs("span",{className:"font-bold text-purple",children:[m?.conversionRate||0,"%"]})]}),e.jsx(J,{value:m?.conversionRate||0,className:"h-1.5 bg-slate-600/50"}),e.jsxs("div",{className:"flex justify-between text-[10px] text-white/50",children:[e.jsxs("span",{children:[m?.reviewRequestsSent||0," sent"]}),e.jsxs("span",{children:[m?.reviewsReceived||0," completed"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-xl bg-slate-700/40 border border-slate-600/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-purple"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-white",children:m?.messagesSent||0}),e.jsx("p",{className:"text-[10px] text-white/50",children:"Messages sent"})]})]}),(m?.messagesFailed||0)>0&&e.jsxs(b,{className:"bg-coral/20 text-coral border-coral/30 border text-[10px]",children:[m.messagesFailed," failed"]})]}),e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-xl bg-slate-700/40 border border-slate-600/30",children:[e.jsx(Q,{className:N("h-4 w-4",m?.automationEnabled?"text-gold":"text-white/40")}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-sm font-medium text-white",children:"Automation"})}),e.jsx(b,{variant:"outline",className:N("text-[10px] border",m?.automationEnabled?"bg-gold/20 text-gold border-gold/30":"bg-slate-700/30 text-white/50 border-slate-600/30"),children:m?.automationEnabled?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-2.5 w-2.5 mr-1"}),"ON"]}):"OFF"})]})]})]})}function gt({clinicId:i}){const m=fe(),[s,o]=E.useState({notification_email:"",email_enabled:!0,sms_enabled:!1,whatsapp_enabled:!1,notify_new_appointment:!0,notify_appointment_reminder:!0,notify_form_submission:!0,notify_new_review:!0,notify_negative_feedback:!0,reminder_1_day:!0,reminder_3_hours:!0}),{data:a,isLoading:r}=k({queryKey:["clinic-automation-settings",i],queryFn:async()=>{const{data:l,error:x}=await u.from("clinic_automation_settings").select("*").eq("clinic_id",i).maybeSingle();if(x&&x.code!=="PGRST116")throw x;return l},enabled:!!i});E.useEffect(()=>{if(a){const l=a.notification_config||{};o({notification_email:l.notification_email||"",email_enabled:l.email_enabled??!0,sms_enabled:l.sms_enabled??!1,whatsapp_enabled:l.whatsapp_enabled??!1,notify_new_appointment:l.notify_new_appointment??!0,notify_appointment_reminder:l.notify_appointment_reminder??!0,notify_form_submission:l.notify_form_submission??!0,notify_new_review:l.notify_new_review??!0,notify_negative_feedback:l.notify_negative_feedback??!0,reminder_1_day:a.reminder_1_day??!0,reminder_3_hours:a.reminder_3_hours??!0})}},[a]);const d=Re({mutationFn:async l=>{const x={clinic_id:i,reminder_1_day:l.reminder_1_day,reminder_3_hours:l.reminder_3_hours,is_messaging_enabled:l.email_enabled||l.sms_enabled||l.whatsapp_enabled,reminder_channel:l.whatsapp_enabled?"whatsapp":l.sms_enabled?"sms":"email"};if(a){const{error:n}=await u.from("clinic_automation_settings").update(x).eq("clinic_id",i);if(n)throw n}else{const{error:n}=await u.from("clinic_automation_settings").insert(x);if(n)throw n}},onSuccess:()=>{z.success("Notification settings saved"),m.invalidateQueries({queryKey:["clinic-automation-settings",i]})},onError:l=>{z.error(l.message||"Failed to save settings")}}),g=()=>{d.mutate(s)};return r?e.jsx(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:e.jsx(w,{className:"py-8 flex items-center justify-center",children:e.jsx(Z,{className:"h-6 w-6 animate-spin text-teal"})})}):e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gold"}),e.jsxs(D,{className:"pb-3",children:[e.jsxs(F,{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-gold/20 flex items-center justify-center",children:e.jsx(he,{className:"h-4 w-4 text-gold"})}),"Notification Preferences"]}),e.jsx(Ue,{className:"text-white/60",children:"Choose how you receive alerts"})]}),e.jsxs(w,{className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Be,{className:"text-white/80 text-sm",children:"Notification Email"}),e.jsx(Ee,{type:"email",placeholder:"your@email.com",value:s.notification_email||"",onChange:l=>o({...s,notification_email:l.target.value}),className:"bg-slate-700/50 border-slate-600/50 text-white placeholder:text-white/40"})]}),e.jsx(ae,{className:"bg-slate-700/50"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-white/80",children:"Channels"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs("div",{className:`p-3 rounded-xl border cursor-pointer transition-all ${s.email_enabled?"bg-teal/20 border-teal/40":"bg-slate-700/30 border-slate-600/30"}`,onClick:()=>o({...s,email_enabled:!s.email_enabled}),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(we,{className:`h-4 w-4 ${s.email_enabled?"text-teal":"text-white/40"}`}),s.email_enabled&&e.jsx(S,{className:"h-3 w-3 text-teal"})]}),e.jsx("p",{className:`text-xs font-medium ${s.email_enabled?"text-white":"text-white/40"}`,children:"Email"})]}),e.jsxs("div",{className:`p-3 rounded-xl border cursor-pointer transition-all ${s.sms_enabled?"bg-primary/20 border-primary/40":"bg-slate-700/30 border-slate-600/30"}`,onClick:()=>o({...s,sms_enabled:!s.sms_enabled}),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(oe,{className:`h-4 w-4 ${s.sms_enabled?"text-primary":"text-white/40"}`}),s.sms_enabled&&e.jsx(S,{className:"h-3 w-3 text-teal"})]}),e.jsx("p",{className:`text-xs font-medium ${s.sms_enabled?"text-white":"text-white/40"}`,children:"SMS"})]}),e.jsxs("div",{className:`p-3 rounded-xl border cursor-pointer transition-all ${s.whatsapp_enabled?"bg-emerald-500/20 border-emerald-500/40":"bg-slate-700/30 border-slate-600/30"}`,onClick:()=>o({...s,whatsapp_enabled:!s.whatsapp_enabled}),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx(ee,{className:`h-4 w-4 ${s.whatsapp_enabled?"text-emerald-400":"text-white/40"}`}),s.whatsapp_enabled&&e.jsx(S,{className:"h-3 w-3 text-teal"})]}),e.jsx("p",{className:`text-xs font-medium ${s.whatsapp_enabled?"text-white":"text-white/40"}`,children:"WhatsApp"})]})]})]}),e.jsx(ae,{className:"bg-slate-700/50"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-white/80",children:"Notify me about"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-700/30 border border-slate-600/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm text-white",children:"New Appointments"})]}),e.jsx(H,{checked:s.notify_new_appointment,onCheckedChange:l=>o({...s,notify_new_appointment:l})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-700/30 border border-slate-600/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ie,{className:"h-4 w-4 text-gold"}),e.jsx("span",{className:"text-sm text-white",children:"Form Submissions"})]}),e.jsx(H,{checked:s.notify_form_submission,onCheckedChange:l=>o({...s,notify_form_submission:l})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-slate-700/30 border border-slate-600/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"h-4 w-4 text-teal"}),e.jsx("span",{className:"text-sm text-white",children:"New Reviews"})]}),e.jsx(H,{checked:s.notify_new_review,onCheckedChange:l=>o({...s,notify_new_review:l})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-coral/10 border border-coral/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(he,{className:"h-4 w-4 text-coral"}),e.jsx("span",{className:"text-sm text-white",children:"Negative Feedback"})]}),e.jsx(H,{checked:s.notify_negative_feedback,onCheckedChange:l=>o({...s,notify_negative_feedback:l})})]})]})]}),e.jsx(ae,{className:"bg-slate-700/50"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-semibold text-white/80",children:"Patient Reminders"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(b,{variant:"outline",className:`cursor-pointer transition-all ${s.reminder_1_day?"bg-teal/20 border-teal/40 text-teal":"bg-slate-700/30 border-slate-600/30 text-white/50"}`,onClick:()=>o({...s,reminder_1_day:!s.reminder_1_day}),children:[s.reminder_1_day&&e.jsx(S,{className:"h-3 w-3 mr-1"}),"1 Day Before"]}),e.jsxs(b,{variant:"outline",className:`cursor-pointer transition-all ${s.reminder_3_hours?"bg-teal/20 border-teal/40 text-teal":"bg-slate-700/30 border-slate-600/30 text-white/50"}`,onClick:()=>o({...s,reminder_3_hours:!s.reminder_3_hours}),children:[s.reminder_3_hours&&e.jsx(S,{className:"h-3 w-3 mr-1"}),"3 Hours Before"]})]})]}),e.jsx(y,{onClick:g,disabled:d.isPending,className:"w-full bg-teal hover:bg-teal/90 text-white font-bold",children:d.isPending?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-4 w-4 mr-2 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"h-4 w-4 mr-2"}),"Save Settings"]})})]})]})}function bt({clinicId:i,clinicName:m,onNavigate:s}){const[o,a]=E.useState(!1),{data:r,isLoading:d}=k({queryKey:["ai-insights-stats",i],queryFn:async()=>{const t=new Date,c=new Date(t.getTime()-30*24*60*60*1e3),{data:f}=await u.from("appointments").select("status, created_at").eq("clinic_id",i),{data:P}=await u.from("review_funnel_events").select("event_type, created_at").eq("clinic_id",i),{data:q}=await u.from("clinics").select("rating, review_count, verification_status, google_place_id, description").eq("id",i).single(),{data:M}=await u.from("clinic_images").select("id").eq("clinic_id",i),C=f||[],T=P||[],_=C.filter(h=>new Date(h.created_at)>=c),$=C.filter(h=>h.status==="pending").length,G=C.filter(h=>h.status==="completed").length,v=T.filter(h=>h.event_type==="thumbs_up").length,p=T.filter(h=>h.event_type==="thumbs_down").length,R=T.length>0?v/T.length*100:100;return{totalAppointments:C.length,recentAppointments:_.length,pendingAppointments:$,completedAppointments:G,thumbsUp:v,thumbsDown:p,positiveRate:R,rating:q?.rating||0,reviewCount:q?.review_count||0,isVerified:q?.verification_status==="verified",hasGmb:!!q?.google_place_id,hasDescription:!!q?.description,imageCount:M?.length||0}},enabled:!!i}),l=(()=>{if(!r)return[];const t=[];return r.rating>=4.5?t.push({type:"success",icon:L,title:"Excellent Rating",description:`Your ${r.rating.toFixed(1)}â˜… rating is above average!`}):r.rating<4&&r.reviewCount>0&&t.push({type:"warning",icon:Y,title:"Rating Needs Attention",description:"Focus on patient experience to improve.",action:{label:"View Reviews",tab:"my-reputation"}}),r.thumbsDown>r.thumbsUp?t.push({type:"warning",icon:_e,title:"High Negative Feedback",description:"Address patient concerns privately.",action:{label:"View Feedback",tab:"my-reputation"}}):r.positiveRate>=80&&r.thumbsUp>5&&t.push({type:"success",icon:U,title:"Great Satisfaction",description:`${Math.round(r.positiveRate)}% of patients are happy!`}),r.hasGmb||t.push({type:"action",icon:ee,title:"Connect Google Business",description:"Redirect happy patients to Google.",action:{label:"Connect",tab:"my-settings"}}),r.isVerified||t.push({type:"action",icon:S,title:"Get Verified",description:"Verified clinics get 3x more bookings.",action:{label:"Verify",tab:"my-settings"}}),(!r.hasDescription||r.imageCount<3)&&t.push({type:"action",icon:Ce,title:"Complete Your Profile",description:r.imageCount<3?"Add more photos to boost engagement.":"Add a compelling description.",action:{label:"Edit",tab:"my-profile"}}),r.pendingAppointments>3&&t.push({type:"warning",icon:B,title:"Pending Appointments",description:`${r.pendingAppointments} awaiting confirmation.`,action:{label:"View",tab:"my-appointments"}}),r.reviewCount<10&&t.push({type:"tip",icon:Q,title:"Boost Your Reviews",description:"Clinics with 10+ reviews get 2x bookings.",action:{label:"Send Requests",tab:"my-reputation"}}),t.slice(0,4)})(),x=t=>{switch(t){case"success":return"bg-teal/15 border-teal/30 hover:bg-teal/20";case"warning":return"bg-coral/15 border-coral/30 hover:bg-coral/20";case"action":return"bg-primary/15 border-primary/30 hover:bg-primary/20";case"tip":return"bg-gold/15 border-gold/30 hover:bg-gold/20";default:return"bg-slate-700/30 border-slate-600/30"}},n=t=>{switch(t){case"success":return"text-teal";case"warning":return"text-coral";case"action":return"text-primary";case"tip":return"text-gold";default:return"text-white/60"}};return d?e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:[e.jsx(D,{className:"pb-3",children:e.jsx(A,{className:"h-6 w-40 bg-slate-700"})}),e.jsx(w,{className:"space-y-3",children:[1,2,3].map(t=>e.jsx(A,{className:"h-16 bg-slate-700"},t))})]}):e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg overflow-hidden",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-primary via-teal to-primary"}),e.jsx(D,{className:"pb-3",children:e.jsxs(F,{className:"text-lg font-bold text-white flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/20 flex items-center justify-center",children:e.jsx(X,{className:"h-4 w-4 text-primary"})}),"AI Insights"]}),e.jsx(y,{variant:"ghost",size:"sm",className:"text-white/50 hover:text-white hover:bg-slate-700/50",onClick:()=>a(!0),disabled:o,children:o?e.jsx(Z,{className:"h-4 w-4 animate-spin"}):e.jsx(ye,{className:"h-4 w-4"})})]})}),e.jsx(w,{className:"space-y-2",children:l.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx(S,{className:"h-10 w-10 text-teal mx-auto mb-2"}),e.jsx("p",{className:"text-white font-medium",children:"You're doing great!"}),e.jsx("p",{className:"text-white/50 text-sm",children:"No urgent actions needed."})]}):l.map((t,c)=>{const f=t.icon;return e.jsx("div",{className:`p-3 rounded-xl border transition-all ${x(t.type)}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`h-7 w-7 rounded-lg flex items-center justify-center flex-shrink-0 ${t.type==="success"?"bg-teal/20":t.type==="warning"?"bg-coral/20":t.type==="action"?"bg-primary/20":"bg-gold/20"}`,children:e.jsx(f,{className:`h-3.5 w-3.5 ${n(t.type)}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-white text-sm",children:t.title}),e.jsx("p",{className:"text-white/60 text-xs mt-0.5",children:t.description}),t.action&&e.jsxs(y,{variant:"ghost",size:"sm",className:"mt-1.5 h-6 text-xs text-teal hover:text-teal hover:bg-teal/10 -ml-2 px-2",onClick:()=>s(t.action.tab),children:[t.action.label,e.jsx(K,{className:"h-3 w-3 ml-1"})]})]})]})},c)})})]})}function ut({clinicId:i,clinicName:m,clinicSlug:s,googlePlaceId:o,verificationStatus:a,rating:r=0,reviewCount:d=0,onNavigate:g}){const{data:l=[]}=k({queryKey:["dashboard-funnel",i],queryFn:async()=>{const{data:h}=await u.from("review_funnel_events").select("*").eq("clinic_id",i).order("created_at",{ascending:!1}).limit(100);return h||[]}}),{data:x=[]}=k({queryKey:["dashboard-appointments-today",i],queryFn:async()=>{const h=new Date().toISOString().split("T")[0],{data:se}=await u.from("appointments").select("*").eq("clinic_id",i).gte("created_at",h);return se||[]}}),{data:n}=k({queryKey:["dashboard-clinic-profile",i],queryFn:async()=>{const{data:h}=await u.from("clinics").select("*, clinic_hours(*), clinic_images(*)").eq("id",i).single();return h}}),t=l.filter(h=>h.event_type==="thumbs_up").length,c=l.filter(h=>h.event_type==="thumbs_down").length,f=l.length,P=f>0?Math.round(t/f*100):0,q=x.filter(h=>h.status==="pending").length,M=x.filter(h=>h.status==="confirmed").length,C=x.filter(h=>h.status==="completed").length,_=(n?[n.name,n.description,n.address,n.phone,n.email,n.website,n.cover_image_url,n.google_place_id,(n.clinic_hours?.length||0)>0,(n.clinic_images?.length||0)>0]:[]).filter(Boolean).length,$=Math.round(_/10*100),G=r>=4.5?"excellent":r>=4?"good":r>=3?"fair":"needs_attention",p={excellent:{label:"Excellent",color:"emerald"},good:{label:"Good",color:"teal"},fair:{label:"Fair",color:"gold"},needs_attention:{label:"Needs Attention",color:"coral"}}[G],R=[c>t?{icon:ve,type:"warning",title:"High negative feedback rate",description:"Review private feedback and address common concerns."}:null,o?null:{icon:O,type:"action",title:"Connect Google Business",description:"Link your GMB to redirect happy patients to Google Reviews."},$<80?{icon:V,type:"action",title:"Complete your profile",description:`Your profile is ${$}% complete. Add missing info to rank higher.`}:null,a!=="verified"?{icon:S,type:"action",title:"Get verified",description:"Verified clinics receive 3x more patient bookings."}:null,{icon:Ce,type:"tip",title:"Send review requests",description:"Ask 5 recent patients for reviews to boost your visibility."}].filter(Boolean).slice(0,3);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg hover:shadow-xl transition-all",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-teal to-primary rounded-t-lg"}),e.jsx(D,{className:"pb-2",children:e.jsxs(F,{className:"text-sm font-medium flex items-center gap-2 text-white",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-teal/20",children:e.jsx(L,{className:"h-4 w-4 text-teal"})}),"Reputation Snapshot"]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-3xl font-bold text-white",children:r.toFixed(1)}),e.jsx(L,{className:"h-6 w-6 text-gold fill-gold"})]}),e.jsxs("p",{className:"text-xs text-white/60",children:[d," reviews"]})]}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-1 text-teal",children:[e.jsx(te,{className:"h-3 w-3"})," ",t]}),e.jsxs("span",{className:"flex items-center gap-1 text-coral",children:[e.jsx(de,{className:"h-3 w-3"})," ",c]})]}),e.jsx(J,{value:P,className:"h-2 bg-white/10"}),e.jsxs("p",{className:"text-xs text-center text-white/60",children:[P,"% positive rate"]})]})]}),e.jsx("div",{className:"mt-3 flex items-center gap-2",children:e.jsxs(b,{className:`text-xs border ${G==="excellent"?"bg-teal/20 text-teal border-teal/30":G==="good"?"bg-teal/15 text-teal border-teal/25":G==="fair"?"bg-gold/20 text-gold border-gold/30":"bg-coral/20 text-coral border-coral/30"}`,children:[G==="needs_attention"&&e.jsx(Y,{className:"h-3 w-3 mr-1"}),G==="excellent"&&e.jsx(U,{className:"h-3 w-3 mr-1"}),p.label]})})]})]}),e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg hover:shadow-xl transition-all",children:[e.jsx(D,{className:"pb-2",children:e.jsxs(F,{className:"text-sm font-medium flex items-center gap-2 text-white",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-teal/20",children:e.jsx(U,{className:"h-4 w-4 text-teal"})}),"Review Funnel"]})}),e.jsx(w,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"p-2 rounded-lg bg-slate-700/50 border border-slate-600/50",children:[e.jsx("p",{className:"text-xl font-bold text-white",children:f}),e.jsx("p",{className:"text-[10px] text-white/60",children:"Total"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-teal/10 border border-teal/30",children:[e.jsx("p",{className:"text-xl font-bold text-teal",children:t}),e.jsx("p",{className:"text-[10px] text-white/60",children:"Positive"})]}),e.jsxs("div",{className:"p-2 rounded-lg bg-coral/10 border border-coral/30",children:[e.jsx("p",{className:"text-xl font-bold text-coral",children:c}),e.jsx("p",{className:"text-[10px] text-white/60",children:"Negative"})]})]}),e.jsxs(y,{variant:"outline",size:"sm",className:"w-full text-xs bg-transparent border-teal/30 text-teal hover:bg-teal/10 hover:border-teal/50",onClick:()=>g("my-reviews"),children:["View Analytics",e.jsx(K,{className:"h-3 w-3 ml-1"})]})]})})]}),e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg hover:shadow-xl transition-all",children:[e.jsx(D,{className:"pb-2",children:e.jsxs(F,{className:"text-sm font-medium flex items-center gap-2 text-white",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-primary/20",children:e.jsx(B,{className:"h-4 w-4 text-primary"})}),"Today's Appointments"]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center",children:[e.jsxs("div",{className:"p-2.5 rounded-xl bg-gold/10 border border-gold/30",children:[e.jsx(I,{className:"h-4 w-4 text-gold mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-gold",children:q}),e.jsx("p",{className:"text-[10px] text-white/60",children:"Pending"})]}),e.jsxs("div",{className:"p-2.5 rounded-xl bg-primary/10 border border-primary/30",children:[e.jsx(S,{className:"h-4 w-4 text-primary mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-primary",children:M}),e.jsx("p",{className:"text-[10px] text-white/60",children:"Confirmed"})]}),e.jsxs("div",{className:"p-2.5 rounded-xl bg-teal/10 border border-teal/30",children:[e.jsx(L,{className:"h-4 w-4 text-teal mx-auto mb-1"}),e.jsx("p",{className:"text-lg font-bold text-teal",children:C}),e.jsx("p",{className:"text-[10px] text-white/60",children:"Completed"})]})]}),e.jsxs(y,{variant:"outline",size:"sm",className:"w-full mt-3 text-xs bg-transparent border-primary/30 text-primary hover:bg-primary/10 hover:border-primary/50",onClick:()=>g("my-appointments"),children:["View All",e.jsx(K,{className:"h-3 w-3 ml-1"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:[e.jsx(D,{className:"pb-2",children:e.jsxs(F,{className:"text-sm font-medium flex items-center gap-2 text-white",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-purple/20",children:e.jsx(V,{className:"h-4 w-4 text-purple"})}),"Profile Health"]})}),e.jsxs(w,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-2xl font-bold text-white",children:[$,"%"]}),e.jsx(b,{className:$>=80?"bg-teal/20 text-teal border border-teal/30":"bg-gold/20 text-gold border border-gold/30",children:$>=80?"Good":"Needs Work"})]}),e.jsx(J,{value:$,className:"h-2 bg-white/10"}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[a==="verified"?e.jsxs(b,{className:"bg-teal/20 text-teal border border-teal/30 text-xs",children:[e.jsx(S,{className:"h-3 w-3 mr-1"})," Verified"]}):e.jsx(b,{className:"bg-slate-700/50 text-white/60 border border-slate-600/50 text-xs",children:"Unverified"}),o?e.jsxs(b,{className:"bg-primary/20 text-primary border border-primary/30 text-xs",children:[e.jsx(O,{className:"h-3 w-3 mr-1"})," GMB Connected"]}):e.jsx(b,{className:"bg-slate-700/50 text-white/60 border border-slate-600/50 text-xs",children:"GMB Not Connected"})]}),e.jsx(y,{variant:"outline",size:"sm",className:"w-full text-xs bg-transparent border-slate-600/50 text-white/80 hover:bg-white/5 hover:border-slate-500",onClick:()=>g("my-profile"),children:"Edit Profile"})]})]}),e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:[e.jsx("div",{className:"h-1 bg-gradient-to-r from-primary to-teal rounded-t-lg"}),e.jsx(D,{className:"pb-2",children:e.jsxs(F,{className:"text-sm font-medium flex items-center gap-2 text-white",children:[e.jsx("div",{className:"p-1.5 rounded-lg bg-gradient-to-br from-primary/20 to-teal/20",children:e.jsx(X,{className:"h-4 w-4 text-teal"})}),"AI Suggestions"]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-2",children:R.map((h,se)=>{if(!h)return null;const Ae=h.icon;return e.jsx("div",{className:`p-2.5 rounded-lg text-xs border transition-colors ${h.type==="warning"?"bg-gold/10 border-gold/30 hover:bg-gold/15":h.type==="action"?"bg-teal/10 border-teal/30 hover:bg-teal/15":"bg-slate-700/50 border-slate-600/50 hover:bg-slate-700/70"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:`p-1 rounded ${h.type==="warning"?"bg-gold/20":h.type==="action"?"bg-teal/20":"bg-slate-600/50"}`,children:e.jsx(Ae,{className:`h-3.5 w-3.5 ${h.type==="warning"?"text-gold":h.type==="action"?"text-teal":"text-white/60"}`})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-white",children:h.title}),e.jsx("p",{className:"text-white/50 text-[10px] mt-0.5",children:h.description})]})]})},se)})})})]}),e.jsxs(j,{className:"bg-slate-800/90 border border-slate-700/50 shadow-lg",children:[e.jsx(D,{className:"pb-2",children:e.jsx(F,{className:"text-sm font-medium text-white",children:"Quick Actions"})}),e.jsxs(w,{className:"space-y-2",children:[e.jsxs(y,{variant:"outline",size:"sm",className:"w-full justify-start gap-2 text-xs bg-transparent border-teal/30 text-teal hover:bg-teal/10 hover:border-teal/50",onClick:()=>g("my-review-requests"),children:[e.jsx(ce,{className:"h-3.5 w-3.5"}),"Send Review Request"]}),e.jsxs(y,{variant:"outline",size:"sm",className:"w-full justify-start gap-2 text-xs bg-transparent border-primary/30 text-primary hover:bg-primary/10 hover:border-primary/50",onClick:()=>g("my-reviews"),children:[e.jsx(ke,{className:"h-3.5 w-3.5"}),"Generate QR Code"]}),e.jsxs(y,{variant:"outline",size:"sm",className:"w-full justify-start gap-2 text-xs bg-transparent border-purple/30 text-purple hover:bg-purple/10 hover:border-purple/50",onClick:()=>g("my-services"),children:[e.jsx(ne,{className:"h-3.5 w-3.5"}),"Add Service"]}),e.jsxs(y,{variant:"outline",size:"sm",className:"w-full justify-start gap-2 text-xs bg-transparent border-gold/30 text-gold hover:bg-gold/10 hover:border-gold/50",onClick:()=>g("my-appointments"),children:[e.jsx(Se,{className:"h-3.5 w-3.5"}),"View All Bookings"]})]})]})]})]})}function ft({clinicId:i}){const[m,s]=E.useState(!1),o=async()=>{s(!0);try{const{data:a,error:r}=await u.functions.invoke("create-verification-payment",{body:{clinicId:i}});if(r)throw r;a.url&&window.open(a.url,"_blank")}catch(a){z.error(a.message||"Payment failed")}finally{s(!1)}};return e.jsxs(y,{onClick:o,disabled:m,className:"w-full bg-teal hover:bg-teal/90 text-white font-bold",children:[m?e.jsx(Z,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(qe,{className:"h-4 w-4 mr-2"}),"Get Verified - 99 AED/month"]})}function os(){const{user:i,isAdmin:m,isSuperAdmin:s}=Ve(),[o,a]=De(),r=fe(),[d,g]=E.useState(!1),[l,x]=E.useState(!1);E.useEffect(()=>{const v=o.get("subscription");v==="success"?(z.success("ðŸŽ‰ Subscription activated successfully! Welcome to your new plan.",{duration:5e3}),o.delete("subscription"),a(o,{replace:!0}),r.invalidateQueries({queryKey:["clinic-subscription"]})):v==="cancelled"&&(z.info("Checkout was cancelled. You can upgrade anytime from your dashboard."),o.delete("subscription"),a(o,{replace:!0}))},[o,a,r]);const n=v=>{a({tab:v})},{data:t,isLoading:c}=k({queryKey:["dentist-profile",i?.id],queryFn:async()=>{const{data:v}=await u.from("clinics").select(`
          id, name, slug, address, phone, email, website, rating, review_count,
          verification_status, claim_status, location_verified, location_pending_approval, 
          city_id, gmb_connected, google_place_id,
          city:cities(name),
          area:areas(name)
        `).eq("claimed_by",i?.id).limit(1);if(v&&v.length>0){const p=v[0];return{id:p.id,name:p.name,slug:p.slug,address:p.address||void 0,phone:p.phone||void 0,email:p.email||void 0,website:p.website||void 0,rating:p.rating?Number(p.rating):void 0,review_count:p.review_count||void 0,verification_status:p.verification_status||void 0,claim_status:p.claim_status||void 0,location_verified:p.location_verified??void 0,location_pending_approval:p.location_pending_approval??void 0,city_id:p.city_id||void 0,gmb_connected:p.gmb_connected||!1,google_place_id:p.google_place_id||void 0,city:p.city,area:p.area}}return null},enabled:!!i?.id&&!m&&!s}),{data:f}=k({queryKey:["clinic-subscription",t?.id],queryFn:async()=>{if(!t?.id)return null;const{data:v}=await u.from("clinic_subscriptions").select("*, plan:subscription_plans(*)").eq("clinic_id",t.id).eq("status","active").maybeSingle();return v},enabled:!!t?.id}),{data:P}=k({queryKey:["dentist-appointments-stats",t?.id],queryFn:async()=>{if(!t?.id)return{total:0,pending:0,confirmed:0,completed:0};const{data:v}=await u.from("appointments").select("status").eq("clinic_id",t.id),p=v||[];return{total:p.length,pending:p.filter(R=>R.status==="pending").length,confirmed:p.filter(R=>R.status==="confirmed").length,completed:p.filter(R=>R.status==="completed").length}},enabled:!!t?.id}),{data:q}=k({queryKey:["dentist-funnel-stats",t?.id],queryFn:async()=>{if(!t?.id)return{thumbsUp:0,thumbsDown:0,total:0};const{data:v}=await u.from("review_funnel_events").select("event_type").eq("clinic_id",t.id),p=v||[];return{thumbsUp:p.filter(R=>R.event_type==="thumbs_up").length,thumbsDown:p.filter(R=>R.event_type==="thumbs_down").length,total:p.length}},enabled:!!t?.id}),{data:M}=k({queryKey:["dentist-patients-count",t?.id],queryFn:async()=>{if(!t?.id)return 0;const{count:v}=await u.from("patients").select("*",{count:"exact",head:!0}).eq("clinic_id",t.id);return v||0},enabled:!!t?.id}),C=t?.verification_status==="verified"&&t?.claim_status==="claimed",T=t&&!t.location_verified&&!t.location_pending_approval,_=t?.location_pending_approval;if(q?.total&&q.total>0&&Math.round(q.thumbsUp/q.total*100),c)return e.jsxs("div",{className:"space-y-6 p-1",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(A,{className:"h-16 w-16 rounded-2xl"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(A,{className:"h-6 w-48"}),e.jsx(A,{className:"h-4 w-32"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:[...Array(7)].map((v,p)=>e.jsx(A,{className:"h-32 rounded-2xl"},p))}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-6",children:[e.jsx(A,{className:"h-96 rounded-2xl"}),e.jsx(A,{className:"h-96 rounded-2xl"}),e.jsx(A,{className:"h-96 rounded-2xl"})]})]});if(!t&&!m&&!s)return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"min-h-[60vh] flex flex-col items-center justify-center text-center px-6",children:[e.jsx("div",{className:"h-24 w-24 rounded-3xl bg-primary/10 flex items-center justify-center mb-8 animate-bounce-gentle border border-primary/20",children:e.jsx(xe,{className:"h-12 w-12 text-primary"})}),e.jsx("h2",{className:"text-3xl font-extrabold mb-3 text-foreground",children:"No Practice Linked"}),e.jsx("p",{className:"text-muted-foreground mb-8 max-w-md",children:"Your account is not linked to any clinic yet. You can claim an existing profile or add your practice to the directory."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx(y,{asChild:!0,size:"lg",className:"rounded-2xl px-8 bg-primary hover:bg-primary/90",children:e.jsxs(Fe,{to:"/claim-profile",children:[e.jsx(V,{className:"h-5 w-5 mr-2"}),"Claim Existing Profile"]})}),e.jsxs(y,{size:"lg",variant:"outline",className:"rounded-2xl px-8",onClick:()=>x(!0),children:[e.jsx(ne,{className:"h-5 w-5 mr-2"}),"Add Your Practice"]})]})]}),e.jsx(Ke,{open:l,onOpenChange:x})]});if(!t&&(m||s))return null;const $=[{label:"Profile",value:C?"Verified":"Pending",icon:V,color:C?"emerald":"gold",progress:C?100:60,onClick:()=>n("my-profile")},{label:"Total Reviews",value:t.review_count||0,icon:L,color:"gold",onClick:()=>n("my-reputation")},{label:"Avg Rating",value:t.rating?.toFixed(1)||"N/A",icon:L,color:"gold",subtitle:"Google"},{label:"New Reviews",value:q?.total||0,subtitle:"Last 30 days",icon:te,color:"teal",onClick:()=>n("my-reputation")},{label:"Appointments",value:P?.total||0,subtitle:`${P?.pending||0} pending`,icon:B,color:"primary",onClick:()=>n("my-appointments")},{label:"Today",value:P?.confirmed||0,subtitle:"Confirmed",icon:S,color:"blue"},{label:"GMB Status",value:t.gmb_connected?"Connected":"Not Set",icon:O,color:t.gmb_connected?"teal":"coral",onClick:()=>n("my-settings")}],G=[{icon:ce,label:"Request Review",onClick:()=>n("my-reputation"),variant:"teal"},{icon:ne,label:"Add Patient",onClick:()=>n("my-patients"),variant:"primary"},{icon:B,label:"Add Appointment",onClick:()=>n("my-appointments"),variant:"primary"},{icon:ye,label:"Sync Google",onClick:()=>n("my-settings"),variant:"gold",disabled:!t.gmb_connected},{icon:et,label:"Edit Profile",onClick:()=>n("my-profile")},{icon:ke,label:"QR Code",onClick:()=>n("my-reputation")},{icon:le,label:"Patients",onClick:()=>n("my-patients"),badge:M?String(M):void 0},{icon:ze,label:"Settings",onClick:()=>n("my-settings")}];return e.jsxs("div",{className:"space-y-6",children:[T&&e.jsx(j,{className:"border-coral/40 bg-gradient-to-r from-coral/15 via-coral/10 to-coral/15 overflow-hidden animate-fade-in shadow-lg",children:e.jsx(w,{className:"p-5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-2xl bg-coral/20 flex items-center justify-center flex-shrink-0 shadow-md",children:e.jsx(_e,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-coral text-lg",children:"Action Required"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Your clinic is not publicly listed because your location hasn't been confirmed. Select your location to go live."}),e.jsxs(y,{onClick:()=>g(!0),className:"bg-coral hover:bg-coral/90 shadow-lg shadow-coral/20",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Select Your Location"]})]})]})})}),_&&e.jsx(j,{className:"border-gold/40 bg-gradient-to-r from-gold/15 via-gold/10 to-gold/15 animate-fade-in shadow-lg",children:e.jsx(w,{className:"p-5",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-2xl bg-gold/20 flex items-center justify-center flex-shrink-0 shadow-md",children:e.jsx(I,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gold text-lg",children:"Location Pending"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Your area request is pending admin approval. Your clinic will go live once approved (usually within 24 hours)."})]})]})})}),e.jsxs("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-6 shadow-xl",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-primary/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-0 left-1/4 w-48 h-48 bg-teal/15 rounded-full blur-2xl"}),e.jsx("div",{className:"absolute top-1/2 right-1/3 w-32 h-32 bg-gold/10 rounded-full blur-xl"}),e.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.03)_1px,transparent_1px)] bg-[size:24px_24px]"}),e.jsxs("svg",{className:"absolute top-4 right-8 w-20 h-20 text-white/5",viewBox:"0 0 100 100",children:[e.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"none",stroke:"currentColor",strokeWidth:"2"}),e.jsx("circle",{cx:"50",cy:"50",r:"25",fill:"none",stroke:"currentColor",strokeWidth:"1"})]}),e.jsx("svg",{className:"absolute bottom-4 left-8 w-16 h-16 text-primary/20",viewBox:"0 0 100 100",children:e.jsx("polygon",{points:"50,10 90,90 10,90",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]}),e.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-16 w-16 rounded-2xl bg-gradient-to-br from-primary to-primary/60 flex items-center justify-center shadow-lg shadow-primary/30 ring-2 ring-white/10",children:e.jsx(xe,{className:"h-8 w-8 text-white"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-extrabold tracking-tight text-white",children:t.name}),C?e.jsxs(b,{className:"bg-teal/20 text-teal border border-teal/30 text-[10px] shadow-lg shadow-teal/20",children:[e.jsx(S,{className:"h-3 w-3 mr-1"}),"Verified"]}):e.jsx(b,{className:"bg-white/10 text-white/60 border border-white/20 text-[10px]",children:"Unverified"})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-white/70",children:[e.jsx(re,{className:"h-3.5 w-3.5"}),e.jsxs("span",{className:"text-sm",children:[t.city?.name||"Location not set",t.area?.name?` â€¢ ${t.area.name}`:""]})]}),f?.plan&&e.jsx(b,{className:"bg-primary/20 text-primary border border-primary/30 text-[10px]",children:f.plan.name})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"hidden lg:flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx(L,{className:"h-3.5 w-3.5 text-gold"}),e.jsx("span",{className:"text-sm font-medium text-white",children:t.rating?.toFixed(1)||"N/A"})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/10",children:[e.jsx(le,{className:"h-3.5 w-3.5 text-teal"}),e.jsxs("span",{className:"text-sm font-medium text-white",children:[t.review_count||0," reviews"]})]})]}),e.jsxs(y,{variant:"outline",className:"rounded-xl bg-white/10 border-white/20 text-white hover:bg-white hover:text-slate-900 transition-all",onClick:()=>window.open(`/clinic/${t.slug}`,"_blank"),children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"View Profile"]})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-primary via-teal to-gold"})]}),e.jsx(Oe,{open:d,onOpenChange:g,clinicId:t.id,detectedCity:t.city?.name,detectedCityId:t.city_id,onLocationSelected:()=>{r.invalidateQueries({queryKey:["dentist-profile"]})}}),e.jsx(dt,{actions:G}),e.jsx(ot,{stats:$}),e.jsx(ut,{clinicId:t.id,clinicName:t.name,clinicSlug:t.slug,googlePlaceId:t.google_place_id,verificationStatus:t.verification_status,rating:t.rating,reviewCount:t.review_count,onNavigate:n}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(mt,{clinicId:t.id,rating:t.rating||0,reviewCount:t.review_count||0,onViewDetails:()=>n("my-reputation")}),f?.plan?e.jsx(j,{className:"bg-card border border-border/50 shadow-sm",children:e.jsx(w,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-9 w-9 rounded-lg bg-teal/10 flex items-center justify-center",children:e.jsx(be,{className:"h-4 w-4 text-teal"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-foreground text-sm",children:f.plan.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:f.plan.price_monthly>0?`$${f.plan.price_monthly}/mo`:"Free tier"})]}),f.plan.slug!=="autopilot_growth"&&e.jsx(y,{variant:"ghost",size:"sm",className:"text-teal hover:bg-teal/10 h-8",onClick:()=>n("my-settings"),children:e.jsx(Q,{className:"h-3.5 w-3.5"})})]})})}):e.jsx(j,{className:"bg-card border border-primary/20 shadow-sm",children:e.jsx(w,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-9 w-9 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(be,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-foreground text-sm",children:"Free Listing"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Upgrade to unlock"})]}),e.jsxs(y,{size:"sm",className:"bg-primary hover:bg-primary/90 text-primary-foreground h-8",onClick:()=>n("my-settings"),children:[e.jsx(Q,{className:"h-3.5 w-3.5 mr-1"}),"Upgrade"]})]})})}),!C&&e.jsx(j,{className:"bg-card border border-gold/20 shadow-sm",children:e.jsxs(w,{className:"p-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-9 w-9 rounded-lg bg-gold/10 flex items-center justify-center",children:e.jsx(qe,{className:"h-4 w-4 text-gold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-foreground text-sm",children:"Get Verified"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"3x more bookings"})]})]}),e.jsx(ft,{clinicId:t.id})]})}),e.jsx(gt,{clinicId:t.id})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(xt,{clinicId:t.id,onViewAll:()=>n("my-appointments")}),e.jsx(ht,{clinicId:t.id,verificationStatus:t.verification_status,gmbConnected:t.gmb_connected,onImprove:()=>n("my-profile")})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(bt,{clinicId:t.id,clinicName:t.name,onNavigate:n}),e.jsx(pt,{clinicId:t.id})]})]}),e.jsx(tt,{clinicId:t.id,maxItems:5})]})}export{os as default};
