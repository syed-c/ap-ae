import{u as S,j as e}from"./chunk-CPh6voF3.js";import{i as n,w as P,U as L,m as u,n as B,x as I,S as M,o as E,C as m,s as a}from"./index-DflORfjh.js";import{C as t,d as i,a as l,b as c,c as o}from"./chunk-Dwq_v72W.js";import{S as T}from"./chunk-CzOt8Wyl.js";import{S as h}from"./chunk-CQtADEjB.js";import{A as G}from"./chunk-C2VW2Ml6.js";import{L as R}from"./chunk-Bpcq5jED.js";import{C as x}from"./chunk-CbEmr7WL.js";import{L as F}from"./chunk-B0x3dbdo.js";import{T as D}from"./chunk-DbdCK11k.js";import{D as O}from"./chunk-CedtSHBb.js";import"./chunk-CffrGP6S.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function ne(){const{data:r,isLoading:p}=S({queryKey:["system-audit-stats"],queryFn:async()=>{const[{count:s},{count:d},{count:v},{count:N},{count:w},{count:y},{count:k},{count:_},{count:A},{count:C}]=await Promise.all([a.from("clinics").select("*",{count:"exact",head:!0}),a.from("dentists").select("*",{count:"exact",head:!0}),a.from("appointments").select("*",{count:"exact",head:!0}),a.from("leads").select("*",{count:"exact",head:!0}),a.from("internal_reviews").select("*",{count:"exact",head:!0}),a.from("user_roles").select("*",{count:"exact",head:!0}),a.from("cities").select("*",{count:"exact",head:!0}),a.from("states").select("*",{count:"exact",head:!0}),a.from("treatments").select("*",{count:"exact",head:!0}),a.from("insurances").select("*",{count:"exact",head:!0})]);return{clinics:s||0,dentists:d||0,appointments:v||0,leads:N||0,reviews:w||0,users:y||0,cities:k||0,states:_||0,treatments:A||0,insurances:C||0}}}),g=[{id:"auth",name:"Authentication & Roles",status:"active",description:"Supabase Auth with role-based access (super_admin, district_manager, dentist)",tables:["user_roles","user_onboarding","user_permission_overrides"],integrationPoints:["Google OAuth","Email/Password"],riskLevel:"low"},{id:"clinics",name:"Clinic Management",status:"active",description:"Clinic profiles with GMB sync, claim flow, hours, images, treatments",tables:["clinics","clinic_hours","clinic_images","clinic_treatments","clinic_insurances","clinic_oauth_tokens"],integrationPoints:["GMB Import","GMB Booking Link","Manual Entry"],riskLevel:"low"},{id:"dentists",name:"Dentist Profiles",status:"active",description:"Individual dentist profiles linked to clinics",tables:["dentists"],integrationPoints:["Clinic Team Management"],riskLevel:"low"},{id:"appointments",name:"Appointment System",status:"partial",description:"Lead-based booking with calendar preference. NO real-time slot selection yet.",tables:["appointments","booking_notifications","leads"],integrationPoints:["Booking Modal","Email Notifications"],riskLevel:"medium"},{id:"reviews",name:"Review System",status:"active",description:"Internal reviews + Google review sync with AI sentiment analysis",tables:["internal_reviews","google_reviews","review_requests","review_funnel_events"],integrationPoints:["Review Funnel","Google Reviews Sync","AI Replies"],riskLevel:"low"},{id:"locations",name:"Location Hierarchy",status:"active",description:"Countries → States → Cities → Areas structure (US focused)",tables:["countries","states","cities","areas"],integrationPoints:["GMB Scraper","Manual Entry"],riskLevel:"low"},{id:"treatments",name:"Treatments & Services",status:"active",description:"Treatment catalog with categories and SEO slugs",tables:["treatments","clinic_treatments"],integrationPoints:["Search Filters","Booking Form"],riskLevel:"low"},{id:"insurance",name:"Insurance Providers",status:"partial",description:"Insurance list exists but filtering/matching is basic",tables:["insurances","clinic_insurances"],integrationPoints:["Clinic Profile","Booking Form"],riskLevel:"low"},{id:"subscriptions",name:"Subscription Plans",status:"active",description:"Tiered plans with Stripe integration and feature gating",tables:["subscription_plans","clinic_subscriptions","plan_features","lead_quotas"],integrationPoints:["Stripe Checkout","Feature Flags"],riskLevel:"low"},{id:"gmb",name:"Google Business Profile",status:"active",description:"GMB sync, booking link injection, OAuth tokens, scraper",tables:["clinic_oauth_tokens","gmb_imports","gmb_scraper_sessions","gmb_link_requests"],integrationPoints:["Google OAuth","Place Actions API","Places API"],riskLevel:"low"},{id:"ai",name:"AI Features",status:"active",description:"AI assistant, review sentiment, reply generation",tables:["ai_conversations","ai_events","ai_outputs","ai_prompt_templates"],integrationPoints:["Gemini API","OpenAI (optional)"],riskLevel:"low"},{id:"audit",name:"Audit Logging",status:"active",description:"Comprehensive audit trail for all admin and system actions",tables:["audit_logs","hipaa_audit_log"],integrationPoints:["All Admin Actions"],riskLevel:"low"},{id:"messaging",name:"Messaging System",status:"active",description:"SMS, WhatsApp, and email messaging for clinics",tables:["clinic_messages","crm_numbers","email_templates"],integrationPoints:["Twilio (placeholder)","WhatsApp Business"],riskLevel:"medium"},{id:"seo",name:"SEO Management",status:"active",description:"Dynamic page content, sitemap, meta management",tables:["seo_pages","page_content","seo_metadata_history","seo_bot_settings"],integrationPoints:["Sitemap Edge Function","Meta Tags"],riskLevel:"low"}],j=[{role:"super_admin",description:"Full platform access, all admin controls",count:"~2"},{role:"district_manager",description:"Regional management (limited use)",count:"~1"},{role:"dentist",description:"Claimed clinic owners, dashboard access",count:"~10"},{role:"patient",description:"Implicit role (no user_roles entry needed)",count:"N/A"}],f=[{name:"Google OAuth",status:"active",notes:"Working for GMB sync and login"},{name:"Google Business Profile API",status:"active",notes:"Booking link sync implemented"},{name:"Google Places API",status:"active",notes:"Clinic import/scraper"},{name:"Stripe",status:"active",notes:"Checkout sessions and webhooks"},{name:"Twilio/SMS",status:"placeholder",notes:"Edge function exists, credentials needed"},{name:"WhatsApp Business",status:"placeholder",notes:"Edge function exists, credentials needed"},{name:"Gemini AI",status:"active",notes:"Review analysis, AI assistant"},{name:"SMTP (Hostinger)",status:"active",notes:"Email sending for bookings"}],b=[{item:"Adding slot-based booking",risk:"medium",mitigation:"Add new tables, use feature flags"},{item:"Booking default ON enforcement",risk:"low",mitigation:"Add dentist_settings table, default TRUE"},{item:"Insurance-first search",risk:"low",mitigation:"Extend existing filters, no schema change"},{item:"AI matching engine",risk:"low",mitigation:"Scoring logic in edge function, configurable weights"},{item:"Availability rules",risk:"low",mitigation:"New tables, does not touch existing"}];return p?e.jsxs("div",{className:"space-y-6",children:[e.jsx(h,{className:"h-12 w-64"}),e.jsx("div",{className:"grid md:grid-cols-4 gap-4",children:[1,2,3,4].map(s=>e.jsx(h,{className:"h-24"},s))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-display font-bold text-foreground flex items-center gap-3",children:[e.jsx(G,{className:"h-8 w-8 text-primary"}),"System Audit Report"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Phase 0 Discovery — Read-only snapshot of existing modules before building new features"}),e.jsxs(n,{className:"mt-2",variant:"outline",children:["Generated: ",new Date().toLocaleString()]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(t,{className:"bg-gradient-to-br from-primary/10 to-primary/5",children:e.jsx(i,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(P,{className:"h-8 w-8 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.clinics.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clinics"})]})]})})}),e.jsx(t,{className:"bg-gradient-to-br from-teal/10 to-teal/5",children:e.jsx(i,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(L,{className:"h-8 w-8 text-teal"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.dentists.toLocaleString()}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Dentists"})]})]})})}),e.jsx(t,{className:"bg-gradient-to-br from-coral/10 to-coral/5",children:e.jsx(i,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(u,{className:"h-8 w-8 text-coral"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.appointments}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Appointments"})]})]})})}),e.jsx(t,{className:"bg-gradient-to-br from-amber/10 to-amber/5",children:e.jsx(i,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{className:"h-8 w-8 text-amber"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.reviews}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Reviews"})]})]})})}),e.jsx(t,{className:"bg-gradient-to-br from-slate/10 to-slate/5",children:e.jsx(i,{className:"pt-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(I,{className:"h-8 w-8 text-slate-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:r?.cities}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Cities (",r?.states," States)"]})]})]})})})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-5 w-5"}),"Existing Modules"]}),e.jsx(o,{children:"Current system components and their status"})]}),e.jsx(i,{children:e.jsx(M,{className:"h-[400px] pr-4",children:e.jsx("div",{className:"space-y-3",children:g.map(s=>e.jsxs("div",{className:"p-3 rounded-lg border bg-muted/30",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx(n,{variant:s.status==="active"?"default":"secondary",className:s.status==="active"?"bg-teal/20 text-teal":s.status==="partial"?"bg-amber/20 text-amber":"bg-coral/20 text-coral",children:s.status})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsxs(n,{variant:"outline",className:"text-xs shrink-0",children:[s.riskLevel," risk"]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[s.tables.slice(0,3).map(d=>e.jsx(n,{variant:"outline",className:"text-[10px]",children:d},d)),s.tables.length>3&&e.jsxs(n,{variant:"outline",className:"text-[10px]",children:["+",s.tables.length-3," more"]})]})]},s.id))})})})]}),e.jsxs(t,{children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"User Roles"]}),e.jsx(o,{children:"Current role-based access control structure"})]}),e.jsx(i,{className:"space-y-3",children:j.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg border bg-muted/30",children:[e.jsxs("div",{children:[e.jsx("code",{className:"text-sm font-mono bg-muted px-2 py-0.5 rounded",children:s.role}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.description})]}),e.jsx(n,{variant:"outline",children:s.count})]},s.role))})]}),e.jsxs(t,{className:"border-amber/50",children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-amber"}),"Current Booking Behavior"]}),e.jsx(o,{children:"How appointments work TODAY (before booking engine features)"})]}),e.jsx(i,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 rounded-lg bg-amber/10 border border-amber/20",children:[e.jsx("p",{className:"font-medium text-sm",children:"Type: Lead Form + Calendar Preference"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Users submit preferred date/time, clinic confirms manually. NOT real-time slots."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Real-time slot selection"}),e.jsx(x,{className:"h-4 w-4 text-coral"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Dentist availability rules"}),e.jsx(x,{className:"h-4 w-4 text-coral"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Double-booking prevention (locks)"}),e.jsx(x,{className:"h-4 w-4 text-coral"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Appointment types with duration"}),e.jsx(x,{className:"h-4 w-4 text-coral"})]}),e.jsx(T,{className:"my-2"}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Email notifications"}),e.jsx(m,{className:"h-4 w-4 text-teal"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Appointment status workflow"}),e.jsx(m,{className:"h-4 w-4 text-teal"})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{children:"Self-service manage/cancel link"}),e.jsx(m,{className:"h-4 w-4 text-teal"})]})]})]})})]}),e.jsxs(t,{children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"h-5 w-5"}),"Integration Status"]}),e.jsx(o,{children:"External services and API connections"})]}),e.jsx(i,{children:e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded border bg-muted/30",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.notes})]}),e.jsx(n,{variant:s.status==="active"?"default":"secondary",className:s.status==="active"?"bg-teal/20 text-teal":"",children:s.status})]},s.name))})})]})]}),e.jsxs(t,{children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-5 w-5 text-amber"}),"Risk Checklist for Booking Features"]}),e.jsx(o,{children:"Assessment of new feature implementation risks and mitigations"})]}),e.jsx(i,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2",children:"Feature"}),e.jsx("th",{className:"text-left p-2",children:"Risk Level"}),e.jsx("th",{className:"text-left p-2",children:"Mitigation Strategy"})]})}),e.jsx("tbody",{children:b.map(s=>e.jsxs("tr",{className:"border-b last:border-0",children:[e.jsx("td",{className:"p-2 font-medium",children:s.item}),e.jsx("td",{className:"p-2",children:e.jsx(n,{variant:"outline",className:s.risk==="low"?"border-teal text-teal":s.risk==="medium"?"border-amber text-amber":"border-coral text-coral",children:s.risk})}),e.jsx("td",{className:"p-2 text-muted-foreground",children:s.mitigation})]},s.item))})]})})})]}),e.jsxs(t,{children:[e.jsxs(l,{children:[e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Database Schema Summary"]}),e.jsx(o,{children:"80+ tables currently in production. Key tables for booking engine features highlighted."})]}),e.jsx(i,{children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-3 rounded-lg border",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Core Entities"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsx("p",{children:"• clinics"}),e.jsx("p",{children:"• dentists"}),e.jsx("p",{children:"• patients"}),e.jsx("p",{children:"• appointments"}),e.jsx("p",{children:"• leads"})]})]}),e.jsxs("div",{className:"p-3 rounded-lg border",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Location"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsx("p",{children:"• countries"}),e.jsx("p",{children:"• states"}),e.jsx("p",{children:"• cities"}),e.jsx("p",{children:"• areas"})]})]}),e.jsxs("div",{className:"p-3 rounded-lg border",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Features"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsx("p",{children:"• treatments"}),e.jsx("p",{children:"• insurances"}),e.jsx("p",{children:"• clinic_hours"}),e.jsx("p",{children:"• internal_reviews"}),e.jsx("p",{children:"• google_reviews"})]})]}),e.jsxs("div",{className:"p-3 rounded-lg border border-primary/30",children:[e.jsx("h4",{className:"font-medium text-sm mb-2 text-primary",children:"To Add (Booking Engine)"}),e.jsxs("div",{className:"space-y-1 text-xs text-muted-foreground",children:[e.jsx("p",{children:"• feature_flags ✨"}),e.jsx("p",{children:"• appointment_types ✨"}),e.jsx("p",{children:"• availability_rules ✨"}),e.jsx("p",{children:"• slot_locks ✨"}),e.jsx("p",{children:"• dentist_settings ✨"})]})]})]})})]}),e.jsx(t,{className:"border-teal bg-teal/5",children:e.jsx(i,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(m,{className:"h-12 w-12 text-teal shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-foreground",children:"Audit Complete"}),e.jsx("p",{className:"text-muted-foreground",children:"The system has been audited. Proceed to Phase 1: Feature Flags to safely add new booking engine functionality. All new features will be additive and behind toggles."})]})]})})})]})}export{ne as default};
