import{u as _,j as e}from"./chunk-CPh6voF3.js";import{r as E}from"./chunk-CffrGP6S.js";import{L as se}from"./chunk-Drd-rt-S.js";import{u as ae,s as R,w as te,B as l,t as re,C as A,E as ie,y as S,q as le,Z as ne,bz as T,$ as g,a9 as ce,bc as de,aa as oe,ab as me,ac as xe,i as f,n as Q,U as ue,I as he,T as pe,Q as L,b as H}from"./index-DflORfjh.js";import{C as t,d as r,a as n,b as c}from"./chunk-Dwq_v72W.js";import{P as N}from"./chunk-DSDQubI6.js";import{T as je,a as ge,b,c as v}from"./chunk-k8HiDHrE.js";import{S as M}from"./chunk-CQtADEjB.js";import{a as fe}from"./chunk-DR0VO1o8.js";import{a as Ne,u as be}from"./chunk-Dq1MrkKO.js";import{C as ve}from"./chunk-GLPyMM0F.js";import{L as ye}from"./chunk-DR32GIZ2.js";import{Q as z}from"./chunk-I5uVO93-.js";import{C as U}from"./chunk-wy0nNZZG.js";import{C as Y}from"./chunk-BFhD_ct7.js";import{T as y,a as K}from"./chunk-BLd3XU4A.js";import{M as O}from"./chunk-B7d2qnKb.js";import{E as we}from"./chunk-CbETxTmt.js";import{E as ke}from"./chunk-CcezodbN.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-DfjE-bP6.js";import"./chunk-Beq7cUgv.js";import"./chunk-C8UDNHIm.js";import"./chunk-z-mlRDN4.js";import"./chunk-DZK1lt0q.js";import"./chunk-BcKWIjsB.js";import"./chunk-z7Kqt5JR.js";import"./chunk-C2VW2Ml6.js";import"./chunk-C7BdFRQZ.js";function rs(){const{user:w}=ae(),[V,W]=E.useState(!1),[P,I]=E.useState(!1),{data:a,isLoading:Z}=_({queryKey:["reputation-clinic",w?.id],queryFn:async()=>{const{data:s,error:i}=await R.from("clinics").select("id, name, slug, google_place_id, rating, review_count, verification_status").eq("claimed_by",w?.id).limit(1).single();if(i&&i.code!=="PGRST116")throw i;return s},enabled:!!w?.id}),{hasAccess:q}=Ne(a?.id,"review_manager"),{data:J}=be(a?.id),{data:d=[]}=_({queryKey:["reputation-funnel",a?.id],queryFn:async()=>{const{data:s}=await R.from("review_funnel_events").select("*").eq("clinic_id",a?.id).order("created_at",{ascending:!1}).limit(200);return s||[]},enabled:!!a?.id}),{data:k=[]}=_({queryKey:["reputation-requests",a?.id],queryFn:async()=>{const{data:s}=await R.from("review_requests").select("*").eq("clinic_id",a?.id).order("created_at",{ascending:!1}).limit(50);return s||[]},enabled:!!a?.id&&q});if(Z)return e.jsxs("div",{className:"space-y-6",children:[e.jsx(M,{className:"h-12"}),e.jsx("div",{className:"grid grid-cols-4 gap-4",children:[...Array(4)].map((s,i)=>e.jsx(M,{className:"h-32"},i))}),e.jsx(M,{className:"h-64"})]});if(!a)return e.jsxs("div",{className:"text-center py-12",children:[e.jsx(te,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Practice Linked"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please claim your practice profile first."}),e.jsx(l,{asChild:!0,children:e.jsx(se,{to:"/claim-profile",children:"Claim Your Profile"})})]});const C=Number(a.rating)||0,o=a.review_count||0,p=d.filter(s=>s.event_type==="thumbs_up").length,F=d.filter(s=>s.event_type==="thumbs_down").length,j=d.length,m=j>0?Math.round(p/j*100):0,u=d.filter(s=>s.event_type==="thumbs_down"),G=u.filter(s=>s.rating).reduce((s,i,h,ee)=>s+(i.rating||0)/ee.length,0)||0,x=Math.min(100,Math.round(C/5*40+m*.3+(o>50?20:o*.4)+(a.verification_status==="verified"?10:0))),B=`${window.location.origin}/review/${a.id}/`,D=a.google_place_id?`https://search.google.com/local/writereview?placeid=${a.google_place_id}`:null,$=async()=>{try{await navigator.clipboard.writeText(B),I(!0),H.success("Link copied to clipboard"),setTimeout(()=>I(!1),2e3)}catch{H.error("Failed to copy link")}},X=[u.some(s=>s.comment?.toLowerCase().includes("wait"))?{type:"insight",icon:re,title:"Common complaint: Wait times",description:"Multiple patients mentioned long waiting times. Consider optimizing scheduling."}:null,F>p*.5?{type:"warning",icon:ve,title:"High negative feedback rate",description:"Your negative feedback rate is above average. Review common issues."}:null,m>70?{type:"success",icon:A,title:"Great conversion rate!",description:"Most patients are leaving positive feedback. Keep it up!"}:null,o<20?{type:"action",icon:ie,title:"Build your review base",description:`You have ${o} reviews. Aim for 50+ to rank higher in search.`}:null,{type:"tip",icon:ye,title:"Best time to ask for reviews",description:"Send review requests within 2 hours of appointment completion."}].filter(Boolean).slice(0,4);return q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-display font-bold flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6 text-primary"}),"Reputation & Growth"]}),e.jsxs("p",{className:"text-muted-foreground",children:["AI-powered reputation management for ",a.name]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ce,{open:V,onOpenChange:W,children:[e.jsx(de,{asChild:!0,children:e.jsxs(l,{variant:"outline",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"QR Code"]})}),e.jsxs(oe,{className:"max-w-2xl",children:[e.jsx(me,{children:e.jsx(xe,{children:"Review QR Code"})}),e.jsx(fe,{clinicName:a.name,clinicSlug:a.slug,googlePlaceId:a.google_place_id||void 0})]})]}),e.jsxs(l,{onClick:$,className:"bg-gradient-to-r from-primary to-teal",children:[P?e.jsx(A,{className:"h-4 w-4 mr-2"}):e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Copy Review Link"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(t,{className:"lg:col-span-1 bg-gradient-to-br from-primary/10 via-primary/5 to-transparent border-primary/20",children:[e.jsx(n,{children:e.jsxs(c,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),"Reputation Score"]})}),e.jsx(r,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative inline-flex items-center justify-center mb-4",children:[e.jsxs("svg",{className:"h-32 w-32 transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"12",fill:"none",className:"text-muted"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"url(#gradient)",strokeWidth:"12",fill:"none",strokeDasharray:`${x*3.52} 352`,strokeLinecap:"round"}),e.jsx("defs",{children:e.jsxs("linearGradient",{id:"gradient",x1:"0%",y1:"0%",x2:"100%",y2:"0%",children:[e.jsx("stop",{offset:"0%",stopColor:"hsl(var(--primary))"}),e.jsx("stop",{offset:"100%",stopColor:"#14b8a6"})]})})]}),e.jsx("span",{className:"absolute text-4xl font-bold",children:x})]}),e.jsx(f,{variant:x>=70?"default":x>=50?"secondary":"destructive",children:x>=70?"Excellent":x>=50?"Good":"Needs Work"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3",children:"Based on Google rating, conversion rate, reviews, and verification status"})]})})]}),e.jsxs(t,{className:"lg:col-span-2",children:[e.jsx(n,{children:e.jsx(c,{className:"text-sm font-medium",children:"Score Breakdown"})}),e.jsx(r,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4 text-gold"}),"Google Rating"]}),e.jsxs("span",{className:"font-bold",children:[C.toFixed(1),"/5"]})]}),e.jsx(N,{value:C*20,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-4 w-4 text-teal"}),"Conversion Rate"]}),e.jsxs("span",{className:"font-bold",children:[m,"%"]})]}),e.jsx(N,{value:m,className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4 text-blue-500"}),"Review Count"]}),e.jsx("span",{className:"font-bold",children:o})]}),e.jsx(N,{value:Math.min(100,o*2),className:"h-2"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-coral"}),"Private Feedback Avg"]}),e.jsxs("span",{className:"font-bold",children:[G.toFixed(1),"/5"]})]}),e.jsx(N,{value:G*20,className:"h-2"})]})]})})]})]}),e.jsx(t,{className:"border-primary/20 bg-gradient-to-r from-primary/5 to-teal/5",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-display font-bold text-lg",children:"Your Review Collection Link"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Share with patients. Happy → Google, Unhappy → Private feedback"})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(he,{value:B,readOnly:!0,className:"w-80 bg-background"}),e.jsx(l,{onClick:$,size:"icon",variant:"outline",children:P?e.jsx(A,{className:"h-4 w-4"}):e.jsx(Y,{className:"h-4 w-4"})}),D&&e.jsx(l,{variant:"outline",size:"icon",asChild:!0,children:e.jsx("a",{href:D,target:"_blank",rel:"noopener noreferrer",children:e.jsx(we,{className:"h-4 w-4"})})})]})]})})}),e.jsxs(je,{defaultValue:"analytics",children:[e.jsxs(ge,{className:"grid w-full grid-cols-4 rounded-xl",children:[e.jsx(b,{value:"analytics",className:"rounded-xl",children:"Analytics"}),e.jsx(b,{value:"feedback",className:"rounded-xl",children:"Private Feedback"}),e.jsx(b,{value:"requests",className:"rounded-xl",children:"Requests Sent"}),e.jsx(b,{value:"ai",className:"rounded-xl",children:"AI Insights"})]}),e.jsx(v,{value:"analytics",className:"mt-4",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Funnel Performance"]})}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50",children:[e.jsx(ke,{className:"h-6 w-6 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-2xl font-bold",children:j}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Views"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-teal/10",children:[e.jsx(y,{className:"h-6 w-6 mx-auto mb-2 text-teal"}),e.jsx("p",{className:"text-2xl font-bold text-teal",children:p}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Positive"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-coral/10",children:[e.jsx(K,{className:"h-6 w-6 mx-auto mb-2 text-coral"}),e.jsx("p",{className:"text-2xl font-bold text-coral",children:F}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Negative"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Conversion Rate"}),e.jsxs("span",{className:"font-bold text-teal",children:[m,"%"]})]}),e.jsx("div",{className:"h-4 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-teal to-primary rounded-full transition-all",style:{width:`${m}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[p," out of ",j," directed to Google"]})]})]})})]}),e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"Recent Activity"]})}),e.jsx(r,{children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(g,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No activity yet. Share your review link!"})]}):e.jsx("div",{className:"space-y-2 max-h-64 overflow-auto",children:d.slice(0,10).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.event_type==="thumbs_up"?e.jsx("div",{className:"h-6 w-6 rounded-full bg-teal/20 flex items-center justify-center",children:e.jsx(y,{className:"h-3 w-3 text-teal"})}):e.jsx("div",{className:"h-6 w-6 rounded-full bg-coral/20 flex items-center justify-center",children:e.jsx(K,{className:"h-3 w-3 text-coral"})}),e.jsx("span",{className:"text-sm capitalize",children:s.event_type.replace("_"," ")})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:L(new Date(s.created_at),"MMM d, HH:mm")})]},s.id))})})]})]})}),e.jsx(v,{value:"feedback",className:"mt-4",children:e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"h-5 w-5"}),"Private Feedback (",u.length,")"]})}),e.jsx(r,{children:u.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(y,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No negative feedback yet. Great job!"})]}):e.jsx("div",{className:"space-y-4",children:u.map(s=>e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.rating&&e.jsx("div",{className:"flex",children:Array.from({length:5}).map((i,h)=>e.jsx(Q,{className:`h-4 w-4 ${h<s.rating?"text-gold fill-gold":"text-muted"}`},h))}),e.jsx(f,{variant:"outline",className:"text-xs capitalize",children:s.source})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:L(new Date(s.created_at),"MMM d, yyyy HH:mm")})]}),s.comment&&e.jsx("p",{className:"mt-3 text-sm",children:s.comment})]},s.id))})})]})}),e.jsx(v,{value:"requests",className:"mt-4",children:e.jsxs(t,{children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),"Review Requests Sent (",k.length,")"]})}),e.jsx(r,{children:k.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(g,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"mb-4",children:"No review requests sent yet"}),e.jsx(l,{children:"Send Your First Request"})]}):e.jsx("div",{className:"space-y-3",children:k.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-primary",children:s.recipient_name?.charAt(0)||"P"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.recipient_name||s.recipient_phone}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.recipient_phone})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{variant:"outline",className:"text-xs uppercase",children:s.channel}),e.jsx(f,{className:`text-xs ${s.status==="delivered"?"bg-teal/20 text-teal":s.status==="sent"?"bg-blue-100 text-blue-600":s.status==="failed"?"bg-red-100 text-red-600":"bg-muted"}`,children:s.status}),e.jsx("span",{className:"text-xs text-muted-foreground",children:L(new Date(s.created_at),"MMM d")})]})]},s.id))})})]})}),e.jsx(v,{value:"ai",className:"mt-4",children:e.jsxs(t,{className:"border-primary/20 bg-gradient-to-br from-primary/5 to-transparent",children:[e.jsx(n,{children:e.jsxs(c,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 text-primary"}),"AI-Powered Insights"]})}),e.jsxs(r,{children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-4",children:X.map((s,i)=>{if(!s)return null;const h=s.icon;return e.jsx("div",{className:`p-4 rounded-xl border ${s.type==="warning"?"bg-amber-50 border-amber-200":s.type==="success"?"bg-emerald-50 border-emerald-200":s.type==="action"?"bg-blue-50 border-blue-200":"bg-muted/50"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-xl flex items-center justify-center flex-shrink-0 ${s.type==="warning"?"bg-amber-100":s.type==="success"?"bg-emerald-100":s.type==="action"?"bg-blue-100":"bg-muted"}`,children:e.jsx(h,{className:`h-5 w-5 ${s.type==="warning"?"text-amber-600":s.type==="success"?"text-emerald-600":s.type==="action"?"text-blue-600":"text-muted-foreground"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.description})]})]})},i)})}),e.jsx("div",{className:"mt-6 p-4 bg-muted/30 rounded-xl",children:e.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:[e.jsx(S,{className:"h-4 w-4 inline mr-1"}),"AI insights are generated based on your feedback patterns and industry benchmarks. AI never sends messages automatically."]})})]})]})})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-display font-bold flex items-center gap-2",children:[e.jsx(S,{className:"h-6 w-6 text-primary"}),"Reputation & Growth"]}),e.jsx("p",{className:"text-muted-foreground",children:"AI-powered reputation management"})]})}),e.jsx(t,{className:"border-2 border-dashed border-primary/30 bg-gradient-to-br from-primary/5 to-transparent",children:e.jsxs(r,{className:"py-16 text-center",children:[e.jsx("div",{className:"h-20 w-20 rounded-2xl bg-gradient-to-br from-primary to-teal flex items-center justify-center mx-auto mb-6 shadow-lg",children:e.jsx(le,{className:"h-10 w-10 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold mb-3",children:"Unlock Reputation Management"}),e.jsx("p",{className:"text-muted-foreground max-w-lg mx-auto mb-8",children:"Get access to AI-powered reputation insights, review collection tools, branded QR codes, and bulk review request campaigns. Available on Verified and Pro plans."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(l,{size:"lg",className:"gap-2 bg-gradient-to-r from-primary to-teal",children:[e.jsx(ne,{className:"h-4 w-4"}),"Upgrade Now"]}),e.jsx(l,{variant:"outline",size:"lg",children:"View All Plans"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-6",children:["Current plan: ",e.jsx("span",{className:"font-medium",children:J?.plan?.name||"Free"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 opacity-50",children:[e.jsx(t,{children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx(T,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:"AI Insights"})]})}),e.jsx(t,{children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx(z,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:"Branded QR Codes"})]})}),e.jsx(t,{children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx(g,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:"Bulk Requests"})]})}),e.jsx(t,{children:e.jsxs(r,{className:"p-4 text-center",children:[e.jsx(U,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground"}),e.jsx("p",{className:"text-sm font-medium",children:"Analytics"})]})})]})]})}export{rs as default};
