import{u as w,j as e}from"./chunk-CPh6voF3.js";import{r as n}from"./chunk-CffrGP6S.js";import{s as v,p as H,I as j,a2 as y,a3 as _,a5 as f,a6 as g,a7 as i,a4 as V,B as K,X as M,i as b,Q as k}from"./index-DflORfjh.js";import{C as Q,d as z}from"./chunk-Dwq_v72W.js";import{T as U,a as X,b as N,c,d as G,e as o}from"./chunk-NLs5Ye4A.js";import{a as J}from"./chunk-j7XJPWWF.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function O(s={}){return w({queryKey:["audit-logs",s],queryFn:async()=>{let a=v.from("audit_logs").select("*").order("created_at",{ascending:!1});s.action&&(a=a.eq("action",s.action)),s.entityType&&(a=a.eq("entity_type",s.entityType)),s.userId&&(a=a.eq("user_id",s.userId)),s.userRole&&(a=a.eq("user_role",s.userRole)),s.dateFrom&&(a=a.gte("created_at",s.dateFrom)),s.dateTo&&(a=a.lte("created_at",s.dateTo));const{data:l,error:r}=await a.limit(200);if(r)throw r;return l}})}function P(){return w({queryKey:["audit-log-actions"],queryFn:async()=>{const{data:s,error:a}=await v.from("audit_logs").select("action").limit(1e3);if(a)throw a;return[...new Set(s.map(r=>r.action))].sort()}})}function W(){return w({queryKey:["audit-log-entity-types"],queryFn:async()=>{const{data:s,error:a}=await v.from("audit_logs").select("entity_type").limit(1e3);if(a)throw a;return[...new Set(s.map(r=>r.entity_type))].sort()}})}function ce(){const[s,a]=n.useState(""),[l,r]=n.useState(""),[u,T]=n.useState(""),[d,C]=n.useState(""),[m,S]=n.useState(""),[x,F]=n.useState(""),{data:h,isLoading:A}=O({action:l||void 0,entityType:u||void 0,dateFrom:m||void 0,dateTo:x||void 0}),{data:L}=P(),{data:q}=W(),p=h?.filter(t=>{const I=!s||t.action?.toLowerCase().includes(s.toLowerCase())||t.entity_type?.toLowerCase().includes(s.toLowerCase())||t.user_email?.toLowerCase().includes(s.toLowerCase()),D=!d||t.user_role===d;return I&&D})||[],R=[...new Set(h?.map(t=>t.user_role).filter(Boolean)||[])],E=()=>{a(""),r(""),T(""),C(""),S(""),F("")},B=s||l||u||d||m||x;return A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"Audit Logs"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Security and activity tracking across all users"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(H,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(j,{placeholder:"Search by action, entity, or email...",value:s,onChange:t=>a(t.target.value),className:"pl-10"})]}),e.jsxs(y,{value:l,onValueChange:t=>r(t==="__all__"?"":t),children:[e.jsx(_,{className:"w-[180px]",children:e.jsx(f,{placeholder:"All Actions"})}),e.jsxs(g,{children:[e.jsx(i,{value:"__all__",children:"All Actions"}),L?.map(t=>e.jsx(i,{value:t,children:t},t))]})]}),e.jsxs(y,{value:u,onValueChange:t=>T(t==="__all__"?"":t),children:[e.jsx(_,{className:"w-[180px]",children:e.jsx(f,{placeholder:"All Entities"})}),e.jsxs(g,{children:[e.jsx(i,{value:"__all__",children:"All Entities"}),q?.map(t=>e.jsx(i,{value:t,children:t},t))]})]}),e.jsxs(y,{value:d,onValueChange:t=>C(t==="__all__"?"":t),children:[e.jsx(_,{className:"w-[180px]",children:e.jsx(f,{placeholder:"All Roles"})}),e.jsxs(g,{children:[e.jsx(i,{value:"__all__",children:"All Roles"}),R.map(t=>e.jsx(i,{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"Date range:"})]}),e.jsx(j,{type:"date",value:m,onChange:t=>S(t.target.value),className:"w-[160px]",placeholder:"From"}),e.jsx("span",{className:"text-muted-foreground",children:"to"}),e.jsx(j,{type:"date",value:x,onChange:t=>F(t.target.value),className:"w-[160px]",placeholder:"To"}),B&&e.jsxs(K,{variant:"ghost",size:"sm",onClick:E,children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Clear filters"]})]})]}),e.jsx(Q,{className:"card-modern",children:e.jsx(z,{className:"p-0",children:e.jsxs(U,{children:[e.jsx(X,{children:e.jsxs(N,{children:[e.jsx(c,{children:"Action"}),e.jsx(c,{children:"Entity"}),e.jsx(c,{children:"User"}),e.jsx(c,{children:"Role"}),e.jsx(c,{children:"Timestamp"})]})}),e.jsxs(G,{children:[p.map(t=>e.jsxs(N,{children:[e.jsx(o,{children:e.jsx(b,{variant:"outline",children:t.action})}),e.jsxs(o,{children:[e.jsx("span",{className:"font-medium",children:t.entity_type}),t.entity_id&&e.jsxs("span",{className:"text-xs text-muted-foreground ml-2",children:[t.entity_id.slice(0,8),"..."]})]}),e.jsx(o,{className:"text-muted-foreground",children:t.user_email||"-"}),e.jsx(o,{children:t.user_role?e.jsx(b,{variant:"secondary",className:"text-xs",children:t.user_role}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"-"})}),e.jsx(o,{className:"text-muted-foreground",children:t.created_at?k(new Date(t.created_at),"MMM d, yyyy HH:mm"):"-"})]},t.id)),p.length===0&&e.jsx(N,{children:e.jsxs(o,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:[e.jsx(J,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No audit logs found"})]})})]})]})})}),e.jsxs("p",{className:"text-xs text-muted-foreground text-center",children:["Showing ",p.length," of ",h?.length||0," logs"]})]})}export{ce as default};
