import{b as Me,u as Oe,j as e}from"./chunk-CPh6voF3.js";import{r as i}from"./chunk-CffrGP6S.js";import{y as ae,B as u,a4 as Ee,a2 as I,a3 as R,a5 as q,a6 as H,a7 as M,bw as le,p as Fe,I as ie,Z as Be,L as re,bA as Ae,S as ne,b7 as ce,F as $e,Q as Ie,a9 as oe,aa as de,ab as me,ac as xe,ad as he,i as g,al as Re,ae as qe,G as He,x as Q,v as Qe,w as ue,b as _,s as G}from"./index-DflORfjh.js";import{C as o,d,a as ge,b as pe,c as Ge}from"./chunk-Dwq_v72W.js";import{P as Ve}from"./chunk-DSDQubI6.js";import{T as We,a as Ke,b as je,c as P,d as Ue,e as k}from"./chunk-NLs5Ye4A.js";import{R as Ze}from"./chunk-BOvFDp2b.js";import{C as Ye}from"./chunk-Bdl4gyLq.js";import{F as V}from"./chunk-BaL04tya.js";import{E as Je}from"./chunk-CcezodbN.js";import{P as Xe}from"./chunk-4cd3rYYj.js";import{C as et}from"./chunk-wy0nNZZG.js";import{C as tt}from"./chunk-f2aNMA4v.js";import{C as fe}from"./chunk-GLPyMM0F.js";import{B as st}from"./chunk-B_ghW3Ra.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";const Ne=[{value:"all",label:"All Page Types",icon:He},{value:"city",label:"City Pages",icon:Q},{value:"state",label:"State Pages",icon:Q},{value:"service",label:"Service Pages",icon:Qe},{value:"service-location",label:"Service + Location",icon:Q},{value:"clinic",label:"Clinic Profiles",icon:ue},{value:"dentist",label:"Dentist Profiles",icon:ue},{value:"blog",label:"Blog Posts",icon:st},{value:"static",label:"Static Pages",icon:V}],at=[{value:"all",label:"All Status"},{value:"missing_both",label:"Missing Both"},{value:"missing_title",label:"Missing Title"},{value:"missing_description",label:"Missing Description"},{value:"has_both",label:"Has Both (Complete)"},{value:"title_too_long",label:"Title Too Long (>60)"},{value:"desc_too_long",label:"Description Too Long (>160)"}];function Tt(){const W=Me(),[r,y]=i.useState([]),[O,be]=i.useState("all"),[K,p]=i.useState("all"),[E,ve]=i.useState("all"),[F,we]=i.useState(""),[S,U]=i.useState(!1),[j,B]=i.useState({current:0,total:0,fixed:0,errors:0}),[A,Z]=i.useState([]),[l,Y]=i.useState(null),[m,z]=i.useState(null),[b,J]=i.useState(""),[v,X]=i.useState(""),C=i.useRef(!1),L=i.useRef(null);i.useEffect(()=>{L.current&&(L.current.scrollTop=L.current.scrollHeight)},[A]);const{data:x,refetch:_e,isLoading:ye}=Oe({queryKey:["meta-optimizer-pages"],queryFn:async()=>{const s=[];let a=0;const N=le.map(c=>c.slug);for(;;){const{data:c,error:D}=await G.from("seo_pages").select("id, slug, page_type, title, meta_title, meta_description, h1, word_count, seo_score, last_audited_at, optimized_at").order("page_type").range(a,a+1e3-1);if(D)throw D;const T=c||[],h=T.filter($=>{const te=($.slug||"").split("/").filter(Boolean);if(te.length===0)return!0;const se=te[0].toLowerCase();if(N.includes(se)||["services","blog","clinic","dentist","insurance","about","contact","faq","privacy","terms","pricing","sitemap","how-it-works"].includes(se))return!0;const De=["static","blog","blog-post","blog-index","service","treatment","clinic","dentist","insurance-index","insurance-detail","home"];return!!($.page_type&&De.includes($.page_type))});if(s.push(...h),T.length<1e3)break;a+=1e3}return s}}),f={total:x?.length||0,missingBoth:x?.filter(t=>!t.meta_title&&!t.meta_description).length||0,missingTitle:x?.filter(t=>!t.meta_title).length||0,missingDescription:x?.filter(t=>!t.meta_description).length||0,complete:x?.filter(t=>t.meta_title&&t.meta_description).length||0,titleTooLong:x?.filter(t=>t.meta_title&&t.meta_title.length>60).length||0,descTooLong:x?.filter(t=>t.meta_description&&t.meta_description.length>160).length||0},n=x?.filter(t=>{if(O!=="all"&&t.page_type!==O||E!=="all"&&((t.slug||"").split("/").filter(Boolean)[0]?.toLowerCase()||"")!==E)return!1;switch(K){case"missing_both":if(t.meta_title||t.meta_description)return!1;break;case"missing_title":if(t.meta_title)return!1;break;case"missing_description":if(t.meta_description)return!1;break;case"has_both":if(!t.meta_title||!t.meta_description)return!1;break;case"title_too_long":if(!t.meta_title||t.meta_title.length<=60)return!1;break;case"desc_too_long":if(!t.meta_description||t.meta_description.length<=160)return!1;break}if(F){const s=F.toLowerCase();if(!t.slug.toLowerCase().includes(s)&&!(t.title||"").toLowerCase().includes(s)&&!(t.meta_title||"").toLowerCase().includes(s))return!1}return!0})||[],Se=t=>{y(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},ee=()=>{r.length===n.length?y([]):y(n.map(t=>t.id))},w=t=>{Z(s=>[...s,{...t,timestamp:new Date}])},Ce=async t=>{try{const{data:s,error:a}=await G.functions.invoke("optimize-meta",{body:{page_id:t}});if(a)throw a;return{success:!0,newMeta:{title:s?.meta_title,description:s?.meta_description}}}catch(s){return console.error("Optimize error:",s),{success:!1}}},Te=async()=>{if(r.length===0){_.info("No pages selected");return}U(!0),C.current=!1,B({current:0,total:r.length,fixed:0,errors:0}),Z([]),w({page:"",action:"started",message:`Starting optimization of ${r.length} pages...`});let t=0,s=0;for(let a=0;a<r.length;a++){if(C.current){w({page:"",action:"skipped",message:`Stopped by user. ${r.length-a} pages skipped.`});break}const N=r[a],c=x?.find(h=>h.id===N),D={title:c?.meta_title||void 0,description:c?.meta_description||void 0};B(h=>({...h,current:a+1})),w({page:c?.slug||N,action:"started",message:`Optimizing: ${c?.slug}`});const T=await Ce(N);T.success?(t++,w({page:c?.slug||N,action:"completed",message:"✓ Optimized successfully",oldMeta:D,newMeta:T.newMeta})):(s++,w({page:c?.slug||N,action:"error",message:"✗ Failed to optimize"})),B(h=>({...h,fixed:t,errors:s})),a<r.length-1&&!C.current&&await new Promise(h=>setTimeout(h,1200))}w({page:"",action:"completed",message:`Optimization complete! Fixed: ${t}, Errors: ${s}`}),U(!1),C.current=!1,W.invalidateQueries({queryKey:["meta-optimizer-pages"]}),y([]),_.success(`Optimization complete! Fixed: ${t}, Errors: ${s}`)},Pe=async()=>{if(m)try{const{error:t}=await G.from("seo_pages").update({meta_title:b||null,meta_description:v||null,optimized_at:new Date().toISOString()}).eq("id",m.id);if(t)throw t;_.success("Meta tags saved successfully"),z(null),W.invalidateQueries({queryKey:["meta-optimizer-pages"]})}catch{_.error("Failed to save meta tags")}},ke=()=>{const t=n.filter(s=>!s.meta_title||!s.meta_description).map(s=>s.id);if(t.length===0){_.info("No pages need fixing with current filter");return}y(t),_.info(`Selected ${t.length} pages. Click "Optimize Selected" to start.`)},ze=t=>{const s=Ne.find(a=>a.value===t);if(s){const a=s.icon;return e.jsx(a,{className:"h-4 w-4"})}return e.jsx(V,{className:"h-4 w-4"})},Le=t=>!t.meta_title&&!t.meta_description?e.jsx(g,{variant:"destructive",className:"text-xs",children:"Missing Both"}):t.meta_title?t.meta_description?t.meta_title.length>60||t.meta_description.length>160?e.jsx(g,{variant:"outline",className:"text-xs border-yellow-400 text-yellow-700",children:"Too Long"}):e.jsx(g,{variant:"outline",className:"text-xs border-green-400 text-green-600",children:"Complete"}):e.jsx(g,{variant:"outline",className:"text-xs border-orange-300 text-orange-600",children:"No Desc"}):e.jsx(g,{variant:"outline",className:"text-xs border-orange-300 text-orange-600",children:"No Title"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-foreground flex items-center gap-2",children:[e.jsx(ae,{className:"h-6 w-6 text-primary"}),"Meta Optimizer"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Bulk fix meta titles & descriptions using AI (Google policy compliant)"})]}),e.jsxs(u,{onClick:()=>_e(),variant:"outline",size:"sm",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3",children:[e.jsx(o,{className:"bg-gradient-to-br from-slate-50 to-slate-100 border-slate-200",children:e.jsxs(d,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-700",children:f.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Total Pages"})]})}),e.jsx(o,{className:"bg-gradient-to-br from-red-50 to-red-100 border-red-200 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>p("missing_both"),children:e.jsxs(d,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-red-600",children:f.missingBoth}),e.jsx("p",{className:"text-xs text-red-700",children:"Missing Both"})]})}),e.jsx(o,{className:"bg-gradient-to-br from-orange-50 to-orange-100 border-orange-200 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>p("missing_title"),children:e.jsxs(d,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-orange-600",children:f.missingTitle}),e.jsx("p",{className:"text-xs text-orange-700",children:"No Title"})]})}),e.jsx(o,{className:"bg-gradient-to-br from-amber-50 to-amber-100 border-amber-200 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>p("missing_description"),children:e.jsxs(d,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:f.missingDescription}),e.jsx("p",{className:"text-xs text-amber-700",children:"No Description"})]})}),e.jsx(o,{className:"bg-gradient-to-br from-green-50 to-green-100 border-green-200 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>p("has_both"),children:e.jsxs(d,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-green-600",children:f.complete}),e.jsx("p",{className:"text-xs text-green-700",children:"Complete"})]})}),e.jsx(o,{className:"bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-200 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>p("title_too_long"),children:e.jsxs(d,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:f.titleTooLong}),e.jsx("p",{className:"text-xs text-yellow-700",children:"Title >60"})]})}),e.jsx(o,{className:"bg-gradient-to-br from-purple-50 to-purple-100 border-purple-200 cursor-pointer hover:shadow-md transition-shadow",onClick:()=>p("desc_too_long"),children:e.jsxs(d,{className:"p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-purple-600",children:f.descTooLong}),e.jsx("p",{className:"text-xs text-purple-700",children:"Desc >160"})]})})]}),e.jsx(o,{children:e.jsxs(d,{className:"p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(I,{value:E,onValueChange:ve,children:[e.jsx(R,{className:"w-[140px]",children:e.jsx(q,{placeholder:"All States"})}),e.jsxs(H,{children:[e.jsx(M,{value:"all",children:"All States"}),le.map(t=>e.jsxs(M,{value:t.slug,children:[t.name," (",t.abbr,")"]},t.slug))]})]})]}),e.jsxs(I,{value:O,onValueChange:be,children:[e.jsx(R,{className:"w-[180px]",children:e.jsx(q,{})}),e.jsx(H,{children:Ne.map(t=>e.jsx(M,{value:t.value,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"h-4 w-4"}),t.label]})},t.value))})]}),e.jsxs(I,{value:K,onValueChange:p,children:[e.jsx(R,{className:"w-[180px]",children:e.jsx(q,{})}),e.jsx(H,{children:at.map(t=>e.jsx(M,{value:t.value,children:t.label},t.value))})]}),e.jsxs("div",{className:"relative flex-1 min-w-[200px]",children:[e.jsx(Fe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(ie,{placeholder:"Search by slug, title...",value:F,onChange:t=>we(t.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2 ml-auto",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:ke,disabled:S,children:[e.jsx(Be,{className:"h-4 w-4 mr-1"}),"Select Incomplete"]}),e.jsxs(u,{variant:"default",size:"sm",onClick:Te,disabled:S||r.length===0,className:"bg-primary hover:bg-primary/90",children:[S?e.jsx(re,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(Ae,{className:"h-4 w-4 mr-1"}),"Optimize Selected (",r.length,")"]}),S&&e.jsxs(u,{variant:"destructive",size:"sm",onClick:()=>{C.current=!0},children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),"Stop"]})]})]}),S&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-muted-foreground",children:["Processing ",j.current," of ",j.total,"..."]}),e.jsxs("span",{className:"font-medium",children:[e.jsxs("span",{className:"text-green-600",children:[j.fixed," fixed"]}),j.errors>0&&e.jsxs("span",{className:"text-red-600 ml-2",children:[j.errors," errors"]})]})]}),e.jsx(Ve,{value:j.current/j.total*100,className:"h-2"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs(o,{className:"lg:col-span-2",children:[e.jsx(ge,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(pe,{className:"text-lg",children:["Pages (",n.length,")"]}),e.jsx(u,{variant:"ghost",size:"sm",onClick:ee,children:r.length===n.length&&n.length>0?"Deselect All":"Select All"})]})}),e.jsx(d,{children:e.jsxs(ne,{className:"h-[500px]",children:[ye?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(re,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):n.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(V,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No pages match the current filters"})]}):e.jsxs(We,{children:[e.jsx(Ke,{children:e.jsxs(je,{children:[e.jsx(P,{className:"w-[40px]",children:e.jsx(ce,{checked:r.length===n.length&&n.length>0,onCheckedChange:ee})}),e.jsx(P,{children:"Page"}),e.jsx(P,{children:"Type"}),e.jsx(P,{children:"Status"}),e.jsx(P,{className:"w-[100px]",children:"Actions"})]})}),e.jsx(Ue,{children:n.slice(0,100).map(t=>e.jsxs(je,{className:r.includes(t.id)?"bg-primary/5":"",children:[e.jsx(k,{children:e.jsx(ce,{checked:r.includes(t.id),onCheckedChange:()=>Se(t.id)})}),e.jsx(k,{children:e.jsxs("div",{className:"max-w-[300px]",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.title||t.slug}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:t.slug.startsWith("/")?t.slug:`/${t.slug}`})]})}),e.jsx(k,{children:e.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground",children:[ze(t.page_type),e.jsx("span",{className:"text-xs capitalize",children:t.page_type})]})}),e.jsx(k,{children:Le(t)}),e.jsx(k,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>Y(t),children:e.jsx(Je,{className:"h-3.5 w-3.5"})}),e.jsx(u,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{z(t),J(t.meta_title||""),X(t.meta_description||"")},children:e.jsx(Xe,{className:"h-3.5 w-3.5"})})]})})]},t.id))})]}),n.length>100&&e.jsxs("p",{className:"text-center text-sm text-muted-foreground py-4",children:["Showing first 100 of ",n.length," pages. Use filters to narrow down."]})]})})]}),e.jsxs(o,{children:[e.jsxs(ge,{className:"pb-3",children:[e.jsxs(pe,{className:"text-lg flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5"}),"Optimization Log"]}),e.jsx(Ge,{children:"Real-time progress and results"})]}),e.jsx(d,{children:e.jsx(ne,{className:"h-[450px]",ref:L,children:A.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ae,{className:"h-10 w-10 mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:'Select pages and click "Optimize Selected" to start'})]}):e.jsx("div",{className:"space-y-2",children:A.map((t,s)=>e.jsx("div",{className:`text-xs p-2 rounded-lg border ${t.action==="error"?"bg-red-50 border-red-200":t.action==="completed"?"bg-green-50 border-green-200":t.action==="skipped"?"bg-yellow-50 border-yellow-200":"bg-slate-50 border-slate-200"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[t.action==="completed"&&e.jsx(tt,{className:"h-3.5 w-3.5 text-green-600 shrink-0 mt-0.5"}),t.action==="error"&&e.jsx(fe,{className:"h-3.5 w-3.5 text-red-600 shrink-0 mt-0.5"}),t.action==="started"&&e.jsx($e,{className:"h-3.5 w-3.5 text-blue-600 shrink-0 mt-0.5"}),t.action==="skipped"&&e.jsx(fe,{className:"h-3.5 w-3.5 text-yellow-600 shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium",children:t.message}),t.newMeta?.title&&e.jsxs("p",{className:"text-muted-foreground mt-1 truncate",children:["Title: ",t.newMeta.title]}),e.jsx("p",{className:"text-muted-foreground opacity-60",children:Ie(t.timestamp,"HH:mm:ss")})]})]})},s))})})})]})]}),e.jsx(oe,{open:!!l,onOpenChange:()=>Y(null),children:e.jsxs(de,{className:"max-w-2xl",children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Meta Preview"}),e.jsx(he,{children:l?.slug?.startsWith("/")?l.slug:`/${l?.slug}`})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-white border rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-blue-700 text-lg font-medium hover:underline cursor-pointer truncate",children:l?.meta_title||l?.title||"No Title Set"}),e.jsxs("p",{className:"text-green-700 text-sm",children:["https://www.appointpanda.ae",l?.slug?.startsWith("/")?l.slug:`/${l?.slug}`]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1 line-clamp-2",children:l?.meta_description||"No description set. This page needs a meta description for better SEO."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Title Length"}),e.jsxs(g,{variant:l?.meta_title&&l.meta_title.length<=60?"outline":"destructive",children:[l?.meta_title?.length||0," / 60 chars"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground mb-1",children:"Description Length"}),e.jsxs(g,{variant:l?.meta_description&&l.meta_description.length<=160?"outline":"destructive",children:[l?.meta_description?.length||0," / 160 chars"]})]})]})]})]})}),e.jsx(oe,{open:!!m,onOpenChange:()=>z(null),children:e.jsxs(de,{className:"max-w-2xl",children:[e.jsxs(me,{children:[e.jsx(xe,{children:"Edit Meta Tags"}),e.jsx(he,{children:m?.slug?.startsWith("/")?m.slug:`/${m?.slug}`})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Meta Title"}),e.jsxs(g,{variant:b.length<=60?"outline":"destructive",children:[b.length," / 60"]})]}),e.jsx(ie,{value:b,onChange:t=>J(t.target.value),placeholder:"Enter meta title...",className:b.length>60?"border-red-300":""})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Meta Description"}),e.jsxs(g,{variant:v.length<=160?"outline":"destructive",children:[v.length," / 160"]})]}),e.jsx(Re,{value:v,onChange:t=>X(t.target.value),placeholder:"Enter meta description...",rows:3,className:v.length>160?"border-red-300":""})]}),e.jsxs("div",{className:"p-4 bg-slate-50 border rounded-lg",children:[e.jsx("p",{className:"text-xs text-muted-foreground mb-2",children:"Google Preview:"}),e.jsx("p",{className:"text-blue-700 font-medium truncate",children:b||"No Title"}),e.jsxs("p",{className:"text-green-700 text-sm",children:["https://www.appointpanda.ae",m?.slug?.startsWith("/")?m.slug:`/${m?.slug}`]}),e.jsx("p",{className:"text-gray-600 text-sm mt-1 line-clamp-2",children:v||"No description"})]})]}),e.jsxs(qe,{children:[e.jsx(u,{variant:"outline",onClick:()=>z(null),children:"Cancel"}),e.jsx(u,{onClick:Pe,children:"Save Changes"})]})]})})]})}export{Tt as default};
