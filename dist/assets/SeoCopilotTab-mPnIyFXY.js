import{b as ee,u as k,c as se,j as e}from"./chunk-CPh6voF3.js";import{r as w}from"./chunk-CffrGP6S.js";import{B as g,G as te,t as ae,C as j,E as $,p as re,a2 as D,a3 as z,a5 as H,a6 as V,a7 as o,b7 as K,s as a,b as d,i as _,Z as le}from"./index-DflORfjh.js";import{C as r,d as l,a as A,b as P,c as I}from"./chunk-Dwq_v72W.js";import{T as ie,a as ce,b as E,c as h,d as ne,e as m}from"./chunk-NLs5Ye4A.js";import{T as de,a as oe,b as O,c as q}from"./chunk-k8HiDHrE.js";import{c as me}from"./chunk-BSjc5zjM.js";import{B as f}from"./chunk-Bl7VVhKV.js";import{R as xe}from"./chunk-BOvFDp2b.js";import{T as F}from"./chunk-DbdCK11k.js";import{L as R}from"./chunk-B0x3dbdo.js";import{F as he}from"./chunk-BaL04tya.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";function Oe(){ee();const[M,G]=w.useState("tasks"),[T,Q]=w.useState("pending");w.useState(!1);const[i,C]=w.useState([]),{data:U,refetch:N}=k({queryKey:["seo-tasks"],queryFn:async()=>{const{data:s}=await a.from("seo_tasks").select("*").order("created_at",{ascending:!1});return s||[]}}),u=(U||[]).map(s=>({id:s.id,title:s.title,description:s.description||"",page_url:s.page_url,task_type:s.task_type||"content",priority:s.priority||"medium",status:s.status||"pending",assigned_to:s.assigned_to,ai_suggestion:s.ai_suggestion,created_at:s.created_at,completed_at:s.completed_at})),{data:b}=k({queryKey:["seo-issues"],queryFn:async()=>{const{data:s}=await a.from("seo_pages").select("id, slug, title, meta_description, is_thin_content, is_duplicate").or("is_thin_content.eq.true,is_duplicate.eq.true,meta_description.is.null"),t=[],c=s?.filter(n=>n.is_thin_content)||[],x=s?.filter(n=>n.is_duplicate)||[],y=s?.filter(n=>!n.meta_description)||[];return c.length>0&&t.push({type:"thin_content",message:`${c.length} pages with thin content`,severity:"high",count:c.length}),x.length>0&&t.push({type:"duplicate",message:`${x.length} duplicate pages detected`,severity:"high",count:x.length}),y.length>0&&t.push({type:"missing_meta",message:`${y.length} pages missing meta descriptions`,severity:"medium",count:y.length}),t}}),{data:B}=k({queryKey:["page-stats"],queryFn:async()=>{const{data:s,count:t}=await a.from("clinics").select("id",{count:"exact"}),{data:c,count:x}=await a.from("treatments").select("id",{count:"exact"}),{data:y,count:n}=await a.from("cities").select("id",{count:"exact"}),{data:ue,count:L}=await a.from("blog_posts").select("id",{count:"exact"}).eq("status","published");return{totalPages:(t||0)+(x||0)+(n||0)+(L||0)+1,clinics:t||0,treatments:x||0,cities:n||0,blogs:L||0}}}),v=se({mutationFn:async()=>{const{data:s,error:t}=await a.functions.invoke("seo-audit",{body:{action:"audit"}});if(t)throw t;return await me({action:"SEO_AUDIT",entityType:"seo_copilot",metadata:{tasks_generated:s?.tasksCreated||0}}),N(),s?.tasksCreated||0},onSuccess:s=>{d.success(`SEO audit complete. ${s} new AI-generated tasks created.`)},onError:s=>d.error(s.message)}),Z=async(s,t)=>{const{error:c}=await a.from("seo_tasks").update({status:t,completed_at:t==="completed"?new Date().toISOString():null}).eq("id",s);if(c){d.error("Failed to update task");return}N(),d.success(`Task ${t==="completed"?"completed":"updated"}`)},J=async s=>{const{error:t}=await a.from("seo_tasks").update({status:"dismissed"}).eq("id",s);if(t){d.error("Failed to dismiss task");return}N(),d.success("Task dismissed")},W=async()=>{const{error:s}=await a.from("seo_tasks").update({status:"completed",completed_at:new Date().toISOString()}).in("id",i);if(s){d.error("Failed to complete tasks");return}C([]),N(),d.success(`${i.length} tasks completed`)},p=u.filter(s=>T==="all"?s.status!=="dismissed":s.status===T),S={pending:u.filter(s=>s.status==="pending").length,inProgress:u.filter(s=>s.status==="in_progress").length,completed:u.filter(s=>s.status==="completed").length},X=s=>{switch(s){case"critical":return e.jsx(_,{variant:"destructive",children:"Critical"});case"high":return e.jsx(_,{className:"bg-coral/20 text-coral",children:"High"});case"medium":return e.jsx(_,{className:"bg-gold/20 text-gold",children:"Medium"});default:return e.jsx(_,{variant:"outline",children:"Low"})}},Y=s=>{switch(s){case"content":return e.jsx(he,{className:"h-4 w-4"});case"technical":return e.jsx(le,{className:"h-4 w-4"});case"linking":return e.jsx(R,{className:"h-4 w-4"});default:return e.jsx($,{className:"h-4 w-4"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"SEO Copilot"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"AI-powered SEO recommendations and task management"})]}),e.jsxs(g,{onClick:()=>v.mutate(),disabled:v.isPending,children:[e.jsx(f,{className:`h-4 w-4 mr-2 ${v.isPending?"animate-pulse":""}`}),v.isPending?"Running Audit...":"Run SEO Audit"]})]}),e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsx(r,{className:"card-modern",children:e.jsxs(l,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(te,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:B?.totalPages||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Indexed Pages"})]})]})}),e.jsx(r,{className:"card-modern",children:e.jsxs(l,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gold-light flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:S.pending}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pending Tasks"})]})]})}),e.jsx(r,{className:"card-modern",children:e.jsxs(l,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-blue-light flex items-center justify-center",children:e.jsx(xe,{className:"h-6 w-6 text-blue-custom"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:S.inProgress}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"In Progress"})]})]})}),e.jsx(r,{className:"card-modern",children:e.jsxs(l,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal-light flex items-center justify-center",children:e.jsx(j,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:S.completed}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Completed"})]})]})}),e.jsx(r,{className:"card-modern",children:e.jsxs(l,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-coral-light flex items-center justify-center",children:e.jsx(F,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:b?.length||0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Active Issues"})]})]})})]}),b&&b.length>0&&e.jsx(r,{className:"card-modern border-coral/30 bg-coral/5",children:e.jsx(l,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(F,{className:"h-6 w-6 text-coral"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-bold text-coral",children:"SEO Issues Detected"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:b.map(s=>s.message).join(" â€¢ ")})]}),e.jsx(g,{variant:"outline",size:"sm",className:"text-coral border-coral hover:bg-coral hover:text-white",children:"View All"})]})})}),e.jsxs(de,{value:M,onValueChange:G,children:[e.jsxs(oe,{className:"grid w-full grid-cols-3 rounded-xl",children:[e.jsxs(O,{value:"tasks",className:"rounded-xl",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"SEO Tasks"]}),e.jsxs(O,{value:"audit",className:"rounded-xl",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Audit Results"]}),e.jsxs(O,{value:"suggestions",className:"rounded-xl",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"AI Suggestions"]})]}),e.jsx(q,{value:"tasks",className:"mt-4",children:e.jsxs(r,{className:"card-modern",children:[e.jsxs(A,{className:"flex flex-row items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(P,{className:"text-lg",children:"SEO Tasks"}),e.jsx(I,{children:"AI-generated tasks to improve your SEO"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(D,{value:T,onValueChange:s=>Q(s),children:[e.jsx(z,{className:"w-36",children:e.jsx(H,{})}),e.jsxs(V,{children:[e.jsx(o,{value:"all",children:"All Tasks"}),e.jsx(o,{value:"pending",children:"Pending"}),e.jsx(o,{value:"in_progress",children:"In Progress"}),e.jsx(o,{value:"completed",children:"Completed"})]})]}),i.length>0&&e.jsxs(g,{onClick:W,size:"sm",children:[e.jsx(j,{className:"h-4 w-4 mr-2"}),"Complete (",i.length,")"]})]})]}),e.jsx(l,{className:"p-0",children:e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs(E,{children:[e.jsx(h,{className:"w-10",children:e.jsx(K,{checked:i.length===p.length&&p.length>0,onCheckedChange:s=>{C(s?p.map(t=>t.id):[])}})}),e.jsx(h,{children:"Task"}),e.jsx(h,{children:"Type"}),e.jsx(h,{children:"Priority"}),e.jsx(h,{children:"Status"}),e.jsx(h,{className:"text-right",children:"Actions"})]})}),e.jsxs(ne,{children:[p.map(s=>e.jsxs(E,{children:[e.jsx(m,{children:e.jsx(K,{checked:i.includes(s.id),onCheckedChange:t=>{C(t?[...i,s.id]:i.filter(c=>c!==s.id))}})}),e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),s.page_url&&e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(R,{className:"h-3 w-3 text-primary"}),e.jsx("span",{className:"text-xs text-primary",children:s.page_url})]})]})}),e.jsx(m,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[Y(s.task_type),e.jsx("span",{className:"capitalize text-sm",children:s.task_type})]})}),e.jsx(m,{children:X(s.priority)}),e.jsx(m,{children:e.jsxs(D,{value:s.status,onValueChange:t=>Z(s.id,t),children:[e.jsx(z,{className:"w-28 h-8",children:e.jsx(H,{})}),e.jsxs(V,{children:[e.jsx(o,{value:"pending",children:"Pending"}),e.jsx(o,{value:"in_progress",children:"In Progress"}),e.jsx(o,{value:"completed",children:"Completed"})]})]})}),e.jsx(m,{className:"text-right",children:e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>J(s.id),children:"Dismiss"})})]},s.id)),p.length===0&&e.jsx(E,{children:e.jsxs(m,{colSpan:6,className:"text-center py-8 text-muted-foreground",children:[e.jsx(f,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No tasks found. Run an SEO audit to generate tasks."})]})})]})]})})]})}),e.jsx(q,{value:"audit",className:"mt-4",children:e.jsxs(r,{className:"card-modern",children:[e.jsxs(A,{children:[e.jsx(P,{className:"text-lg",children:"Technical SEO Audit"}),e.jsx(I,{children:"Automated checks for common SEO issues"})]}),e.jsx(l,{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-teal/10 border border-teal/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-5 w-5 text-teal"}),e.jsx("span",{className:"font-medium",children:"Sitemap"})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Sitemap is valid and includes ",B?.totalPages||0," URLs"]})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-teal/10 border border-teal/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-5 w-5 text-teal"}),e.jsx("span",{className:"font-medium",children:"Robots.txt"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Robots.txt is properly configured"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-teal/10 border border-teal/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(j,{className:"h-5 w-5 text-teal"}),e.jsx("span",{className:"font-medium",children:"SSL Certificate"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"HTTPS is enabled sitewide"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-gold/10 border border-gold/20",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{className:"h-5 w-5 text-gold"}),e.jsx("span",{className:"font-medium",children:"Canonical Tags"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Some pages may need canonical review"})]})]})})]})}),e.jsx(q,{value:"suggestions",className:"mt-4",children:e.jsxs(r,{className:"card-modern",children:[e.jsxs(A,{children:[e.jsxs(P,{className:"text-lg flex items-center gap-2",children:[e.jsx(f,{className:"h-5 w-5 text-primary"}),"AI Content Suggestions"]}),e.jsx(I,{children:"Smart recommendations for your pages"})]}),e.jsx(l,{className:"space-y-4",children:u.filter(s=>s.ai_suggestion).slice(0,5).map(s=>e.jsx("div",{className:"p-4 rounded-xl bg-primary/5 border border-primary/10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx(f,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:s.ai_suggestion}),s.page_url&&e.jsxs("div",{className:"flex items-center gap-1 mt-2",children:[e.jsx(R,{className:"h-3 w-3 text-primary"}),e.jsx("a",{href:s.page_url,className:"text-xs text-primary hover:underline",children:s.page_url})]})]}),e.jsx(g,{variant:"outline",size:"sm",children:"Apply"})]})},s.id))})]})})]})]})}export{Oe as default};
