import{b as V,u as v,c as w,j as e}from"./chunk-CPh6voF3.js";import{r as a}from"./chunk-CffrGP6S.js";import{u as Y,s as l,v as f,a9 as J,bc as W,B as o,aa as X,ab as Z,ac as ee,y as te,p as se,I as d,S as ae,l as re,aK as L,a as I,ae as ie,L as le,i as K,ap as ce,b as c}from"./index-DflORfjh.js";import{C as ne,d as oe}from"./chunk-Dwq_v72W.js";import{S}from"./chunk-CQtADEjB.js";import{c as Q}from"./chunk-BSjc5zjM.js";import{N as de}from"./chunk-BQwaAkM6.js";import{P as _}from"./chunk-HAC-i_a2.js";import{T as me}from"./chunk-BRVan1jG.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-Cq66vzLV.js";import"./chunk-fofMllkR.js";import"./chunk-DSDQubI6.js";import"./chunk-BaL04tya.js";function qe(){const{user:p}=Y(),u=V(),[z,g]=a.useState(!1),[i,T]=a.useState(null),[m,C]=a.useState(""),[h,F]=a.useState(""),[b,E]=a.useState(""),[M,A]=a.useState(null),[j,P]=a.useState(""),[y,q]=a.useState(""),{data:r,isLoading:$}=v({queryKey:["dentist-clinic-services",p?.id],queryFn:async()=>{const{data:t,error:s}=await l.from("clinics").select("id, name").eq("claimed_by",p?.id).limit(1).single();if(s&&s.code!=="PGRST116")throw s;return t},enabled:!!p?.id}),{data:B}=v({queryKey:["all-treatments"],queryFn:async()=>{const{data:t,error:s}=await l.from("treatments").select("*").eq("is_active",!0).order("display_order").order("name");if(s)throw s;return t}}),{data:n,isLoading:R}=v({queryKey:["clinic-treatments",r?.id],queryFn:async()=>{const{data:t,error:s}=await l.from("clinic_treatments").select(`
          id, clinic_id, treatment_id, price_from, price_to,
          treatment:treatments(id, name, slug, description, icon)
        `).eq("clinic_id",r?.id);if(s)throw s;return(t||[]).map(x=>({...x,treatment:x.treatment}))},enabled:!!r?.id}),N=w({mutationFn:async()=>{if(!r?.id||!i)throw new Error("Missing data");const{error:t}=await l.from("clinic_treatments").insert({clinic_id:r.id,treatment_id:i,price_from:m?parseFloat(m):null,price_to:h?parseFloat(h):null});if(t)throw t;await Q({action:"CREATE",entityType:"clinic_treatment",entityId:r.id,newValues:{treatment_id:i,price_from:m,price_to:h}})},onSuccess:()=>{u.invalidateQueries({queryKey:["clinic-treatments"]}),c.success("Treatment added"),g(!1),T(null),C(""),F(""),E("")},onError:t=>c.error(t.message||"Failed to add treatment")}),U=w({mutationFn:async t=>{const{error:s}=await l.from("clinic_treatments").delete().eq("id",t);if(s)throw s;await Q({action:"DELETE",entityType:"clinic_treatment",entityId:t})},onSuccess:()=>{u.invalidateQueries({queryKey:["clinic-treatments"]}),c.success("Treatment removed")},onError:t=>c.error(t.message||"Failed to remove treatment")}),G=w({mutationFn:async({id:t,priceFrom:s,priceTo:x})=>{const{error:D}=await l.from("clinic_treatments").update({price_from:s,price_to:x}).eq("id",t);if(D)throw D},onSuccess:()=>{u.invalidateQueries({queryKey:["clinic-treatments"]}),c.success("Pricing updated"),A(null)},onError:t=>c.error(t.message||"Failed to update pricing")}),k=B?.filter(t=>!n?.some(s=>s.treatment_id===t.id))?.filter(t=>t.name.toLowerCase().includes(b.toLowerCase())),H=t=>{A(t.id),P(t.price_from?.toString()||""),q(t.price_to?.toString()||"")},O=t=>{G.mutate({id:t,priceFrom:j?parseFloat(j):null,priceTo:y?parseFloat(y):null})};return $?e.jsxs("div",{className:"space-y-6",children:[e.jsx(S,{className:"h-20 bg-slate-700/50"}),e.jsx(S,{className:"h-64 bg-slate-700/50"})]}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl bg-slate-800/90 border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-gradient-to-br from-primary to-teal flex items-center justify-center",children:e.jsx(f,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Services & Treatments"}),e.jsxs("p",{className:"text-sm text-white/60",children:[n?.length||0," services listed"]})]})]}),e.jsxs(J,{open:z,onOpenChange:g,children:[e.jsx(W,{asChild:!0,children:e.jsxs(o,{size:"sm",className:"bg-primary hover:bg-primary/90",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Add Service"]})}),e.jsxs(X,{className:"sm:max-w-md bg-slate-900 border-slate-700/50",children:[e.jsx(Z,{children:e.jsxs(ee,{className:"flex items-center gap-2 text-white",children:[e.jsx(te,{className:"h-5 w-5 text-primary"}),"Add Service"]})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-white/40"}),e.jsx(d,{placeholder:"Search treatments...",value:b,onChange:t=>E(t.target.value),className:"pl-9 bg-slate-800 border-slate-600/50 text-white"})]}),e.jsxs(ae,{className:"h-48",children:[e.jsx("div",{className:"grid grid-cols-2 gap-2 pr-4",children:k?.map(t=>e.jsx("button",{type:"button",onClick:()=>T(t.id),className:re("p-3 border rounded-lg text-left transition-all",i===t.id?"border-primary bg-primary/10":"border-slate-600/50 hover:border-slate-500"),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-medium text-sm text-white truncate",children:t.name}),i===t.id&&e.jsx(L,{className:"h-4 w-4 text-primary shrink-0"})]})},t.id))}),k?.length===0&&e.jsx("p",{className:"text-white/50 text-sm text-center py-4",children:b?"No matches found":"All treatments added"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 pt-2 border-t border-slate-700/50",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{className:"text-xs text-white/60",children:"Price From (USD)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40",children:"$"}),e.jsx(d,{type:"number",value:m,onChange:t=>C(t.target.value),placeholder:"0",className:"pl-7 bg-slate-800 border-slate-600/50 text-white"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(I,{className:"text-xs text-white/60",children:"Price To (USD)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-white/40",children:"$"}),e.jsx(d,{type:"number",value:h,onChange:t=>F(t.target.value),placeholder:"0",className:"pl-7 bg-slate-800 border-slate-600/50 text-white"})]})]})]})]}),e.jsx(ie,{children:e.jsxs(o,{className:"w-full bg-primary hover:bg-primary/90",onClick:()=>N.mutate(),disabled:!i||N.isPending,children:[N.isPending?e.jsx(le,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(_,{className:"h-4 w-4 mr-2"}),"Add Service"]})})]})]})]}),R?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:[...Array(6)].map((t,s)=>e.jsx(S,{className:"h-24 bg-slate-700/50 rounded-xl"},s))}):n&&n.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:n.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-slate-800/90 rounded-xl border border-slate-700/50 hover:border-slate-600/50 transition-all group",children:[e.jsx("div",{className:"h-10 w-10 rounded-lg bg-primary/20 flex items-center justify-center shrink-0",children:e.jsx(f,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-white text-sm truncate",children:t.treatment.name}),M===t.id?e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx(d,{type:"number",value:j,onChange:s=>P(s.target.value),placeholder:"Min",className:"h-7 w-16 text-xs bg-slate-700 border-slate-600/50 text-white"}),e.jsx("span",{className:"text-white/40",children:"-"}),e.jsx(d,{type:"number",value:y,onChange:s=>q(s.target.value),placeholder:"Max",className:"h-7 w-16 text-xs bg-slate-700 border-slate-600/50 text-white"}),e.jsx(o,{size:"icon",className:"h-7 w-7 bg-primary hover:bg-primary/90",onClick:()=>O(t.id),children:e.jsx(L,{className:"h-3 w-3"})})]}):e.jsx("button",{onClick:()=>H(t),className:"text-left",children:t.price_from||t.price_to?e.jsxs(K,{className:"bg-teal/20 text-teal border-0 text-xs mt-1",children:[e.jsx(ce,{className:"h-3 w-3 mr-0.5"}),t.price_from&&`${t.price_from} AED`,t.price_from&&t.price_to&&" - ",t.price_to&&`${t.price_to} AED`]}):e.jsx(K,{className:"bg-slate-700/50 text-white/50 border-0 text-xs mt-1 hover:bg-slate-600/50",children:"+ Add pricing"})})]}),e.jsx(o,{size:"icon",variant:"ghost",onClick:()=>U.mutate(t.id),className:"h-8 w-8 text-white/40 hover:text-coral hover:bg-coral/10 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(me,{className:"h-4 w-4"})})]},t.id))}):e.jsx(ne,{className:"bg-slate-800/90 border border-slate-700/50",children:e.jsxs(oe,{className:"py-12 text-center",children:[e.jsx(f,{className:"h-12 w-12 mx-auto text-white/20 mb-4"}),e.jsx("p",{className:"text-white/60 mb-2",children:"No services added yet"}),e.jsx("p",{className:"text-sm text-white/40 mb-4",children:"Add treatments to show patients what you offer"}),e.jsxs(o,{onClick:()=>g(!0),size:"sm",className:"bg-primary hover:bg-primary/90",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),"Add Your First Service"]})]})})]}):e.jsx(de,{compact:!0})}export{qe as default};
