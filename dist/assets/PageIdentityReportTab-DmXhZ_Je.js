import{c as F,j as e}from"./chunk-CPh6voF3.js";import{r as j}from"./chunk-CffrGP6S.js";import{a2 as te,a3 as le,a5 as re,a6 as ne,a7 as ie,B as u,L as b,F as ce,E as oe,i as n,bz as de,G as U,S as q,b7 as W,C as xe,a9 as me,aa as ue,ab as he,ac as ge,ad as pe,s as T,b as d}from"./index-DflORfjh.js";import{C as f,d as N,a as S,b as P,c as je}from"./chunk-Dwq_v72W.js";import{P as G}from"./chunk-DSDQubI6.js";import{T as be,a as fe,b as O,c as i,d as Ne,e as c}from"./chunk-NLs5Ye4A.js";import{T as ve,a as ye,b as y,c as we}from"./chunk-k8HiDHrE.js";import{F as M}from"./chunk-CKGg_XGJ.js";import{S as E}from"./chunk-Qn9fG9ae.js";import{C as Y}from"./chunk-wy0nNZZG.js";import{C as Q}from"./chunk-BFhD_ct7.js";import{F as _e}from"./chunk-CwDzaQ9n.js";import{T as R}from"./chunk-DbdCK11k.js";import{C as B}from"./chunk-CbEmr7WL.js";import{W as H}from"./chunk-CFui2uTv.js";import{E as Ce}from"./chunk-CcezodbN.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";const Se=[{value:"all",label:"All Pages"},{value:"state",label:"State Pages"},{value:"city",label:"City Pages"},{value:"service",label:"Service Pages"},{value:"service_location",label:"Service-Location"},{value:"clinic",label:"Clinic Pages"},{value:"insurance",label:"Insurance Pages"}],X={"Duplicate Content":"bg-red-500","Duplicate Structure":"bg-orange-500","Duplicate Metadata":"bg-amber-500","Intent Conflict":"bg-purple-500","Thin Value Page":"bg-rose-500","AI-Sounding Content":"bg-pink-500","Low Local Authenticity":"bg-yellow-600"},Z={critical:{label:"Critical",color:"bg-red-500 text-white",textColor:"text-red-500"},high:{label:"High",color:"bg-orange-500 text-white",textColor:"text-orange-500"},medium:{label:"Medium",color:"bg-amber-500 text-white",textColor:"text-amber-500"},none:{label:"Good",color:"bg-green-500 text-white",textColor:"text-green-500"}};function Qe(){const[z,J]=j.useState("all"),[l,A]=j.useState(null),[x,K]=j.useState("report"),[h,ee]=j.useState(0),[L,D]=j.useState(null),[g,k]=j.useState(new Set),w=50,o=F({mutationFn:async(s=0)=>{const{data:a,error:t}=await T.functions.invoke("page-identity-scan",{body:{action:"run_identity_scan",page_type:z,limit:w,offset:s}});if(t)throw t;if(!a?.success)throw new Error(a?.error||"Scan failed");return a},onSuccess:s=>{const a=`Scanned ${s.summary.total_scanned} pages (batch ${Math.floor(h/w)+1}). Found ${s.summary.duplicate_content} duplicates, ${s.summary.thin_value} thin pages.`;d.success(a),s.summary.has_more&&d.info(`${s.summary.total_pages-h-w} more pages remaining. Click "Scan Next Batch" to continue.`)},onError:s=>d.error(`Scan failed: ${s.message}`)}),I=F({mutationFn:async()=>{const{data:s,error:a}=await T.functions.invoke("page-identity-scan",{body:{action:"find_boilerplate_clusters",limit:200}});if(a)throw a;return s},onSuccess:s=>d.success(`Found ${s.total_clusters} boilerplate clusters`),onError:s=>d.error(`Cluster scan failed: ${s.message}`)}),_=(s=0)=>{ee(s),o.mutate(s)},v=F({mutationFn:async s=>{D(s);const{data:a,error:t}=await T.functions.invoke("seo-bulk-processor",{body:{action:"process_job",job_id:crypto.randomUUID(),page_ids:[s],config:{regenerateH1:!0,regenerateH2:!0,regenerateMetaTitle:!0,regenerateMetaDescription:!0,regenerateIntro:!0,regenerateSections:!0,regenerateFaq:!0,addInternalLinks:!1,rewriteForUniqueness:!0,expandContent:!0,targetWordCount:800},apply_mode:"auto_apply",quality_threshold:50,custom_prompt:"Rewrite to be completely unique, human-sounding, locally relevant to UAE/Dubai. Remove AI patterns, add specific details, pricing ranges in AED, neighborhood references, and practical patient guidance."}});if(t)throw t;return a},onSuccess:s=>{D(null),s?.successful>0?(d.success("Page content fixed and rewritten by AI!"),_(h)):d.error("Fix attempted but failed. Check the page content.")},onError:s=>{D(null),d.error(`Fix failed: ${s.message}`)}}),$=F({mutationFn:async s=>{const{data:a,error:t}=await T.functions.invoke("seo-bulk-processor",{body:{action:"process_job",job_id:crypto.randomUUID(),page_ids:s,config:{regenerateH1:!0,regenerateH2:!0,regenerateMetaTitle:!0,regenerateMetaDescription:!0,regenerateIntro:!0,regenerateSections:!0,regenerateFaq:!0,addInternalLinks:!1,rewriteForUniqueness:!0,expandContent:!0,targetWordCount:800},apply_mode:"auto_apply",quality_threshold:50,custom_prompt:"Rewrite to be completely unique, human-sounding, locally relevant to UAE/Dubai. Remove AI patterns, add specific details, pricing ranges in AED, neighborhood references, and practical patient guidance."}});if(t)throw t;return a},onSuccess:s=>{k(new Set),d.success(`Bulk fix completed! ${s?.successful||0} pages fixed.`),_(h)},onError:s=>d.error(`Bulk fix failed: ${s.message}`)}),se=s=>{g.size===s.length?k(new Set):k(new Set(s.map(a=>a.id)))},ae=s=>{k(a=>{const t=new Set(a);return t.has(s)?t.delete(s):t.add(s),t})},m=o.data?.results||[],r=o.data?.summary,V=I.data?.clusters||[],C=j.useMemo(()=>x==="duplicates"?m.filter(s=>s.issues.includes("Duplicate Content")||s.issues.includes("Duplicate Metadata")):x==="thin"?m.filter(s=>s.issues.includes("Thin Value Page")):x==="ai"?m.filter(s=>s.ai_sounding_score>=50):x==="noindex"?m.filter(s=>!s.is_index_worthy):m,[m,x]),p=s=>s>=80?"text-green-500":s>=60?"text-amber-500":"text-red-500";return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"relative overflow-hidden rounded-2xl bg-gradient-to-r from-violet-500/10 via-primary/10 to-teal/10 p-6 border border-primary/20",children:e.jsxs("div",{className:"relative flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-display font-bold text-foreground flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-gradient-to-br from-violet-500 to-primary flex items-center justify-center",children:e.jsx(M,{className:"h-5 w-5 text-white"})}),"Page Identity Report"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Full-site similarity audit — text, structure, metadata, and intent analysis"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsxs(te,{value:z,onValueChange:J,children:[e.jsx(le,{className:"w-[180px]",children:e.jsx(re,{})}),e.jsx(ne,{children:Se.map(s=>e.jsx(ie,{value:s.value,children:s.label},s.value))})]}),e.jsx(u,{onClick:()=>_(0),disabled:o.isPending,className:"bg-gradient-to-r from-violet-500 to-primary",children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}),"Scanning..."]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Run Scan (Batch 1)"]})}),r?.has_more&&e.jsxs(u,{onClick:()=>_(h+w),disabled:o.isPending,variant:"outline",children:[o.isPending?e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Scan Next Batch"]})]})]})}),r&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3",children:[{label:"Scanned",value:r.total_scanned,icon:Y,color:"text-primary"},{label:"Duplicate Content",value:r.duplicate_content,icon:Q,color:"text-red-500"},{label:"Duplicate Meta",value:r.duplicate_metadata,icon:_e,color:"text-amber-500"},{label:"Intent Conflicts",value:r.intent_conflicts,icon:oe,color:"text-purple-500"},{label:"Thin Value",value:r.thin_value,icon:R,color:"text-rose-500"},{label:"Not Indexable",value:r.not_index_worthy,icon:B,color:"text-red-600"}].map(s=>e.jsx(f,{className:"bg-card/50",children:e.jsxs(N,{className:"pt-4 pb-3 px-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(s.icon,{className:`h-4 w-4 ${s.color}`}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.label})]}),e.jsx("p",{className:`text-2xl font-bold ${s.color}`,children:s.value})]})},s.label))}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground px-1",children:[e.jsxs("span",{children:["Showing batch: pages ",h+1," – ",h+r.total_scanned," of ",r.total_pages," total"]}),r.has_more&&e.jsx("span",{className:"text-primary font-medium",children:"More pages available →"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(P,{className:"text-sm",children:"Avg Identity Score"})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(G,{value:r.avg_identity_score,className:"flex-1"}),e.jsxs("span",{className:`text-lg font-bold ${p(r.avg_identity_score)}`,children:[r.avg_identity_score,"%"]})]})})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(P,{className:"text-sm",children:"Avg Page Value"})}),e.jsx(N,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(G,{value:r.avg_value_score,className:"flex-1"}),e.jsxs("span",{className:`text-lg font-bold ${p(r.avg_value_score)}`,children:[r.avg_value_score,"%"]})]})})]}),e.jsxs(f,{children:[e.jsx(S,{className:"pb-2",children:e.jsx(P,{className:"text-sm",children:"Rewrite Queue"})}),e.jsx(N,{children:e.jsxs("div",{className:"flex gap-2 text-sm",children:[e.jsxs(n,{className:"bg-red-500",children:[r.critical_rewrites," Critical"]}),e.jsxs(n,{className:"bg-orange-500",children:[r.high_rewrites," High"]})]})})]})]})]}),m.length>0&&e.jsxs(ve,{value:x,onValueChange:K,children:[e.jsx("div",{className:"w-full overflow-x-auto scrollbar-thin scrollbar-thumb-border",style:{WebkitOverflowScrolling:"touch"},children:e.jsxs(ye,{className:"inline-flex w-max h-10 p-1 gap-0.5",children:[e.jsxs(y,{value:"report",className:"text-xs gap-1 whitespace-nowrap",children:[e.jsx(Y,{className:"h-3 w-3"})," All (",m.length,")"]}),e.jsxs(y,{value:"duplicates",className:"text-xs gap-1 whitespace-nowrap",children:[e.jsx(Q,{className:"h-3 w-3"})," Duplicates"]}),e.jsxs(y,{value:"thin",className:"text-xs gap-1 whitespace-nowrap",children:[e.jsx(R,{className:"h-3 w-3"})," Thin Value"]}),e.jsxs(y,{value:"ai",className:"text-xs gap-1 whitespace-nowrap",children:[e.jsx(de,{className:"h-3 w-3"})," AI-Sounding"]}),e.jsxs(y,{value:"noindex",className:"text-xs gap-1 whitespace-nowrap",children:[e.jsx(B,{className:"h-3 w-3"})," Not Indexable"]}),e.jsxs(y,{value:"clusters",className:"text-xs gap-1 whitespace-nowrap",children:[e.jsx(U,{className:"h-3 w-3"})," Boilerplate"]})]})}),e.jsx(we,{value:x,className:"mt-4",children:x==="clusters"?e.jsxs(f,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5 text-primary"}),"Boilerplate Clusters"]}),e.jsx(je,{children:"Groups of pages sharing identical paragraph blocks"})]}),e.jsxs(u,{onClick:()=>I.mutate(),disabled:I.isPending,variant:"outline",children:[I.isPending?e.jsx(b,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(E,{className:"h-4 w-4 mr-2"}),"Scan Clusters"]})]})}),e.jsx(N,{children:V.length>0?e.jsx(q,{className:"h-[500px]",children:e.jsx("div",{className:"space-y-3",children:V.map((s,a)=>e.jsxs("div",{className:"p-4 border rounded-xl bg-muted/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs(n,{variant:"outline",children:[s.page_count," pages share this block"]}),e.jsxs(n,{className:"bg-amber-500",children:["Cluster #",a+1]})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-2",children:s.pages.map(t=>e.jsxs("code",{className:"text-xs bg-muted px-1.5 py-0.5 rounded",children:["/",t]},t))})]},a))})}):e.jsx("p",{className:"text-center text-muted-foreground py-8",children:'Click "Scan Clusters" to detect boilerplate patterns'})})]}):e.jsxs(f,{children:[e.jsx(S,{children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[e.jsxs(P,{className:"text-lg",children:[C.length," Pages ",x!=="report"&&"(filtered)"]}),g.size>0&&e.jsx(u,{size:"sm",onClick:()=>$.mutate(Array.from(g)),disabled:$.isPending,className:"bg-gradient-to-r from-violet-500 to-primary gap-2",children:$.isPending?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-3 w-3 animate-spin"})," Fixing ",g.size,"..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-3 w-3"})," Fix All Selected (",g.size,")"]})})]})}),e.jsx(N,{children:e.jsx(q,{className:"h-[600px]",children:e.jsxs(be,{children:[e.jsx(fe,{children:e.jsxs(O,{className:"bg-muted/50",children:[e.jsx(i,{className:"w-10",children:e.jsx(W,{checked:C.length>0&&g.size===C.length,onCheckedChange:()=>se(C)})}),e.jsx(i,{className:"font-bold",children:"Page URL"}),e.jsx(i,{className:"font-bold text-center",children:"Type"}),e.jsx(i,{className:"font-bold text-center",children:"Identity"}),e.jsx(i,{className:"font-bold text-center",children:"Value"}),e.jsx(i,{className:"font-bold text-center",children:"AI Score"}),e.jsx(i,{className:"font-bold text-center",children:"Similar %"}),e.jsx(i,{className:"font-bold",children:"Issues"}),e.jsx(i,{className:"font-bold text-center",children:"Priority"}),e.jsx(i,{className:"text-center",children:"Index"}),e.jsx(i,{className:"text-right",children:"Actions"})]})}),e.jsx(Ne,{children:C.map(s=>{const a=Z[s.rewrite_priority]||Z.none;return e.jsxs(O,{className:"hover:bg-muted/30",children:[e.jsx(c,{children:e.jsx(W,{checked:g.has(s.id),onCheckedChange:()=>ae(s.id)})}),e.jsx(c,{children:e.jsxs("code",{className:"text-xs bg-muted px-1 py-0.5 rounded block max-w-[200px] truncate",children:["/",s.slug]})}),e.jsx(c,{className:"text-center",children:e.jsx(n,{variant:"outline",className:"text-xs",children:s.page_type})}),e.jsx(c,{className:"text-center",children:e.jsx("span",{className:`font-bold ${p(s.identity_score)}`,children:s.identity_score})}),e.jsx(c,{className:"text-center",children:e.jsx("span",{className:`font-bold ${p(s.page_value_score)}`,children:s.page_value_score})}),e.jsx(c,{className:"text-center",children:e.jsx("span",{className:s.ai_sounding_score>=50?"text-pink-500 font-bold":"text-muted-foreground",children:s.ai_sounding_score})}),e.jsx(c,{className:"text-center",children:e.jsxs("span",{className:s.max_text_similarity>=65?"text-red-500 font-bold":"text-muted-foreground",children:[s.max_text_similarity,"%"]})}),e.jsx(c,{children:e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-[200px]",children:[s.issues.slice(0,2).map(t=>e.jsx(n,{className:`text-[10px] px-1 py-0 text-white ${X[t]||"bg-gray-500"}`,children:t.replace("Duplicate ","Dup ").replace("Content","Cont")},t)),s.issues.length>2&&e.jsxs(n,{variant:"outline",className:"text-[10px] px-1 py-0",children:["+",s.issues.length-2]})]})}),e.jsx(c,{className:"text-center",children:e.jsx(n,{className:`text-[10px] ${a.color}`,children:a.label})}),e.jsx(c,{className:"text-center",children:s.is_index_worthy?e.jsx(xe,{className:"h-4 w-4 text-green-500 mx-auto"}):e.jsx(B,{className:"h-4 w-4 text-red-500 mx-auto"})}),e.jsx(c,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[s.issues.length>0&&e.jsxs(u,{size:"sm",variant:"outline",className:"text-xs gap-1 border-primary/30 text-primary hover:bg-primary/10",onClick:()=>v.mutate(s.id),disabled:v.isPending&&L===s.id,children:[v.isPending&&L===s.id?e.jsx(b,{className:"h-3 w-3 animate-spin"}):e.jsx(H,{className:"h-3 w-3"}),"Fix"]}),e.jsx(u,{size:"sm",variant:"ghost",onClick:()=>A(s),children:e.jsx(Ce,{className:"h-4 w-4"})})]})})]},s.id)})})]})})})]})})]}),!o.isPending&&m.length===0&&e.jsx(f,{className:"border-dashed",children:e.jsxs(N,{className:"py-12 text-center",children:[e.jsx(M,{className:"h-16 w-16 text-muted-foreground/30 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Scan Results Yet"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:['Click "Run Scan" to analyze your pages for duplicate content, AI-sounding text, thin value, and structural similarity. Pages are scanned in batches of ',w," to ensure reliable results."]}),e.jsxs(u,{onClick:()=>_(0),disabled:o.isPending,variant:"outline",children:[o.isPending?e.jsx(b,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(E,{className:"h-4 w-4 mr-2"}),"Start Full Scan"]})]})}),e.jsx(me,{open:!!l,onOpenChange:()=>A(null),children:e.jsxs(ue,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(he,{children:[e.jsxs(ge,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 text-primary"}),"Page Identity Details"]}),e.jsx(pe,{children:e.jsxs("code",{className:"text-sm",children:["/",l?.slug]})})]}),l&&e.jsxs("div",{className:"space-y-4",children:[l.issues?.length>0&&e.jsx(u,{onClick:()=>{v.mutate(l.id),A(null)},disabled:v.isPending,className:"w-full bg-gradient-to-r from-primary to-purple hover:opacity-90 gap-2",children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"h-4 w-4 animate-spin"})," Fixing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4"})," Fix All Issues with AI"]})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[{label:"Identity",value:l.identity_score,color:p(l.identity_score)},{label:"Value",value:l.page_value_score,color:p(l.page_value_score)},{label:"AI Score",value:l.ai_sounding_score,color:l.ai_sounding_score>=50?"text-pink-500":"text-green-500"},{label:"Local Auth.",value:l.local_authenticity_score,color:p(l.local_authenticity_score)}].map(s=>e.jsxs("div",{className:"text-center p-3 rounded-xl border bg-muted/20",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s.label}),e.jsx("p",{className:`text-2xl font-bold ${s.color}`,children:s.value})]},s.label))}),l.issues.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Issues Detected"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l.issues.map(s=>e.jsx(n,{className:`text-white ${X[s]||"bg-gray-500"}`,children:s},s))})]}),l.ai_flags?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"AI Detection Flags"}),e.jsx("ul",{className:"text-sm text-muted-foreground space-y-1",children:l.ai_flags.map((s,a)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx(R,{className:"h-3 w-3 text-pink-500"})," ",s]},a))})]}),l.similar_pages?.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Most Similar Pages"}),e.jsx("div",{className:"space-y-2",children:l.similar_pages.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg border text-sm",children:[e.jsxs("code",{className:"text-xs",children:["/",s.slug]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",className:"text-xs",children:["Text: ",Math.round(s.textSim*100),"%"]}),e.jsxs(n,{variant:"outline",className:"text-xs",children:["Struct: ",Math.round(s.structSim*100),"%"]}),s.metaSim&&e.jsx(n,{className:"bg-amber-500 text-white text-xs",children:"Same Meta"})]})]},s.slug))})]})]})]})})]})}export{Qe as default};
