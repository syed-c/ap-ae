import{b as ee,u as se,c as P,j as e}from"./chunk-CPh6voF3.js";import{r as l}from"./chunk-CffrGP6S.js";import{b as te,c as ae}from"./chunk-Drd-rt-S.js";import{ak as ne,m as v,l as E,Q as T,t as R,w as re,x as le,P as q,v as ie,a8 as ce,A as oe,B as o,a9 as $,aa as Y,ab as F,ac as Q,ad as B,ae as K,a1 as de,a2 as me,a3 as xe,a5 as ue,a6 as he,a7 as pe,s as w,C as I}from"./index-DflORfjh.js";import{P as y}from"./chunk-D3ia1n3Z.js";import{C as fe}from"./chunk-8Vpa5_RZ.js";import{T as L}from"./chunk-DbdCK11k.js";import{C as j}from"./chunk-CbEmr7WL.js";import{R as C}from"./chunk-BOvFDp2b.js";import{p as ge}from"./chunk-CaZUr2rj.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-aAsotRsv.js";import"./chunk-C_nua8Pg.js";import"./chunk-DncHrJ4I.js";import"./chunk-BcyAVLmp.js";import"./chunk-B2Rulxe9.js";const je=Array.from({length:20},(a,d)=>{const r=Math.floor(d/2)+9,n=d%2===0?"00":"30",m=`${r.toString().padStart(2,"0")}:${n}`,b=r<12?`${r}:${n} AM`:r===12?`12:${n} PM`:`${r-12}:${n} PM`;return{value:m,label:b}}),Qe=()=>{const{token:a}=te(),[d]=ae(),r=d.get("action"),{toast:n}=ne(),m=ee(),[b,x]=l.useState(r==="cancel"),[O,u]=l.useState(r==="reschedule"),[h,z]=l.useState(),[p,V]=l.useState(""),[i,f]=l.useState(!1),[c,S]=l.useState(null);l.useEffect(()=>{let s=document.querySelector('meta[name="robots"]');return s||(s=document.createElement("meta"),s.setAttribute("name","robots"),document.head.appendChild(s)),s.setAttribute("content","noindex, nofollow"),()=>{s?.setAttribute("content","index, follow")}},[]);const{data:t,isLoading:H,error:U}=se({queryKey:["appointment-manage",a],queryFn:async()=>{if(!a)throw new Error("No token provided");const{data:s,error:M}=await w.from("appointments").select(`
          *,
          clinic:clinics!appointments_clinic_id_fkey(id, name, phone, address, slug),
          dentist:dentists(id, name, slug),
          treatment:treatments(id, name)
        `).eq("manage_token",a).maybeSingle();if(M)throw M;if(!s)throw new Error("Appointment not found");return s},enabled:!!a}),X=P({mutationFn:async()=>{if(!a)throw new Error("No token");const{error:s}=await w.from("appointments").update({status:"cancelled"}).eq("manage_token",a);if(s)throw s},onSuccess:()=>{m.invalidateQueries({queryKey:["appointment-manage",a]}),x(!1),S("cancelled"),n({title:"Appointment Cancelled",description:"Your appointment has been successfully cancelled."})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),G=P({mutationFn:async()=>{if(!a||!h||!p)throw new Error("Please select a new date and time");const{error:s}=await w.from("appointments").update({preferred_date:T(h,"yyyy-MM-dd"),preferred_time:p,status:"pending",confirmed_date:null,confirmed_time:null}).eq("manage_token",a);if(s)throw s},onSuccess:()=>{m.invalidateQueries({queryKey:["appointment-manage",a]}),u(!1),S("rescheduled"),n({title:"Appointment Rescheduled",description:"Your appointment has been rescheduled. The clinic will confirm your new time."})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),J=async()=>{f(!0),await X.mutateAsync(),f(!1)},W=async()=>{f(!0),await G.mutateAsync(),f(!1)};if(H)return e.jsx(y,{children:e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4 animate-pulse",children:e.jsx(v,{className:"h-8 w-8 text-primary"})}),e.jsx("p",{className:"text-muted-foreground",children:"Loading appointment details..."})]})})});if(U||!t)return e.jsx(y,{children:e.jsx("div",{className:"min-h-[60vh] flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-md mx-auto px-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-6",children:e.jsx(L,{className:"h-10 w-10 text-destructive"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-3",children:"Appointment Not Found"}),e.jsx("p",{className:"text-muted-foreground",children:"This link may have expired or the appointment doesn't exist. Please contact the clinic directly if you need assistance."})]})})});const N=t.status||"pending",A=["pending","confirmed"].includes(N),k=["pending","confirmed"].includes(N),_=t.confirmed_date||t.preferred_date,Z=t.confirmed_time||t.preferred_time,D={pending:{color:"text-amber-600",bg:"bg-amber-50 border-amber-200",icon:e.jsx(R,{className:"h-5 w-5"}),label:"Pending Confirmation"},confirmed:{color:"text-emerald-600",bg:"bg-emerald-50 border-emerald-200",icon:e.jsx(I,{className:"h-5 w-5"}),label:"Confirmed"},completed:{color:"text-blue-600",bg:"bg-blue-50 border-blue-200",icon:e.jsx(I,{className:"h-5 w-5"}),label:"Completed"},cancelled:{color:"text-destructive",bg:"bg-destructive/5 border-destructive/20",icon:e.jsx(j,{className:"h-5 w-5"}),label:"Cancelled"},no_show:{color:"text-slate-600",bg:"bg-slate-50 border-slate-200",icon:e.jsx(L,{className:"h-5 w-5"}),label:"No Show"}},g=D[N]||D.pending;return e.jsxs(y,{children:[e.jsx("div",{className:"min-h-[70vh] py-12",children:e.jsxs("div",{className:"container max-w-2xl mx-auto px-4",children:[c&&e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:E("w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6",c==="cancelled"?"bg-destructive/10":"bg-emerald-100"),children:c==="cancelled"?e.jsx(j,{className:"h-10 w-10 text-destructive"}):e.jsx(C,{className:"h-10 w-10 text-emerald-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-foreground mb-2",children:c==="cancelled"?"Appointment Cancelled":"Appointment Rescheduled"}),e.jsx("p",{className:"text-muted-foreground",children:c==="cancelled"?"Your appointment has been successfully cancelled.":"Your new appointment request has been sent. The clinic will confirm your time."})]}),e.jsxs("div",{className:"bg-card border border-border rounded-3xl overflow-hidden shadow-lg",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary/10 via-primary/5 to-transparent p-6 border-b border-border",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-primary/10 flex items-center justify-center",children:e.jsx(v,{className:"h-7 w-7 text-primary"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Your Appointment"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your booking details"})]})]}),e.jsxs("div",{className:E("inline-flex items-center gap-2 px-4 py-2 rounded-full border",g.bg,g.color),children:[g.icon,e.jsx("span",{className:"font-bold",children:g.label})]})]}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-muted/50 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(v,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Date"})]}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:_?T(ge(_),"EEEE, MMMM d, yyyy"):"Not set"})]}),e.jsxs("div",{className:"bg-muted/50 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(R,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Time"})]}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:Z||"Not set"})]})]}),t.clinic&&e.jsxs("div",{className:"bg-muted/50 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(re,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Clinic"})]}),e.jsx("p",{className:"text-lg font-bold text-foreground mb-2",children:t.clinic.name}),t.clinic.address&&e.jsxs("div",{className:"flex items-start gap-2 text-muted-foreground",children:[e.jsx(le,{className:"h-4 w-4 mt-0.5 shrink-0"}),e.jsx("span",{className:"text-sm",children:t.clinic.address})]}),t.clinic.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mt-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("a",{href:`tel:${t.clinic.phone}`,className:"text-sm hover:text-primary transition-colors",children:t.clinic.phone})]})]}),t.treatment&&e.jsxs("div",{className:"bg-muted/50 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(ie,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Service"})]}),e.jsx("p",{className:"text-lg font-bold text-foreground",children:t.treatment.name})]}),e.jsxs("div",{className:"bg-muted/50 rounded-2xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ce,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Patient Details"})]}),e.jsx("p",{className:"font-bold text-foreground mb-2",children:t.patient_name}),e.jsxs("div",{className:"space-y-1 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:t.patient_phone})]}),t.patient_email&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{children:t.patient_email})]})]})]}),(A||k)&&!c&&e.jsx("div",{className:"pt-4 border-t border-border",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[k&&e.jsxs(o,{variant:"outline",size:"lg",className:"flex-1 rounded-2xl font-bold h-14",onClick:()=>u(!0),children:[e.jsx(C,{className:"h-5 w-5 mr-2"}),"Reschedule"]}),A&&e.jsxs(o,{variant:"outline",size:"lg",className:"flex-1 rounded-2xl font-bold h-14 border-destructive/30 text-destructive hover:bg-destructive/10 hover:text-destructive",onClick:()=>x(!0),children:[e.jsx(j,{className:"h-5 w-5 mr-2"}),"Cancel Appointment"]})]})})]})]})]})}),e.jsx($,{open:b,onOpenChange:x,children:e.jsxs(Y,{className:"sm:max-w-md rounded-3xl",children:[e.jsxs(F,{children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-destructive/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(j,{className:"h-8 w-8 text-destructive"})}),e.jsx(Q,{className:"text-center text-xl",children:"Cancel Appointment?"}),e.jsx(B,{className:"text-center",children:"Are you sure you want to cancel this appointment? This action cannot be undone."})]}),e.jsxs(K,{className:"flex-col sm:flex-row gap-3 pt-4",children:[e.jsx(o,{variant:"outline",className:"flex-1 rounded-xl",onClick:()=>x(!1),disabled:i,children:"Keep Appointment"}),e.jsx(o,{variant:"destructive",className:"flex-1 rounded-xl",onClick:J,disabled:i,children:i?"Cancelling...":"Yes, Cancel"})]})]})}),e.jsx($,{open:O,onOpenChange:u,children:e.jsxs(Y,{className:"sm:max-w-lg rounded-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(F,{children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(C,{className:"h-8 w-8 text-primary"})}),e.jsx(Q,{className:"text-center text-xl",children:"Reschedule Appointment"}),e.jsx(B,{className:"text-center",children:"Choose a new date and time for your appointment"})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"Select New Date"}),e.jsx("div",{className:"flex justify-center",children:e.jsx(fe,{mode:"single",selected:h,onSelect:z,disabled:s=>s<de(new Date,1),className:"rounded-2xl border border-border pointer-events-auto"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium text-foreground mb-3 block",children:"Select New Time"}),e.jsxs(me,{value:p,onValueChange:V,children:[e.jsx(xe,{className:"rounded-xl h-12",children:e.jsx(ue,{placeholder:"Choose a time slot"})}),e.jsx(he,{className:"max-h-64",children:je.map(s=>e.jsx(pe,{value:s.value,children:s.label},s.value))})]})]})]}),e.jsxs(K,{className:"flex-col sm:flex-row gap-3 pt-4",children:[e.jsx(o,{variant:"outline",className:"flex-1 rounded-xl",onClick:()=>u(!1),disabled:i,children:"Cancel"}),e.jsx(o,{className:"flex-1 rounded-xl",onClick:W,disabled:i||!h||!p,children:i?"Rescheduling...":"Confirm Reschedule"})]})]})})]})};export{Qe as default};
