import{u as Z,j as e,b as fe,c as K}from"./chunk-CPh6voF3.js";import{r as f}from"./chunk-CffrGP6S.js";import{T as Le,a as Me,b as ee,c as se}from"./chunk-k8HiDHrE.js";import{f as Ne,a4 as Ee,i as u,p as ae,I as be,a2 as $,a3 as U,a5 as G,a6 as V,a7 as z,B as h,S as X,b7 as w,H as Re,F as ve,s as C,bK as Ie,bB as Oe,J as E,K as R,N as I,O,C as W,Z as we,a as b,y as Be,al as Je,bA as ye,a9 as _e,aa as Ce,ab as ke,ac as Se,ad as Te,ae as Pe,b as F,Q as pe,aG as Qe,t as je,bC as Ke}from"./index-DflORfjh.js";import{C as le,a as ce,b as oe,d as de,c as Fe}from"./chunk-Dwq_v72W.js";import{T as re,a as ne,b as _,c as m,d as ie,e as c}from"./chunk-NLs5Ye4A.js";import{E as xe}from"./chunk-CcezodbN.js";import{E as $e}from"./chunk-CbETxTmt.js";import{C as Y}from"./chunk-CbEmr7WL.js";import{T as te}from"./chunk-DbdCK11k.js";import{P as Ue}from"./chunk-DSDQubI6.js";import{H as Ge}from"./chunk-K8HBjO-X.js";import{F as Ve}from"./chunk-BaL04tya.js";import{A as We}from"./chunk-oOYeAGgD.js";import{C as Ze}from"./chunk-C14yCe0w.js";import{L as Xe}from"./chunk-B0x3dbdo.js";import{H as Ae}from"./chunk-C077LRJi.js";import{R as ge}from"./chunk-3oqKMbN4.js";import{B as Ye}from"./chunk-Bl7VVhKV.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-BSjc5zjM.js";import"./chunk-C2VW2Ml6.js";import"./chunk-I1o_Hd8I.js";import"./chunk-CyRXX0qx.js";import"./chunk-DncHrJ4I.js";import"./chunk-j7XJPWWF.js";import"./chunk-GLPyMM0F.js";import"./chunk-CedtSHBb.js";import"./chunk-B7d2qnKb.js";import"./chunk-D2X27E5n.js";import"./chunk-B_ghW3Ra.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=Ne("ChevronsLeft",[["path",{d:"m11 17-5-5 5-5",key:"13zhaf"}],["path",{d:"m18 17-5-5 5-5",key:"h8a8et"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=Ne("ChevronsRight",[["path",{d:"m6 17 5-5-5-5",key:"xnjwq"}],["path",{d:"m13 17 5-5-5-5",key:"17xmmf"}]]),ts=[{value:"all",label:"All Page Types"},{value:"state",label:"State Pages"},{value:"city",label:"City Pages"},{value:"city_treatment",label:"Service + Location"},{value:"treatment",label:"Service Pages"},{value:"clinic",label:"Clinic Profiles"},{value:"dentist",label:"Dentist Profiles"},{value:"blog",label:"Blog Posts"},{value:"static",label:"Static Pages"}],as=[{value:"all",label:"All Statuses"},{value:"missing_meta",label:"Missing Meta"},{value:"missing_h1",label:"Missing H1"},{value:"thin_content",label:"Thin Content (<300 words)"},{value:"no_content",label:"No Content"},{value:"duplicate",label:"Duplicate Content"},{value:"low_score",label:"Low SEO Score (<50)"},{value:"needs_optimization",label:"Needs Optimization"},{value:"optimized",label:"Already Optimized"}],Q=50;function rs({selectedPages:i,onSelectionChange:l,onInspectPage:T}){const[r,k]=f.useState(""),[p,H]=f.useState("all"),[S,B]=f.useState("all"),[v,L]=f.useState(""),[A,q]=f.useState(""),[o,N]=f.useState(1),{data:j,isLoading:t}=Z({queryKey:["seo-pages-picker"],queryFn:async()=>{const x=[];let y=0;for(;;){const{data:He,error:he}=await C.from("seo_pages").select("*").order("slug",{ascending:!0}).range(y,y+1e3-1);if(he)throw he;const me=He||[],ze=me.filter(ue=>Ie(ue.slug,ue.page_type));if(x.push(...ze),me.length<1e3)break;y+=1e3}return x}}),{data:n}=Z({queryKey:["seo-filter-options"],queryFn:async()=>{const[{data:s},{data:x}]=await Promise.all([C.from("states").select("slug, name, abbreviation").eq("is_active",!0).in("slug",Oe).order("name"),C.from("cities").select("slug, name, state_id").eq("is_active",!0).order("name").limit(500)]);return{states:s||[],cities:x||[]}}}),g=f.useMemo(()=>j?j.filter(s=>{if(r&&!s.slug.toLowerCase().includes(r.toLowerCase())&&!(s.title||"").toLowerCase().includes(r.toLowerCase())||p!=="all"&&s.page_type!==p||v&&!s.slug.includes(`/${v}/`)||A&&!s.slug.includes(`/${A}`))return!1;switch(S){case"missing_meta":if(s.meta_title&&s.meta_description)return!1;break;case"missing_h1":if(s.h1)return!1;break;case"thin_content":if(!s.is_thin_content)return!1;break;case"no_content":if(s.content&&(s.word_count||0)>=50)return!1;break;case"duplicate":if(!s.is_duplicate)return!1;break;case"low_score":if((s.seo_score||100)>=50)return!1;break;case"needs_optimization":if(!s.needs_optimization)return!1;break;case"optimized":if(!s.is_optimized)return!1;break}return!0}):[],[j,r,p,S,v,A]),D=Math.ceil(g.length/Q),P=g.slice((o-1)*Q,o*Q),a=s=>{i.includes(s)?l(i.filter(x=>x!==s)):l([...i,s])},d=()=>{const s=g.map(y=>y.id),x=[...new Set([...i,...s])];l(x)},M=()=>{l([])},J=()=>{const s=P.map(y=>y.id),x=[...new Set([...i,...s])];l(x)},qe=s=>s===null?e.jsx(u,{variant:"outline",children:"—"}):s>=80?e.jsx(u,{className:"bg-teal/20 text-teal border-teal/30",children:s}):s>=50?e.jsx(u,{className:"bg-gold/20 text-gold border-gold/30",children:s}):e.jsx(u,{className:"bg-coral/20 text-coral border-coral/30",children:s}),De=s=>{const x=[];return s.meta_title||x.push(e.jsx(E,{children:e.jsxs(R,{children:[e.jsx(I,{children:e.jsx(Y,{className:"h-3 w-3 text-destructive"})}),e.jsx(O,{children:"Missing meta title"})]})},"mt")),s.meta_description||x.push(e.jsx(E,{children:e.jsxs(R,{children:[e.jsx(I,{children:e.jsx(Y,{className:"h-3 w-3 text-destructive"})}),e.jsx(O,{children:"Missing meta description"})]})},"md")),s.h1||x.push(e.jsx(E,{children:e.jsxs(R,{children:[e.jsx(I,{children:e.jsx(te,{className:"h-3 w-3 text-gold"})}),e.jsx(O,{children:"Missing H1"})]})},"h1")),s.is_thin_content&&x.push(e.jsx(E,{children:e.jsxs(R,{children:[e.jsx(I,{children:e.jsx(te,{className:"h-3 w-3 text-coral"})}),e.jsx(O,{children:"Thin content"})]})},"tc")),s.is_duplicate&&x.push(e.jsx(E,{children:e.jsxs(R,{children:[e.jsx(I,{children:e.jsx(te,{className:"h-3 w-3 text-coral"})}),e.jsx(O,{children:"Duplicate"})]})},"dp")),x.length===0&&x.push(e.jsx(E,{children:e.jsxs(R,{children:[e.jsx(I,{children:e.jsx(W,{className:"h-3 w-3 text-teal"})}),e.jsx(O,{children:"OK"})]})},"ok")),x};return e.jsxs(le,{children:[e.jsx(ce,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(oe,{className:"text-lg flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5"}),"Page Picker"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",children:[g.length," pages"]}),e.jsxs(u,{className:"bg-primary/20 text-primary",children:[i.length," selected"]})]})]})}),e.jsxs(de,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(be,{placeholder:"Search by URL or title...",value:r,onChange:s=>{k(s.target.value),N(1)},className:"pl-9"})]}),e.jsxs($,{value:p,onValueChange:s=>{H(s),N(1)},children:[e.jsx(U,{children:e.jsx(G,{placeholder:"Page Type"})}),e.jsx(V,{children:ts.map(s=>e.jsx(z,{value:s.value,children:s.label},s.value))})]}),e.jsxs($,{value:S,onValueChange:s=>{B(s),N(1)},children:[e.jsx(U,{children:e.jsx(G,{placeholder:"Status"})}),e.jsx(V,{children:as.map(s=>e.jsx(z,{value:s.value,children:s.label},s.value))})]}),e.jsxs($,{value:v||"__all__",onValueChange:s=>{L(s==="__all__"?"":s),q(""),N(1)},children:[e.jsx(U,{children:e.jsx(G,{placeholder:"Filter by State"})}),e.jsxs(V,{children:[e.jsx(z,{value:"__all__",children:"All States"}),n?.states.map(s=>e.jsx(z,{value:s.slug||"__empty__",children:s.name},s.slug))]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:J,children:["Select Page (",P.length,")"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:d,children:["Select All Filtered (",g.length,")"]}),e.jsx(h,{variant:"ghost",size:"sm",onClick:M,children:"Clear Selection"})]}),e.jsx(X,{className:"h-[400px] border rounded-md",children:e.jsxs(re,{children:[e.jsx(ne,{children:e.jsxs(_,{children:[e.jsx(m,{className:"w-10",children:e.jsx(w,{checked:P.length>0&&P.every(s=>i.includes(s.id)),onCheckedChange:s=>{if(s)J();else{const x=P.map(y=>y.id);l(i.filter(y=>!x.includes(y)))}}})}),e.jsx(m,{children:"URL"}),e.jsx(m,{className:"w-24",children:"Type"}),e.jsx(m,{className:"w-16",children:"Score"}),e.jsx(m,{className:"w-16",children:"Words"}),e.jsx(m,{className:"w-20",children:"Status"}),e.jsx(m,{className:"w-20",children:"Actions"})]})}),e.jsx(ie,{children:t?e.jsx(_,{children:e.jsx(c,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"Loading pages..."})}):P.length===0?e.jsx(_,{children:e.jsx(c,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No pages match your filters"})}):P.map(s=>e.jsxs(_,{className:i.includes(s.id)?"bg-primary/5":"",children:[e.jsx(c,{children:e.jsx(w,{checked:i.includes(s.id),onCheckedChange:()=>a(s.id)})}),e.jsx(c,{className:"font-mono text-xs max-w-[300px] truncate",title:s.slug,children:s.slug}),e.jsx(c,{children:e.jsx(u,{variant:"outline",className:"text-xs",children:s.page_type})}),e.jsx(c,{children:qe(s.seo_score)}),e.jsx(c,{className:"text-xs text-muted-foreground",children:s.word_count||0}),e.jsx(c,{children:e.jsx("div",{className:"flex items-center gap-1",children:De(s)})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[T&&e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>T(s),children:e.jsx(xe,{className:"h-3 w-3"})}),e.jsx("a",{href:`https://www.appointpanda.ae${s.slug}`,target:"_blank",rel:"noopener noreferrer",children:e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",children:e.jsx($e,{className:"h-3 w-3"})})})]})})]},s.id))})]})}),D>1&&e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",(o-1)*Q+1,"–",Math.min(o*Q,g.length)," of ",g.length]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{variant:"outline",size:"icon",className:"h-8 w-8",disabled:o===1,onClick:()=>N(1),children:e.jsx(es,{className:"h-4 w-4"})}),e.jsx(h,{variant:"outline",size:"icon",className:"h-8 w-8",disabled:o===1,onClick:()=>N(s=>s-1),children:e.jsx(Re,{className:"h-4 w-4"})}),e.jsxs("span",{className:"px-3 text-sm",children:["Page ",o," of ",D]}),e.jsx(h,{variant:"outline",size:"icon",className:"h-8 w-8",disabled:o===D,onClick:()=>N(s=>s+1),children:e.jsx(ve,{className:"h-4 w-4"})}),e.jsx(h,{variant:"outline",size:"icon",className:"h-8 w-8",disabled:o===D,onClick:()=>N(D),children:e.jsx(ss,{className:"h-4 w-4"})})]})]})]})]})}const ns={regenerateH1:!0,regenerateH2:!1,regenerateMetaTitle:!0,regenerateMetaDescription:!0,regenerateIntro:!1,regenerateSections:!1,regenerateFaq:!1,addInternalLinks:!1,rewriteForUniqueness:!1,expandContent:!1,targetWordCount:500};function is({selectedPageIds:i,onJobStarted:l}){const T=fe(),[r,k]=f.useState(ns),[p,H]=f.useState("draft"),[S,B]=f.useState(70),[v,L]=f.useState(""),[A,q]=f.useState(!1),[o,N]=f.useState(null),[j,t]=f.useState(null),n=a=>{typeof r[a]=="boolean"&&k(d=>({...d,[a]:!d[a]}))},g=K({mutationFn:async()=>{const{data:a,error:d}=await C.from("seo_fix_jobs").insert([{job_type:"bulk_regenerate",status:"pending",filters:JSON.parse(JSON.stringify({selected_page_ids:i})),regeneration_config:JSON.parse(JSON.stringify(r)),target_word_count:r.targetWordCount,apply_mode:p,quality_threshold:S,total_pages:i.length,notes:v||null}]).select("id").single();if(d)throw d;t({isRunning:!0,jobId:a.id,total:i.length,processed:0,successful:0,failed:0,currentSlug:"",logs:[{timestamp:new Date,message:`Starting job with ${i.length} pages...`,type:"info"}]}),l&&l(a.id);const{data:M,error:J}=await C.functions.invoke("seo-bulk-processor",{body:{action:"process_job",job_id:a.id,page_ids:i,config:r,apply_mode:p,quality_threshold:S,custom_prompt:v||void 0}});if(J)throw J;return M},onSuccess:a=>{t(d=>d?{...d,isRunning:!1,processed:a.processed||d.total,successful:a.successful||0,failed:a.failed||0,logs:[...d.logs,{timestamp:new Date,message:`Job completed: ${a.successful} successful, ${a.failed} failed`,type:"success"}]}:null),T.invalidateQueries({queryKey:["seo-pages-picker"]}),T.invalidateQueries({queryKey:["seo-fix-jobs"]}),F.success(`Bulk job completed! ${a.successful} pages processed.`)},onError:a=>{t(d=>d?{...d,isRunning:!1,logs:[...d.logs,{timestamp:new Date,message:`Error: ${a.message}`,type:"error"}]}:null),F.error(`Job failed: ${a.message}`)}}),D=K({mutationFn:async a=>{const{data:d,error:M}=await C.functions.invoke("seo-content-optimizer",{body:{action:"preview_optimization",page_id:a,config:r,custom_prompt:v||void 0}});if(M)throw M;return d},onSuccess:a=>{N(a),q(!0)},onError:a=>F.error(a.message)}),P=()=>{let a=0;return r.regenerateH1&&a++,r.regenerateH2&&a++,r.regenerateMetaTitle&&a++,r.regenerateMetaDescription&&a++,r.regenerateIntro&&a++,r.regenerateSections&&a++,r.regenerateFaq&&a++,r.addInternalLinks&&a++,r.rewriteForUniqueness&&a++,r.expandContent&&a++,a};return e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-5 w-5 text-primary"}),"Bulk Actions"]}),e.jsxs(Fe,{children:["Configure what to regenerate for ",i.length," selected pages"]})]}),e.jsxs(de,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h4",{className:"font-medium text-sm flex items-center gap-2",children:["Regeneration Options",e.jsxs(u,{variant:"outline",children:[P()," active"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"h1",checked:r.regenerateH1,onCheckedChange:()=>n("regenerateH1")}),e.jsxs(b,{htmlFor:"h1",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(Ge,{className:"h-4 w-4"})," H1 Heading"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"h2",checked:r.regenerateH2,onCheckedChange:()=>n("regenerateH2")}),e.jsx(b,{htmlFor:"h2",className:"cursor-pointer",children:"H2/H3 Outline"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"metaTitle",checked:r.regenerateMetaTitle,onCheckedChange:()=>n("regenerateMetaTitle")}),e.jsxs(b,{htmlFor:"metaTitle",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(Ve,{className:"h-4 w-4"})," Meta Title"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"metaDesc",checked:r.regenerateMetaDescription,onCheckedChange:()=>n("regenerateMetaDescription")}),e.jsx(b,{htmlFor:"metaDesc",className:"cursor-pointer",children:"Meta Description"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"intro",checked:r.regenerateIntro,onCheckedChange:()=>n("regenerateIntro")}),e.jsxs(b,{htmlFor:"intro",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(We,{className:"h-4 w-4"})," Intro Section"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"sections",checked:r.regenerateSections,onCheckedChange:()=>n("regenerateSections")}),e.jsx(b,{htmlFor:"sections",className:"cursor-pointer",children:"Core Sections (2-5)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"faq",checked:r.regenerateFaq,onCheckedChange:()=>n("regenerateFaq")}),e.jsxs(b,{htmlFor:"faq",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(Ze,{className:"h-4 w-4"})," FAQ (3-6)"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"links",checked:r.addInternalLinks,onCheckedChange:()=>n("addInternalLinks")}),e.jsxs(b,{htmlFor:"links",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(Xe,{className:"h-4 w-4"})," Internal Links"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"unique",checked:r.rewriteForUniqueness,onCheckedChange:()=>n("rewriteForUniqueness")}),e.jsxs(b,{htmlFor:"unique",className:"flex items-center gap-1 cursor-pointer",children:[e.jsx(Be,{className:"h-4 w-4"})," High Uniqueness"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{id:"expand",checked:r.expandContent,onCheckedChange:()=>n("expandContent")}),e.jsx(b,{htmlFor:"expand",className:"cursor-pointer",children:"Expand Thin Content to:"})]}),e.jsxs($,{value:String(r.targetWordCount),onValueChange:a=>k(d=>({...d,targetWordCount:parseInt(a)})),disabled:!r.expandContent,children:[e.jsx(U,{className:"w-32",children:e.jsx(G,{})}),e.jsxs(V,{children:[e.jsx(z,{value:"500",children:"500 words"}),e.jsx(z,{value:"700",children:"700 words"}),e.jsx(z,{value:"1000",children:"1000 words"})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Apply Mode"}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(h,{variant:p==="draft"?"default":"outline",size:"sm",onClick:()=>H("draft"),children:"Draft Only"}),e.jsx(h,{variant:p==="quality_gated"?"default":"outline",size:"sm",onClick:()=>H("quality_gated"),children:"Quality Gated"}),e.jsx(h,{variant:p==="auto_apply"?"default":"outline",size:"sm",onClick:()=>H("auto_apply"),children:"Auto Apply"})]}),p==="quality_gated"&&e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(b,{className:"text-sm",children:"Apply only if score ≥"}),e.jsx(be,{type:"number",value:S,onChange:a=>B(parseInt(a.target.value)||70),className:"w-20",min:0,max:100})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"Custom Instructions (Optional)"}),e.jsx(Je,{value:v,onChange:a=>L(a.target.value),placeholder:"Add specific instructions for the AI, e.g., 'Focus on emergency dental services' or 'Mention insurance options'",className:"min-h-[80px]"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-4 border-t",children:[i.length===1&&e.jsxs(h,{variant:"outline",onClick:()=>D.mutate(i[0]),disabled:D.isPending,children:[e.jsx(xe,{className:"h-4 w-4 mr-2"}),"Preview Changes"]}),e.jsxs(h,{onClick:()=>g.mutate(),disabled:i.length===0||g.isPending||j?.isRunning,className:"flex-1",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),p==="draft"?"Generate Drafts":p==="auto_apply"?"Apply Live":"Run with Quality Gate","(",i.length," pages)"]})]}),j&&e.jsxs("div",{className:"space-y-3 p-4 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:"Job Progress"}),e.jsx(u,{variant:j.isRunning?"default":"outline",children:j.isRunning?"Running":"Completed"})]}),e.jsx(Ue,{value:j.processed/j.total*100}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[e.jsxs("span",{children:[j.processed," / ",j.total," processed"]}),e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-teal",children:["✓ ",j.successful]}),e.jsxs("span",{className:"text-coral",children:["✗ ",j.failed]})]})]}),j.currentSlug&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Processing: ",j.currentSlug]}),e.jsx(X,{className:"h-24 border rounded p-2",children:j.logs.map((a,d)=>e.jsxs("p",{className:`text-xs ${a.type==="error"?"text-destructive":a.type==="success"?"text-teal":"text-muted-foreground"}`,children:["[",a.timestamp.toLocaleTimeString(),"] ",a.message]},d))})]}),e.jsx(_e,{open:A,onOpenChange:q,children:e.jsxs(Ce,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsx(Se,{children:"Preview Changes"}),e.jsx(Te,{children:"Review generated content before applying"})]}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2 text-muted-foreground",children:"Before"}),e.jsxs("div",{className:"p-3 rounded border bg-muted/50 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",o.before?.meta_title||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",o.before?.meta_description||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"H1:"})," ",o.before?.h1||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Words:"})," ",o.before?.word_count||0]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2 text-teal",children:"After"}),e.jsxs("div",{className:"p-3 rounded border border-teal/30 bg-teal/5 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",o.after?.meta_title]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",o.after?.meta_description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"H1:"})," ",o.after?.h1]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Words:"})," ",o.after?.word_count||0]})]})]})]}),o.after?.h2_sections&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Generated Sections"}),e.jsx("div",{className:"p-3 rounded border space-y-2 text-sm",children:o.after.h2_sections.map((a,d)=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.heading}),e.jsxs("p",{className:"text-muted-foreground text-xs",children:[a.content?.slice(0,100),"..."]})]},d))})]})]}),e.jsx(Pe,{children:e.jsx(h,{variant:"outline",onClick:()=>q(!1),children:"Close"})})]})})]})]})}function ls(){const i=fe(),[l,T]=f.useState(null),[r,k]=f.useState(!1),[p,H]=f.useState(new Set),{data:S,isLoading:B}=Z({queryKey:["seo-fix-jobs"],queryFn:async()=>{const{data:t,error:n}=await C.from("seo_fix_jobs").select("*").order("created_at",{ascending:!1}).limit(50);if(n)throw n;return t}}),{data:v}=Z({queryKey:["seo-fix-job-items",l?.id],queryFn:async()=>{if(!l)return[];const{data:t,error:n}=await C.from("seo_fix_job_items").select("*").eq("job_id",l.id).order("created_at",{ascending:!0});if(n)throw n;return t},enabled:!!l}),L=K({mutationFn:async t=>{const{data:n,error:g}=await C.functions.invoke("seo-bulk-processor",{body:{action:"rollback_item",item_id:t}});if(g)throw g;return n},onSuccess:()=>{i.invalidateQueries({queryKey:["seo-fix-job-items"]}),i.invalidateQueries({queryKey:["seo-pages-picker"]}),F.success("Changes rolled back successfully")},onError:t=>F.error(t.message)}),A=K({mutationFn:async t=>{const{data:n,error:g}=await C.functions.invoke("seo-bulk-processor",{body:{action:"rollback_job",job_id:t}});if(g)throw g;return n},onSuccess:t=>{i.invalidateQueries({queryKey:["seo-fix-jobs"]}),i.invalidateQueries({queryKey:["seo-fix-job-items"]}),i.invalidateQueries({queryKey:["seo-pages-picker"]}),F.success(`Rolled back ${t.rolled_back_count} pages`)},onError:t=>F.error(t.message)}),q=K({mutationFn:async t=>{const{data:n,error:g}=await C.functions.invoke("seo-bulk-processor",{body:{action:"apply_pending",job_id:t}});if(g)throw g;return n},onSuccess:t=>{i.invalidateQueries({queryKey:["seo-fix-job-items"]}),i.invalidateQueries({queryKey:["seo-pages-picker"]}),F.success(`Applied ${t.applied_count} changes`)},onError:t=>F.error(t.message)}),o=t=>{switch(t){case"completed":return e.jsxs(u,{className:"bg-teal/20 text-teal border-teal/30",children:[e.jsx(W,{className:"h-3 w-3 mr-1"}),"Completed"]});case"running":return e.jsxs(u,{className:"bg-primary/20 text-primary border-primary/30",children:[e.jsx(ye,{className:"h-3 w-3 mr-1"}),"Running"]});case"failed":return e.jsxs(u,{variant:"destructive",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Failed"]});case"cancelled":return e.jsxs(u,{variant:"outline",children:[e.jsx(Ke,{className:"h-3 w-3 mr-1"}),"Cancelled"]});default:return e.jsxs(u,{variant:"outline",children:[e.jsx(je,{className:"h-3 w-3 mr-1"}),"Pending"]})}},N=t=>{const n={bulk_regenerate:"Bulk Regenerate",meta_optimization:"Meta Fix",content_enrichment:"Content Enrichment",indexing_fix:"Indexing Fix"};return e.jsx(u,{variant:"outline",children:n[t]||t})},j=t=>{const n=new Set(p);n.has(t)?n.delete(t):n.add(t),H(n)};return e.jsxs(le,{children:[e.jsxs(ce,{children:[e.jsxs(oe,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-5 w-5"}),"Jobs History & Rollback"]}),e.jsx(Fe,{children:"View past optimization jobs and rollback changes"})]}),e.jsxs(de,{children:[e.jsx(X,{className:"h-[500px]",children:e.jsxs(re,{children:[e.jsx(ne,{children:e.jsxs(_,{children:[e.jsx(m,{children:"Date"}),e.jsx(m,{children:"Type"}),e.jsx(m,{children:"Status"}),e.jsx(m,{className:"text-center",children:"Pages"}),e.jsx(m,{className:"text-center",children:"Success"}),e.jsx(m,{children:"Mode"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(ie,{children:B?e.jsx(_,{children:e.jsx(c,{colSpan:7,className:"text-center py-8",children:"Loading..."})}):S?.length===0?e.jsx(_,{children:e.jsx(c,{colSpan:7,className:"text-center py-8 text-muted-foreground",children:"No jobs yet. Run a bulk optimization to see history."})}):S?.map(t=>e.jsxs(_,{children:[e.jsx(c,{className:"text-sm",children:pe(new Date(t.created_at),"MMM d, HH:mm")}),e.jsx(c,{children:N(t.job_type)}),e.jsx(c,{children:o(t.status)}),e.jsx(c,{className:"text-center",children:t.total_pages}),e.jsxs(c,{className:"text-center",children:[e.jsx("span",{className:"text-teal",children:t.successful_pages}),t.failed_pages>0&&e.jsxs("span",{className:"text-coral",children:[" / ",t.failed_pages]})]}),e.jsx(c,{children:e.jsx(u,{variant:"outline",className:"text-xs",children:t.apply_mode})}),e.jsx(c,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:()=>{T(t),k(!0)},children:e.jsx(xe,{className:"h-4 w-4"})}),t.status==="completed"&&t.successful_pages>0&&e.jsx(h,{variant:"ghost",size:"icon",className:"h-7 w-7 text-coral hover:text-coral",onClick:()=>A.mutate(t.id),disabled:A.isPending,children:e.jsx(ge,{className:"h-4 w-4"})})]})})]},t.id))})]})}),e.jsx(_e,{open:r,onOpenChange:k,children:e.jsxs(Ce,{className:"max-w-4xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs(ke,{children:[e.jsx(Se,{children:"Job Details"}),e.jsx(Te,{children:l&&e.jsxs("span",{children:[N(l.job_type)," • ",pe(new Date(l.created_at),"PPp")]})})]}),l&&e.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[o(l.status),e.jsxs("span",{className:"text-sm",children:["Processed: ",l.processed_pages,"/",l.total_pages]}),e.jsxs("span",{className:"text-sm text-teal",children:["✓ ",l.successful_pages]}),e.jsxs("span",{className:"text-sm text-coral",children:["✗ ",l.failed_pages]})]}),l.regeneration_config&&e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(l.regeneration_config).filter(([t,n])=>n===!0).map(([t])=>e.jsx(u,{variant:"outline",className:"text-xs",children:t.replace(/regenerate|add/,"").replace(/([A-Z])/g," $1").trim()},t))}),e.jsx(X,{className:"flex-1 border rounded-md",children:e.jsxs(re,{children:[e.jsx(ne,{children:e.jsxs(_,{children:[e.jsx(m,{className:"w-10"}),e.jsx(m,{children:"Page"}),e.jsx(m,{children:"Status"}),e.jsx(m,{children:"Score"}),e.jsx(m,{children:"Applied"}),e.jsx(m,{children:"Actions"})]})}),e.jsx(ie,{children:v?.map(t=>e.jsxs(e.Fragment,{children:[e.jsxs(_,{children:[e.jsx(c,{children:e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>j(t.id),children:p.has(t.id)?e.jsx(Qe,{className:"h-4 w-4"}):e.jsx(ve,{className:"h-4 w-4"})})}),e.jsx(c,{className:"font-mono text-xs max-w-[200px] truncate",children:t.page_slug}),e.jsx(c,{children:t.status==="completed"?e.jsx(W,{className:"h-4 w-4 text-teal"}):t.status==="failed"?e.jsx(Y,{className:"h-4 w-4 text-destructive"}):e.jsx(je,{className:"h-4 w-4 text-muted-foreground"})}),e.jsxs(c,{children:[t.before_score," → ",t.after_score]}),e.jsx(c,{children:t.is_applied?t.is_rolled_back?e.jsx(u,{variant:"outline",className:"text-xs",children:"Rolled Back"}):e.jsx(u,{className:"bg-teal/20 text-teal text-xs",children:"Applied"}):e.jsx(u,{variant:"outline",className:"text-xs",children:"Draft"})}),e.jsx(c,{children:t.is_applied&&!t.is_rolled_back&&e.jsxs(h,{variant:"ghost",size:"sm",className:"h-6 text-xs",onClick:()=>L.mutate(t.id),disabled:L.isPending,children:[e.jsx(ge,{className:"h-3 w-3 mr-1"}),"Rollback"]})})]},t.id),p.has(t.id)&&e.jsx(_,{children:e.jsxs(c,{colSpan:6,className:"bg-muted/50",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-muted-foreground mb-2",children:"Before"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",t.before_snapshot?.meta_title||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Desc:"})," ",t.before_snapshot?.meta_description?.slice(0,60)||"—","..."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"H1:"})," ",t.before_snapshot?.h1||"—"]})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-teal mb-2",children:"After"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Title:"})," ",t.after_snapshot?.meta_title||"—"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Desc:"})," ",t.after_snapshot?.meta_description?.slice(0,60)||"—","..."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"H1:"})," ",t.after_snapshot?.h1||"—"]})]})]}),t.error_message&&e.jsxs("p",{className:"text-destructive text-sm p-3 pt-0",children:["Error: ",t.error_message]})]})})]}))})]})}),l.apply_mode==="draft"&&v?.some(t=>!t.is_applied&&t.status==="completed")&&e.jsx("div",{className:"flex justify-end pt-2 border-t",children:e.jsxs(h,{onClick:()=>q.mutate(l.id),disabled:q.isPending,children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Apply All Pending Changes"]})})]}),e.jsx(Pe,{children:e.jsx(h,{variant:"outline",onClick:()=>k(!1),children:"Close"})})]})})]})]})}function Qs(){const[i,l]=f.useState([]),[T,r]=f.useState("operations"),k=p=>{window.open(`https://www.appointpanda.ae${p.slug}`,"_blank")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gradient-to-br from-primary to-teal flex items-center justify-center shadow-lg",children:e.jsx(Ye,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold",children:"SEO Operations Center"}),e.jsx("p",{className:"text-muted-foreground",children:"Select pages, configure regeneration, apply fixes with preview & rollback"})]})]}),e.jsxs(Le,{value:T,onValueChange:r,children:[e.jsxs(Me,{className:"grid w-full grid-cols-3",children:[e.jsxs(ee,{value:"operations",className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Operations"]}),e.jsxs(ee,{value:"history",className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"h-4 w-4"}),"History & Rollback"]}),e.jsxs(ee,{value:"diagnostics",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4"}),"Indexing Diagnostics"]})]}),e.jsx(se,{value:"operations",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-3 gap-6",children:[e.jsx("div",{className:"xl:col-span-2",children:e.jsx(rs,{selectedPages:i,onSelectionChange:l,onInspectPage:k})}),e.jsx("div",{children:e.jsx(is,{selectedPageIds:i,onJobStarted:()=>r("history")})})]})}),e.jsx(se,{value:"history",className:"mt-6",children:e.jsx(ls,{})}),e.jsx(se,{value:"diagnostics",className:"mt-6",children:e.jsxs("div",{className:"p-8 text-center text-muted-foreground border rounded-lg",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"font-medium mb-2",children:"Indexing Diagnostics"}),e.jsx("p",{className:"text-sm",children:"Select pages in the Operations tab to run indexing diagnostics - checks for canonical issues, sitemap presence, internal links, and rendered HTML content."})]})})]})]})}export{Qs as default};
