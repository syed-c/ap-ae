import{b as ke,u as le,c as ce,j as e}from"./chunk-CPh6voF3.js";import{r as g}from"./chunk-CffrGP6S.js";import{s as y,b as T,B as m,G as ae,I as h,C as R,t as Se,Q as oe,L as J,bA as de,i as v,a9 as Ce,aa as Ae,ab as Ie,ac as Te,ad as De,Z as je,P as fe,A as re,a as o,o as Pe}from"./index-DflORfjh.js";import{C as A,d as P,a as Z,b as X,c as K}from"./chunk-Dwq_v72W.js";import{S as I}from"./chunk-DfjE-bP6.js";import{T as me,a as ue,b as L,c as S,d as xe,e as _}from"./chunk-NLs5Ye4A.js";import{T as Oe,a as Ee,b as ee,c as se}from"./chunk-k8HiDHrE.js";import{S as W}from"./chunk-CzOt8Wyl.js";import{c as he}from"./chunk-BSjc5zjM.js";import{R as Me}from"./chunk-BOvFDp2b.js";import{C as H}from"./chunk-BFhD_ct7.js";import{C as pe}from"./chunk-CbEmr7WL.js";import{S as Y,A as ve}from"./chunk-C2VW2Ml6.js";import{S as Re}from"./chunk-C2HaaarX.js";import{K as $e}from"./chunk-3oqKMbN4.js";import{M as ge}from"./chunk-B7d2qnKb.js";import{C as ye}from"./chunk-j7XJPWWF.js";import{T as Le}from"./chunk-DbdCK11k.js";import{E as G}from"./chunk-Dfi7JVLs.js";import{E as B}from"./chunk-CcezodbN.js";import{S as O}from"./chunk-C7BdFRQZ.js";import{L as te}from"./chunk-CG1o0-Xj.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-I1o_Hd8I.js";import"./chunk-CyRXX0qx.js";import"./chunk-DncHrJ4I.js";import"./chunk-CbETxTmt.js";import"./chunk-BaL04tya.js";import"./chunk-GLPyMM0F.js";import"./chunk-CedtSHBb.js";import"./chunk-D2X27E5n.js";import"./chunk-Bl7VVhKV.js";import"./chunk-B_ghW3Ra.js";function Ge(){const[E,F]=g.useState({}),[Q,x]=g.useState({}),C=g.useCallback(async l=>{try{const{data:n,error:r}=await y.functions.invoke("gmb-import",{body:{action:"search",category:"dentist",city:"Dubai",radius:1e3}});return r?{key:"google_places",status:"error",message:(typeof r=="object"&&"message"in r?r.message:String(r))||"Edge function call failed",timestamp:new Date().toISOString()}:n?.success?{key:"google_places",status:"connected",message:`Google Places API (New) working — found ${n.total_found||0} results`,timestamp:new Date().toISOString()}:n?.requiresSetup?{key:"google_places",status:"not_configured",message:n.error||"API key not configured",timestamp:new Date().toISOString()}:{key:"google_places",status:"error",message:n?.error||"Unknown error from Places API",timestamp:new Date().toISOString(),details:n}}catch(n){return{key:"google_places",status:"error",message:n instanceof Error?n.message:"Network error testing API",timestamp:new Date().toISOString()}}},[]),u=g.useCallback(async l=>{try{const{data:n,error:r}=await y.functions.invoke("test-api",{body:{api:"gemini",api_key:l}});if(!r&&n?.status==="ok")return{key:"gemini",status:"connected",message:"Gemini AI API is working correctly",timestamp:new Date().toISOString()};const i=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${l}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:'Say "OK" if you can hear me'}]}]})});return i.ok?{key:"gemini",status:"connected",message:"Gemini AI API is working correctly",timestamp:new Date().toISOString()}:{key:"gemini",status:"error",message:(await i.json().catch(()=>({}))).error?.message||`HTTP ${i.status}`,timestamp:new Date().toISOString()}}catch(n){return{key:"gemini",status:"error",message:n instanceof Error?n.message:"Failed to test Gemini API",timestamp:new Date().toISOString()}}},[]),j=g.useCallback(async l=>{const r=["host","username","password","from_email"].filter(i=>!l[i]);return r.length>0?{key:"smtp",status:"not_configured",message:`Missing required fields: ${r.join(", ")}`,timestamp:new Date().toISOString()}:{key:"smtp",status:"connected",message:"SMTP settings are configured. Send a test email to verify.",timestamp:new Date().toISOString()}},[]),t=g.useCallback(async l=>{const{account_sid:n,auth_token:r}=l;if(!n||!r)return{key:"sms",status:"not_configured",message:"Account SID and Auth Token are required",timestamp:new Date().toISOString()};try{const{data:i,error:p}=await y.functions.invoke("test-api",{body:{api:"twilio",account_sid:n,auth_token:r}});return p?{key:"sms",status:"error",message:p.message||"Failed to verify Twilio credentials",timestamp:new Date().toISOString()}:i?.status==="ok"?{key:"sms",status:"connected",message:"Twilio SMS gateway is connected",timestamp:new Date().toISOString()}:{key:"sms",status:"connected",message:"Twilio credentials configured. Send test SMS to verify.",timestamp:new Date().toISOString()}}catch{return{key:"sms",status:"connected",message:"Twilio credentials saved. Test by sending an SMS.",timestamp:new Date().toISOString()}}},[]),d=g.useCallback(async l=>{const{access_token:n,phone_number_id:r}=l;if(!n||!r)return{key:"whatsapp",status:"not_configured",message:"Access Token and Phone Number ID are required",timestamp:new Date().toISOString()};try{const i=await fetch(`https://graph.facebook.com/v18.0/${r}`,{headers:{Authorization:`Bearer ${n}`}});return i.ok?{key:"whatsapp",status:"connected",message:`Connected to WhatsApp Business: ${(await i.json()).display_phone_number||"OK"}`,timestamp:new Date().toISOString()}:{key:"whatsapp",status:"error",message:(await i.json().catch(()=>({}))).error?.message||`HTTP ${i.status}`,timestamp:new Date().toISOString()}}catch(i){return{key:"whatsapp",status:"error",message:i instanceof Error?i.message:"Failed to connect",timestamp:new Date().toISOString()}}},[]),q=g.useCallback(async l=>{const{client_id:n,client_secret:r,redirect_uri:i}=l;if(!n||!r)return{key:"google_oauth",status:"not_configured",message:"Client ID and Client Secret are required",timestamp:new Date().toISOString()};const p=`${window.location.origin}/auth/callback`;return i&&i!==p?{key:"google_oauth",status:"error",message:`Redirect URI mismatch. Expected: ${p}`,timestamp:new Date().toISOString(),details:{configured:i,expected:p}}:{key:"google_oauth",status:"connected",message:'Google OAuth credentials configured. Test by clicking "Connect GMB".',timestamp:new Date().toISOString()}},[]),N=g.useCallback(async l=>{const{api_key:n,secret_key:r}=l,i=n||r;if(!i)return{key:"stripe",status:"not_configured",message:"Stripe Secret Key is required",timestamp:new Date().toISOString()};try{const{data:p,error:b}=await y.functions.invoke("test-api",{body:{api:"stripe",api_key:i}});return b?{key:"stripe",status:"error",message:b.message||"Failed to verify Stripe credentials",timestamp:new Date().toISOString()}:p?.status==="ok"?{key:"stripe",status:"connected",message:p.message||"Stripe is connected",timestamp:new Date().toISOString()}:{key:"stripe",status:"error",message:p?.message||"Failed to connect to Stripe",timestamp:new Date().toISOString()}}catch{return{key:"stripe",status:"error",message:"Failed to test Stripe connection",timestamp:new Date().toISOString()}}},[]),w=g.useCallback(async(l,n)=>{x(r=>({...r,[l]:!0}));try{let r;switch(l){case"google_places":r=await C(n.api_key);break;case"gemini":r=await u(n.api_key);break;case"smtp":r=await j(n);break;case"sms":r=await t(n);break;case"whatsapp":r=await d(n);break;case"google_oauth":r=await q(n);break;case"stripe":r=await N(n);break;case"resend":case"aimlapi":{const{data:i,error:p}=await y.functions.invoke("test-api",{body:{api:l}});p?r={key:l,status:"error",message:p.message||"Failed to test API",timestamp:new Date().toISOString()}:i?.status==="ok"?r={key:l,status:"connected",message:i.message||`${l} is working`,timestamp:new Date().toISOString()}:i?.status==="rate_limited"?r={key:l,status:"rate_limited",message:i.message||"Rate limited",timestamp:new Date().toISOString()}:r={key:l,status:"error",message:i?.message||"API test failed",timestamp:new Date().toISOString()};break}default:r={key:l,status:n.api_key||n.enabled?"connected":"not_configured",message:n.api_key?"API key configured":"Not configured",timestamp:new Date().toISOString()}}return await y.from("global_settings").upsert({key:l,value:{...n,last_test:r.timestamp,last_test_status:r.status,last_error:r.status==="error"?r.message:null}},{onConflict:"key"}),F(i=>({...i,[l]:r})),r.status==="connected"?T.success(`${l}: ${r.message}`):r.status==="error"?T.error(`${l}: ${r.message}`):T.info(`${l}: ${r.message}`),r}finally{x(r=>({...r,[l]:!1}))}},[C,u,j,t,d,q,N]),M=g.useCallback(async l=>{const n={};for(const[r,i]of Object.entries(l))i&&Object.keys(i).length>0&&(n[r]=await w(r,i));return n},[w]);return{testApi:w,testAllApis:M,testResults:E,isTesting:Q,clearResults:()=>F({})}}const V=[{id:"aimlapi",name:"AI/ML API Gateway (Primary AI)",key:"aimlapi",icon:je},{id:"google_places",name:"Google Places API",key:"google_places",icon:ae},{id:"google_reviews",name:"Google Reviews API",key:"google_reviews",icon:ge},{id:"whatsapp",name:"WhatsApp Business API",key:"whatsapp",icon:ge},{id:"sms",name:"SMS Gateway (Twilio)",key:"sms",icon:fe},{id:"resend",name:"Resend Email API",key:"resend",icon:re},{id:"smtp",name:"Email SMTP (Fallback)",key:"smtp",icon:re},{id:"stripe",name:"Stripe Payments",key:"stripe",icon:ye},{id:"search_console",name:"Google Search Console",key:"search_console",icon:ve}];function bs(){const E=ke(),[F,Q]=g.useState("status"),[x,C]=g.useState({}),[u,j]=g.useState(null),[t,d]=g.useState({}),{testApi:q,testResults:N,isTesting:w}=Ge(),{data:M,isLoading:l}=le({queryKey:["api-settings"],queryFn:async()=>{const{data:s,error:a}=await y.from("global_settings").select("*").in("key",V.map(c=>c.key));if(a)throw a;return s||[]}}),{data:n}=le({queryKey:["api-logs"],queryFn:async()=>{const{data:s,error:a}=await y.from("ai_errors").select("*").order("created_at",{ascending:!1}).limit(50);if(a)throw a;return s||[]}}),r=ce({mutationFn:async({key:s,value:a})=>{const c=M?.find(k=>k.key===s),f=a;if(c){const{error:k}=await y.from("global_settings").update({value:f,updated_at:new Date().toISOString()}).eq("id",c.id);if(k)throw k}else{const{error:k}=await y.from("global_settings").insert([{key:s,value:f}]);if(k)throw k}await he({action:"UPDATE_API_SETTINGS",entityType:"api_integration",entityId:s,newValues:{...f,api_key:"***REDACTED***"}})},onSuccess:()=>{E.invalidateQueries({queryKey:["api-settings"]}),T.success("API settings updated"),j(null),d({})},onError:s=>T.error("Failed: "+s.message)}),i=ce({mutationFn:async({key:s,enabled:a})=>{const c=M?.find(D=>D.key===s),k={...c?.value||{},enabled:a};if(c){const{error:D}=await y.from("global_settings").update({value:k,updated_at:new Date().toISOString()}).eq("id",c.id);if(D)throw D}else{const{error:D}=await y.from("global_settings").insert([{key:s,value:{enabled:a}}]);if(D)throw D}await he({action:a?"ENABLE_API":"DISABLE_API",entityType:"api_integration",entityId:s})},onSuccess:()=>{E.invalidateQueries({queryKey:["api-settings"]}),T.success("API status updated")},onError:s=>T.error("Failed: "+s.message)}),p=s=>{if(N[s])return N[s].status;const a=M?.find(f=>f.key===s);if(s==="aimlapi"){if(a){const f=a.value;if(f.last_test_status)return f.last_test_status;if(f.uses_secrets&&f.secret_key_configured)return"connected"}return"connected"}if(!a)return"not_configured";const c=a.value;return c.last_test_status?c.last_test_status:s==="stripe"&&c.uses_secrets&&c.secret_key_configured?"connected":!c.api_key&&!c.enabled&&!c.client_id&&!c.access_token&&!c.account_sid?"not_configured":c.last_error?"error":c.rate_limited?"rate_limited":"connected"},b=s=>M?.find(c=>c.key===s)?.value||{},$=V.map(s=>({...s,status:p(s.key),lastSync:N[s.key]?.timestamp||b(s.key).last_test||b(s.key).last_sync||void 0,errorMessage:N[s.key]?.message||b(s.key).last_error||void 0,isEnabled:b(s.key).enabled??!1})),_e=$.filter(s=>s.status==="connected").length,Ne=$.filter(s=>s.status==="error").length,we=$.filter(s=>s.status==="not_configured").length,ne=(s,a)=>{if(a&&w[a])return e.jsxs(v,{className:"bg-primary/20 text-primary",children:[e.jsx(J,{className:"h-3 w-3 mr-1 animate-spin"}),"Testing..."]});switch(s){case"connected":return e.jsxs(v,{className:"bg-teal/20 text-teal",children:[e.jsx(R,{className:"h-3 w-3 mr-1"}),"Connected"]});case"error":return e.jsxs(v,{variant:"destructive",children:[e.jsx(pe,{className:"h-3 w-3 mr-1"}),"Error"]});case"rate_limited":return e.jsxs(v,{className:"bg-gold/20 text-gold",children:[e.jsx(Le,{className:"h-3 w-3 mr-1"}),"Rate Limited"]});default:return e.jsx(v,{variant:"secondary",children:"Not Configured"})}},ie=async s=>{const a=b(s);await q(s,a),E.invalidateQueries({queryKey:["api-settings"]})},U=s=>{navigator.clipboard.writeText(s),T.success("Copied to clipboard")},z="https://apztvwpogywvounohqtk.supabase.co/functions/v1",be=()=>{if(!u)return null;const s=b(u);switch(u){case"aimlapi":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 rounded-xl bg-gradient-to-r from-violet-50 to-purple-50 border border-violet-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(je,{className:"h-5 w-5 text-violet-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-violet-900",children:"AI/ML API Gateway (Primary AI Service)"}),e.jsx("p",{className:"text-sm text-violet-700 mt-1",children:"This is the primary AI gateway used for all AI features including SEO, content generation, review analysis, and more."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-teal/10 border border-teal/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-4 w-4 text-teal"}),e.jsx("span",{className:"font-medium text-teal",children:"AIMLAPI_KEY"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"API key is securely stored in Lovable Cloud secrets and used by all edge functions for AI processing."})]}),e.jsx(W,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"font-medium",children:"Supported Models"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("div",{className:"p-2 rounded bg-muted/50",children:"gemini-2.0-flash"}),e.jsx("div",{className:"p-2 rounded bg-muted/50",children:"gemini-2.5-pro"}),e.jsx("div",{className:"p-2 rounded bg-muted/50",children:"gpt-4o"}),e.jsx("div",{className:"p-2 rounded bg-muted/50",children:"claude-3-5-sonnet"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(o,{className:"font-medium",children:"Used By"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(v,{variant:"secondary",children:"SEO Expert"}),e.jsx(v,{variant:"secondary",children:"SEO Bot"}),e.jsx(v,{variant:"secondary",children:"Content Optimizer"}),e.jsx(v,{variant:"secondary",children:"AI Assistant"}),e.jsx(v,{variant:"secondary",children:"Review Sentiment"}),e.jsx(v,{variant:"secondary",children:"AI Reply Generator"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{checked:t.aimlapi_enabled==="true"||t.aimlapi_enabled===void 0&&(s.enabled??!0),onCheckedChange:a=>d({...t,aimlapi_enabled:a?"true":"false"})}),e.jsx(o,{children:"Enable AI/ML API Integration"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>j(null),children:"Cancel"}),e.jsxs(m,{onClick:()=>r.mutate({key:"aimlapi",value:{uses_secrets:!0,secret_key_configured:!0,enabled:t.aimlapi_enabled==="true"||t.aimlapi_enabled===void 0&&(s.enabled??!0)}}),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]})]});case"whatsapp":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 rounded-xl bg-blue-50 border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Pe,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"WhatsApp Business API Setup"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Configure your WhatsApp Business API credentials from Meta Business Suite."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Access Token"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:x.whatsapp_token?"text":"password",value:t.whatsapp_token??s.access_token??"",onChange:a=>d({...t,whatsapp_token:a.target.value}),placeholder:"Your WhatsApp access token",className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-7 w-7 p-0",onClick:()=>C({...x,whatsapp_token:!x.whatsapp_token}),children:x.whatsapp_token?e.jsx(G,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Phone Number ID"}),e.jsx(h,{value:t.whatsapp_phone_id??s.phone_number_id??"",onChange:a=>d({...t,whatsapp_phone_id:a.target.value}),placeholder:"Your WhatsApp Phone Number ID"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Business Account ID"}),e.jsx(h,{value:t.whatsapp_business_id??s.business_account_id??"",onChange:a=>d({...t,whatsapp_business_id:a.target.value}),placeholder:"Your WhatsApp Business Account ID"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Verify Token (for webhook)"}),e.jsx(h,{value:t.whatsapp_verify_token??s.verify_token??"DUBAI_DENTAL_WHATSAPP_VERIFY",onChange:a=>d({...t,whatsapp_verify_token:a.target.value}),placeholder:"Webhook verification token"})]}),e.jsx(W,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Webhook URL (configure in Meta)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:`${z}/whatsapp-webhook`,readOnly:!0,className:"bg-muted"}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>U(`${z}/whatsapp-webhook`),children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add this URL to your WhatsApp Business Platform webhook settings"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{checked:t.whatsapp_enabled==="true"||t.whatsapp_enabled===void 0&&s.enabled,onCheckedChange:a=>d({...t,whatsapp_enabled:a?"true":"false"})}),e.jsx(o,{children:"Enable WhatsApp Integration"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>j(null),children:"Cancel"}),e.jsxs(m,{onClick:()=>r.mutate({key:"whatsapp",value:{access_token:t.whatsapp_token||s.access_token||"",phone_number_id:t.whatsapp_phone_id||s.phone_number_id||"",business_account_id:t.whatsapp_business_id||s.business_account_id||"",verify_token:t.whatsapp_verify_token||s.verify_token||"DUBAI_DENTAL_WHATSAPP_VERIFY",enabled:t.whatsapp_enabled==="true"||t.whatsapp_enabled===void 0&&s.enabled}}),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]})]});case"sms":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 rounded-xl bg-green-50 border border-green-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(fe,{className:"h-5 w-5 text-green-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-900",children:"Twilio SMS Gateway Setup"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Configure your Twilio credentials for SMS notifications."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Account SID"}),e.jsx(h,{value:t.twilio_sid??s.account_sid??"",onChange:a=>d({...t,twilio_sid:a.target.value}),placeholder:"Your Twilio Account SID"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Auth Token"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:x.twilio_token?"text":"password",value:t.twilio_token??s.auth_token??"",onChange:a=>d({...t,twilio_token:a.target.value}),placeholder:"Your Twilio Auth Token",className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-7 w-7 p-0",onClick:()=>C({...x,twilio_token:!x.twilio_token}),children:x.twilio_token?e.jsx(G,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Default Sender Number"}),e.jsx(h,{value:t.twilio_from??s.from_number??"",onChange:a=>d({...t,twilio_from:a.target.value}),placeholder:"+1234567890"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your Twilio phone number (or use Messaging Service SID)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Messaging Service SID (Optional)"}),e.jsx(h,{value:t.twilio_messaging_sid??s.messaging_service_sid??"",onChange:a=>d({...t,twilio_messaging_sid:a.target.value}),placeholder:"MGxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{checked:t.sms_enabled==="true"||t.sms_enabled===void 0&&s.enabled,onCheckedChange:a=>d({...t,sms_enabled:a?"true":"false"})}),e.jsx(o,{children:"Enable SMS Integration"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>j(null),children:"Cancel"}),e.jsxs(m,{onClick:()=>r.mutate({key:"sms",value:{account_sid:t.twilio_sid||s.account_sid||"",auth_token:t.twilio_token||s.auth_token||"",from_number:t.twilio_from||s.from_number||"",messaging_service_sid:t.twilio_messaging_sid||s.messaging_service_sid||"",enabled:t.sms_enabled==="true"||t.sms_enabled===void 0&&s.enabled}}),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]})]});case"smtp":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 rounded-xl bg-purple-50 border border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(re,{className:"h-5 w-5 text-purple-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-purple-900",children:"Email SMTP Setup"}),e.jsx("p",{className:"text-sm text-purple-700 mt-1",children:"Configure your SMTP server for sending emails."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"SMTP Host"}),e.jsx(h,{value:t.smtp_host??s.host??"",onChange:a=>d({...t,smtp_host:a.target.value}),placeholder:"smtp.example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"SMTP Port"}),e.jsx(h,{value:t.smtp_port??s.port??"587",onChange:a=>d({...t,smtp_port:a.target.value}),placeholder:"587"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Username"}),e.jsx(h,{value:t.smtp_user??s.username??"",onChange:a=>d({...t,smtp_user:a.target.value}),placeholder:"your-email@example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:x.smtp_pass?"text":"password",value:t.smtp_pass??s.password??"",onChange:a=>d({...t,smtp_pass:a.target.value}),placeholder:"Your SMTP password",className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-7 w-7 p-0",onClick:()=>C({...x,smtp_pass:!x.smtp_pass}),children:x.smtp_pass?e.jsx(G,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"From Email"}),e.jsx(h,{value:t.smtp_from??s.from_email??"",onChange:a=>d({...t,smtp_from:a.target.value}),placeholder:"noreply@yourdomain.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"From Name"}),e.jsx(h,{value:t.smtp_from_name??s.from_name??"",onChange:a=>d({...t,smtp_from_name:a.target.value}),placeholder:"Appoint Panda"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{checked:t.smtp_enabled==="true"||t.smtp_enabled===void 0&&s.enabled,onCheckedChange:a=>d({...t,smtp_enabled:a?"true":"false"})}),e.jsx(o,{children:"Enable Email Integration"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>j(null),children:"Cancel"}),e.jsxs(m,{onClick:()=>r.mutate({key:"smtp",value:{host:t.smtp_host||s.host||"",port:t.smtp_port||s.port||"587",username:t.smtp_user||s.username||"",password:t.smtp_pass||s.password||"",from_email:t.smtp_from||s.from_email||"",from_name:t.smtp_from_name||s.from_name||"",enabled:t.smtp_enabled==="true"||t.smtp_enabled===void 0&&s.enabled}}),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]})]});case"google_oauth":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 rounded-xl bg-blue-50 border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"h-5 w-5 text-blue-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-blue-900",children:"Google OAuth Setup"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Configure your Google OAuth credentials for GMB synchronization."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Client ID"}),e.jsx(h,{value:t.google_client_id??s.client_id??"",onChange:a=>d({...t,google_client_id:a.target.value}),placeholder:"xxx.apps.googleusercontent.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Client Secret"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:x.google_secret?"text":"password",value:t.google_client_secret??s.client_secret??"",onChange:a=>d({...t,google_client_secret:a.target.value}),placeholder:"Your client secret",className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-7 w-7 p-0",onClick:()=>C({...x,google_secret:!x.google_secret}),children:x.google_secret?e.jsx(G,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})]})]}),e.jsx(W,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Callback URL (configure in Google Cloud Console)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:`${window.location.origin}/auth/callback`,readOnly:!0,className:"bg-muted"}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>U(`${window.location.origin}/auth/callback`),children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add this URL as an authorized redirect URI in your Google Cloud Console OAuth credentials"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{checked:t.google_oauth_enabled==="true"||t.google_oauth_enabled===void 0&&s.enabled,onCheckedChange:a=>d({...t,google_oauth_enabled:a?"true":"false"})}),e.jsx(o,{children:"Enable Google OAuth Integration"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>j(null),children:"Cancel"}),e.jsxs(m,{onClick:()=>{r.mutate({key:"google_oauth",value:{client_id:t.google_client_id||s.client_id||"",client_secret:t.google_client_secret||s.client_secret||"",redirect_uri:`${window.location.origin}/auth/callback`,enabled:t.google_oauth_enabled==="true"||t.google_oauth_enabled===void 0&&s.enabled}})},children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]})]});case"stripe":return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"p-4 rounded-xl bg-violet-50 border border-violet-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ye,{className:"h-5 w-5 text-violet-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-violet-900",children:"Stripe Payment Gateway"}),e.jsx("p",{className:"text-sm text-violet-700 mt-1",children:"Stripe credentials are securely stored in Lovable Cloud secrets."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-teal/10 border border-teal/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-4 w-4 text-teal"}),e.jsx("span",{className:"font-medium text-teal",children:"STRIPE_SECRET_KEY"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Secret key is configured securely and used by edge functions for payment processing."})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-teal/10 border border-teal/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(R,{className:"h-4 w-4 text-teal"}),e.jsx("span",{className:"font-medium text-teal",children:"STRIPE_WEBHOOK_SECRET"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Webhook secret is configured for secure event verification."})]}),e.jsx(W,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4"}),"Webhook URL (configure in Stripe Dashboard)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{value:`${z}/stripe-webhook`,readOnly:!0,className:"bg-muted"}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>U(`${z}/stripe-webhook`),children:e.jsx(H,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Add this URL in your Stripe Dashboard → Developers → Webhooks"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{checked:t.stripe_enabled==="true"||t.stripe_enabled===void 0&&s.enabled,onCheckedChange:a=>d({...t,stripe_enabled:a?"true":"false"})}),e.jsx(o,{children:"Enable Stripe Payments"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>j(null),children:"Cancel"}),e.jsxs(m,{onClick:()=>r.mutate({key:"stripe",value:{uses_secrets:!0,secret_key_configured:!0,webhook_secret_configured:!0,enabled:t.stripe_enabled==="true"||t.stripe_enabled===void 0&&s.enabled}}),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]})]});default:return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"API Key / Token"}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{type:x[u]?"text":"password",value:t[`${u}_key`]??s.api_key??"",onChange:a=>d({...t,[`${u}_key`]:a.target.value}),placeholder:"Enter API key...",className:"pr-10"}),e.jsx(m,{type:"button",variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-7 w-7 p-0",onClick:()=>C({...x,[u]:!x[u]}),children:x[u]?e.jsx(G,{className:"h-4 w-4"}):e.jsx(B,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"Endpoint URL (Optional)"}),e.jsx(h,{value:t[`${u}_url`]??s.endpoint_url??"",onChange:a=>d({...t,[`${u}_url`]:a.target.value}),placeholder:"https://api.example.com"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{checked:t[`${u}_enabled`]==="true"||t[`${u}_enabled`]===void 0&&s.enabled,onCheckedChange:a=>d({...t,[`${u}_enabled`]:a?"true":"false"})}),e.jsx(o,{children:"Enable Integration"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(m,{variant:"outline",onClick:()=>j(null),children:"Cancel"}),e.jsxs(m,{onClick:()=>r.mutate({key:u,value:{api_key:t[`${u}_key`]||s.api_key||"",endpoint_url:t[`${u}_url`]||s.endpoint_url||"",enabled:t[`${u}_enabled`]==="true"||t[`${u}_enabled`]===void 0&&s.enabled}}),children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Save Settings"]})]})]})}};return l?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"API & Integrations"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Monitor and configure external API connections"})]}),e.jsxs(m,{variant:"outline",onClick:()=>E.invalidateQueries({queryKey:["api-settings"]}),children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Refresh Status"]})]}),e.jsx(A,{className:"card-modern border-primary/20 bg-primary/5 mb-6",children:e.jsxs(P,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(ae,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Google OAuth Callback URL"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Required for GMB OAuth integration"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{value:`${window.location.origin}/auth/callback`,readOnly:!0,className:"w-80 bg-background text-sm"}),e.jsx(m,{variant:"outline",size:"icon",onClick:()=>U(`${window.location.origin}/auth/callback`),children:e.jsx(H,{className:"h-4 w-4"})})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-3 pl-13",children:"Add this URL as an authorized redirect URI in your Google Cloud Console OAuth 2.0 credentials"})]})}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(A,{className:"card-modern",children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal-light flex items-center justify-center",children:e.jsx(R,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:_e}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Connected"})]})]})}),e.jsx(A,{className:"card-modern",children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-coral-light flex items-center justify-center",children:e.jsx(pe,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:Ne}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Errors"})]})]})}),e.jsx(A,{className:"card-modern",children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-muted flex items-center justify-center",children:e.jsx(Y,{className:"h-6 w-6 text-muted-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:we}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not Configured"})]})]})}),e.jsx(A,{className:"card-modern",children:e.jsxs(P,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(Re,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:V.length}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total APIs"})]})]})})]}),e.jsxs(Oe,{value:F,onValueChange:Q,children:[e.jsxs(Ee,{className:"grid w-full grid-cols-3 rounded-xl",children:[e.jsxs(ee,{value:"status",className:"rounded-xl",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Status Overview"]}),e.jsxs(ee,{value:"configure",className:"rounded-xl",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Configure APIs"]}),e.jsxs(ee,{value:"logs",className:"rounded-xl",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Error Logs"]})]}),e.jsx(se,{value:"status",className:"mt-4",children:e.jsxs(A,{className:"card-modern",children:[e.jsxs(Z,{children:[e.jsx(X,{className:"text-lg",children:"API Status Dashboard"}),e.jsx(K,{children:"Real-time status of all external integrations"})]}),e.jsx(P,{className:"p-0",children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(L,{children:[e.jsx(S,{children:"API"}),e.jsx(S,{children:"Status"}),e.jsx(S,{children:"Last Sync"}),e.jsx(S,{children:"Enabled"}),e.jsx(S,{className:"text-right",children:"Actions"})]})}),e.jsx(xe,{children:$.map(s=>{const a=s.icon,c=N[s.key];return e.jsxs(L,{children:[e.jsx(_,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-muted flex items-center justify-center",children:e.jsx(a,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.key}),s.status==="error"&&s.errorMessage&&e.jsx("p",{className:"text-xs text-coral mt-0.5 max-w-xs truncate",children:s.errorMessage})]})]})}),e.jsx(_,{children:e.jsxs("div",{className:"flex flex-col gap-1",children:[ne(s.status,s.key),c&&e.jsx("p",{className:"text-[10px] text-muted-foreground max-w-[150px] truncate",children:c.message})]})}),e.jsx(_,{className:"text-muted-foreground",children:s.lastSync?oe(new Date(s.lastSync),"MMM d, HH:mm"):"Never"}),e.jsx(_,{children:e.jsx(I,{checked:s.isEnabled,onCheckedChange:f=>i.mutate({key:s.key,enabled:f})})}),e.jsx(_,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-1 justify-end",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>ie(s.key),disabled:w[s.key],children:w[s.key]?e.jsx(J,{className:"h-4 w-4 animate-spin"}):e.jsx(de,{className:"h-4 w-4"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>j(s.key),children:e.jsx(Y,{className:"h-4 w-4"})})]})})]},s.id)})})]})})]})}),e.jsx(se,{value:"configure",className:"mt-4 space-y-4",children:$.map(s=>{const a=s.icon,c=N[s.key];return e.jsx(A,{className:"card-modern",children:e.jsx(Z,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-xl bg-muted flex items-center justify-center",children:e.jsx(a,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(X,{className:"text-lg",children:s.name}),e.jsxs(K,{children:[s.key,c&&e.jsxs("span",{className:`ml-2 text-xs ${c.status==="connected"?"text-teal":c.status==="error"?"text-coral":"text-muted-foreground"}`,children:["— ",c.message]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ne(s.status,s.key),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>ie(s.key),disabled:w[s.key],children:[w[s.key]?e.jsx(J,{className:"h-4 w-4 animate-spin mr-2"}):e.jsx(de,{className:"h-4 w-4 mr-2"}),"Test"]}),e.jsxs(m,{size:"sm",onClick:()=>j(s.key),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Configure"]})]})]})})},s.id)})}),e.jsx(se,{value:"logs",className:"mt-4",children:e.jsxs(A,{className:"card-modern",children:[e.jsxs(Z,{children:[e.jsx(X,{className:"text-lg",children:"API Error Logs"}),e.jsx(K,{children:"Recent errors from external API calls"})]}),e.jsx(P,{className:"p-0",children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(L,{children:[e.jsx(S,{children:"Time"}),e.jsx(S,{children:"Error Code"}),e.jsx(S,{children:"Message"}),e.jsx(S,{children:"Context"})]})}),e.jsxs(xe,{children:[n?.map(s=>e.jsxs(L,{children:[e.jsx(_,{className:"text-muted-foreground",children:s.created_at?oe(new Date(s.created_at),"MMM d, HH:mm:ss"):"-"}),e.jsx(_,{children:e.jsx(v,{variant:"destructive",children:s.error_code||"UNKNOWN"})}),e.jsx(_,{className:"max-w-xs truncate",children:s.error_message}),e.jsx(_,{className:"text-xs text-muted-foreground max-w-xs truncate",children:s.context_data?JSON.stringify(s.context_data).slice(0,50):"-"})]},s.id)),(!n||n.length===0)&&e.jsx(L,{children:e.jsxs(_,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:[e.jsx(R,{className:"h-12 w-12 mx-auto mb-3 opacity-50 text-teal"}),e.jsx("p",{children:"No recent API errors"})]})})]})]})})]})})]}),e.jsx(Ce,{open:!!u,onOpenChange:s=>!s&&j(null),children:e.jsxs(Ae,{className:"max-w-lg",children:[e.jsxs(Ie,{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"h-5 w-5"}),"Configure ",V.find(s=>s.key===u)?.name]}),e.jsx(De,{children:"Enter your API credentials to enable this integration"})]}),be()]})})]})}export{bs as default};
