import{u as w,j as e}from"./chunk-CPh6voF3.js";import{L as K}from"./chunk-Drd-rt-S.js";import{q as V,B as c,T as L,a9 as W,bc as Y,aa as J,ab as X,ac as Z,n as S,I,C as ee,i as se,Q as F,$ as ae,b as M,s as k,u as te,w as re}from"./index-DflORfjh.js";import{S as q}from"./chunk-CQtADEjB.js";import{r as N}from"./chunk-CffrGP6S.js";import{C as t,d as r,a as h,b as u}from"./chunk-Dwq_v72W.js";import{T as le,a as ie,b as v,c as b}from"./chunk-k8HiDHrE.js";import{a as ne}from"./chunk-DR0VO1o8.js";import{a as ce,u as de}from"./chunk-Dq1MrkKO.js";import{Q as oe}from"./chunk-I5uVO93-.js";import{L as me}from"./chunk-CG1o0-Xj.js";import{E as xe}from"./chunk-CcezodbN.js";import{T as p,a as y}from"./chunk-BLd3XU4A.js";import{C as he}from"./chunk-BFhD_ct7.js";import{E as ue}from"./chunk-CbETxTmt.js";import{C as pe}from"./chunk-wy0nNZZG.js";import{M as je}from"./chunk-B7d2qnKb.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";import"./chunk-DfjE-bP6.js";import"./chunk-Beq7cUgv.js";import"./chunk-C8UDNHIm.js";import"./chunk-z-mlRDN4.js";import"./chunk-DZK1lt0q.js";import"./chunk-BcKWIjsB.js";import"./chunk-z7Kqt5JR.js";import"./chunk-C2VW2Ml6.js";import"./chunk-C7BdFRQZ.js";function fe({clinicId:a,clinicName:i,googlePlaceId:o}){const[j,m]=N.useState("overview"),[P,D]=N.useState(!1),[A,C]=N.useState(!1),{hasAccess:H,isLoading:G}=ce(a,"review_manager"),{data:Q}=de(a),{data:E}=w({queryKey:["clinic-slug",a],queryFn:async()=>{const{data:s,error:l}=await k.from("clinics").select("slug").eq("id",a).single();if(l)throw l;return s}}),U=E?.slug||a,R=`${window.location.origin}/review/${a}/`,_=o?`https://search.google.com/local/writereview?placeid=${o}`:null,{data:n=[],isLoading:$}=w({queryKey:["review-funnel",a],queryFn:async()=>{const{data:s,error:l}=await k.from("review_funnel_events").select("*").eq("clinic_id",a).order("created_at",{ascending:!1}).limit(100);if(l)throw l;return s||[]}}),T=async()=>{try{await navigator.clipboard.writeText(R),C(!0),M.success("Link copied to clipboard"),setTimeout(()=>C(!1),2e3)}catch{M.error("Failed to copy link")}},d=n?.length||0,x=n?.filter(s=>s.event_type==="thumbs_up").length||0,O=n?.filter(s=>s.event_type==="thumbs_down").length||0,z=n?.filter(s=>s.rating).reduce((s,l,g,B)=>s+(l.rating||0)/B.length,0)||0,f=n?.filter(s=>s.event_type==="thumbs_down")||[];return!G&&!H?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold",children:"Review Manager"}),e.jsx("p",{className:"text-muted-foreground",children:"Collect and manage patient feedback"})]})}),e.jsx(t,{className:"border-2 border-dashed border-primary/30 bg-primary/5",children:e.jsxs(r,{className:"py-12 text-center",children:[e.jsx("div",{className:"h-16 w-16 rounded-2xl bg-primary/10 flex items-center justify-center mx-auto mb-4",children:e.jsx(V,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Upgrade to Access Review Manager"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto mb-6",children:"The Review Manager helps you collect Google reviews, capture private feedback, and send bulk review requests via SMS/WhatsApp. Available on Verified and Pro plans."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[e.jsxs(c,{size:"lg",className:"gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),"Upgrade Now"]}),e.jsx(c,{variant:"outline",size:"lg",children:"View Plans"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-4",children:["Current plan: ",Q?.plan?.name||"Free"]})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold",children:"Review Manager"}),e.jsxs("p",{className:"text-muted-foreground",children:["Collect and manage patient feedback for ",i]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(W,{open:P,onOpenChange:D,children:[e.jsx(Y,{asChild:!0,children:e.jsxs(c,{variant:"outline",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Get QR Code"]})}),e.jsxs(J,{className:"max-w-2xl",children:[e.jsx(X,{children:e.jsx(Z,{children:"Review QR Code"})}),e.jsx(ne,{clinicName:i,clinicSlug:U,googlePlaceId:o})]})]}),e.jsxs(c,{onClick:T,children:[e.jsx(me,{className:"h-4 w-4 mr-2"}),"Copy Review Link"]})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsx(t,{className:"card-modern",children:e.jsxs(r,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-primary/10 flex items-center justify-center",children:e.jsx(xe,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:d}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Responses"})]})]})}),e.jsx(t,{className:"card-modern",children:e.jsxs(r,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-teal-light flex items-center justify-center",children:e.jsx(p,{className:"h-6 w-6 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:x}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Happy Patients"})]})]})}),e.jsx(t,{className:"card-modern",children:e.jsxs(r,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-coral-light flex items-center justify-center",children:e.jsx(y,{className:"h-6 w-6 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:O}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Needs Attention"})]})]})}),e.jsx(t,{className:"card-modern",children:e.jsxs(r,{className:"p-4 flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gold-light flex items-center justify-center",children:e.jsx(S,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold",children:z.toFixed(1)}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg Rating (Private)"})]})]})})]}),e.jsx(t,{className:"card-modern border-primary/20 bg-primary/5",children:e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-display font-bold text-lg",children:"Your Review Collection Link"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Share this link with patients to collect reviews. Happy patients go to Google, unhappy patients give private feedback."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{value:R,readOnly:!0,className:"w-80 bg-background"}),e.jsx(c,{onClick:T,children:A?e.jsx(ee,{className:"h-4 w-4"}):e.jsx(he,{className:"h-4 w-4"})}),_&&e.jsx(c,{variant:"outline",asChild:!0,children:e.jsx("a",{href:_,target:"_blank",rel:"noopener noreferrer",children:e.jsx(ue,{className:"h-4 w-4"})})})]})]})})}),e.jsxs(le,{value:j,onValueChange:m,children:[e.jsxs(ie,{className:"grid w-full grid-cols-3 rounded-xl",children:[e.jsx(v,{value:"overview",className:"rounded-xl",children:"Overview"}),e.jsx(v,{value:"feedback",className:"rounded-xl",children:"Private Feedback"}),e.jsx(v,{value:"funnel",className:"rounded-xl",children:"Funnel Analytics"})]}),e.jsx(b,{value:"overview",className:"mt-4",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(t,{className:"card-modern",children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"How It Works"]})}),e.jsxs(r,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-bold text-primary",children:"1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Patient Opens Link"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Share the link via SMS, email, or QR code"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"font-bold text-primary",children:"2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Thumbs Up or Down"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Patient indicates their satisfaction"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-teal-light flex items-center justify-center flex-shrink-0",children:e.jsx(p,{className:"h-4 w-4 text-teal"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Happy → Google Review"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Redirected to leave a public Google review"})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-coral-light flex items-center justify-center flex-shrink-0",children:e.jsx(y,{className:"h-4 w-4 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Unhappy → Private Feedback"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Captures feedback privately for you to address"})]})]})]})]}),e.jsxs(t,{className:"card-modern",children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5"}),"Funnel Performance"]})}),e.jsx(r,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Conversion Rate"}),e.jsxs("span",{className:"font-bold text-teal",children:[d>0?(x/d*100).toFixed(0):0,"%"]})]}),e.jsx("div",{className:"h-4 rounded-full bg-muted overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-teal to-primary rounded-full transition-all",style:{width:`${d>0?x/d*100:0}%`}})}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[x," out of ",d," patients directed to Google"]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("p",{className:"font-medium mb-2",children:"Tips to Improve"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• Send link right after appointment"}),e.jsx("li",{children:"• Include personalized message"}),e.jsx("li",{children:"• Follow up on private feedback quickly"})]})]})]})})]})]})}),e.jsx(b,{value:"feedback",className:"mt-4",children:e.jsxs(t,{className:"card-modern",children:[e.jsx(h,{children:e.jsxs(u,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5"}),"Private Feedback (",f.length,")"]})}),e.jsx(r,{children:f.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(p,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No negative feedback yet. Great job!"})]}):e.jsx("div",{className:"space-y-4",children:f.map(s=>e.jsxs("div",{className:"p-4 rounded-xl bg-muted/50 border border-border",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.rating&&e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:5}).map((l,g)=>e.jsx(S,{className:`h-4 w-4 ${g<s.rating?"text-gold fill-gold":"text-muted"}`},g))}),e.jsx(se,{variant:"outline",className:"capitalize",children:s.source})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:F(new Date(s.created_at),"MMM d, yyyy HH:mm")})]}),s.comment&&e.jsx("p",{className:"mt-3 text-sm",children:s.comment})]},s.id))})})]})}),e.jsx(b,{value:"funnel",className:"mt-4",children:e.jsxs(t,{className:"card-modern",children:[e.jsx(h,{children:e.jsx(u,{children:"Recent Activity"})}),e.jsx(r,{children:$?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):n?.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(ae,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"No funnel activity yet. Share your review link to get started!"})]}):e.jsx("div",{className:"space-y-3",children:n?.slice(0,20).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.event_type==="thumbs_up"?e.jsx("div",{className:"h-8 w-8 rounded-full bg-teal-light flex items-center justify-center",children:e.jsx(p,{className:"h-4 w-4 text-teal"})}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-coral-light flex items-center justify-center",children:e.jsx(y,{className:"h-4 w-4 text-coral"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.event_type==="thumbs_up"?"Redirected to Google":"Private Feedback"}),e.jsxs("p",{className:"text-xs text-muted-foreground capitalize",children:["via ",s.source]})]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:F(new Date(s.created_at),"MMM d, HH:mm")})]},s.id))})})]})})]})]})}function Ye(){const{user:a}=te(),{data:i,isLoading:o}=w({queryKey:["dentist-clinic-reviews",a?.id],queryFn:async()=>{const{data:j,error:m}=await k.from("clinics").select("id, name, google_place_id").eq("claimed_by",a?.id).limit(1).single();if(m&&m.code!=="PGRST116")throw m;return j},enabled:!!a?.id});return o?e.jsxs("div",{className:"space-y-6",children:[e.jsx(q,{className:"h-12"}),e.jsx(q,{className:"h-64"})]}):i?e.jsx(fe,{clinicId:i.id,clinicName:i.name,googlePlaceId:i.google_place_id||void 0}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(re,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"No Practice Linked"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Please claim your practice profile first."}),e.jsx(c,{asChild:!0,children:e.jsx(K,{to:"/claim-profile",children:"Claim Your Profile"})})]})}export{Ye as default};
