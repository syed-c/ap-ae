import{b as Q,u as j,c as U,j as e}from"./chunk-CPh6voF3.js";import{r as f}from"./chunk-CffrGP6S.js";import{f as G,a2 as q,a3 as k,x as T,a5 as A,a6 as I,a7 as p,w as D,B as g,i as y,n as J,s as d,b as F}from"./index-DflORfjh.js";import{C as N,d as w,a as W,b as X,c as Y}from"./chunk-Dwq_v72W.js";import{T as Z,a as ee,b,c as u,d as se,e as o}from"./chunk-NLs5Ye4A.js";import{c as ae}from"./chunk-BSjc5zjM.js";import{S as te}from"./chunk-C7BdFRQZ.js";import{P as v}from"./chunk-BrfF1Wgp.js";import{R as ne}from"./chunk-BOvFDp2b.js";import{A as ie,a as le}from"./chunk-BRjFAgpB.js";import"./chunk-B8auUmee.js";import"./chunk-DK8nT4cj.js";import"./chunk-Drd-rt-S.js";import"./chunk-BEQ5VEiB.js";import"./chunk-yff5u8mE.js";import"./chunk-xExVBHTi.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=G("PinOff",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M15 9.34V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H7.89",key:"znwnzq"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v1.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h11",key:"c9qhm2"}]]);function ve(){const O=Q(),[i,$]=f.useState(""),[r,_]=f.useState(""),[l,m]=f.useState([]),[M,x]=f.useState(!1),{data:S}=j({queryKey:["cities-for-top"],queryFn:async()=>{const{data:s}=await d.from("cities").select("id, name, slug").eq("is_active",!0).order("name");return s||[]}}),{data:h}=j({queryKey:["areas-for-top",i],queryFn:async()=>{const{data:s}=await d.from("areas").select("id, name, slug").eq("city_id",i).eq("is_active",!0).order("name");return s||[]},enabled:!!i}),c=r?`pinned_clinics_${i}_${r}`:`pinned_clinics_${i}`;j({queryKey:["pinned-clinics",c],queryFn:async()=>{const{data:s}=await d.from("global_settings").select("value").eq("key",c).maybeSingle(),a=s?.value||[];return m(a),a},enabled:!!i});const{data:V,isLoading:z}=j({queryKey:["clinics-for-pinning",i,r],queryFn:async()=>{let s=d.from("clinics").select("id, name, slug, rating, review_count, verification_status, claim_status, area:areas(name)").eq("city_id",i).eq("is_active",!0);r&&(s=s.eq("area_id",r));const{data:a}=await s.order("verification_status",{ascending:!1}).order("rating",{ascending:!1}).limit(50);return a||[]},enabled:!!i}),P=U({mutationFn:async()=>{const{data:s}=await d.from("global_settings").select("id").eq("key",c).maybeSingle();if(s){const{error:a}=await d.from("global_settings").update({value:l,updated_at:new Date().toISOString()}).eq("key",c);if(a)throw a}else{const{error:a}=await d.from("global_settings").insert([{key:c,value:l}]);if(a)throw a}await ae({action:"UPDATE_PINNED_CLINICS",entityType:"global_settings",entityId:c,newValues:{pinned_clinics:l,area:r||null}})},onSuccess:()=>{O.invalidateQueries({queryKey:["pinned-clinics",c]}),F.success("Pinned clinics saved"),x(!1)},onError:s=>F.error("Failed: "+s.message)}),K=s=>{$(s),_(""),m([]),x(!1)},B=s=>{m(a=>{const t=a.includes(s)?a.filter(n=>n!==s):a.length<10?[...a,s]:a;return x(!0),t})},E=s=>{m(a=>{const t=a.indexOf(s);if(t<=0)return a;const n=[...a];return[n[t-1],n[t]]=[n[t],n[t-1]],x(!0),n})},H=s=>{m(a=>{const t=a.indexOf(s);if(t<0||t>=a.length-1)return a;const n=[...a];return[n[t],n[t+1]]=[n[t+1],n[t]],x(!0),n})},L=()=>{m([]),x(!0)},R=V?.slice().sort((s,a)=>{const t=l.indexOf(s.id),n=l.indexOf(a.id);return t>=0&&n<0?-1:n>=0&&t<0?1:t>=0&&n>=0?t-n:(a.rating||0)-(s.rating||0)})||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-display font-bold text-foreground",children:"Top Dentists Selection"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manually select Top 10 clinics per city or area"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(q,{value:i,onValueChange:K,children:[e.jsxs(k,{className:"w-48 bg-background",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),e.jsx(A,{placeholder:"Select city..."})]}),e.jsx(I,{className:"bg-background",children:S?.map(s=>e.jsx(p,{value:s.id,children:s.name},s.id))})]}),i&&h&&h.length>0&&e.jsxs(q,{value:r||"all",onValueChange:s=>_(s==="all"?"":s),children:[e.jsxs(k,{className:"w-48 bg-background",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),e.jsx(A,{placeholder:"All areas"})]}),e.jsxs(I,{className:"bg-background",children:[e.jsx(p,{value:"all",children:"All Areas (City-wide)"}),h.map(s=>e.jsx(p,{value:s.id,children:s.name},s.id))]})]}),M&&e.jsxs(g,{onClick:()=>P.mutate(),disabled:P.isPending,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Save Changes"]})]})]}),i?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"card-modern",children:e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 rounded-xl bg-gold-light flex items-center justify-center",children:e.jsx(v,{className:"h-6 w-6 text-gold"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold",children:[l.length," / 10 Pinned"]}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[r?`Area: ${h?.find(s=>s.id===r)?.name}`:"City-wide pins"," • ",l.length<10?`${10-l.length} slots available`:"Maximum reached"]})]})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:L,disabled:l.length===0,children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Clear All"]})]})})}),e.jsxs(N,{className:"card-modern",children:[e.jsxs(W,{children:[e.jsxs(X,{className:"text-lg",children:["Clinics in ",S?.find(s=>s.id===i)?.name,r&&` › ${h?.find(s=>s.id===r)?.name}`]}),e.jsxs(Y,{children:["Pinned clinics will appear at the top of search results for this ",r?"area":"city"]})]}),e.jsx(w,{className:"p-0",children:e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsxs(b,{children:[e.jsx(u,{className:"w-12",children:"#"}),e.jsx(u,{children:"Clinic"}),e.jsx(u,{children:"Rating"}),e.jsx(u,{children:"Status"}),e.jsx(u,{children:"Pinned"}),e.jsx(u,{className:"text-right",children:"Actions"})]})}),e.jsx(se,{children:z?e.jsx(b,{children:e.jsx(o,{colSpan:6,className:"text-center py-8",children:e.jsx(ne,{className:"h-6 w-6 animate-spin mx-auto"})})}):R.map((s,a)=>{const t=l.includes(s.id),n=l.indexOf(s.id);return e.jsxs(b,{className:t?"bg-gold/5":"",children:[e.jsx(o,{className:"font-bold",children:t?e.jsx(y,{className:"bg-gold text-white",children:n+1}):e.jsx("span",{className:"text-muted-foreground",children:a+1})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`h-10 w-10 rounded-xl flex items-center justify-center ${t?"bg-gold/10":"bg-muted"}`,children:e.jsx(D,{className:`h-5 w-5 ${t?"text-gold":"text-muted-foreground"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.slug})]})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-4 w-4 text-gold fill-gold"}),e.jsx("span",{className:"font-medium",children:s.rating||0}),e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",s.review_count||0,")"]})]})}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-1",children:[s.verification_status==="verified"&&e.jsx(y,{className:"bg-teal/20 text-teal text-xs",children:"Verified"}),s.claim_status==="claimed"&&e.jsx(y,{variant:"outline",className:"text-xs",children:"Claimed"})]})}),e.jsx(o,{children:t?e.jsx(v,{className:"h-4 w-4 text-gold fill-gold"}):e.jsx(C,{className:"h-4 w-4 text-muted-foreground"})}),e.jsx(o,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-1",children:[t&&e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>E(s.id),disabled:n===0,children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(g,{variant:"ghost",size:"sm",onClick:()=>H(s.id),disabled:n===l.length-1,children:e.jsx(le,{className:"h-4 w-4"})})]}),e.jsx(g,{variant:t?"default":"outline",size:"sm",onClick:()=>B(s.id),disabled:!t&&l.length>=10,children:t?e.jsx(C,{className:"h-4 w-4"}):e.jsx(v,{className:"h-4 w-4"})})]})})]},s.id)})})]})})]})]}):e.jsx(N,{className:"card-modern",children:e.jsxs(w,{className:"py-12 text-center text-muted-foreground",children:[e.jsx(T,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Select a city to manage top clinics"})]})})]})}export{ve as default};
